'use strict';

/*eslint angular/file-name: 0*/
(function () {
  'use strict';

  angular.module('app', ['ngAnimate', 'ngAria', 'ui.router', 'ngC2', 'ui.utils.masks', 'text-mask', 'ngMaterial', 'modelFactory', 'md.data.table', 'ngMaterialDatePicker', 'pascalprecht.translate', 'angularFileUpload', 'ngMaterial', 'ngAnimate', 'ngMessages', 'ngAria', 'ui.router', 'lfNgMdFileInput', 'nemLogging', 'ui-leaflet', 'ng-sortable']);
})();
'use strict';

(function () {
    'use strict';

    config.$inject = ["Global", "$mdThemingProvider", "$modelFactoryProvider", "$translateProvider", "moment", "$mdAriaProvider", "$windowProvider"];
    angular.module('app').config(config);

    /** @ngInject */
    // eslint-disable-next-line max-params
    function config(Global, $mdThemingProvider, $modelFactoryProvider, $translateProvider, moment, $mdAriaProvider, $windowProvider) {

        $translateProvider.useLoader('languageLoader').useSanitizeValueStrategy('escape');

        //$translateProvider.usePostCompiling(true);

        moment.locale('en-GB');

        //the prefix to be used in all back-end api requests
        var $window = $windowProvider.$get();
        $modelFactoryProvider.defaultOptions.prefix = Global.apiPath;

        // Configuration theme - see: https://material.angularjs.org/latest/Theming/03_configuring_a_theme
        $mdThemingProvider.theme('default').primaryPalette('blue', {
            default: '700'
        }).accentPalette('indigo').warnPalette('deep-orange');

        // Enable browser color
        $mdThemingProvider.enableBrowserColor();

        $mdAriaProvider.disableWarnings();
    }
})();
'use strict';

(function () {

    'use strict';

    AppController.$inject = ["$state", "Global", "$localStorage"];
    angular.module('app').controller('AppController', AppController);

    /** @ngInject */
    /**
     * Controller responsible for functionalities that are used in any system state/page
     */
    function AppController($state, Global, $localStorage) {
        var vm = this;

        // Current year to be shown in the footer
        vm.currentYear = null;
        activate();

        function activate() {
            var date = new Date();
            vm.currentYear = date.getFullYear();
        }

        sessionStorage.clear();
        sessionStorage.setItem("role", "admin");
        if (sessionStorage.getItem("role") === "admin") {
            sessionStorage.setItem("role", "1");
        } else if (sessionStorage.getItem("role") === "senior") {
            sessionStorage.setItem("role", "2");
        } else if (sessionStorage.getItem("role") === "user") {
            sessionStorage.setItem("role", "3");
        } else if (sessionStorage.getItem("role") === "guest") {
            sessionStorage.setItem("role", "4");
        }

        // console.log("appcontroller ", $localStorage);
        sessionStorage.setItem("projId", "31024283");
        sessionStorage.setItem("userId", "1000");
    }
})();
'use strict';

/*eslint angular/file-name: 0, no-undef: 0*/
(function () {
  'use strict';

  /**
   * Transforms external libs in angular services so we can use them with dependence injection
   */

  angular.module('app').constant('lodash', _).constant('moment', moment).constant('leaflet', L);
})();
'use strict';

(function () {
  'use strict';

  angular.module('app').constant('Global', {
    appName: 'HeiMAP',
    imagePath: '/images',
    clientPath: '/webapp/app',
    homeState: 'app.map',
    homeUrl: '/map',
    apiPath: ''
  });
})();
'use strict';

(function () {
  'use strict';

  routes.$inject = ["$stateProvider", "$urlRouterProvider", "Global"];
  angular.module('app').config(routes);

  /** @ngInject */
  function routes($stateProvider, $urlRouterProvider, Global) {
    $stateProvider.state('app', {
      templateUrl: Global.clientPath + '/shared/partials/app.html',
      abstract: true,
      resolve: { //ensure langs is ready before render view
        translateReady: ['$translate', '$q', function ($translate, $q) {
          var deferred = $q.defer();

          $translate.use('en-GB').then(function () {
            deferred.resolve();
          });

          return deferred.promise;
        }]
      }
    });

    $urlRouterProvider.when('/app', Global.homeUrl);
    $urlRouterProvider.otherwise(Global.homeUrl);
  }
})();
'use strict';

(function () {
  'use strict';

  run.$inject = ["$rootScope", "$state", "$stateParams", "Global"];
  angular.module('app').run(run);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function run($rootScope, $state, $stateParams, Global) {
    //Sets the rootScope so it can be accessed in the views without the controller prefix
    $rootScope.$state = $state;
    $rootScope.$stateParams = $stateParams;
    $rootScope.global = Global;
  }
})();
'use strict';

/*eslint angular/file-name: 0*/
(function () {
  'use strict';

  serviceFactory.$inject = ["$modelFactory"];
  angular.module('app').factory('serviceFactory', serviceFactory);

  /** @ngInject */
  /**
   * More information:
   * https://github.com/swimlane/angular-model-factory/wiki/API
   */
  function serviceFactory($modelFactory) {
    return function (url, options) {
      var model;
      var defaultOptions = {
        actions: {
          /**
           * Action to do a paginated search
           * Expects that a json object with the properties items and total
           */
          paginate: {
            method: 'GET',
            isArray: false,
            wrap: false,
            afterRequest: function afterRequest(response) {
              if (response['items']) {
                response['items'] = model.List(response['items']);
              }

              return response;
            }
          }
        }
      };

      model = $modelFactory(url, angular.merge(defaultOptions, options));

      return model;
    };
  }
})();
'use strict';

(function () {

  'use strict';

  CRUDController.$inject = ["vm", "modelService", "options", "C2Toast", "C2Pagination", "C2Dialog", "$translate"];
  angular.module('app').controller('CRUDController', CRUDController);

  /** @ngInject */
  /**
   * Base Controller that  implements al the standard CRUD functions
   *
   * Implemented actions:
   * activate()
   * search(page)
   * edit(resource)
   * save()
   * remove(resource)
   * goTo(viewName)
   * cleanForm()
   *
   * Triggers:
   *
   * onActivate()
   * applyFilters(defaultQueryFilters)
   * beforeSearch(page) //returning false cancel the submission/flow
   * afterSearch(response)
   * beforeClean //returning false cancel the submission/flow
   * afterClean()
   * beforeSave() //returning false cancel the submission/flow
   * afterSave(resource)
   * onSaveError(error)
   * beforeRemove(resource) //returning false cancel the submission/flow
   * afterRemove(resource)
   *
   * @param {any} vm child controller instance
   * @param {any} modelService model service that the controller will use for the restful requests
   * @param {any} options options to overwrite the default behaviors
   */
  // eslint-disable-next-line max-params
  function CRUDController(vm, modelService, options, C2Toast, C2Pagination, // NOSONAR
  C2Dialog, $translate) {

    //Functions Block
    vm.search = search;
    vm.paginateSearch = paginateSearch;
    vm.normalSearch = normalSearch;
    vm.edit = edit;
    vm.save = save;
    vm.remove = remove;
    vm.goTo = goTo;
    vm.cleanForm = cleanForm;

    activate();

    /**
     * Prepare the controller
     * Do an options merge
     * Initialize the resource
     * Initialize the paging object and do the initial search (if searchOnInit is true )
     */
    function activate() {
      vm.defaultOptions = {
        redirectAfterSave: true,
        searchOnInit: true,
        perPage: 8,
        skipPagination: false
      };

      angular.merge(vm.defaultOptions, options);

      vm.viewForm = false;
      vm.resource = new modelService();

      if (angular.isFunction(vm.onActivate)) vm.onActivate();

      var labelOptions = {
        labels: {
          total: $translate.instant('views.pagination.total'),
          items: $translate.instant('views.pagination.items')
        }
      };

      vm.paginator = C2Pagination.getInstance(vm.search, vm.defaultOptions.perPage, labelOptions);

      if (vm.defaultOptions.searchOnInit) vm.search();
    }

    /**
     * Do a search
     * Checks which of the search functions must be used
     *
     * @param {any} page page that must be requested
     */
    function search(page) {
      vm.defaultOptions.skipPagination ? normalSearch() : paginateSearch(page);
    }

    /**
     * Do a paged search with the applied filters
     *
     * @param {any} page page that must be requested
     */
    function paginateSearch(page) {
      vm.paginator.currentPage = angular.isDefined(page) ? page : 1;
      vm.defaultQueryFilters = {
        page: vm.paginator.currentPage,
        perPage: vm.paginator.perPage
      };

      if (angular.isFunction(vm.applyFilters)) {
        vm.defaultQueryFilters = vm.applyFilters(vm.defaultQueryFilters);
      }
      if (angular.isFunction(vm.beforeSearch) && vm.beforeSearch(page) === false) return false;

      modelService.paginate(vm.defaultQueryFilters).then(function (response) {
        vm.paginator.calcNumberOfPages(response.total);
        vm.resources = response.items;

        if (angular.isFunction(vm.afterSearch)) vm.afterSearch(response);
      });
    }

    /**
     * Do a search with the applied filters
     *
     */
    function normalSearch() {
      vm.defaultQueryFilters = {};

      if (angular.isFunction(vm.applyFilters)) vm.defaultQueryFilters = vm.applyFilters(vm.defaultQueryFilters);
      if (angular.isFunction(vm.beforeSearch) && vm.beforeSearch() === false) return false;

      modelService.query(vm.defaultQueryFilters).then(function (response) {
        vm.resources = response;

        if (angular.isFunction(vm.afterSearch)) vm.afterSearch(response);
      });
    }

    /**
     * Clear the form
     */
    function cleanForm(form) {
      if (angular.isFunction(vm.beforeClean) && vm.beforeClean() === false) return false;

      vm.resource = new modelService();

      if (angular.isDefined(form)) {
        form.$setPristine();
        form.$setUntouched();
      }

      if (angular.isFunction(vm.afterClean)) vm.afterClean();
    }

    /**
     * Load the selected resource in the form
     *
     * @param {any} resource selected resource
     */
    function edit(resource) {
      vm.goTo('form');
      vm.resource = new angular.copy(resource);

      if (angular.isFunction(vm.afterEdit)) vm.afterEdit();
    }

    /**
     * Save or update the resource
     * In the default behavior, redirect the user to the list view after saving
     *
     * @returns
     */
    function save(form) {
      if (angular.isFunction(vm.beforeSave) && vm.beforeSave() === false) return false;

      // console.log(vm.resource)

      vm.resource.$save().then(function (resource) {
        //vm.resource = resource;

        if (angular.isFunction(vm.afterSave)) vm.afterSave(resource);

        if (vm.defaultOptions.redirectAfterSave) {
          vm.cleanForm(form);
          vm.search(vm.paginator.currentPage);
          vm.goTo('list');
        }

        C2Toast.success($translate.instant('messages.saveSuccess'));
      }, function (responseData) {
        if (angular.isFunction(vm.onSaveError)) vm.onSaveError(responseData);
      });
    }

    // /**
    //  * Save vector GeoJSON data
    //  * 
    //  * @returns
    //  */
    // function savegeojson(data){
    //   data = "{adssd}"
    //   vm.resource.geosjondata = data
    //   console.log(vm.resource)
    //   // vm.resource.$save().then(function (resource) {
    //   //   // vm.resource = resource;

    //   //   // console.log("resource")

    //   // }, function (responseData) {
    //   //   // console.log("responseData");
    //   // });
    // }

    /**
     * Retrieve vector GeoJSON data
     * 
     * @returns
     */
    function retrievegeojson(params) {
      console.log(params);
    }

    /**
     * Remove the resource, but before show a dialog to confirm     
     *
     * @param {any} resource resource selected
     */
    function remove(resource) {
      var config = {
        title: $translate.instant('dialog.confirmTitle'),
        description: $translate.instant('dialog.confirmDescription'),
        yes: $translate.instant('global.yes'),
        no: $translate.instant('global.no')
      };

      C2Dialog.confirm(config).then(function () {
        if (angular.isFunction(vm.beforeRemove) && vm.beforeRemove(resource) === false) return false;

        resource.$destroy().then(function () {
          if (angular.isFunction(vm.afterRemove)) vm.afterRemove(resource);

          vm.search();
          C2Toast.info($translate.instant('messages.removeSuccess'));
        });
      });
    }

    /**
     * Switch between the list and form mode
     *
     * @param {any} viewName view name to witch to
     */
    function goTo(viewName) {
      vm.viewForm = false;

      if (viewName === 'form') {
        vm.cleanForm();
        vm.viewForm = true;
      }
    }
  }
})();
'use strict';

(function () {

  'use strict';

  GeoreferenceController.$inject = ["$controller", "$scope", "MapMarkerService", "leafletMarkerEvents", "$rootScope", "MapViewerService", "$translate", "C2Dialog", "$mdColors", "$mdSidenav", "Global", "$timeout", "lodash"];
  angular.module('app').controller('GeoreferenceController', GeoreferenceController);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function GeoreferenceController($controller, $scope, MapMarkerService, leafletMarkerEvents, $rootScope, MapViewerService, $translate, C2Dialog, $mdColors, $mdSidenav, Global, $timeout, lodash) {
    var vm = this;

    // Functions Block     
    vm.onViewerActivate = onViewerActivate;
    vm.toggleCreateMarker = toggleCreateMarker;
    vm.beforeViewerActivate = beforeViewerActivate;
    vm.toggleRemoveMarker = toggleRemoveMarker;
    vm.openSaveGeoRef = openSaveGeoRef;
    vm.validGCP = validGCP;
    vm.numOfGCP = numOfGCP;
    vm.redrawMarkers = redrawMarkers;

    // Set the map viewer options
    var options = {
      supportListingView: false,
      supportDrawing: false,
      titleTranslKey: 'views.titles.mapGeoreferencing',
      showGeoRefTools: true,
      leftSideBar: Global.clientPath + '/georeference/navs/geo-left-sidenav.html',
      showGcpTable: true,
      gcpTable: Global.clientPath + '/georeference/navs/gcp-Table.html'
    };

    // initialize empty markers object
    vm.rightMarkers = {};
    vm.leftMarkers = {};

    // instantiate the base MapViewerController
    $controller('MapViewerController', { vm: vm, $scope: $scope, options: options });

    // Listen to the rightMapViewer dragend
    $rootScope.$on('leafletDirectiveMarker.rightMapViewer.dragend', function (event, args) {
      if (vm.rightCreateMarkerEnable === true) {
        // doing nothing for a while
      }
    });

    // Listen to the rightMapViewer click and remove the marker if the removal tool is enabled
    $rootScope.$on('leafletDirectiveMarker.rightMapViewer.click', function (event, args) {
      if (vm.rightRemoveMarkerEnable === true) {
        var id = args.model.id;
        removeMarker(id);
        // call an event to delete it from GCP Table
        $rootScope.$broadcast("deleteGcpFromTableEvent", id);
      } else {
        // ensure the event is fired from GCP Table delete button
        if (args.model.eventFrom === "gcpTable") {
          var id = args.model.id;
          // console.log(id)
          removeMarker(id);
        }
      }
    });

    // Listen to the leftMapViewer click and remove the marker if the removal tool is enabled
    $rootScope.$on('leafletDirectiveMarker.leftMapViewer.click', function (event, args) {
      if (vm.leftRemoveMarkerEnable === true) {
        var id = args.model.id;
        // console.log(id)
        removeMarker(id);
        // call an event to delete it from GCP Table
        $rootScope.$broadcast("deleteGcpFromTableEvent", id);
      } else {
        // ensure the event is fired from GCP Table delete button
        if (args.model.eventFrom === "gcpTable") {
          var id = args.model.id;
          // console.log(id)
          removeMarker(id);
        }
      }
    });

    // Listen to the rightMapViewer click and add a marker on the clicked position
    // if the marker creation tool is enabled
    $rootScope.$on("leafletDirectiveMap.rightMapViewer.click", function (event, args) {
      if (vm.rightCreateMarkerEnable === true) {
        addMarker(args.leafletEvent, 'rightMarkers');
        // ensure both the maps have equal number of markers
        if (lodash.size(vm['leftMarkers']) === _.size(vm['rightMarkers'])) {
          // fire event to GCP controller for caqll refreshGCPTable
          $rootScope.$broadcast("refreshGcpTableEvent");
        }
      }
    });

    // Listen to the leftMapViewer click and add a marker on the clicked position
    // if the marker creation tool is enabled
    $rootScope.$on("leafletDirectiveMap.leftMapViewer.click", function (event, args) {
      if (vm.leftCreateMarkerEnable === true) {
        addMarker(args.leafletEvent, 'leftMarkers');
        // ensure both the maps have equal number of markers
        if (_.size(vm['leftMarkers']) === _.size(vm['rightMarkers'])) {
          // console.log("marker siye equal on both maps");
          // fire event to GCP controller for caqll refreshGCPTable
          $rootScope.$broadcast("refreshGcpTableEvent");
        }
      }
    });

    // Listen to the rightMapViewer click and add a marker on the clicked position
    // if the marker creation tool is enabled
    $rootScope.$on("createMarkerForTable", function (event, args) {
      // console.log(">>> georeference.controller >>> createMarkerForTable ", args);
      if (args.markersKeeper === "leftMarkers") {
        addMarker(args, 'leftMarkers');
      }
      if (args.markersKeeper === "rightMarkers") {
        addMarker(args, 'rightMarkers');
      }
    });

    // Listen to the disable marker creation 
    $rootScope.$on("toggleMarkerCreation", function (event, args) {
      // console.log(">>> georeference.controller >>> toggleMarkerCreation ", args);
      var markersKeeper = args.markersKeeper; // 'leftMapViewer'
      toggleCreateMarker(markersKeeper);
    });

    // Listen to create markers on map based on GCP positions
    $rootScope.$on("createGcpOnMap", function (event, args) {
      // console.log(">>> georeference.controller >>> createGcpOnMap ", args);

      lodash.forEach(args, function (position) {
        var preparedMarkerData = prepareDataForAddMarker(position);
        addMarker(preparedMarkerData.imagePosition, 'leftMarkers');

        // delay is added otherwise only one of the map has markers on it
        setTimeout(function () {
          addMarker(preparedMarkerData.mapPosition, 'rightMarkers');
        }, 10);
      });
    });

    /**
     * Add a marker on a given markers keeper object
     * 
     * @param {any} leafEvent 
     * @param {any} markersKeeper 
     */
    function addMarker(leafEvent, markersKeeper) {
      var markerData = {
        lat: leafEvent.latlng.lat,
        lng: leafEvent.latlng.lng,
        focus: true
      };

      var newMarker = MapMarkerService.buildMarker(vm[markersKeeper], markerData);
      vm[markersKeeper][newMarker.id] = newMarker;
    }

    /**
     * Remove a given marker id from bot viewers
     * 
     * @param {any} markerId 
     */
    function removeMarker(markerId) {
      if (angular.isDefined(vm.leftMarkers[markerId])) {
        // var tempMarkerId = vm.leftMarkers[markerId].icon.className.split(" ")[1];
        delete vm.leftMarkers[markerId];
        // redrawMarkers(vm.leftMarkers, tempMarkerId);
      }
      if (angular.isDefined(vm.rightMarkers[markerId])) {
        var tempMarkerId = vm.rightMarkers[markerId].icon.className.split(" ")[1];
        // added a timeout other wise, after deleting marker on leftside map and then creating a 
        // marker on rightside was not in-sync
        // setTimeout(() => {
        delete vm.rightMarkers[markerId];
        //   redrawMarkers(vm.rightMarkers, tempMarkerId);    
        // }, 10);
      }
    }

    /**
     * Redraw/updates a given map (markerskeeper - object) all the markers 
     * except the deleted one
     * 
     * @param {any} markersKeeper 
     * @param {any} deletedMarkerId 
     */
    function redrawMarkers(markersKeeper, deletedMarkerId) {

      // console.log(">>>georeferenceControlller >>> redrawMarkers ", markersKeeper, deletedMarkerId[1]);
      _.forOwn(markersKeeper, function (marker, key) {
        var tempIdNum = marker.icon.className.split(" ")[1][1];
        if (tempIdNum > deletedMarkerId[1]) {
          var newMarkerNo = tempIdNum - 1;
          // ui changes of marker icon
          marker.icon.html = "<div class=\"mk-icon-container mk-ok\">" + newMarkerNo + "</div>";
          marker.icon.className = "mk-div-icon m" + newMarkerNo;

          // change the old key of the marker with new one, otherwise the newly created marker's numbering 
          // will not be in sync
          var oldKey = key;
          var newKey = "m" + newMarkerNo;
          if (oldKey !== newKey) {
            Object.defineProperty(markersKeeper, newKey, Object.getOwnPropertyDescriptor(markersKeeper, oldKey));
            delete markersKeeper[oldKey];
          }
          // console.log("marker = ", marker);
        }
      });
    }

    /**
     * Actions executed before the base viewer is activated
     * 
     */
    function beforeViewerActivate() {

      // activate the event listening for right viewer and right marker events
      vm.rightViewerEvents = {
        markers: {
          enable: leafletMarkerEvents.getAvailableEvents()
        },
        map: {
          enable: ['dragend', 'drag', 'click', 'mousemove']
          //logic: 'emit'
        }
      };
      // activate the event listening for left viewer and left marker events
      vm.leftViewerEvents = {
        markers: {
          enable: leafletMarkerEvents.getAvailableEvents()
        },
        map: {
          enable: ['dragend', 'drag', 'click', 'mousemove']
          //logic: 'emit'
        }
      };
    }

    /**
     * Actions executed after the base viewer is activated
     * 
     */
    function onViewerActivate() {
      // Set global viewer options
      // changed for resolving #184 
      // MapViewerService.setOption('rightMapViewer', 'showLoadMapInRight', false);
      MapViewerService.setOption('rightMapViewer', 'showLoadMapInRight', true);
      MapViewerService.setOption('leftMapViewer', 'showLoadMapInRight', true);
    }

    /**
     * Enable/disable the marker creation
     * 
     * @param {any} viewerId 
     */
    function toggleCreateMarker(viewerId) {
      if (viewerId === 'rightMapViewer') {
        vm.rightCreateMarkerEnable = !vm.rightCreateMarkerEnable;

        // it is not possible to have removal and create tool enabled at the same time
        // so, if the removal and create tool are enabled, the right removal tool is disabled
        if (vm.rightCreateMarkerEnable === true && vm.rightRemoveMarkerEnable === true) {
          vm.rightRemoveMarkerEnable = false;
        }
      } else {
        vm.leftCreateMarkerEnable = !vm.leftCreateMarkerEnable;

        // it is not possible to have removal and create tool enabled at the same time
        // so, if the removal and create tool are enabled, the left removal tool is disabled
        if (vm.leftCreateMarkerEnable === true && vm.leftRemoveMarkerEnable === true) {
          vm.leftRemoveMarkerEnable = false;
        }
      }
    }

    /**
     * Enable/disable the marker removal
     * 
     * @param {any} viewerId
     */
    function toggleRemoveMarker(viewerId) {
      if (viewerId === 'rightMapViewer') {
        vm.rightRemoveMarkerEnable = !vm.rightRemoveMarkerEnable;

        // it is not possible to have removal and create tool enabled at the same time
        // so, if the removal and create tool are enabled, the right create tool is disabled
        if (vm.rightRemoveMarkerEnable === true && vm.rightCreateMarkerEnable === true) {
          vm.rightCreateMarkerEnable = false;
        }
      } else {
        vm.leftRemoveMarkerEnable = !vm.leftRemoveMarkerEnable;

        // it is not possible to have removal and create tool enabled at the same time
        // so, if the removal and create tool are enabled, the left create tool is disabled
        if (vm.leftRemoveMarkerEnable === true && vm.leftCreateMarkerEnable === true) {
          vm.leftCreateMarkerEnable = false;
        }
      }
    }

    /**
     * Opens the side nav with save options for the georeference
     * This function just open the side nav. The georeference save function is defined 
     * in the side nav controller @see app/georeference/navs.geo.left.sidenav.controller.js
     */
    function openSaveGeoRef() {
      // if the Ground Control Points are valid, we just open the side nav
      if (validGCP()) {
        $scope.vm = vm;
        $mdSidenav('left').toggle();
        $rootScope.$emit('saveGeoRef', vm.leftMarkers);
      } else {
        // if not, we warn the user about it
        var config = {
          title: $translate.instant('dialog.invalidGeorefTitle'),
          description: $translate.instant('dialog.invalidGeorefText'),
          toolbarBgColor: $mdColors.getThemeColor('primary'),
          okBgColor: $mdColors.getThemeColor('primary'),
          ok: $translate.instant('global.ok')
        };
        C2Dialog.alert(config);
      }
    }

    /**
     * 
     */
    function numOfGCP() {
      return Object.keys(vm.leftMarkers).length;
    }

    /**
     * Validate the Ground Control Points about to be used for the georeference
     * 
     * @returns 
     */
    function validGCP() {
      // get the properties count of both viewers
      var leftCount = Object.keys(vm.leftMarkers).length;
      var rightCount = Object.keys(vm.rightMarkers).length;

      // to be valid a minimum of 3 GCP must be selected 
      // and both viewers must have the same amount of GCP defined
      return leftCount >= 3 && leftCount === rightCount;
    }

    /**
     * Convert GCP data received from /map response to marker format data
     * 
     * @param position gcp response of /map request
     * @returns Object In format how addMarker function needs marker data
     */
    function prepareDataForAddMarker(position) {
      var imagePositionInLatLng = L.Projection.SphericalMercator.unproject(
      // L.latLng(position.pixelY,parseFloat(position.pixelX))
      L.point(parseFloat(position.pixelX), position.pixelY));
      // console.log(imagePositionInLatLng);

      return {
        "imagePosition": {
          "latlng": {
            "lat": imagePositionInLatLng.lat,
            "lng": imagePositionInLatLng.lng
          }
        },
        "mapPosition": {
          "latlng": {
            "lat": position.lat,
            "lng": position.lon
          }
        }
      };
    }
  }
})();
'use strict';

(function () {
  'use strict';

  routes.$inject = ["$stateProvider", "Global"];
  angular.module('app').config(routes);

  /**
   * Configuration file for georeference route
   *
   * @param {object} $stateProvider
   * @param {object} Global
   */
  /** @ngInject */
  function routes($stateProvider, Global) {
    $stateProvider.state('app.georeference', {
      url: '/georeference',
      templateUrl: Global.clientPath + '/georeference/georeference.html',
      controller: 'GeoreferenceController as mapCtrl',
      data: {}
    });
  }
})();
'use strict';

(function () {
  'use strict';

  GeoreferenceService.$inject = ["serviceFactory", "$http", "$q"];
  angular.module('app').factory('GeoreferenceService', GeoreferenceService);

  /** @ngInject */
  function GeoreferenceService(serviceFactory, $http, $q) {
    var applyEndPoint = "/heimap/georef/apply";
    var previewGcpEndPoint = "/heimap/georef/rmse";

    var model = serviceFactory(applyEndPoint, {
      actions: {},
      instance: {
        saveGeoRef: saveGeoRef,
        previewGCP: previewGCP
      }
    });

    function previewGCP(paramData) {
      // console.log(">>> GeoreferenceService >>> previewGCP ", previewGcpEndPoint, paramData);
      var deferred = $q.defer();
      var formData = new FormData();
      /* 
      paramData = {
          "imageCoordinates":{
            "m1":{
              "id":"m1",
              "lat":0.0067377090298955476,
              "lng":0.00429989455581481,
              "focus":true,
              "draggable":true,
              "icon":{
                "type":"div",
                "className":"mk-div-icon m1",
                "iconSize":null,
                "html":"<div class=\"mk-icon-container mk-ok\">1</div>"
              }
            },
            "m2":{
              "id":"m2",
              "lat":0.0003862380981423107,
              "lng":0.0029246218792744476,
              "focus":true,
              "draggable":true,
              "icon":{
                "type":"div",
                "className":"mk-div-icon m2",
                "iconSize":null,
                "html":"<div class=\"mk-icon-container mk-ok\">2</div>"
              }
            },
            "m3":{
              "id":"m3",
              "lat":0.0007295608520352782,
              "lng":0.012852371513050189,
              "focus":true,
              "draggable":true,
              "icon":{
                "type":"div",
                "className":"mk-div-icon m3",
                "iconSize":null,
                "html":"<div class=\"mk-icon-container mk-ok\">3</div>"
              }
            },
            "m4":{
              "id":"m4",
              "lat":0.006051063526346111,
              "lng":0.01096137158280719,
              "focus":true,
              "draggable":true,
              "icon":{
                "type":"div",
                "className":"mk-div-icon m4",
                "iconSize":null,
                "html":"<div class=\"mk-icon-container mk-ok\">4</div>"
              }
            }
          },
          "worldCoordinates":{
            "m1":{
              "id":"m1",
              "lat":49.360911547126165,
              "lng":8.03715297154017,
              "focus":true,
              "draggable":true,
              "icon":{
                "type":"div",
                "className":"mk-div-icon m1",
                "iconSize":null,
                "html":"<div class=\"mk-icon-container mk-ok\">1</div>"
              }
            },
            "m2":{
              "id":"m2",
              "lat":48.832181625698475,
              "lng":7.998645336597,
              "focus":true,
              "draggable":true,
              "icon":{
                "type":"div",
                "className":"mk-div-icon m2",
                "iconSize":null,
                "html":"<div class=\"mk-icon-container mk-ok\">2</div>"
              }
            },
            "m3":{
              "id":"m3",
              "lat":48.85387273165656,
              "lng":9.049353661475235,
              "focus":true,
              "draggable":true,
              "icon":{
                "type":"div",
                "className":"mk-div-icon m3",
                "iconSize":null,
                "html":"<div class=\"mk-icon-container mk-ok\">3</div>"
              }
            },
            "m4":{
              "id":"m4",
              "lat":49.47883244071047,
              "lng":9.203384201247957,
              "focus":true,
              "draggable":true,
              "icon":{
                "type":"div",
                "className":"mk-div-icon m4",
                "iconSize":null,
                "html":"<div class=\"mk-icon-container mk-ok\">4</div>"
              }
            }
          },
          "rectifyMethod":"1stOrderPolyn",
          "resamplingMethod":"near",
          "mapId":"23",
          "newFileName":"1_g_1stOrderPolyn_near_7.19.2018",
          "bboxCropImage":"7.998645336597 48.832181625698475 9.203384201247957 49.47883244071047"
        }
       */
      $http.post(previewGcpEndPoint, paramData).then(function (result) {
        deferred.resolve(result.data);
      }, function (err) {
        deferred.reject(err);
      });
      return deferred.promise;
    }

    // not used
    function saveGeoRef() {
      console.log(">>> GeoreferenceService >>> saveGeoRef ", this.applyEndPoint);

      var deferred = $q.defer();
      var formData = new FormData();

      $http.post(this.applyEndPoint, formData, {
        transformRequest: angular.identity,
        headers: {
          'Content-Type': undefined
        }
      }).then(function (result) {
        deferred.resolve(result.data);
      }, function (err) {
        deferred.reject(err);
      });
      return deferred.promise;
    }

    return model;
  }
})();
'use strict';

(function () {

  'use strict';

  ExportController.$inject = ["$controller", "ExportService"];
  angular.module('app').controller('ExportController', ExportController);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function ExportController($controller, ExportService) {
    var vm = this;

    //Attributes Block

    //Functions Block

    // instantiate base controller
    $controller('CRUDController', { vm: vm, modelService: ExportService, options: { searchOnInit: false } });
  }
})();
'use strict';

(function () {
  'use strict';

  routes.$inject = ["$stateProvider", "Global"];
  angular.module('app').config(routes);

  /**
   * Arquivo de configuração com as rotas específicas do recurso export
   *
   * @param {object} $stateProvider
   * @param {object} Global
   */
  /** @ngInject */
  function routes($stateProvider, Global) {
    $stateProvider.state('app.export', {
      url: '/export',
      templateUrl: Global.clientPath + '/export/export.html',
      controller: 'ExportController as exportCtrl',
      data: {}
    });
  }
})();
'use strict';

(function () {
  'use strict';

  ExportService.$inject = ["serviceFactory"];
  angular.module('app').factory('ExportService', ExportService);

  /** @ngInject */
  function ExportService(serviceFactory) {
    var model = serviceFactory('export', {
      actions: {},
      instance: {}
    });

    return model;
  }
})();
'use strict';

(function () {

  'use strict';

  isOrNotGeoreferenced.$inject = ["$filter"];
  angular.module('app').filter('isOrNotGeoreferenced', isOrNotGeoreferenced);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function isOrNotGeoreferenced($filter) {
    /**
     * Filter to convert boolean to yes or not string
     *
     * @param {any} input property/variable
     * @returns the translated yes/no string
     */
    return function (input) {
      var isTrue = input === true || input === 'true' || input === 1 || angular.isDefined(input) && input !== false;
      var key = 'attributes.' + (isTrue ? 'isGeoreferenced' : 'isNotGeoreferenced');
      var translated = $filter('translate')(key);
      return translated;
    };
  }
})();
'use strict';

(function () {

  'use strict';

  LanguageLoader.$inject = ["$q", "$log", "$injector"];
  angular.module('app').factory('languageLoader', LanguageLoader);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function LanguageLoader($q, $log, $injector) {
    var service = this;

    service.translate = function (locale) {
      return {
        global: $injector.get(locale + '.i18n.global'),
        views: $injector.get(locale + '.i18n.views'),
        attributes: $injector.get(locale + '.i18n.attributes'),
        dialog: $injector.get(locale + '.i18n.dialog'),
        messages: $injector.get(locale + '.i18n.messages'),
        models: $injector.get(locale + '.i18n.models')
      };
    };

    // return loaderFn
    return function (options) {
      $log.info('Loading the language content ' + options.key);
      var translation = service.translate(options.key);
      return $q.when(translation);
    };
  }
})();
'use strict';

(function () {

  'use strict';

  tAttr.$inject = ["$filter"];
  angular.module('app').filter('tAttr', tAttr);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function tAttr($filter) {
    /**
     * Filtro para tradução de um atributo de um model
     * 
     * @param {any} name nome do atributo
     * @returns o nome do atributo traduzido caso encontre se não o nome passado por parametro
     */
    return function (name) {
      var key = 'attributes.' + name;
      var translate = $filter('translate')(key);

      return translate === key ? name : translate;
    };
  }
})();
'use strict';

(function () {

  'use strict';

  tBreadcrumb.$inject = ["$filter"];
  angular.module('app').filter('tBreadcrumb', tBreadcrumb);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function tBreadcrumb($filter) {
    /**
     * Filtro para tradução do breadcrumb (titulo da tela com rastreio)
     *
     * @param {any} id chave com o nome do state referente tela
     * @returns a tradução caso encontre se não o id passado por parametro
     */
    return function (id) {
      //pega a segunda parte do nome do state, retirando a parte abstrata (app.)
      var key = 'views.breadcrumbs.' + id.split('.')[1];
      var translate = $filter('translate')(key);

      return translate === key ? id : translate;
    };
  }
})();
'use strict';

(function () {

  'use strict';

  tModel.$inject = ["$filter"];
  angular.module('app').filter('tModel', tModel);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function tModel($filter) {
    /**
     * Filtro para tradução de um atributo de um model
     *
     * @param {any} name nome do atributo
     * @returns o nome do atributo traduzido caso encontre se não o nome passado por parametro
     */
    return function (name) {
      var key = 'models.' + name.toLowerCase();
      var translate = $filter('translate')(key);

      return translate === key ? name : translate;
    };
  }
})();
'use strict';

(function () {

  'use strict';

  yesOrNo.$inject = ["$filter"];
  angular.module('app').filter('yesOrNo', yesOrNo);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function yesOrNo($filter) {
    /**
     * Filter to convert boolean to yes or not string
     *
     * @param {any} input property/variable
     * @returns the translated yes/no string
     */
    return function (input) {
      var isTrue = input === true || input === 'true' || input === 1 || angular.isDefined(input) && input !== false;
      var key = 'global.' + (isTrue ? 'yes' : 'no');
      var translated = $filter('translate')(key);
      return translated;
    };
  }
})();
'use strict';

(function () {
  'use strict';

  spinnerInterceptor.$inject = ["$httpProvider", "$provide"];
  angular.module('app').config(spinnerInterceptor);

  function spinnerInterceptor($httpProvider, $provide) {
    /**
     * This interceptor is responsible for showing and hiding the C2Spinner
     * when a async request is started/ended
     *
     * @param {any} $q
     * @param {any} $injector
     * @returns
     */
    showHideSpinner.$inject = ["$q", "$injector", "Global"];
    function showHideSpinner($q, $injector, Global) {

      /**
       * Current pending requests
       */
      Global.pendingRequests = 0;

      return {
        request: function request(config) {
          Global.pendingRequests++;
          $injector.get('C2Spinner').show();
          return config;
        },

        response: function response(_response) {
          Global.pendingRequests--;
          // the spinner is only hidden if there are no more  pending requests      
          if (Global.pendingRequests === 0) {
            $injector.get('C2Spinner').hide();
          }
          return _response;
        },

        responseError: function responseError(rejection) {
          Global.pendingRequests--;
          // the spinner is only hidden if there are nomore  pending requests      
          if (Global.pendingRequests === 0) {
            $injector.get('C2Spinner').hide();
          }
          return $q.reject(rejection);
        }
      };
    }

    // Define a factory to the $httpInterceptor
    $provide.factory('showHideSpinner', showHideSpinner);

    // Push the new factory onto the $http interceptor array
    $httpProvider.interceptors.push('showHideSpinner');
  }
})();
'use strict';

(function () {
  'use strict';

  FeatureService.$inject = ["serviceFactory"];
  angular.module('app').factory('FeatureService', FeatureService);

  /** @ngInject */
  function FeatureService(serviceFactory) {
    var model = serviceFactory('/heimap/feature/', {
      actions: {},
      instance: {}
    });

    return model;
  }
})();
'use strict';

(function () {

  'use strict';

  MapController.$inject = ["$controller", "C2Dialog", "$scope", "Global", "MapViewerService", "$rootScope"];
  angular.module('app').controller('MapController', MapController);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function MapController($controller, C2Dialog, $scope, Global, MapViewerService, $rootScope) {
    var vm = this;

    // Functions Block
    vm.openAddMap = openAddMap;
    vm.openEditMap = openEditMap;
    vm.onViewerActivate = onViewerActivate;

    // Set the map viewer options
    var options = {
      supportListingView: true,
      supportDrawing: false,
      titleTranslKey: 'views.titles.mapView',
      leftSideBar: Global.clientPath + '/map/navs/map-left-sidenav.html'

      // instantiate the base MapViewerController
    };$controller('MapViewerController', { vm: vm, $scope: $scope, options: options });

    /**
     * Actions executed after the base viewer is activated
     * 
     */
    function onViewerActivate() {
      // Set global viewer options
      MapViewerService.setOption('rightMapViewer', 'showLoadMapInRight', true);
      MapViewerService.setOption('leftMapViewer', 'showLoadMapInRight', true);
    }

    /**
     * Listen to the added map draw  event and save the map
     * in the back-end
     */
    $rootScope.$on('addedMapDraw', function (event, drawsGeoJson) {
      console.log(">>>map.controller >>> addedMapDraw ", drawsGeoJson);
      vm.resource.draws = drawsGeoJson;
      openAttributeDailog(drawsGeoJson);
      // it is needed to define a way to identify the target map over which the polygon was drawn, so it can be saved as a vector data to that map
      //vm.resource.$save();
    });

    /**
     * Open the dialog to add a map
     * @return void
     */
    function openAddMap() {
      openDialog();
    }

    /**
     * Open the dialog to edit a map
     * 
     * @param {any} resource 
     *  @return void
     */
    function openEditMap(resource) {
      openDialog(resource);
    }

    /**
     * Open the dialog that allows add or edit a map
     * When closed, the resources (maps) will be refreshed
     * 
     * @param {any} resource 
     * @return void
     */
    function openDialog(resource) {
      var config = {
        locals: {
          mapDialogInput: {
            model: resource,
            removeFn: vm.remove
          }
        },
        controller: 'MapDialogController',
        controllerAs: 'ctrl',
        templateUrl: Global.clientPath + '/map/dialog/map-dialog.html',
        hasBackdrop: true
      };

      C2Dialog.custom(config).then(function () {
        // reload the items from back-end
        vm.search();
      });
    }
  }
})();
'use strict';

(function () {
  'use strict';

  routes.$inject = ["$stateProvider", "Global"];
  angular.module('app').config(routes);

  /**
   * Configuration file for map route
   *
   * @param {object} $stateProvider
   * @param {object} Global
   */
  /** @ngInject */
  function routes($stateProvider, Global) {
    $stateProvider.state('app.map', {
      url: '/map',
      templateUrl: Global.clientPath + '/map/map.html',
      controller: 'MapController as mapCtrl',
      data: {}
    });
  }
})();
'use strict';

(function () {
  'use strict';

  MapService.$inject = ["serviceFactory"];
  angular.module('app').factory('MapService', MapService);

  /** @ngInject */
  function MapService(serviceFactory) {
    var model = serviceFactory('/heimap/map/', {
      actions: {},
      instance: {}
    });

    return model;
  }
})();
'use strict';

(function () {
  'use strict';

  FileService.$inject = ["serviceFactory", "$http", "$q"];
  angular.module('app').factory('FileService', FileService);

  /** @ngInject */
  function FileService(serviceFactory, $http, $q) {
    var endPoint = '/heimap/file';
    var model = serviceFactory(endPoint, {
      actions: {},
      instance: {
        upload: upload
      }
    });

    function upload() {
      var deferred = $q.defer();
      var formData = new FormData();
      formData.append('file', this.file);
      if (angular.isDefined(this.map_image_file_id) && this.map_image_file_id !== null) {
        formData.append('map_image_file_id', this.map_image_file_id);
      }
      if (angular.isDefined(this.map_geo_file_projection) && this.map_geo_file_projection !== null) {
        formData.append('map_geo_file_projection', this.map_geo_file_projection);
      }

      $http.post(endPoint, formData, {
        transformRequest: angular.identity,
        headers: {
          'Content-Type': undefined
        }
      }).then(function (result) {
        deferred.resolve(result.data);
      }, function (err) {
        deferred.reject(err);
      });
      return deferred.promise;
    }
    return model;
  }
})();
'use strict';

/**
 * Map Layer Service responsible for building basic layers, managing the state of the right and left viewers 
 * and its layers, as well as basic interactions supported by leaflet, like change opacity, reorder etc.
 * 
 * As a centralized service this service execute actions and broadcast events when the state changes
 * The following events are broadcasted:
 * 
 * ungeoreferencedLayerToBeLoaded
 * georeferencedLayerToBeLoaded
 * mapLayersChanged
 * addedMapLayer
 * removedMapLayer
 * removedAllMapLayers
 * mapHidden
 * mapShown
 * viewerHidden
 * viewerShown
 * mapLayersReordered
 * addedMapDraw
 */

(function () {
  'use strict';

  MapLayerService.$inject = ["leafletData", "leaflet", "lodash", "SupportService", "$rootScope", "$q", "$timeout"];
  angular.module('app').factory('MapLayerService', MapLayerService);

  function MapLayerService(leafletData, leaflet, lodash, SupportService, $rootScope, $q, $timeout) {
    var service = {
      buildDefaultLayers: buildDefaultLayers,
      addMapLayer: addMapLayer,
      removeMapLayer: removeMapLayer,
      hideMap: hideMap,
      showMap: showMap,
      // addMapLayer: addMapLayer,
      serverConfig: null,
      isAdded: isAdded,
      fitMapBounds: fitMapBounds,
      applyOpacity: applyOpacity,
      hasNonGeoreferencedLayer: hasNonGeoreferencedLayer,
      removeAllMapLayers: removeAllMapLayers,
      getViewerOverlays: getViewerOverlays,
      getViewerData: getViewerData,
      getDefaultCenter: getDefaultCenter,
      refreshMapResource: refreshMapResource,
      hideViewer: hideViewer,
      showViewer: showViewer,
      applyReorder: applyReorder,
      setWheelZoomStatus: setWheelZoomStatus,
      getViewerDraws: getViewerDraws,
      getOverlaysCountBool: getOverlaysCountBool,
      addWFSLayer: addWFSLayer
    };

    /**
     * Private property that stores the base layers / overlays 
     *  
     */
    var serviceData = {};

    /**
     * Get the viewer overlays
     * 
     * @param {any} viewerId 
     * @returns {}
     */
    function getViewerOverlays(viewerId) {
      var viewerData = getViewerData(viewerId);
      var overlays = angular.copy(viewerData.overlays);
      if (overlays && angular.isDefined(overlays.draw)) {
        delete overlays.draw;
      }
      return overlays;
    }

    /**
     * Get the viewer draws
     * 
     * @param {any} viewerId 
     * @returns {}
     */
    function getViewerDraws(viewerId) {
      var viewerData = getViewerData(viewerId);
      var overlays = angular.copy(viewerData.overlays);
      if (overlays && angular.isDefined(overlays.draw)) {
        return overlays.draw;
      }
    }

    /**
     * Set the mouse wheel scroll zoom control as enabled/disabled for a certain viewer
     * 
     * @param {string} viewerId 
     * @param {boolean} enabled
     * @returns void
     */
    function setWheelZoomStatus(viewerId, enabled) {
      leafletData.getMap(viewerId).then(function (map) {
        if (enabled === true) {
          map.scrollWheelZoom.enable();
        } else {
          map.scrollWheelZoom.disable();
        }
      });
    }

    /**
     * Get boolean. True if there are no overlays added.
     * 
     * 
     * 
     */
    function getOverlaysCountBool() {
      if (Object.values(serviceData)[0]["overlays"] == undefined && Object.values(serviceData)[1]["overlays"] == undefined) {
        return true;
      } else {
        return false;
      }
    }

    /**
     * Get view data by viewer ID
     * 
     * @param {any} viewerId 
     * @returns {}
     */
    function getViewerData(viewerId) {
      viewerId = parseMapViewerId(viewerId);
      if (viewerId in serviceData) {
        return serviceData[viewerId];
      }
      return {};
    }

    /**
     * Build the default base layers
     * @param {} options
     */
    function buildDefaultLayers(options) {
      options = angular.isUndefined(options) ? {} : options;

      SupportService.config().then(function (response) {
        service.serverConfig = response;
      });

      serviceData.leftMapViewer = {
        baselayers: getBaseLayers()
      };

      if (options.supportDrawing) {
        serviceData.leftMapViewer.overlays = {
          draw: {
            name: 'draw',
            type: 'group',
            visible: true,
            layerParams: {
              showOnSelector: false
            }
          }
        };
      }
      // At the beginning both map layers are equal
      serviceData.rightMapViewer = angular.copy(serviceData.leftMapViewer);
      listenAndApplyDraw();
    }

    /**
     * Apply draw as new layer on draw
     * 
     */
    function listenAndApplyDraw() {
      function keepDraw(viewerId) {
        leafletData.getMap(viewerId).then(function (map) {
          leafletData.getLayers(viewerId).then(function (baselayers) {
            // console.log("baselyer = ", baselayers);
            var drawnItems = baselayers.overlays.draw;
            // added condition to handle rectangle selection for Georef
            if (typeof drawnItems !== "undefined") {
              map.on('draw:created', function (e) {
                var layer = e.layer;
                drawnItems.addLayer(layer);
                var drawsGeoJson = layer.toGeoJSON();
                // broadcast the events
                $rootScope.$broadcast('mapLayersChanged');
                $rootScope.$broadcast('addedMapDraw', drawsGeoJson);
              }.bind(drawnItems));
            }
          });
        });
      }
      keepDraw('leftMapViewer');
      keepDraw('rightMapViewer');
    }

    /**
     * Get the default center for a layer
     */
    function getDefaultCenter() {
      // Heidelberg, Germany
      return {
        lat: 49.399228,
        lng: 8.680522,
        zoom: 8
      };
    }

    /**
     * Get the base layers
     */
    function getBaseLayers() {
      return {
        xyz: {
          name: 'OpenStreetMap',
          url: 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
          type: 'xyz',
          opacity: 1,
          layerOptions: {
            zIndex: 0
          }
        },
        bingAerial: {
          name: 'Aerial',
          type: 'bing',
          key: 'Aj6XtE1Q1rIvehmjn2Rh1LR2qvMGZ-8vPS9Hn3jCeUiToM77JFnf-kFRzyMELDol',
          layerOptions: {
            type: 'Aerial',
            opacity: 1,
            zIndex: 0
          }
        },
        bingRoad: {
          name: 'Road',
          type: 'bing',
          key: 'Aj6XtE1Q1rIvehmjn2Rh1LR2qvMGZ-8vPS9Hn3jCeUiToM77JFnf-kFRzyMELDol',
          layerOptions: {
            type: 'Road',
            opacity: 1,
            zIndex: 0
          }
        },
        bingAerialWithLabels: {
          name: 'Aerial With Labels',
          type: 'bing',
          key: 'Aj6XtE1Q1rIvehmjn2Rh1LR2qvMGZ-8vPS9Hn3jCeUiToM77JFnf-kFRzyMELDol',
          layerOptions: {
            type: 'AerialWithLabels',
            opacity: 1,
            zIndex: 0
          }
        }
      };
    }

    /**
     * Build an additional overlays
     * @param {} resource 
     */
    function buildMapOverlay(resource) {
      var layer = {
        name: resource.title,
        type: 'wms',
        visible: true,
        url: service.serverConfig.base_ows_url,
        layerParams: {
          layers: resource.geoserver_layer_id,
          format: 'image/png',
          transparent: true,
          opacity: 0.7
        },
        layerOptions: {
          opacity: 0.7,
          tiled: true
        },
        resource: resource
      };
      return layer;
    }

    /**
     * Fit the map view to the bounds of a layer
     * @param object resource 
     * @param string mapComponentId 
     */
    function fitMapBounds(resource, viewerId) {
      viewerId = parseMapViewerId(viewerId);
      leafletData.getMap(viewerId).then(function (map) {
        var bounds = [[resource.map_top_left_long, resource.map_top_left_lat], [resource.map_right_bottom_long, resource.map_right_bottom_lat]];
        map.fitBounds(bounds);
      });
    }

    /**
     * Apply the layer defined opacity or the value defined in the layer transparency property
     * @param {} layer 
     * @param string viewerId 
     */
    function applyOpacity(layer) {
      leafletData.getLayers(layer.viewerId).then(function (layers) {
        var overlayId = parseMapOverlayId(layer.viewerId, layer.resource);
        layers.overlays[overlayId].setOpacity(layer.layerParams.opacity);
      });
    }

    /**
     * Add a map as a layer to the maps (left and right)
     * 
     * @param object resource representing map
     */
    function addMapLayer(resource, viewerId) {

      // console.log(resource)

      if (isAdded(resource, viewerId) === false) {

        prepareViewer(resource, viewerId).then(function () {
          // parse the viewer id and make sure that
          // the overlays property is initialized
          viewerId = parseMapViewerId(viewerId);
          if (angular.isUndefined(serviceData[viewerId].overlays)) {
            serviceData[viewerId].overlays = {};
          }

          // build a new overlay
          var newLayer = buildMapOverlay(resource);
          // set the viewerId in as a property (in some loop it can be useful)
          newLayer.viewerId = viewerId;
          var overlayId = parseMapOverlayId(viewerId, resource);

          // add the new layer as a property of the layer
          serviceData[viewerId].overlays[overlayId] = newLayer;

          // fit the bounds of the new loaded map layer, so it is visible
          fitMapBounds(resource, viewerId);
          listenAndApplyDraw();

          // broadcast the events
          $rootScope.$broadcast('mapLayersChanged');
          $rootScope.$broadcast('addedMapLayer', resource);
          showMap(resource, viewerId);
        });
      }
    }

    /**
     * Prepare sa viewer for loading map layer according its georeferencing status
     * 
     * @param {any} resource 
     * @param {any} viewerId 
     * @returns promise 
     */
    function prepareViewer(resource, viewerId) {
      if (resource.georeferenced === false) {
        return prepareForUngeoreferenced(viewerId);
      } else {
        return prepareForGeoreferenced(viewerId);
      }
    }

    /**
     * Prepare the viewer to load an ungeoreferenced layer, removing all the base layers and overlays
     * @param {} viewerId 
     * @returns promise
     */
    function prepareForUngeoreferenced(viewerId) {
      var deferred = $q.defer();
      $rootScope.$broadcast('ungeoreferencedLayerToBeLoaded', viewerId);

      // to give the opportunity to the ungeoreferencedLayerToBeLoaded event listeners
      // to do some action before the viewer is prepared, it is necessary to wait a little
      // so we use the timeout for that. 200 milliseconds appears to be enough
      $timeout(function () {
        serviceData[viewerId].overlays = {};
        serviceData[viewerId].baselayers = {};
        deferred.resolve();
      }, 200);

      // return the promise
      return deferred.promise;
    }

    /**
     * Prepare the viewer to load an ungeoreferenced layer, removing all the base layers and overlays
     * @param {} viewerId 
     * @returns promise
     */
    function prepareForGeoreferenced(viewerId) {
      var deferred = $q.defer();
      $rootScope.$broadcast('georeferencedLayerToBeLoaded', viewerId);

      // to give the opportunity to the ungeoreferencedLayerToBeLoaded event listeners
      // to do some action before the viewer is prepared, it is necessary to wait a little
      // so we use the timeout for that. 200 milliseconds appears to be enough
      $timeout(function () {
        serviceData[viewerId].baselayers = getBaseLayers();
        deferred.resolve();
      }, 200);

      // return the promise
      return deferred.promise;
    }

    /**
     * Remove a map resource from the overlays
     * @param {} resource map
     * @param string viewerId 
     */
    function removeMapLayer(resource, viewerId) {
      viewerId = parseMapViewerId(viewerId);
      var overlayId = parseMapOverlayId(viewerId, resource);
      delete serviceData[viewerId].overlays[overlayId];
      listenAndApplyDraw();
      $rootScope.$broadcast('mapLayersChanged');
      $rootScope.$broadcast('removedMapLayer', resource);
    }

    /**
     * Remove a map resource from the overlays
     * @param {} resource map
     * @param string viewerId 
     */
    function removeAllMapLayers(viewerId) {
      viewerId = parseMapViewerId(viewerId);
      serviceData[viewerId].overlays = {};
      $rootScope.$broadcast('mapLayersChanged');
      $rootScope.$broadcast('removedAllMapLayers');
    }

    /**
     * Hide a map but keep it in the loaded list
     * @param {} resource map
     * @param string viewerId 
     */
    function hideMap(resource, viewerId) {
      viewerId = parseMapViewerId(viewerId);
      var overlayId = parseMapOverlayId(viewerId, resource);
      serviceData[viewerId].overlays[overlayId].visible = false;
      $rootScope.$broadcast('mapLayersChanged');
      $rootScope.$broadcast('mapHidden', resource);
    }

    /**
     * Show a map previously loaded
     * @param {} resource map
     * @param string viewerId 
     */
    function showMap(resource, viewerId) {
      viewerId = parseMapViewerId(viewerId);
      var overlayId = parseMapOverlayId(viewerId, resource);
      serviceData[viewerId].overlays[overlayId].visible = true;
      $rootScope.$broadcast('mapLayersChanged');
      $rootScope.$broadcast('mapShown', resource);
    }

    /**
     * Hide a viewer
     * @param string viewerId 
     */
    function hideViewer(viewerId) {
      viewerId = parseMapViewerId(viewerId);
      serviceData[viewerId].visible = false;
      $rootScope.$broadcast('mapViewersChanged');
      $rootScope.$broadcast('viewerHidden', viewerId);
    }

    /**
     * Show a viewer     
     * @param string viewerId 
     */
    function showViewer(viewerId) {
      viewerId = parseMapViewerId(viewerId);
      serviceData[viewerId].visible = true;
      $rootScope.$broadcast('mapViewersChanged');
      $rootScope.$broadcast('viewerShown', viewerId);
    }

    /**
     * Parse a default layer id
     * @param string viewerId 
     */
    function parseMapViewerId(viewerId) {
      if (angular.isUndefined(viewerId) || viewerId === null) {
        viewerId = 'rightMapViewer';
      }
      return viewerId;
    }

    /**
     * Parse a default layer id
     * @param string viewerId 
     * @param {} resource map 
     */
    function parseMapOverlayId(viewerId, resource) {
      if (angular.isUndefined(viewerId) || viewerId === null) {
        viewerId = 'rightMapViewer';
      }
      var overlayId = viewerId + resource.id;
      return overlayId;
    }

    /**
     * check if a map resource is already loaded
     * 
     * @param object resource 
     */
    function isAdded(resource, viewerId) {
      viewerId = parseMapViewerId(viewerId);
      if (angular.isUndefined(serviceData[viewerId].overlays)) {
        return false;
      }
      var overlayId = parseMapOverlayId(viewerId, resource);
      return angular.isDefined(serviceData[viewerId].overlays[overlayId]);
      //return (resource.id in serviceData[viewerId].overlays);
    }

    /**
     * Check if  there are non georeferenced layers loaded in the viewer
     * 
     * @param string viewerId 
     * @returns boolean
     */
    function hasNonGeoreferencedLayer(viewerId) {
      viewerId = parseMapViewerId(viewerId);
      var nonGeoLayers = lodash.filter(getViewerOverlays(viewerId), function (layer) {
        return layer.resource.georeferenced === false;
      });
      return angular.isArray(nonGeoLayers) && nonGeoLayers.length > 0;
    }

    /**
     * Refresh the resource of a layer
     * @param {resource} resource 
     * @param string viewerId 
     */
    function refreshLayerResource(resource, viewerId) {
      viewerId = parseMapViewerId(viewerId);
      var overlayId = parseMapOverlayId(viewerId, resource);
      delete serviceData[viewerId].overlays[overlayId];
      addMapLayer(resource, viewerId);
    }

    /**
     * When a map is edited, refresh the map the map layer
     */
    function refreshMapResource(resource) {
      if (isAdded(resource, 'rightMapViewer')) {
        refreshLayerResource(resource, 'rightMapViewer');
      }
      if (isAdded(resource, 'leftMapViewer')) {
        refreshLayerResource(resource, 'leftMapViewer');
      }
    }

    /**
     * Apply the new order and broadcast the mapLayersReordered event
     * 
     * @param {any} layersInOrder 
     */
    function applyReorder(layersInOrder) {
      var counter = 1;
      // iterate over the layersInOrder and apply the new z-index of each one
      layersInOrder.slice().reverse().forEach(function (value) {
        // for each layer identification, we get the leaflet layers object
        leafletData.getLayers(value.viewerId).then(function (layers) {
          // we parse the mapOverlayId
          var overlayId = parseMapOverlayId(this.value.viewerId, this.value.resource);
          // apply the new z-index
          layers.overlays[overlayId].setZIndex(this.counter);
        }.bind({ value: value, counter: counter }));
        counter++;
      });

      // broadcast the event
      $rootScope.$broadcast('mapLayersReordered');
    }

    function addWFSLayer(layerName, viewerId) {
      console.log(">>> MaplayerService >>> addWFSLayer >>> ", layerName);
      leafletData.getMap(viewerId).then(function (map) {
        var tempLayer = new leaflet.WFS({
          url: 'https://demo.geo-solutions.it:443/geoserver/ows',
          typeNS: 'topp',
          typeName: 'tasmania_state_boundaries',
          /* url: 'http://0.0.0.0:8081/geoserver/ows',
          typeNS: 'public',
          typeName: '0_1536149875', // layerName */
          crs: leaflet.CRS.EPSG4326,
          geometryField: 'the_geom',
          style: {
            color: 'blue',
            weight: 2
          }
        }).addTo(map).on('load', function () {
          map.fitBounds(tempLayer.getLayers()[0].getBounds());
        });
      });
    }

    return service;
  }
})();
'use strict';

(function () {
  'use strict';

  MapMarkerService.$inject = ["lodash", "leaflet"];
  angular.module('app').factory('MapMarkerService', MapMarkerService);

  function MapMarkerService(lodash, leaflet) {
    var service = {
      buildMarker: buildMarker
    };

    /**
     * Builds a marker object
     * 
     * @param {object} defaultOptions 
     * @param {object} markerOptions
     * @returns {object} marker
     */
    function buildMarker(markersHolder, markerOptions) {
      var defaultOptions = {
        focus: true,
        draggable: true
      };

      angular.merge(defaultOptions, markerOptions);
      var mKey = getNextMarkerKey(markersHolder);
      var mId = 'm' + mKey;
      var classes = 'mk-div-icon ' + mId;

      // build the icon object to be used in the marker
      var mIcon = {
        type: 'div',
        className: classes,
        iconSize: null,
        html: '<div class="mk-icon-container mk-ok">' + mKey + '</div>' // mk-ok, mk-warn or mk-error


        // return the marker object with its properties/values
      };return {
        id: mId,
        lat: defaultOptions.lat,
        lng: defaultOptions.lng,
        focus: defaultOptions.focus,
        message: defaultOptions.message,
        draggable: defaultOptions.draggable,
        icon: mIcon
      };
    }

    /**
     * Get the next auto increment id that must be used for a new marker
     * 
     * @param {any} markersHolder 
     * @returns nextIndex
     */
    function getNextMarkerKey(markersHolder) {
      var max = 0;
      lodash.forOwn(markersHolder, function (value, key) {
        var keyIndex = parseInt(key.replace('m', ''));
        if (keyIndex > max) {
          max = keyIndex;
        }
      });

      return (max + 1).toString();
    }

    return service;
  }
})();
'use strict';

(function () {
  'use strict';

  MapProjectService.$inject = ["serviceFactory", "$q"];
  angular.module('app').factory('MapProjectService', MapProjectService);

  /** @ngInject */
  function MapProjectService(serviceFactory, $q) {
    var model = serviceFactory('/heimap/map-project', {
      actions: {},
      instance: {}
    });
    return model;
  }
})();
'use strict';

(function () {
  'use strict';

  MapProjectionService.$inject = ["serviceFactory", "$q"];
  angular.module('app').factory('MapProjectionService', MapProjectionService);

  /** @ngInject */
  function MapProjectionService(serviceFactory, $q) {
    var model = serviceFactory('/heimap/map-projection', {
      actions: {},
      instance: {}
    });
    return model;
  }
})();
'use strict';

(function () {
  'use strict';

  MapTypeService.$inject = ["serviceFactory", "$q"];
  angular.module('app').factory('MapTypeService', MapTypeService);

  /** @ngInject */
  function MapTypeService(serviceFactory, $q) {
    var model = serviceFactory('/heimap/map-type', {
      actions: {},
      instance: {}
    });
    return model;
  }
})();
'use strict';

/**
 * Map Layer Service responsible for storing and returning global viewer option used by multiple controllers.
 * 
 * As a centralized service this service change the option value when asked for and broadcast an event when
 * this change occurs. The following event is broadcasted:
 * 
 * viewerOptionChanged

 */
(function () {
  'use strict';

  MapViewerService.$inject = ["$rootScope"];
  angular.module('app').service('MapViewerService', MapViewerService);

  function MapViewerService($rootScope) {
    var service = {
      setOption: setOption,
      getOption: getOption
    };

    /**
     * Private property that stores the viewer global options 
     *  
     */
    var serviceData = {};

    /**
     * Define an option for a viewer with a given value
     * 
     * @param {any} viewerId 
     * @param {any} option 
     * @param {any} value 
     */
    function setOption(viewerId, option, value) {
      parseViewer(viewerId, option);
      serviceData[viewerId][option] = value;
      var changed = { viewerId: viewerId, option: viewerId, value: value };
      $rootScope.$broadcast('viewerOptionChanged', changed);
    }

    /**
     * Get an global option value, or, if it is not defined, the default value
     * 
     * @param {any} viewerId 
     * @param {any} option 
     * @param {any} defaultValue 
     * @returns 
     */
    function getOption(viewerId, option, defaultValue) {
      parseViewer(viewerId, option);
      if (angular.isUndefined(serviceData[viewerId][option])) {
        return defaultValue;
      }
      return serviceData[viewerId][option];
    }

    /**
     * Ensures that the viewer property exists
     * 
     * @param {any} viewerId 
     */
    function parseViewer(viewerId) {
      if (angular.isUndefined(serviceData[viewerId])) {
        serviceData[viewerId] = {};
      }
    }
    return service;
  }
})();
'use strict';

(function () {

  'use strict';

  ImportController.$inject = ["$controller", "ImportService"];
  angular.module('app').controller('ImportController', ImportController);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function ImportController($controller, ImportService) {
    var vm = this;

    //Attributes Block

    //Functions Block

    // instantiate base controller
    $controller('CRUDController', { vm: vm, modelService: ImportService, options: { searchOnInit: false } });
  }
})();
'use strict';

(function () {
  'use strict';

  routes.$inject = ["$stateProvider", "Global"];
  angular.module('app').config(routes);

  /**
   * Arquivo de configuração com as rotas específicas do recurso import
   *
   * @param {object} $stateProvider
   * @param {object} Global
   */
  /** @ngInject */
  function routes($stateProvider, Global) {
    $stateProvider.state('app.import', {
      url: '/import',
      templateUrl: Global.clientPath + '/import/import.html',
      controller: 'ImportController as importCtrl',
      data: {}
    });
  }
})();
'use strict';

(function () {
  'use strict';

  ImportService.$inject = ["serviceFactory"];
  angular.module('app').factory('ImportService', ImportService);

  /** @ngInject */
  function ImportService(serviceFactory) {
    var model = serviceFactory('import', {
      actions: {},
      instance: {}
    });

    return model;
  }
})();
'use strict';

(function () {
  'use strict';

  SupportService.$inject = ["serviceFactory", "$http", "$q"];
  angular.module('app').factory('SupportService', SupportService);

  /** @ngInject */
  function SupportService(serviceFactory, $http, $q) {
    var endPoint = '/heimap/support';
    var model = serviceFactory(endPoint, {
      actions: {
        config: {
          method: 'GET',
          isArray: false,
          wrap: false,
          url: 'config',
          afterRequest: function afterRequest(response) {
            return response;
          }
        }
      },
      instance: {}
    });

    return model;
  }
})();
'use strict';

(function () {

  'use strict';

  PreferencesController.$inject = ["$controller", "PreferencesService"];
  angular.module('app').controller('PreferencesController', PreferencesController);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function PreferencesController($controller, PreferencesService) {
    var vm = this;

    //Attributes Block

    //Functions Block

    // instantiate base controller
    $controller('CRUDController', { vm: vm, modelService: PreferencesService, options: { searchOnInit: false } });
  }
})();
'use strict';

(function () {
  'use strict';

  routes.$inject = ["$stateProvider", "Global"];
  angular.module('app').config(routes);

  /**
   * Arquivo de configuração com as rotas específicas do recurso preferences
   *
   * @param {object} $stateProvider
   * @param {object} Global
   */
  /** @ngInject */
  function routes($stateProvider, Global) {
    $stateProvider.state('app.preferences', {
      url: '/preferences',
      templateUrl: Global.clientPath + '/preferences/preferences.html',
      controller: 'PreferencesController as preferencesCtrl',
      data: {}
    });
  }
})();
'use strict';

(function () {
  'use strict';

  PreferencesService.$inject = ["serviceFactory"];
  angular.module('app').factory('PreferencesService', PreferencesService);

  /** @ngInject */
  function PreferencesService(serviceFactory) {
    var model = serviceFactory('preferences', {
      actions: {},
      instance: {}
    });

    return model;
  }
})();
'use strict';

(function () {

    'use strict';

    ProjectController.$inject = ["$location", "Global"];
    angular.module('app').controller('ProjectController', ProjectController);

    /** @ngInject */
    // eslint-disable-next-line max-params
    function ProjectController($location, Global) {
        var vm = this;

        //Attributes Block

        //Functions Block

        // console.log($location.search());
        var qParams = $location.search();
        sessionStorage.clear();
        // sessionStorage.setItem("role", "admin");
        if (qParams.role === "admin") {
            sessionStorage.setItem("role", "1");
        } else if (qParams.role === "senior") {
            sessionStorage.setItem("role", "2");
        } else if (qParams.role === "user") {
            sessionStorage.setItem("role", "3");
        } else if (qParams.role === "guest") {
            sessionStorage.setItem("role", "4");
        }

        // console.log("appcontroller ", $localStorage);
        sessionStorage.setItem("projId", qParams.projId);
        sessionStorage.setItem("userId", qParams.userId);
        $location.url(Global.clientPath);
    }
})();
'use strict';

(function () {
  'use strict';

  routes.$inject = ["$stateProvider", "Global"];
  angular.module('app').config(routes);

  /**
   * Arquivo de configuração com as rotas específicas do recurso export
   *
   * @param {object} $stateProvider
   * @param {object} Global
   */
  /** @ngInject */
  function routes($stateProvider, Global) {
    $stateProvider.state('app.project', {
      url: '/project',
      templateUrl: Global.clientPath + '/project/project.html',
      controller: 'ProjectController as projectCtrl',
      data: {}
    });
  }
})();
'use strict';

(function () {
  'use strict';

  ProjectService.$inject = ["serviceFactory"];
  angular.module('app').factory('ProjectService', ProjectService);

  /** @ngInject */
  function ProjectService(serviceFactory) {
    var model = serviceFactory('export', {
      actions: {},
      instance: {}
    });

    return model;
  }
})();
'use strict';

(function () {
  'use strict';

  FeatureService.$inject = ["lodash"];
  angular.module('app').factory('FeatureService', FeatureService);

  function FeatureService(lodash) {

    var service = {
      getAttribute: getAttribute,
      setAttribute: setAttribute,
      createObject: createObject,
      stitchObject: stitchObject,
      createObjectFromGeoJson: createObjectFromGeoJson,
      createGeoJson: createGeoJson,
      tearObject: tearObject
    };

    function getAttribute(featureId) {
      return { "abc": "def" };
    }

    function setAttribute(featureProperties) {
      console.log(">>> FeatureService >>> setAttribute ", featureProperties);
    }

    function createObject(obj) {
      console.log(">>> FeatureService >>> createObject ", obj);
      return obj;
    }

    function createObjectFromGeoJson(obj) {
      // console.log(">>> FeatureService >>> createObjectFromGeoJson ", obj.properties);

      if (lodash.size(obj.properties.key_cidoc_array.split("|")) === lodash.size(obj.properties.value_gazetteer_array.split("|"))) {
        var keyArr = obj.properties.key_cidoc_array.split("|");
        var valueArr = obj.properties.value_gazetteer_array.split("|");
        var temp = {
          // "id": obj.properties.type_crm
          "type_crm": obj.properties.type_crm
        };
        // console.log(" keyArr ", keyArr, valueArr);

        for (var i = 0; i < keyArr.length; i++) {
          if (valueArr[i].indexOf("[") !== -1) {
            if (valueArr[i] !== "[object Object]") {
              temp[keyArr[i]] = JSON.parse(valueArr[i]);
            }
          } else {
            if (keyArr[i] !== "type_crm") {
              temp[keyArr[i]] = valueArr[i];
            }
          }
        }
        temp["geom"] = obj.geometry;
        // console.log("temp = ", temp);
        return temp;
      }
    }

    /**
     * generate a object with has key : value pair
     * 
     * @param {*} keys 
     * @param {*} values 
     */
    function stitchObject(keys, values) {
      // console.log(">>> FeatureService >>> stitchObject ", keys, values);
      var returnObj = {};
      if (lodash.size(keys) === lodash.size(values)) {
        for (var i = 0; i < keys.length; i++) {
          returnObj[keys[i]] = values[i];
        }
        // console.log(">>> FeatureService >>> stitchObject ", returnObj);
        return returnObj;
      }
    }

    function tearObject(obj) {
      // console.log(">>> FeatureService >>> tearObject ", obj);
      // var returnObj = {};
      var keys = Object.keys(obj);
      var values = Object.values(obj);

      var resultVal = [];
      for (var i = 0; i < values.length; i++) {
        if (Array.isArray(values[i])) {
          resultVal.push(JSON.stringify(values[i]));
          // } else if(typeof values[i] === "string" || typeof values[i] === "object") {
        } else {
          resultVal.push(values[i]);
        }
      }
      // keys.push("geom");
      // values.push(feature.geometry);
      return {
        "keys": keys,
        "values": resultVal
      };
    }

    function createGeoJson(geojson, properties) {
      console.log(">>> FeatureService >>> createGeoJson ", geojson, properties);
    }

    return service;
  }
})();
'use strict';

(function () {

  'use strict';

  VectorController.$inject = ["$controller", "$scope", "VectorService", "Global"];
  angular.module('app').controller('VectorController', VectorController);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function VectorController($controller, $scope, VectorService, Global) {
    var vm = this;

    // Functions Block     
    vm.onViewerActivate = onViewerActivate;
    vm.beforeViewerActivate = beforeViewerActivate;

    // Set the map viewer options
    var options = {
      supportListingView: false,
      supportDrawing: false,
      titleTranslKey: 'views.titles.vectorTitle',
      showVectorLayers: true,
      leftSideBar: Global.clientPath + '/vector/navs/vector-left-sidenav.html',
      rightSideBar: Global.clientPath + '/vector/navs/vector-right-sidenav.html'
      // bottomNav : false
    };

    // initialize empty markers object
    vm.rightMarkers = {};
    vm.leftMarkers = {};
    vm.layerNames = [];

    // instantiate the base MapViewerController
    $controller('MapViewerController', { vm: vm, $scope: $scope, options: options });

    /**
     * Actions executed before the base viewer is activated
     * 
     */
    function beforeViewerActivate() {}
    // get vector layers from API and list them in left side nav
    // getLayerNames();
    // get ProjId
    // console.log($scope.$parent);


    /**
     * Actions executed after the base viewer is activated
     * 
     */
    function onViewerActivate() {}
    // Set global viewer options
    // changed for resolving #184 
    // MapViewerService.setOption('rightMapViewer', 'showLoadMapInRight', false);
    // MapViewerService.setOption('rightMapViewer', 'showLoadMapInRight', true);
    // MapViewerService.setOption('leftMapViewer', 'showLoadMapInRight', true);


    /**
     * Get Layer name from API
     * 
     */
    function getLayerNames() {
      var layerService = new VectorService();
      layerService.getVectorLayers().then(function (result) {
        vm.layerNames = result;
        console.log("layerNames = ", vm.layerNames);
      }, function (err) {
        console.log(err);
        // the code inside this block will be fired if some error occur
        // here you can show some error message or do nothing, depending on the business rule

        //TODO: notify the user about the error?
      });
    }
  }
})();
'use strict';

(function () {
  'use strict';

  routes.$inject = ["$stateProvider", "Global"];
  angular.module('app').config(routes);

  /**
   * Configuration file for georeference route
   *
   * @param {object} $stateProvider
   * @param {object} Global
   */
  /** @ngInject */
  function routes($stateProvider, Global) {
    $stateProvider.state('app.vector', {
      url: '/vector',
      templateUrl: Global.clientPath + '/vector/vector.html',
      controller: 'VectorController as mapCtrl',
      data: {}
    });
  }
})();
'use strict';

(function () {
  'use strict';

  VectorService.$inject = ["serviceFactory", "$http", "$q"];
  angular.module('app').factory('VectorService', VectorService);

  /** @ngInject */
  function VectorService(serviceFactory, $http, $q) {
    var getVectorLayersUrl = "/heimap/vector/layers";

    var model = serviceFactory(getVectorLayersUrl, {
      actions: {},
      instance: {
        getVectorLayers: getVectorLayers,
        createVectorLayers: createVectorLayers,
        createFeatures: createFeatures,
        editVectorLayers: editVectorLayers,
        deleteVectorLayer: deleteVectorLayer,
        getAllFeatureVersion: getAllFeatureVersion,
        getFormData: getFormData,
        exportLayerGeoJson: exportLayerGeoJson
      }
    });

    function getVectorLayers(paramData) {
      // console.log(">>> VectorService >>> getVectorLayers ", previewGcpEndPoint, paramData);
      // http://localhost:8080/heimap/vector?user_id=112345&proj_id=312344&fetch=allLayers
      var getLayerUrl = "/heimap/vector";
      var deferred = $q.defer();

      $http({
        method: 'GET',
        url: getLayerUrl,
        params: paramData
      }).then(function successCallback(response) {
        // console.log("response ", response);
        deferred.resolve(response.data.items);
      }, function errorCallback(response) {
        deferred.reject(response);
      });

      return deferred.promise;
    }

    function createVectorLayers(paramData) {
      // console.log(">>> VectorService >>> createVectorLayers ", paramData);
      var createLayerUrl = "/heimap/vector/layer";
      var deferred = $q.defer();

      $http.post(createLayerUrl, paramData).then(function (result) {
        deferred.resolve(result.data);
      }, function (err) {
        deferred.reject(err);
      });

      return deferred.promise;
    }

    function createFeatures(paramData) {
      var createFeatureUrl = "/heimap/vector/feature";
      var deferred = $q.defer();

      $http.post(createFeatureUrl, paramData).then(function successCallback(response) {
        deferred.resolve(response.data);
      }, function errorCallback(response) {
        deferred.reject(response);
      });
      return deferred.promise;
    }

    function deleteVectorLayer(paramData) {
      var delLayerUrl = "/heimap/vector/layer";
      var deferred = $q.defer();

      $http.post(delLayerUrl, paramData).then(function successCallback(response) {
        deferred.resolve(response.data);
      }, function errorCallback(response) {
        deferred.reject(response);
      });
      return deferred.promise;
    }

    function editVectorLayers(paramData) {
      var editLayerUrl = "/heimap/vector/layer";
      var deferred = $q.defer();

      $http.post(editLayerUrl, paramData).then(function successCallback(response) {
        deferred.resolve(response.data);
      }, function errorCallback(response) {
        deferred.reject(response);
      });
      return deferred.promise;
    }

    function getAllFeatureVersion(paramData) {
      var getAllVersionUrl = "/heimap/vector";
      var deferred = $q.defer();

      $http({
        method: 'GET',
        url: getAllVersionUrl,
        params: paramData
      }).then(function successCallback(response) {
        // console.log("response ", response);
        deferred.resolve(response.data.items);
      }, function errorCallback(response) {
        deferred.reject(response);
      });

      return deferred.promise;
    }

    function getFormData(paramData) {
      var getFormUrl = "/heimap/feature-source-type";
      var deferred = $q.defer();

      $http({
        method: 'GET',
        url: getFormUrl,
        params: paramData
      }).then(function successCallback(response) {
        // console.log("response ", response);
        deferred.resolve(response.data.items);
      }, function errorCallback(response) {
        deferred.reject(response);
      });
      // deferred.resolve([
      //   {"name":"buildingType","required":false,"type":"text","order":1,"placeholder":"buildingType","dependent":"buildingType"},
      //   {"name":"country","required":false,"type":"text","order":3,"placeholder":"country","dependent":"country"},
      //   {"name":"state","required":false,"type":"text","order":2,"placeholder":"state","dependent":"country"},
      //   {"name":"king","required":false,"type":"text","order":4,"placeholder":"king","dependent":"king"},
      //   {"name":"city","order":5,"placeholder":"city","dependent":"country","type":"select","options":[{"order":0,"name":"mumbai","value":"mumbai"},{"order":1,"name":"heidelberg","value":"heidelberg"}]},
      //   {"name":"language","order":6,"placeholder":"language","type":"multiple","dependent":"language","options":[{"order":0,"name":"english","value":"english"},{"order":1,"name":"german","value":"german"}],"value":["english"]},
      //   {"name":"description","order":7,"type":"textarea","placeholder":"description","value":"","dependent":"description","required":false}
      // ]);

      return deferred.promise;
    }

    function exportLayerGeoJson(paramData) {
      var exportUrl = "/heimap/vector";
      var deferred = $q.defer();

      $http({
        method: 'GET',
        url: exportUrl,
        params: paramData
      }).then(function successCallback(response) {
        // console.log("response ", response);
        deferred.resolve(response.data);
      }, function errorCallback(response) {
        deferred.reject(response);
      });

      return deferred.promise;
    }

    return model;
  }
})();
'use strict';

(function () {

  'use strict';

  GcpTableController.$inject = ["$scope", "$rootScope", "$translate", "C2Dialog", "$mdColors", "Global", "GeoreferenceService", "lodash"];
  angular.module('app').controller('GcpTableController', GcpTableController);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function GcpTableController($scope, $rootScope, $translate, C2Dialog, $mdColors, Global, GeoreferenceService, lodash) {
    var vm = this;
    vm.deleteGCPFromTable = deleteGCPFromTable;
    vm.deleteGCPFromMap = deleteGCPFromMap;
    vm.refreshGCPTable = refreshGCPTable;
    vm.avgRmse = null;
    $scope.showTable = false;
    $scope.tableData = [];
    $scope.paginationLimit = 5;
    $scope.paginationCurrentPage = 1;

    // global variable used for refresh
    vm.geoRef = null;

    $rootScope.$on('previewGcp', function (event, args) {
      // console.log(">>> GcpTableController >>> previewGcpEvent", args);
      previewGcp(args);
    });

    $rootScope.$on('deleteGcpFromTableEvent', function (event, args) {
      // console.log(">>> GcpTableController >>> deleteGcpFromTableEvent", args);
      deleteGCPFromTable(args);
    });

    $rootScope.$on('refreshGcpTableEvent', function (event, args) {
      // console.log(">>> GcpTableController >>> refreshGcpTableEvent", args);
      refreshGCPTable();
    });

    $rootScope.$on('clearGcp', function (event, args) {
      // console.log(">>> GcpTableController >>> clearGcp", args);
      clearData();
    });

    /**
     * Start of the GCP Table controller
     * 
     */
    function init() {
      // console.log(">>> GcpTableController >>> init");
      // previewGcp();
    }

    function previewGcpInTable(tableData) {}
    // console.log(">>> GcpTableController >>> previewGcpInTable", tableData);
    // $scope.tableData = result.items[3];


    /**
     * Call the RMSE api to calculate the RMS error for each GCPoints
     * and fill the GCP table below to response data and creates marker on Left and Right Map
     * 
     * @param {object} geoRef
     */
    function previewGcp(geoRef) {
      // console.log(">>> GcpTableController >>> previewGcp");
      // $scope.showTable = true;
      // var geoRef = new GeoreferenceService();
      if (!vm.geoRef) {
        vm.geoRef = geoRef;
      }

      geoRef.previewGCP(geoRef).then(function (result) {
        // console.log("result from API ", result);
        $scope.tableData = result.items[3];
        if (angular.isDefined(result.items[2]["average error"])) {
          vm.avgRmse = result.items[2]["average error"];
        }
        // console.log("result from API ", $scope.tableData);
        //create marker object as required by leaflet marker object
        $scope.showTable = true;
        lodash.forEach($scope.tableData, function (markerFromDB) {
          // remove "m" from id attribute
          markerFromDB.gcpNo = markerFromDB.id[1];
          // markers for left map ie Non georeference
          // generateLeftMarker(markerFromDB, function() {
          //   generateRightMarker(markerFromDB);
          // });
        });
      }, function (err) {
        console.log(err);
        // the code inside this block will be fired if some error occur
        // here you can show some error message or do nothing, depending on the business rule

        //TODO: notify the user about the error?
      });
    }

    /**
     * Generate markers on Left Map
     * 
     * To be used when a user wants to view his or someone else's GCP
     * 
     * @param {object} markerFromDB
     * @param {object} callback
     */
    function generateLeftMarker(markerFromDB, callback) {
      var marker = null;
      marker = {
        "draggable": true,
        // "icon": {type: "div", className: "mk-div-icon "+markerFromDB.id, iconSize: null, html: "<div class=\"mk-icon-container mk-ok\">"+ tempMarkerNo +"</div>"},
        "id": markerFromDB.id,
        "latlng": {
          "lat": markerFromDB.imageX,
          "lng": markerFromDB.imageY
        },
        "message": undefined,
        "markersKeeper": "leftMarkers"

        // console.log("throw marker to georeference.controller ", marker);
      };$rootScope.$broadcast('createMarkerForTable', marker);
      // a delay of 10 millseconds for letting the markers be rendered on map and then firing for another map
      setTimeout(function () {
        callback();
      }, 10);
    }

    /**
     * Generate markers on Right Map
     * 
     * To be used when a user wants to view his or someone else's GCP
     * 
     * @param {object} markerFromDB
     */
    function generateRightMarker(markerFromDB) {
      var marker = null;

      marker = {
        "draggable": true,
        // "icon": {type: "div", className: "mk-div-icon "+markerFromDB.id, iconSize: null, html: "<div class=\"mk-icon-container mk-ok\">"+ tempMarkerNo +"</div>"},
        "id": markerFromDB.id,
        "latlng": {
          "lat": markerFromDB.lat,
          "lng": markerFromDB.lon
        },
        "message": undefined,
        "markersKeeper": "rightMarkers"

        // console.log("throw marker to georeference.controller ", marker);
      };$rootScope.$broadcast('createMarkerForTable', marker);
    }

    /**
     * delete event fired from GCP Table to delete the GCP from Left and Right Map 
     * 
     * @param {string} gcpId
     */
    function deleteGCPFromMap(gcpId) {
      // console.log(">>> GcpTableController >>> deleteGCPFromMap ", gcpId, $scope.tableData);
      // check if gcpId aexist in Table data
      // console.log(_.find($scope.tableData, ['id', gcpId]));
      if (_.find($scope.tableData, ['id', gcpId])) {
        // TODO : call some event to delete markers from both the maps 
        var temp = {
          model: {
            id: gcpId,
            eventFrom: "gcpTable"
          }
        };
        // fire a event to remove markers from maps
        $rootScope.$broadcast("leafletDirectiveMarker.leftMapViewer.click", temp);
        // $rootScope.$broadcast("leafletDirectiveMarker.leftMapViewer.click", temp);
        // delete from table
        $scope.tableData = _.filter($scope.tableData, function (o) {
          return !(o.id === gcpId);
        });
        // console.log("filteredTableData = ", $scope.tableData);
      }
      refreshGCPTable();
    }

    /**
     * Delete event fired from map to delete the GCP from Table 
     * 
     * @param {string} gcpId
     */
    function deleteGCPFromTable(gcpId) {
      // console.log(">>> GcpTableController >>> deleteGCPFromTable ", gcpId, $scope.tableData);
      // check if gcpId aexist in Table data
      // console.log(_.find($scope.tableData, ['id', gcpId]));
      if (_.find($scope.tableData, ['id', gcpId])) {
        $scope.tableData = _.filter($scope.tableData, function (o) {
          return !(o.id === gcpId);
        });
        // console.log("filteredTableData = ", $scope.tableData);
      }
      refreshGCPTable();
    }

    /**
     * Refresh GCP from Table with current GCP
     * 
     */
    function refreshGCPTable() {
      // console.log(">>> GcpTableController >>> refreshGCPTable ", vm.geoRef);
      if (vm.geoRef) {
        $scope.showTable = false;
        if (_.size(vm.geoRef.imageCoordinates) >= 3 && _.size(vm.geoRef.worldCoordinates) >= 3) {
          // check if both the maps have same number of GCPs
          if (_.size(vm.geoRef.imageCoordinates) === _.size(vm.geoRef.worldCoordinates)) {
            // console.log(_.size(vm.geoRef.imageCoordinates) + " - "+ _.size(vm.geoRef.worldCoordinates))
            previewGcp(vm.geoRef);
          } else {
            var config = {
              title: $translate.instant('dialog.invalidGeorefTitle'),
              description: $translate.instant('dialog.invalidGeorefText'),
              toolbarBgColor: $mdColors.getThemeColor('primary'),
              okBgColor: $mdColors.getThemeColor('primary'),
              ok: $translate.instant('global.ok')
            };
            C2Dialog.alert(config);
          }
        }
      }
    }

    function clearData() {
      vm.geoRef = null;
      $scope.showTable = false;
      $scope.tableData = [];
    }

    init();
  }
})();
'use strict';

(function () {

  'use strict';

  GeoLeftSidenavController.$inject = ["$scope", "$timeout", "$mdSidenav", "$log", "$rootScope", "lodash", "$mdSelect", "$window", "MapLayerService", "GeoreferenceService", "C2Toast", "$translate", "Global", "$mdColors", "C2Dialog", "$mdDialog", "$state", "leafletData", "$localStorage"];
  angular.module('app').controller('GeoLeftSidenavController', GeoLeftSidenavController);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function GeoLeftSidenavController($scope, $timeout, $mdSidenav, $log, $rootScope, lodash, $mdSelect, $window, MapLayerService, GeoreferenceService, C2Toast, $translate, Global, $mdColors, C2Dialog, $mdDialog, $state, leafletData, $localStorage) {
    var vm = this;

    vm.close = close;
    vm.save = save;
    vm.rectifyDisable = rectifyDisable;
    vm.previewGcp = previewGcp;
    vm.generateFilenameandExtent = generateFilenameandExtent;
    vm.minx = null;
    vm.miny = null;
    vm.maxx = null;
    vm.maxy = null;
    vm.gcp = null;
    vm.manualExtent = false;
    $scope.extentSelection = '0';

    $scope.$watch("extentSelection", function (newVal, old) {
      // if 2 selected means draw manaul rect
      if (newVal === 2) {
        // removeExtentRectangle(function() {
        drawRectangleForExtent();
        // });
      } else if (newVal === 1) {
        cleanUp();
        // calculate minx, miny values
        calcMinMaxValues();
      } else if (newVal === 0) {
        // remove Extent rectangle from map
        cleanUp();
      }
    });

    // emit listener when save of Georeference controller called. It passes the GCP on left panel
    $rootScope.$on('saveGeoRef', function (event, args) {
      // console.log(">>> ge.left.sidenav.controller >>> saveGeoRef ", args);
      vm.gcp = args;
      // redraw the resampling method dropdown
      getResamplingMethodsBasedOnGCP(Object.keys(vm.gcp).length);
      // redraw the rectify method dropdown
      getRectifyMethodsBasedOnGCP(Object.keys(vm.gcp).length);
    });

    /**
     * Enables / Disables Rectify options in dropdown based on number of GCPS
     * 
     */
    function rectifyDisable(id) {
      // Can't access numOfGCP() fun of georeference.controller.js here.
      if (id == "2ndOrderPolyn") {
        return false; // GeoreferenceController.numOfGCP >= 6
      } else if (id == "3rdOrderPolyn") {
        return false; // GeoreferenceController.numOfGCP >= 10
      } else {
          return false; // Keep the button enabled for Auto and 1st Order
        }
    }

    /**
     * First function called after the controller is ran
     * here the stuff are initialized
     * 
     */
    function activate() {
      // console.log(">>> ge.left.sidenav.controller >>> activate ");
      vm.rectifyMethods = getRectifyMethods();
      vm.rectifyMethod = lodash.find(vm.rectifyMethods, function (rm) {
        // return rm.id === 'AutoBasedOnGCP';
        return rm.id === ''; // To not allow 'AutoBasedOnGCP' to be there by default
      });
      vm.resamplingMethods = getResamplingMethods();
      vm.resamplingMethod = lodash.find(vm.resamplingMethods, function (rm) {
        // return rm.id === 'near';
        return rm.id === ''; // To not allow 'near' to be there by default.
      });
      monitorCloseSelect();
      $mdSidenav('left').onClose(function () {
        $mdSelect.hide();
      });
      vm.geoRefFilename = '';
      // resolving #208
      if (!lodash.isEmpty($localStorage.getObject("georefLayer"))) {
        // remove base layer
        $timeout(function () {
          MapLayerService.removeAllMapLayers("leftMapViewer");
        }, 200);
        // Add layer to right map
        MapLayerService.addMapLayer($localStorage.getObject("georefLayer"), "rightMapViewer");
        // Add image layer to left map
        MapLayerService.addMapLayer($localStorage.getObject("nongeorefLayer"), "leftMapViewer");
        $localStorage.remove("georefLayer");
        $localStorage.remove("nongeorefLayer");
      }
    }

    /**
     * Close this sidenav
     * 
     */
    function close() {
      $mdSidenav('left').close();
    }

    /**
     * Open this sidenav
     * 
     */
    function open() {
      $mdSidenav('left').open();
    }

    /**
     * Get the the rectify methods available to be used
     * 
     * @returns {array}
     */
    function getRectifyMethods() {
      return [{ name: 'Auto (based on GCP)', id: 'AutoBasedOnGCP', disable: true }, { name: '1st Order Polyn. (min 3 points required)', id: '1stOrderPolyn', disable: true }, { name: '2nd Order Polyn. (min 6 points required)', id: '2ndOrderPolyn', disable: true }, { name: '3rd Order Polyn. (min 10 points required)', id: '3rdOrderPolyn', disable: true }];
    }

    /**
     * Get the the rectify methods based on number of GCP
     * 
     * @returns {array}
     */
    function getRectifyMethodsBasedOnGCP() {
      /* vm.rectifyMethods = [
        {name: 'Auto (based on GCP)', id: 'AutoBasedOnGCP', disable: false},
        { name: '1st Order Polyn. (min 3 points required)',id: '1stOrderPolyn', disable: false},
        { name: '2nd Order Polyn. (min 6 points required)',id: '2ndOrderPolyn', disable: false},
        { name: '3rd Order Polyn. (min 10 points required)',id: '3rdOrderPolyn', disable: false}
      ]; */
      if (Object.keys(vm.gcp).length >= 3 && Object.keys(vm.gcp).length < 6) {
        vm.rectifyMethods = [{ name: 'Auto (based on GCP)', id: 'AutoBasedOnGCP', disable: false }, { name: '1st Order Polyn. (min 3 points required)', id: '1stOrderPolyn', disable: false }, { name: '2nd Order Polyn. (min 6 points required)', id: '2ndOrderPolyn', disable: true }, { name: '3rd Order Polyn. (min 10 points required)', id: '3rdOrderPolyn', disable: true }];
      } else if (Object.keys(vm.gcp).length >= 6 && Object.keys(vm.gcp).length < 10) {
        vm.rectifyMethods = [{ name: 'Auto (based on GCP)', id: 'AutoBasedOnGCP', disable: false }, { name: '1st Order Polyn. (min 3 points required)', id: '1stOrderPolyn', disable: false }, { name: '2nd Order Polyn. (min 6 points required)', id: '2ndOrderPolyn', disable: false }, { name: '3rd Order Polyn. (min 10 points required)', id: '3rdOrderPolyn', disable: true }];
      } else if (Object.keys(vm.gcp).length >= 10) {
        vm.rectifyMethods = [{ name: 'Auto (based on GCP)', id: 'AutoBasedOnGCP', disable: false }, { name: '1st Order Polyn. (min 3 points required)', id: '1stOrderPolyn', disable: false }, { name: '2nd Order Polyn. (min 6 points required)', id: '2ndOrderPolyn', disable: false }, { name: '3rd Order Polyn. (min 10 points required)', id: '3rdOrderPolyn', disable: false }];
      }
      // if user have already selected an option from dropdown than reselected it
      if (typeof vm.rectifyMethod !== "undefined") {
        lodash.forEach(vm.rectifyMethods, function (method) {
          if (method.id === vm.rectifyMethod.id) {
            vm.rectifyMethod = method;
          }
        });
      }
    }

    /**
     * Get the the resampling methods available to be used
     * 
     * @returns {array}
     */
    function getResamplingMethods() {
      return [
      // id = gdalwarp parameter
      { name: 'Nearest neighbour resampling', id: 'near', disable: true }, { name: 'Bilinear resampling', id: 'bilinear', disable: true }, { name: 'Cubic resampling', id: 'cubic', disable: true }];
    }

    /**
     * Get the the resampling methods based on the number of GCP points available
     * 
     * @returns {array}
     */
    function getResamplingMethodsBasedOnGCP() {
      if (Object.keys(vm.gcp).length < 3) {
        vm.resamplingMethods = [{ name: 'Nearest neighbour resampling', id: 'near', disable: false }, { name: 'Bilinear resampling', id: 'bilinear', disable: false }, { name: 'Cubic resampling', id: 'cubic', disable: false }];
      } else if (Object.keys(vm.gcp).length >= 3 && Object.keys(vm.gcp).length < 6) {
        vm.resamplingMethods = [{ name: 'Nearest neighbour resampling', id: 'near', disable: false }, { name: 'Bilinear resampling', id: 'bilinear', disable: true }, { name: 'Cubic resampling', id: 'cubic', disable: true }];
      } else if (Object.keys(vm.gcp).length >= 6 && Object.keys(vm.gcp).length < 10) {
        vm.resamplingMethods = [{ name: 'Nearest neighbour resampling', id: 'near', disable: false }, { name: 'Bilinear resampling', id: 'bilinear', disable: false }, { name: 'Cubic resampling', id: 'cubic', disable: true }];
      } else if (Object.keys(vm.gcp).length >= 10) {
        vm.resamplingMethods = [{ name: 'Nearest neighbour resampling', id: 'near', disable: false }, { name: 'Bilinear resampling', id: 'bilinear', disable: false }, { name: 'Cubic resampling', id: 'cubic', disable: false }];
      }
      // if user have already selected an option from dropdown than reselected it
      if (typeof vm.resamplingMethod !== "undefined") {
        lodash.forEach(vm.resamplingMethods, function (method) {
          if (method.id === vm.resamplingMethod.id) {
            vm.resamplingMethod = method;
          }
        });
      }
    }

    /**
     * Gets called on resample Dropdown selection change, to get generate the 
     * 'filename' and extent 'value'
     * 
     */
    function generateFilenameandExtent() {
      // get the layer that contains the resource/map to be georeferenced
      var layer = MapLayerService.getViewerOverlays("leftMapViewer");

      // get the resource/map id from the loaded layer
      // as in the case of georeference module only one resource/map will
      // be loaded, we get the properties from the first resource in the layer
      var firstLayerKey = Object.keys(layer)[0];

      // Get new georefenced file name from the user
      vm.geoRefFilename = layer[firstLayerKey].resource.title + "_g_" + vm.rectifyMethod.id + "_" + vm.resamplingMethod.id + "_" + (new Date().getMonth() + 1) + "." + new Date().getDate() + "." + new Date().getFullYear();

      // calculate minx, miny values
      calcMinMaxValues();
      vm.bboxCropImage = vm.minx + " " + vm.miny + " " + vm.maxx + " " + vm.maxy;
    }

    /**
     * Calculates the minx, miny, maxx and maxy values based on GCP created 
     * on right map
     * 
     */
    function calcMinMaxValues() {
      // Crop final georeferenced image
      var lat = [];var lng = [];
      for (var i = 0; i < Object.keys($scope.$parent.vm.rightMarkers).length; i++) {
        lat.push(Object.values($scope.$parent.vm.rightMarkers)[i]["lat"]);
        lng.push(Object.values($scope.$parent.vm.rightMarkers)[i]["lng"]);
      }
      // assign the extent values to scope variable to diplay on page
      vm.minx = parseFloat(Math.min.apply(Math, lng).toFixed(5));
      vm.miny = parseFloat(Math.min.apply(Math, lat).toFixed(5));
      vm.maxx = parseFloat(Math.max.apply(Math, lng).toFixed(5));
      vm.maxy = parseFloat(Math.max.apply(Math, lat).toFixed(5));
    }

    /**
     * In a combination of leaflet, ui-leaflet, sidenav and md-select
     * when the md-select drop down options are open and the user clicks
     * outside the options overlay, the md-select is not been closed automatically
     * So, for instance we had to create this hack until we find a nice solution     * 
     */
    function monitorCloseSelect() {
      var $$window = angular.element($window);
      $$window.on('click', function (event) {
        if (event.target.classList[0] === 'md-sidenav-left') {
          $mdSelect.hide();
        }
      });
    };

    /**
     * Save//apply the georeference to the layer/resource loaded in the leftMapViewer
     * 
     */
    function save() {
      // check for number of markers on both maps to be equal
      if (Object.values($scope.$parent.vm.leftMarkers).length === Object.values($scope.$parent.vm.rightMarkers).length) {
        // get the layer that contains the resource/map to be georeferenced
        var layer = MapLayerService.getViewerOverlays("leftMapViewer");

        // instantiate the georeference service that is linked with the back-end end-point
        var geoRef = new GeoreferenceService();

        // get the markers from left and right viewers from parent controller
        geoRef.imageCoordinates = $scope.$parent.vm.leftMarkers;
        geoRef.worldCoordinates = $scope.$parent.vm.rightMarkers;
        geoRef.rectifyMethod = vm.rectifyMethod.id;
        geoRef.resamplingMethod = vm.resamplingMethod.id;

        // console.log($scope.$parent.vm);
        // console.log(vm);


        // get the resource/map id from the loaded layer
        // as in the case of georeference module only one resource/map will
        // be loaded, we get the properties from the first resource in the layer

        var firstLayerKey = Object.keys(layer)[0];
        geoRef.mapId = layer[firstLayerKey].resource.id;

        // Convert AutoBasedOnGCP to Order 
        var numCoordinates = Object.values(geoRef.imageCoordinates).length;
        geoRef.rectifyMethod == "AutoBasedOnGCP" ? numCoordinates >= 3 && numCoordinates < 6 ? geoRef.rectifyMethod = "1stOrderPolyn" : numCoordinates >= 6 && numCoordinates < 10 ? geoRef.rectifyMethod = "2ndOrderPolyn" : geoRef.rectifyMethod = "3rdOrderPolyn" : null;

        // Get new georefenced file name from the user
        // geoRef.newFileName = prompt("Enter new file name. Default is follows:", layer[firstLayerKey].resource.title + "_g_" + geoRef.rectifyMethod + "_" + geoRef.resamplingMethod + "_" + ((new Date()).getMonth()+1) + "." + (new Date()).getDate() + "." + (new Date()).getFullYear());
        // use the filename generated in 
        geoRef.newFileName = vm.geoRefFilename;

        // Crop final georeferenced image
        /* var lat = []; var lng = [];
        for (var i=0; i<Object.keys(geoRef.worldCoordinates).length; i++){
          lat.push(Object.values(geoRef.worldCoordinates)[i]["lat"]);
          lng.push(Object.values(geoRef.worldCoordinates)[i]["lng"])
        }
        var lngmin = Math.min.apply(Math, lng);
        var latmin = Math.min.apply(Math, lat);
        var lngmax = Math.max.apply(Math, lng);
        var latmax = Math.max.apply(Math, lat); */
        // geoRef.bboxCropImage = prompt("Enter coordinates to crop the image: min Lng, min Lat, max Lng, max Lat. Default extent, as shown below, is selected based from the provided GCPs. If don't want any cropping then simply delete the default coordinates.", lngmin + " " + latmin + " " + lngmax + " " + latmax);
        if ($scope.extentSelection == '0') {
          geoRef.bboxCropImage = "";
        }
        // if extent is by values provided by the user then just send 4 params to /apply API
        else if ($scope.extentSelection == '1') {
            geoRef.bboxCropImage = vm.minx + " " + vm.miny + " " + vm.maxx + " " + vm.maxy;
          }
          // if extent is by drawing a rectangle on map then send 8 params to /apply API
          else if ($scope.extentSelection == '2') {
              geoRef.bboxCropImage = vm.minx + " " + vm.miny + " " + vm.maxx + " " + vm.miny + " " + vm.maxx + " " + vm.maxy + " " + vm.minx + " " + vm.maxy;
            }
        // console.log(geoRef.bboxCropImage)

        geoRef.applyEndPoint = '/heimap/georef/apply';
        geoRef.$save()
        // geoRef.saveGeoRef()
        .then(function (result) {

          // console.log(result.id)
          // console.log(angular.isDefined(result.id))
          // console.log("zz");

          if (angular.isDefined(result.id)) {
            close();
            C2Toast.success($translate.instant('messages.saveGeoreferenceSuccess'));
          }

          for (var i = 0; i < numCoordinates; i++) {
            delete $scope.$parent.vm.leftMarkers[Object.values($scope.$parent.vm.leftMarkers)[0]["id"]];
            delete $scope.$parent.vm.rightMarkers[Object.values($scope.$parent.vm.rightMarkers)[0]["id"]];
          };

          //TODO: 
          /* update the viewer state with the georeferenced resource
              reset the GCP
          */
          /* var whereToGo = prompt("Enter your next action: 1 to view recently georeferenced image and/or georeference another image and 2 to upload new image", "1");
           switch(whereToGo){
            case "1": 
              MapLayerService.removeAllMapLayers("leftMapViewer"); 
              MapLayerService.addMapLayer(result, "rightMapViewer"); 
              break;
            case "2": 
              $window.location.href = '#!/map'; 
              break;
          } */

          // // fire event to GCP controller for call refreshGCPTable
          // $rootScope.$broadcast("refreshGcpTableEvent");
          // create popup box
          var confirm = $mdDialog.confirm().title('Next Action?').textContent('View recently georeferenced image and/or georeference another image OR upload a new image')
          // .ariaLabel('Lucky day')
          .ok('Load it in Right Map').cancel('Upload a new file');

          $mdDialog.show(confirm).then(function () {
            // console.log("Load in right map clicked");
            // MapLayerService.removeAllMapLayers("leftMapViewer"); 
            // MapLayerService.addMapLayer(result, "rightMapViewer"); 
            // resolving Dirk's request menitoned in #182
            // resolving #208 with use of localstorage
            var tempLeftLayer = layer[Object.keys(layer)[0]].resource;
            // delete it because it has reference to other Models, which creates a circular JSON
            if (typeof tempLeftLayer.$$array !== "undefined") {
              delete tempLeftLayer.$$array;
            }
            $localStorage.setObject("nongeorefLayer", tempLeftLayer);
            $localStorage.setObject("georefLayer", result);
            $state.reload();
          }, function () {
            // console.log("upload a new file");
            // change app state to map, first page of app
            $state.go('app.map');
          });
        }, function (err) {
          console.log(err);
          // the code inside this block will be fired if some error occur
          // here you can show some error message or do nothing, depending on the business rule

          //TODO: notify the user about the error?
        });
      } else {
        var config = {
          title: $translate.instant('dialog.invalidGeorefTitle'),
          description: $translate.instant('dialog.invalidGeorefText'),
          toolbarBgColor: $mdColors.getThemeColor('primary'),
          okBgColor: $mdColors.getThemeColor('primary'),
          ok: $translate.instant('global.ok')
        };
        C2Dialog.alert(config);
      }
    }

    /**
     * Show the GCP table in a preview table
     * 
     */
    function previewGcp() {
      // check for number of markers on both maps to be equal
      if (Object.values($scope.$parent.vm.leftMarkers).length === Object.values($scope.$parent.vm.rightMarkers).length) {
        if (vm.rectifyMethod && vm.resamplingMethod) {
          // get the layer that contains the resource/map to be georeferenced
          var layer = MapLayerService.getViewerOverlays("leftMapViewer");

          // instantiate the georeference service that is linked with the back-end end-point
          var geoRef = new GeoreferenceService();

          // get the markers from left and right viewers from parent controller
          geoRef.imageCoordinates = $scope.$parent.vm.leftMarkers;
          geoRef.worldCoordinates = $scope.$parent.vm.rightMarkers;
          geoRef.rectifyMethod = vm.rectifyMethod.id;
          geoRef.resamplingMethod = vm.resamplingMethod.id;

          // get the resource/map id from the loaded layer
          // as in the case of georeference module only one resource/map will
          // be loaded, we get the properties from the first resource in the layer

          var firstLayerKey = Object.keys(layer)[0];
          geoRef.mapId = layer[firstLayerKey].resource.id;

          // Convert AutoBasedOnGCP to Order 
          var numCoordinates = Object.values(geoRef.imageCoordinates).length;
          geoRef.rectifyMethod == "AutoBasedOnGCP" ? numCoordinates >= 3 && numCoordinates < 6 ? geoRef.rectifyMethod = "1stOrderPolyn" : numCoordinates >= 6 && numCoordinates < 10 ? geoRef.rectifyMethod = "2ndOrderPolyn" : geoRef.rectifyMethod = "3rdOrderPolyn" : null;

          // Get new georefenced file name from the user
          geoRef.newFileName = vm.geoRefFilename;

          // Crop final georeferenced image
          if (vm.manualExtent) {
            geoRef.bboxCropImage = vm.minx + " " + vm.miny + " " + vm.maxx + " " + vm.maxy;
            // console.log(geoRef.bboxCropImage)
          } else {
            geoRef.bboxCropImage = "";
          }

          $rootScope.$broadcast('previewGcp', geoRef);
        } else {
          // closing left sidenav since it was overlaping alert message
          close();
          var config = {
            title: $translate.instant('dialog.cantPreviewGcptableTitle'),
            description: $translate.instant('dialog.cantPreviewGcptableText'),
            toolbarBgColor: $mdColors.getThemeColor('primary'),
            okBgColor: $mdColors.getThemeColor('primary'),
            ok: $translate.instant('global.ok')
          };
          C2Dialog.alert(config);
        }
      } else {
        var config = {
          title: $translate.instant('dialog.invalidGeorefTitle'),
          description: $translate.instant('dialog.invalidGeorefText'),
          toolbarBgColor: $mdColors.getThemeColor('primary'),
          okBgColor: $mdColors.getThemeColor('primary'),
          ok: $translate.instant('global.ok')
        };
        C2Dialog.alert(config);
      }
    }

    function removeGcpTable() {
      // console.log(">>> ge.left.sidenav.controller >>> removeGcpTable ");
      angular.element(document.querySelector('#gcpTable')).empty();
    }
    /**
     * Starts the drawing interaction to draw a rectangle on left map to crop the image
     * 
     * Alternatively, COMMENTED CODE is for showing the extent rectangle on right map
     * 
     */
    function drawRectangleForExtent() {
      // console.log(">>> ge.left.sidenav.controller >>> drawRectangleForExtent ");
      close();
      C2Toast.success($translate.instant('messages.georefStartRectangleExtent'));
      var viewerId = "leftMapViewer";
      // disble marker creation by firing an event to Georeference controller
      $rootScope.$broadcast('toggleMarkerCreation', { 'markersKeeper': viewerId });

      leafletData.getMap(viewerId).then(function (map) {
        // Approach 2 : draw extent rectangle on right Map and let the user by able to edit it
        // if(map.hasLayer(drawnItems)){
        //   console.log(drawnItems);
        // }
        // var drawnItems = new L.FeatureGroup();

        // // drawnItems.forEach(function(layer) {
        // //   console.log(layer);
        // //   map.removeLayer(layer);
        // // });
        // // create a rectangle based on extend calculated
        // var extentRect = L.rectangle([[vm.miny, vm.minx], [vm.maxy, vm.maxx]]).addTo(drawnItems);
        // console.log(extentRect);
        // extentRect.type = extentRect.type || "Feature"; // Intialize feature.type
        // var props = extentRect.properties = extentRect.properties || {}; // Intialize feature.properties
        // props.title = "extentRectangleForCropping";
        // // props.content = "my content";
        // extentRect.editing.enable();
        // map.on('draw:editresize', function (e) {
        //   console.log("draw:editresize ", e.layer);
        //   vm.minx = e.layer.getBounds().getWest();
        //   vm.miny = e.layer.getBounds().getSouth();
        //   vm.maxx = e.layer.getBounds().getEast();
        //   vm.maxy = e.layer.getBounds().getNorth();
        // }.bind(drawnItems));
        // map.addLayer(drawnItems);

        // Approach 2 : Let the User draw rectangle on Left Map
        // FeatureGroup is to store editable layers
        var drawnItems = new L.FeatureGroup();
        map.addLayer(drawnItems);
        var polygonDrawer = new L.Draw.Rectangle(map);
        polygonDrawer.enable();

        map.on('draw:created', function (e) {
          var layer = e.layer;
          layer.type = layer.type || "Feature"; // Intialize feature.type
          var props = layer.properties = layer.properties || {}; // Intialize feature.properties
          props.title = "extentRectangleForCropping";

          drawnItems.addLayer(layer);
          // var drawsGeoJson = layer.toGeoJSON();
          // console.log("poygon geojson = ", drawsGeoJson);
          vm.minx = layer.getBounds().getSouthWest().lng;
          vm.miny = layer.getBounds().getSouthWest().lat;
          vm.maxx = layer.getBounds().getNorthEast().lng;
          vm.maxy = layer.getBounds().getNorthEast().lat;
          // open the sidenav
          // open();
          // console.log("vm.minx = ", vm.minx, vm.miny, vm.maxx, vm.maxy);
        }.bind(drawnItems));
      });
    }

    /** 
     * If any rectangle drawn on left map than clears it and 
     * reinitializes min, max values to null
     */
    function cleanUp() {
      // console.log(">>> ge.left.sidenav.controller >>> cleanUp");
      // alway display extent rectangle in Right map
      var viewerId = "leftMapViewer";
      leafletData.getMap(viewerId).then(function (map) {
        lodash.forEach(map._layers, function (feature) {
          if (typeof feature.type !== "undefined") {
            if (feature.type === "Feature") {
              // console.log(feature);
              // feature.removeFrom(drawnItems);
              // feature.remove();
              map.removeLayer(feature);
            }
          }
        });
      });
      vm.minx = vm.miny = vm.maxx = vm.maxy = null;
    }

    /**
     * Removes Extent rectanlg from Right map before drawing a new one
     * **** Unused code, good for callback example
     */
    function removeExtentRectangle(callback) {
      console.log(">>> ge.left.sidenav.controller >>> removeExtentRectangle");
      // alway display extent rectangle in Right map
      var viewerId = "rightMapViewer";
      leafletData.getMap(viewerId).then(function (map) {
        // check if rectangle already drawn, if yes than remove it
        lodash.forEach(map._layers, function (feature) {
          if (typeof feature.type !== "undefined") {
            if (feature.type === "Feature") {
              console.log(feature);
              // feature.removeFrom(drawnItems);
              // feature.remove();
              map.removeLayer(feature);
            }
          }
        });
      });
      callback();
    }

    activate();
  }
})();
'use strict';

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

/*eslint angular/file-name: 0, no-undef: 0*/
(function () {
  'use strict';

  angular.module('app').constant('en-GB.i18n.attributes', _defineProperty({
    email: 'Email',
    password: 'Password',
    name: 'Name',
    image: 'Image',
    roles: 'Profiles',
    date: 'Date',
    initialDate: 'Initial date',
    finalDate: 'End date',
    title: 'Title',
    mapType: 'Map type',
    projection: 'Projection',
    georeferenced: 'Georeferenced',
    isGeoreferenced: 'Is georeferenced',
    isNotGeoreferenced: 'Is not georeferenced',
    mapOptions: 'Map options',
    verified: 'Verified',
    rectifyMethod: 'Rectify method',
    resamplingMethod: 'Resampling method',
    enterGeorefFileName: 'Georeferenced file name',
    extentGeoRef: 'Enter coordinates to crop the image: min Lng, min Lat, max Lng, max Lat. Default extent, as shown below, is selected based from the provided GCPs. If don\'t want any cropping then simply delete the default coordinates',
    minx: 'West',
    miny: 'South',
    maxx: 'East',
    maxy: 'North',
    cropImage: 'Crop Image based on Extent Values?',
    cropImageByDraw: 'Crop Image based by drawing on map?',
    cropImageNone: 'None',
    previewGCP: 'Show GCP Table',
    showOnlyChildMap: 'Show only Maps which used the loaded NonGeoreferenced image',
    description: 'Description',
    gazzType: 'CRM Entity Type',
    buildingType: 'Buidling Type',
    state: 'State',
    country: 'Country',
    timeSpan: 'Time Span',
    material: 'Material',
    refDocument: 'Document Reference',
    createdDate: 'Created Date',
    king: 'King'
  }, 'title', 'Title'));
})();
'use strict';

/*eslint angular/file-name: 0, no-undef: 0*/
(function () {
  'use strict';

  angular.module('app').constant('en-GB.i18n.dialog', {
    confirmTitle: 'Confirm?',
    confirmDescription: 'Confirm action?',
    confirmLoadUngeoreferencedTitle: 'Confirm load ungeoreferenced map',
    confirmLoadGeoreferencedTitle: 'Confirm load georeferenced map',
    LoadUngeoreferencedDescription: 'If you load this ungeoreferenced map all base layers and other maps will be removed from the viewer. Do you want to proceed?',
    LoadGeoreferencedDescription: 'If you load this georeferenced map current ungeoreferenced layers will be removed from the viewer. Do you want to proceed?',
    removeDescription: 'Do you want to remove permanently {{name}}?',
    invalidGeorefTitle: 'Invalid number of Ground Control Points',
    invalidGeorefText: 'Same number of Ground Control Points and a minimum of 3 Ground Control Points is required in each viewer to georeference a map',
    login: {
      resetPassword: {
        description: 'Type your registered e-mail in the system.'
      }
    },
    cantLoadTitle: 'Can\'t link Both the maps',
    cantLoadDescription: 'Can\'t link maps since one of maps has Ungeoreferenced image',
    cantPreviewGcptableTitle: 'Select Rectify Method and Resampling Method',
    cantPreviewGcptableText: 'Please select Rectify Method and Resampling Method to Preview GCP'
  });
})();
'use strict';

/*eslint angular/file-name: 0, no-undef: 0*/
(function () {
  'use strict';

  angular.module('app').constant('en-GB.i18n.global', {
    loading: 'Loading...',
    processing: 'Processing...',
    yes: 'Yes',
    no: 'No',
    all: 'All',
    ok: 'OK'
  });
})();
'use strict';

/*eslint angular/file-name: 0, no-undef: 0*/
(function () {
  'use strict';

  angular.module('app').constant('en-GB.i18n.messages', {
    internalError: 'Internal error. contact the system admin',
    mapFileIsMandatory: 'Select a map file is mandatory',
    invalidImageFile: 'File selected is not a valid image file',
    fileTooBig: 'File selected is too big',
    notFound: 'Not found',
    notAuthorized: 'You do not have access to this functionality.',
    searchError: 'Search error.',
    saveSuccess: 'Item saved successfully.',
    saveGeoreferenceSuccess: 'Image has been rectified.',
    operationSuccess: 'Operation done with success.',
    operationError: 'Error while doing the operation',
    saveError: 'Error while trying to save the item.',
    removeSuccess: 'Removal done with success.',
    removeError: 'Error while trying to remove the item.',
    resourceNotFoundError: 'Item not found',
    notNullError: 'All the mandatory fields must be filled.',
    duplicatedResourceError: 'Already exists an item with these data.',
    deleteLayerTitle: 'Delete Layer?',
    deleteLayerMessage: 'Would you like to Delete layer?',
    yes: 'Yes',
    no: 'No',
    validate: {
      fieldRequired: 'The field {{field}} is mandatory.'
    },
    layout: {
      error404: 'Page no found'
    },
    login: {
      logoutInactive: 'You have been logged out. Login again.',
      invalidCredentials: 'Invalid credentials',
      unknownError: 'It was not possible to log you in. ' + 'Try again. If the error persists, contact the system administrator.',
      userNotFound: 'User not found'
    },
    dashboard: {
      welcome: 'Welcome {{userName}}',
      description: 'Use the for navigation.'
    },
    mail: {
      mailErrors: 'An error has occurred in the following e-mails:\n',
      sendMailSuccess: 'Email sent with success!',
      sendMailError: 'It was not possible to send the e-mail.',
      passwordSendingSuccess: 'The password recover process was initiated. If the e-mail does not arrive in 10 minutes, try again.'
    },
    user: {
      removeYourSelfError: 'You can not remove your own user.',
      userExists: 'User already exists!',
      profile: {
        updateError: 'It was not possible to update your profile.'
      }
    },
    map: {
      dropMap: 'Drop map here',
      selectAMap: 'Select a map image',
      selectAGeoFile: 'Select a geo file',
      clickToAdd: 'Click to add a new map'
    },
    georefStartRectangleExtent: 'Draw a Rectangle on Left Map'
  });
})();
'use strict';

/*eslint angular/file-name: 0, no-undef: 0*/
(function () {
  'use strict';

  angular.module('app').constant('en-GB.i18n.models', {
    user: 'User'
  });
})();
'use strict';

/*eslint angular/file-name: 0, no-undef: 0*/
(function () {
  'use strict';

  angular.module('app').constant('en-GB.i18n.views', {
    breadcrumbs: {
      user: 'Use admin',
      'user-profile': 'User profile',
      dashboard: 'Dashboard',
      audit: 'Audit',
      mail: 'Mail send',
      project: 'Projects',
      'not-authorized': 'Not authorized'
    },
    titles: {
      dashboard: 'Home page',
      mailSend: 'Send mail',
      taskList: 'Task list',
      userList: 'User list',
      auditList: 'Audit List',
      register: 'Register',
      resetPassword: 'Reset password',
      update: 'Update',
      addMap: 'Add map',
      editMap: 'Edit map',
      mapList: 'Map list',
      mapView: 'Map view',
      mapElements: 'Map elements',
      mapLayers: 'Map layers',
      newMap: 'New map',
      mapGeoreferencing: 'Map georeferencing',
      saveControlPoints: 'Save Control Points',
      vectorTitle: 'Vector',
      featureAttr: 'Feature Attribute',
      layerList: 'Layer list',
      addLayer: 'Add layer',
      editLayer: 'Edit layer'
    },
    actions: {
      send: 'Send',
      save: 'Save',
      clear: 'Clear',
      clearAll: 'Clear all',
      restart: 'Restart',
      filter: 'Filter',
      search: 'Search',
      list: 'List',
      edit: 'Edit',
      cancel: 'Cancel',
      update: 'Update',
      remove: 'Remove',
      getOut: 'Exit',
      add: 'Add',
      in: 'enter',
      loadImage: 'Load image',
      open: 'Open',
      close: 'Close',
      view: 'View',
      filterMaps: 'Filter maps',
      show: 'Show',
      hide: 'Hide',
      loadMapInLeft: 'Load in the left viewer',
      loadMapInRight: 'Load in the right viewer',
      hideMapLayer: 'Hide map layer',
      showMapLayer: 'Show map layer',
      removeMapLayer: 'Remove map layer',
      zoomToMapLayer: 'Zoom to map layer',
      loadedInLeftViewer: 'Loaded in the left viewer',
      loadedInRightViewer: 'Loaded in the right viewer',
      reset: 'Reset',
      unlinkLink: 'Unlink/link viewers',
      split: 'Split viewers',
      toggleVerified: 'Is or not a verified map?',
      toggleFavorite: 'Toggle favorite',
      toggleWheelZoom: 'Toggle wheel zoom',
      toggleMarkerCreation: 'Enable/disable marker creation',
      toggleMarkerRemoval: 'Enable/disable marker removal',
      saveGeoref: 'Save georef',
      loadGcpOnMap: 'Load GCP on Map',
      createlayer: 'New Layer',
      publish: 'Publish',
      showFeatureVersion: 'Show Features Version sdfgasdgasd asdgfasdgasdfga asdgasdgfasdfasd asdfasdfasdfasd asdfasdfasdf'
    },
    fields: {
      date: 'Date',
      action: 'Action',
      actions: 'Actions',
      opacity: 'Opacity',
      login: {
        resetPassword: 'Reset password',
        confirmPassword: 'Confirm password'
      },
      mail: {
        to: 'To',
        subject: 'Subject',
        message: 'Message'
      },
      user: {
        profile: 'Profiles',
        nameOrEmail: 'Name or e-mail'
      }
    },
    layout: {
      menu: {
        map: 'Map',
        export: 'Export',
        import: 'Import',
        vector: 'Vector',
        georeference: 'Georeference',
        preferences: 'preferences'
      },
      input: {
        select: 'Select'
      }
    },
    tooltips: {
      user: {
        profile: 'Profile',
        transfer: 'Transfer'
      }
    },
    pagination: {
      total: 'Total',
      items: 'Item(s)'
    }
  });
})();
'use strict';

/*eslint angular/file-name: 0, no-undef: 0*/
(function () {
  'use strict';

  angular.module('app').constant('de-DE.i18n.attributes', {
    email: 'Email',
    password: 'Password',
    name: 'Name',
    image: 'Image',
    roles: 'Profiles',
    date: 'Date',
    initialDate: 'Initial date',
    finalDate: 'End date',
    task: {
      description: 'Description',
      done: 'Done?',
      priority: 'Priority',
      scheduled_to: 'Scheduled to?',
      project: 'Project'
    },
    project: {
      cost: 'cost'
    },
    auditModel: {}
  });
})();
'use strict';

/*eslint angular/file-name: 0, no-undef: 0*/
(function () {
  'use strict';

  angular.module('app').constant('de-DE.i18n.dialog', {
    confirmTitle: 'Confirm?',
    confirmDescription: 'Confirm action?',
    removeDescription: 'Do you want to remove permanently {{name}}?',
    audit: {
      created: 'Created',
      updatedBefore: 'Updated before',
      updatedAfter: 'Updated after',
      deleted: 'Deleted'
    },
    login: {
      resetPassword: {
        description: 'Type your registered e-mail in the system.'
      }
    }
  });
})();
'use strict';

/*eslint angular/file-name: 0, no-undef: 0*/
(function () {
  'use strict';

  angular.module('app').constant('de-DE.i18n.global', {
    loading: 'Loading...',
    processing: 'Processing...',
    yes: 'Yes',
    no: 'No',
    all: 'All'
  });
})();
'use strict';

/*eslint angular/file-name: 0, no-undef: 0*/
(function () {
  'use strict';

  angular.module('app').constant('de-DE.i18n.messages', {
    internalError: 'Internal error. contact the system admin',
    mapFileIsMandatory: 'Select a map file is mandatory',
    invalidImageFile: 'File selected is not a valid image file',
    fileTooBig: 'File selected is too big',
    notFound: 'Not found',
    notAuthorized: 'You do not have access to this functionality.',
    searchError: 'Search error.',
    saveSuccess: 'Item saved successfully.',
    operationSuccess: 'Operation done with success.',
    operationError: 'Error while doing the operation',
    saveError: 'Error while trying to save the item.',
    removeSuccess: 'Removal done with success.',
    removeError: 'Error while trying to remove the item.',
    resourceNotFoundError: 'Item not found',
    notNullError: 'All the mandatory fields must be filled.',
    duplicatedResourceError: 'Already exists an item with these data.',
    validate: {
      fieldRequired: 'The field {{field}} is mandatory.'
    },
    layout: {
      error404: 'Page no found'
    },
    login: {
      logoutInactive: 'You have been logged out. Login again.',
      invalidCredentials: 'Invalid credentials',
      unknownError: 'It was not possible to log you in. ' + 'Try again. If the error persists, contact the system administrator.',
      userNotFound: 'User not found'
    },
    dashboard: {
      welcome: 'Welcome {{userName}}',
      description: 'Use the for navigation.'
    },
    mail: {
      mailErrors: 'An error has occurred in the following e-mails:\n',
      sendMailSuccess: 'Email sent with success!',
      sendMailError: 'It was not possible to send the e-mail.',
      passwordSendingSuccess: 'The password recover process was initiated. If the e-mail does not arrive in 10 minutes, try again.'
    },
    user: {
      removeYourSelfError: 'You can not remove your own user.',
      userExists: 'User already exists!',
      profile: {
        updateError: 'It was not possible to update your profile.'
      }
    }
  });
})();
'use strict';

/*eslint angular/file-name: 0, no-undef: 0*/
(function () {
  'use strict';

  angular.module('app').constant('de-DE.i18n.models', {
    user: 'User'
  });
})();
'use strict';

/*eslint angular/file-name: 0, no-undef: 0*/
(function () {
  'use strict';

  angular.module('app').constant('de-DE.i18n.views', {
    breadcrumbs: {
      user: 'Use admin',
      'user-profile': 'User profile',
      dashboard: 'Dashboard',
      audit: 'Audit',
      mail: 'Mail send',
      project: 'Projects',
      'not-authorized': 'Not authorized'
    },
    titles: {
      dashboard: 'Home page',
      mailSend: 'Send mail',
      taskList: 'Task list',
      userList: 'User list',
      auditList: 'Audit List',
      register: 'Register',
      resetPassword: 'Reset password',
      update: 'Update'
    },
    actions: {
      send: 'Send',
      save: 'Save',
      clear: 'Clear',
      clearAll: 'Clear all',
      restart: 'Restart',
      filter: 'Filter',
      search: 'Search',
      list: 'List',
      edit: 'Edit',
      cancel: 'Cancel',
      update: 'Update',
      remove: 'Remove',
      getOut: 'Exit',
      add: 'Add',
      in: 'enter',
      loadImage: 'Load image'
    },
    fields: {
      date: 'Date',
      action: 'Action',
      actions: 'Actions',
      login: {
        resetPassword: 'Reset password',
        confirmPassword: 'Confirm password'
      },
      mail: {
        to: 'To',
        subject: 'Subject',
        message: 'Message'
      },
      user: {
        profile: 'Profiles',
        nameOrEmail: 'Name or e-mail'
      }
    },
    layout: {
      menu: {
        dashboard: 'Dashboard',
        admin: 'Administration',
        examples: 'Examples',
        user: 'User',
        mail: 'Send email',
        audit: 'Audit'
      }
    },
    tooltips: {
      user: {
        profile: 'Profile',
        transfer: 'Transfer'
      }
    }
  });
})();
'use strict';

(function () {

    'use strict';

    MapDialogController.$inject = ["$controller", "MapService", "C2Dialog", "mapDialogInput", "FileService", "C2Toast", "$translate", "MapTypeService", "MapProjectionService", "MapProjectService", "lodash", "MapLayerService"];
    angular.module('app').controller('MapDialogController', MapDialogController);

    /** @ngInject */
    // eslint-disable-next-line max-params
    function MapDialogController($controller, MapService, C2Dialog, mapDialogInput, FileService, C2Toast, $translate, MapTypeService, MapProjectionService, MapProjectService, lodash, MapLayerService) {

        var vm = this;

        vm.onActivate = onActivate;
        vm.beforeSave = beforeSave;
        vm.afterSave = afterSave;
        vm.onFileRemove = onFileRemove;
        vm.removeFile = removeFile;
        vm.onActivate = onActivate;
        vm.close = close;
        vm.geoFileNeeded = false;
        vm.onImageFileChange = onImageFileChange;
        vm.onGeoFileChange = onGeoFileChange;
        vm.showGeoFileInput = showGeoFileInput;
        vm.showProjectionInput = showProjectionInput;
        vm.showGeorefBadge = showGeorefBadge;

        // instantiate base controller
        $controller('CRUDController', {
            vm: vm,
            modelService: MapService,
            options: {
                searchOnInit: false
            }
        });

        /**
         * Run initial functions on dialog openIng
         * @return void
         */
        function onActivate() {
            vm.saving = false;
            defineViewState();
            vm.removeMap = mapDialogInput.removeFn;
            MapTypeService.paginate().then(function (response) {
                vm.mapTypes = response.items;
                adjustResource();
            });
            MapProjectionService.paginate().then(function (response) {
                vm.projections = response.items;
            });

            MapProjectService.paginate().then(function (response) {
                vm.projects = response.items;
            });
        }

        /**
         * Check if a valid projection is selected and thus if we shall show the geo file input
         * 
         * @returns boolean
         */
        function showGeoFileInput() {
            return angular.isDefined(vm.resource.projection) && vm.resource.projection != null;
        }

        /**
         * Define the dialog view state as add or edit 
         * and parse the view title
         * @return void
         */
        function defineViewState() {
            vm.mode = angular.isDefined(mapDialogInput.model) ? 'edit' : 'add';
            if (vm.mode == 'add') {
                vm.viewTitle = $translate.instant('views.titles.addMap');
            } else {
                vm.viewTitle = $translate.instant('views.titles.editMap');
            }
        }

        function showProjectionInput() {
            var result = vm.geoFileNeeded && vm.mode === 'add';
            return result;
        }

        /**
         * Adjust resource mapping the field names and set the resource model
         * @return void
         */
        function adjustResource() {
            if (vm.mode === 'edit') {
                vm.resource = mapDialogInput.model;
                var mapType = lodash.find(vm.mapTypes, function (m) {
                    return m.id === vm.resource.field_map_type;
                });
                vm.resource.mapType = mapType;
                vm.geoFileNeeded = !vm.resource.mapImageFile.georeferenced;
            }
        }

        /**
         * Close the dialog
         * 
         */
        function close() {
            C2Dialog.close();
        }

        /**
         * Handle the after save event, refreshing the maps from server and closing the dialog
         * 
         */
        function afterSave() {
            vm.saving = false;
            if (angular.isDefined(mapDialogInput.onSave)) {
                mapDialogInput.onSave();
            }
            close();
            MapLayerService.refreshMapResource(vm.resourceUpdated);
        }

        /**
         * Check the constraints and adjust resource mapping the field names and set the resource model
         * 
         * @returns void
         */
        function beforeSave() {
            vm.saving = true;
            if (angular.isUndefined(vm.resource.mapImageFile)) {
                vm.saving = false;
                C2Toast.error($translate.instant('messages.mapFileIsMandatory'));
                return false;
            } else {
                vm.resource.image_file_id = vm.resource.mapImageFile.id;
                vm.resource.map_type_id = vm.resource.mapType.id;

                if (angular.isDefined(vm.resource.mapGeoFile)) {
                    vm.resource.field_map_geo_id = vm.resource.mapGeoFile.id;
                }
            }
            // While we don't have projects management, assign the first
            vm.resource.map_project_id = vm.projects[0].id;
            vm.resourceUpdated = angular.copy(vm.resource);
        }

        /**
         * Handles the file remove event, deleting the file from the back-end 
         * and removing it from the resource.files collection  
         * @param {any} fileData 
         */
        function onFileRemove() {}
        //vm.removeMap();


        /**
         * Handles the file remove event, deleting the file from the back-end 
         * and removing it from the resource.files collection
         */
        function removeFile(file) {
            var fileService = new FileService();
            fileService.id = file.id;

            if (angular.isDefined(fileService)) {
                fileService.$destroy().then(function () {
                    setStateAfterFileRemoval(file);
                });
            }
        }

        /**
         * Set the the variables state after a file (image or geo) is removed
         * 
         * @param {object} savedFileData 
         */
        function setStateAfterFileRemoval(removedFile) {
            setIsGeoreferenced();
            var isImage = angular.isDefined(removedFile.thumb) ? true : false;
            if (isImage) {
                vm.resource.mapImageFile = {};
                vm.resource.mapGeoFile = {};
                vm.geoFileNeeded = false;
            } else {
                vm.resource.mapGeoFile = {};
                vm.geoFileNeeded = !vm.resource.georeferenced;
            }
        }

        /**
         * Handles the image file change (when a file is added), preparing, and uploading it 
         * to the back-end and adding it to the client resource.files collection 
         */
        function onImageFileChange() {
            // In sequence we upload the new file (we dont have to wait the removal)
            var fileObj = vm.imageFile[0];
            if (angular.isDefined(fileObj) && !fileObj.isRemote) {
                if (fileObj.lfTagType === "image") {
                    // check whether the file size is less than 200 MB
                    if (fileObj.lfFile.size / 1024 / 1024 <= 200) {
                        var fileService = new FileService();
                        fileService.file = fileObj.lfFile;
                        uploadFile(fileService);
                    } else {
                        C2Toast.error($translate.instant('messages.fileTooBig'));
                    }
                } else {
                    C2Toast.error($translate.instant('messages.invalidImageFile'));
                }
            }
        }

        /**
         * Handles the geo file change (when a file is added), preparing, and uploading it 
         * to the back-end and adding it to the client resource.files collection 
         */
        function onGeoFileChange() {
            // We the has a image, we ask the server to remvoe this file
            // to avoid garbage in the back-end
            var imageId = null;
            if (angular.isDefined(vm.resource.mapImageFile) && angular.isDefined(vm.resource.mapImageFile.id)) {
                imageId = vm.resource.mapImageFile.id;
            }
            // In sequence we upload the new file (we dont have to wait the removal)
            var fileObj = vm.geoFile[0];
            if (angular.isDefined(fileObj) && !fileObj.isRemote) {
                var fileService = new FileService();
                fileService.file = fileObj.lfFile;
                fileService.map_image_file_id = imageId;
                fileService.map_geo_file_projection = vm.resource.projection.value;
                uploadFile(fileService);
            };
        }

        /**
         * Process a file upload (image or geo file)
         * 
         * @param {FileService} fileService 
         */
        function uploadFile(fileService) {
            fileService.upload().then(function (savedFileData) {
                setStateAfterFileUpload(savedFileData);
            });
        }

        /**
         * Set the the variables state after a file (image or geo) is uploaded
         * 
         * @param {object} savedFileData 
         */
        function setStateAfterFileUpload(savedFileData) {
            if (angular.isDefined(savedFileData.id)) {
                if (angular.isDefined(savedFileData.thumb)) {
                    vm.resource.mapImageFile = savedFileData;
                    // if(!vm.resource.mapImageFile.georeferenced){
                    if (!vm.resource.mapImageFile.isgeoref) {
                        vm.geoFileNeeded = true;
                    }
                } else {
                    vm.resource.mapGeoFile = savedFileData;
                    vm.geoFileNeeded = false;
                }
                setIsGeoreferenced();
            }
        }

        /**
         * Define a shorthand property if the map is georeferenced or not
         * 
         */
        function setIsGeoreferenced() {
            // vm.resource.georeferenced = vm.resource.mapImageFile.georeferenced === true || angular.isDefined(vm.resource.mapGeoFile.id);
            vm.resource.georeferenced = vm.resource.mapImageFile.isgeoref;
        }

        function showGeorefBadge() {
            if (vm.resource.georeferenced !== undefined && vm.mode !== 'edit') {
                return true;
            } else {
                return false;
            }
        }
    }
})();
'use strict';

(function () {

  'use strict';

  MapLeftSidenavController.$inject = ["$scope", "$timeout", "$mdSidenav", "$log", "$rootScope"];
  angular.module('app').controller('MapLeftSidenavController', MapLeftSidenavController);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function MapLeftSidenavController($scope, $timeout, $mdSidenav, $log, $rootScope) {
    var vm = this;

    vm.close = function () {
      // Component lookup should always be available since we are not using `ng-if`
      $mdSidenav('left').close().then(function () {
        $log.debug("close LEFT is done");
      });
    };

    $rootScope.$on('addToWorkingList', function (event, data) {
      console.log(data); // 'Some data'
    });
  }
})();
'use strict';

(function () {
	'use strict';

	var app = angular.module('app');

	app.factory('$localStorage', ['$window', function ($window) {
		return {
			set: function set(key, value) {
				$window.localStorage[key] = value;
			},
			get: function get(key, defaultValue) {
				return $window.localStorage[key] || defaultValue;
			},
			setObject: function setObject(key, value) {
				$window.localStorage[key] = JSON.stringify(value);
			},
			getObject: function getObject(key) {
				return JSON.parse($window.localStorage[key] || '{}');
			},
			remove: function remove(key) {
				delete $window.localStorage[key];
			}
		};
	}]);
})();
'use strict';

(function () {
	'use strict';

	var app = angular.module('app');

	app.factory('$sessionStorage', ['$window', function ($window) {
		return {
			set: function set(key, value) {
				$window.sessionStorage[key] = value;
			},
			get: function get(key, defaultValue) {
				return $window.sessionStorage[key] || defaultValue;
			},
			setObject: function setObject(key, value) {
				$window.sessionStorage[key] = JSON.stringify(value);
			},
			getObject: function getObject(key) {
				return JSON.parse($window.sessionStorage[key] || '{}');
			},
			remove: function remove(key) {
				delete $window.sessionStorage[key];
			}
		};
	}]);
})();
'use strict';

(function () {
  'use strict';

  /** @ngInject */

  angular.module('app').component('box', {
    replace: true,
    templateUrl: ['Global', function (Global) {
      return Global.clientPath + '/shared/components/box.html';
    }],
    transclude: {
      toolbarButtons: '?boxToolbarButtons',
      footerButtons: '?boxFooterButtons'
    },
    bindings: {
      boxTitle: '@',
      toolbarClass: '@',
      toolbarBgColor: '@'
    },
    controller: ['$transclude', function ($transclude) {
      var ctrl = this;

      ctrl.transclude = $transclude;

      ctrl.$onInit = function () {
        if (angular.isUndefined(ctrl.toolbarBgColor)) ctrl.toolbarBgColor = 'default-primary';
      };
    }]
  });
})();
'use strict';

(function () {
  'use strict';

  /** @ngInject */

  angular.module('app').component('contentBody', {
    replace: true,
    transclude: true,
    templateUrl: ['Global', function (Global) {
      return Global.clientPath + '/shared/components/content-body.html';
    }],
    bindings: {
      layoutAlign: '@'
    },
    controller: [function () {
      var ctrl = this;

      ctrl.$onInit = function () {
        // Make a copy of the initial value to be able to reset it later
        ctrl.layoutAlign = angular.isDefined(ctrl.layoutAlign) ? ctrl.layoutAlign : 'center start';
      };
    }]
  });
})();
'use strict';

(function () {
  'use strict';

  /** @ngInject */

  angular.module('app').component('contentHeader', {
    templateUrl: ['Global', function (Global) {
      return Global.clientPath + '/shared/components/content-header.html';
    }],
    replace: true,
    bindings: {
      title: '@',
      description: '@'
    }
  });
})();
'use strict';

(function () {

  'use strict';

  MapViewerController.$inject = ["vm", "$scope", "options", "$controller", "MapService", "lodash", "Global", "C2Dialog", "MapTypeService", "leafletData", "leaflet", "$mdSidenav", "SupportService", "$rootScope", "MapLayerService", "$timeout", "$window", "$state", "$translate", "$mdColors", "C2Toast"];
  angular.module('app').controller('MapViewerController', MapViewerController);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function MapViewerController(vm, $scope, options, $controller, MapService, lodash, Global, C2Dialog, MapTypeService, leafletData, leaflet, $mdSidenav, SupportService, $rootScope, MapLayerService, $timeout, $window, $state, $translate, $mdColors, C2Toast) {

    // Functions Block    
    vm.afterSearch = afterSearch;
    vm.onActivate = onActivate;
    vm.applyFilters = applyFilters;
    vm.toggleLeft = toggleLeft;
    vm.toggleRight = toggleRight;
    vm.switchToView = switchToView;
    vm.reset = reset;
    vm.toggleViewersCenterLink = toggleViewersCenterLink;
    vm.hideViewer = hideViewer;
    vm.showBothViewers = showBothViewers;
    vm.toggleWheelZoom = toggleWheelZoom;
    vm.toggleAddGCP = toggleAddGCP;

    // Set options as context variables
    vm.supportListingView = options.supportListingView;
    vm.supportDrawing = options.supportDrawing;
    vm.titleTranslKey = options.titleTranslKey;
    vm.showGeoRefTools = options.showGeoRefTools;
    vm.leftSideBar = options.leftSideBar;
    // vm.rightSideBar = options.rightSideBar;
    vm.showGcpTable = options.showGcpTable;
    vm.gcpTable = options.gcpTable;
    vm.displayBottomNav = false;

    if (angular.isUndefined(options.rightSideBar)) {
      vm.rightSideBar = Global.clientPath + "/shared/map-viewer/navs/map-right-sidenav.html";
    } else {
      vm.rightSideBar = options.rightSideBar;
    }

    if (angular.isUndefined(options.bottomNav)) {
      vm.displayBottomNav = true;
    } else {
      vm.displayBottomNav = false;
    }

    // instantiate base controller
    $controller('CRUDController', {
      vm: vm,
      modelService: MapService,
      options: {
        searchOnInit: true,
        perPage: 7
      }
    });

    /**
     * Execute the action when this controller is activated
     * 
     */
    function onActivate() {
      // call child onActivate function, if it exists
      if (angular.isFunction(vm.beforeViewerActivate)) {
        vm.beforeViewerActivate();
      }

      // Initially the bottom nav start retracted
      vm.showBottomNav = false;

      // Get the map types from the service
      MapTypeService.paginate().then(function (response) {
        vm.mapTypes = response.items;
      });

      // Build the options for the default layers building task      
      var options = {
        supportDrawing: vm.supportDrawing
      };

      // Build the base layers for both viewers (leftMapViewer and rightMapViewer)    
      MapLayerService.buildDefaultLayers(options);

      // check if at the beginning, both viewers 
      // should have draw capabilities and (if yes) add
      if (vm.supportDrawing === true) {
        vm.rightControls = {
          draw: {}
        };
        vm.leftControls = {
          draw: {}
        };
      }

      // Initial center in Heidelberg, Germany
      vm.leftCenter = MapLayerService.getDefaultCenter();

      // Get each viewer data
      vm.leftMapViewer = MapLayerService.getViewerData('leftMapViewer');
      vm.rightMapViewer = MapLayerService.getViewerData('rightMapViewer');

      // At the beginning, both viewers are visible     
      vm.showRightMapViewer = true;
      vm.showLeftMapViewer = true;

      // Initially, both maps should have the same center, moving together      
      vm.rightCenter = vm.leftCenter;

      // Refresh the viewers, so the tiles are loaded/adjusted
      // according the view size
      refreshMapViewer();

      // Initially the mouse wheel scroll as a zoom control starts disabled
      // so the user can scroll the page easily
      vm.rightWheelZoomEnabled = false;
      vm.leftWheelZoomEnabled = false;
      MapLayerService.setWheelZoomStatus('leftMapViewer', false);
      MapLayerService.setWheelZoomStatus('rightMapViewer', false);

      // call child onActivate function, if it exists
      if (angular.isFunction(vm.onViewerActivate)) {
        vm.onViewerActivate();
      }
    }

    /**
     * Switched the view and broadcast and event when the view is switched
     */
    function switchToView(view) {
      vm.goTo(view);
      $rootScope.$broadcast('switchedView', view);
      if (view === 'form') {
        // Refresh the viewers, so the tiles are loaded/adjusted
        // according the view size
        refreshMapViewer();
      }
    }

    /**
     * Diasble Add GCP Points button. The first time that the viewers load, the buttons should be disabled are there is no overlays other than baselayers.
     */
    function toggleAddGCP() {
      return MapLayerService.getOverlaysCountBool();
    }

    /**
     * Toggle the mouse wheel scroll as a zoom control for a viewer
     * 
     * @param {any} viewerId 
     */
    function toggleWheelZoom(viewerId) {
      if (viewerId === 'rightMapViewer') {
        vm.rightWheelZoomEnabled = !vm.rightWheelZoomEnabled;
        MapLayerService.setWheelZoomStatus(viewerId, vm.rightWheelZoomEnabled);
      } else {
        vm.leftWheelZoomEnabled = !vm.leftWheelZoomEnabled;
        MapLayerService.setWheelZoomStatus(viewerId, vm.leftWheelZoomEnabled);
      }
    }

    /**
     * Refresh the map on the viewer. 
     * Useful when the viewer is resized or switched from one/two viewers
     * 
     * @return void 
     */
    function refreshMapViewer() {
      // This is a hack to force leaflet redraw/resize correctly the maps
      // in the case when there are two map viewers and the container of one of them 
      // is resized. 
      // The candidates map.invalidateSize() and map.eachLayer(function(layer){layer.redraw();});
      // have not worked at all on this case
      // @see  https://github.com/Leaflet/Leaflet/issues/694
      $timeout(function () {
        // We manually fire the browser resize event inside a
        // timeout function with a delay of 1 tenth of second
        // For some reason, when this event occurs, leaflet
        // is able to resize/redraw the tiles correctly
        $window.dispatchEvent(new Event('resize'));
      }, 100);
    }

    /**
     * Hide a viewer
     * 
     * @param {any} viewerId 
     */
    function hideViewer(viewerId) {
      if (viewerId === 'leftMapViewer') {
        vm.showLeftMapViewer = false;
      } else {
        vm.showRightMapViewer = false;
      }
      // Tells the service that a viewer is now hidden
      // Internally the service propagate this so other controllers/services
      // can listen to this event and apply changes
      MapLayerService.hideViewer(viewerId);

      // As there is only one viewer, it must have used the full space
      vm.viewerWidth = 100;

      // This attribute is used to determine if the viewer split button must be shown
      vm.bothViewersVisible = false;

      // Refresh the viewers, so the tiles are loaded/adjusted
      // according to the view size
      refreshMapViewer();
    }

    /**
     * Show both the viewers, resize both to 50%
     * and refresh the viewers (reload the tiles)
     * 
     */
    function showBothViewers() {
      // As there are two viewers, each one must have half space
      vm.viewerWidth = 50;

      // if the right viewer is hidden, show it
      if (vm.showRightMapViewer === false) {
        vm.showRightMapViewer = true;

        // Tells the the service that a viewer is now shown
        // Internally the service propagate this so other controllers/services
        // can listen to this event and apply changes
        MapLayerService.showViewer('rightMapViewer');
      }

      // if the left viewer is hidden, show it
      if (vm.showLeftMapViewer === false) {
        vm.showLeftMapViewer = true;

        // Tells the the service that a viewer is now shown
        // Internally the service propagate this and other controllers/services
        // can listen to this event and apply changes
        MapLayerService.showViewer('leftMapViewer');
      }
      // This attribute is used to determine if the viewer split button must be shown
      vm.bothViewersVisible = true;

      // After the changes we refresh the viewers, to the tiles are adjusted
      refreshMapViewer();
    }

    /**
     * Link or unlink the center of both viewers
     * 
     * @param {string} masterViewer - the viewer from which the center will be used to centralized itself
     */
    function toggleViewersCenterLink(masterViewer) {
      // console.log(">>> map-viewer.controller >>> toggleViewersCenterLink >>> ", masterViewer);
      // if loaded ungeoreferenced file then can't link the maps
      // if the viewers' center are linked, unlink then
      // but keep them with the same center
      if (vm.rightCenter == vm.leftCenter) {
        vm.rightCenter = angular.copy(vm.leftCenter);
      }
      // if the viewers' center are not linked, link
      // them, moving the slave viewer's center to the center of
      // the 'master viewer' center passed as parameter
      else {
          if (!MapLayerService.hasNonGeoreferencedLayer('leftMapViewer')) {
            if (masterViewer === 'leftMapViewer') {
              vm.rightCenter = vm.leftCenter;
            } else {
              vm.leftCenter = vm.rightCenter;
            }
          } else {
            // console.log("can't load right map since right side is ungeorefernced")
            C2Toast.info($translate.instant('dialog.cantLoadDescription'));
          }
        }
    }

    /**
     * Listen to the event that tells us that an ungeoreferenced map will be loaded
     * and unlink the viewers' center. This event occurs before the map is loaded
     * and receive the viewer id where the ungeoreferenced mao will be loaded
     */
    $rootScope.$on('ungeoreferencedLayerToBeLoaded', function (event, viewerId) {
      // the toggle function unlink on viewer's center       
      if (vm.rightCenter == vm.leftCenter) {
        toggleViewersCenterLink(viewerId);
      }
    });

    /**
     * Listen to the event that tells us that an georeferenced map will be loaded
     * and link the viewers' center. This event occurs before the map is loaded
     * and receive the viewer id where the georeferenced mao will be loaded
     */
    $rootScope.$on('georeferencedLayerToBeLoaded', function (event, viewerId) {
      // the toggle function unlink on viewer's center       
      if (vm.rightCenter != vm.leftCenter) {
        toggleViewersCenterLink(viewerId);
      }
    });

    /**
     * Make some adjustments in the resources list after loading them
     * 
     * @param {any} response 
     */
    function afterSearch(response) {
      lodash.map(vm.resources, function (map) {
        map.mapImageFile = map.map_image_file;
        map.mapTypeName = map.map_type_name;
        map.mapGeoFile = map.field_map_geofile;
        return map;
      });
    }

    /**
     * Here we listen to the applyFilters callback to add custom filters
     * 
     * @param {any} defaultQueryFilters 
     * @returns {}
     */
    function applyFilters(defaultQueryFilters) {
      var filters = {};
      if (angular.isDefined(vm.queryFilters)) {
        if (angular.isDefined(vm.queryFilters.mapType)) {
          filters.field_map_type = angular.copy(vm.queryFilters.mapType.id);
        }
        filters.title = vm.queryFilters.title;
        if (vm.queryFilters.georeferenced !== 'All') {
          filters.georeferenced = vm.queryFilters.georeferenced;
        }
        if (vm.queryFilters.verified !== 'All') {
          filters.verified = vm.queryFilters.verified;
        }
      }

      return angular.extend(defaultQueryFilters, filters);
    }

    /**
     * Reset the search state and reload items
     */
    function reset() {
      vm.queryFilters = {};
      vm.search();
    }

    /**
     * Open/close the left side nav
     * 
     */
    function toggleLeft() {
      $mdSidenav('left').toggle();
    }

    /**
     * Open/close the right side nav
     * 
     */
    function toggleRight() {
      $mdSidenav('right').toggle();
    }

    /**
     * 
     * 
     */
    function deleteGCP(gcpId) {
      console.log(">>> ma-viewer.controller >>> deleteGCP ", gcpId);
    }
  }
})();
'use strict';

/*eslint-env es6*/

(function () {

  'use strict';

  MenuController.$inject = ["$mdSidenav", "$state", "$mdColors", "$rootScope"];
  angular.module('app').controller('MenuController', MenuController);

  /** @ngInject */
  function MenuController($mdSidenav, $state, $mdColors, $rootScope) {
    var vm = this;

    //Bloco de declaracoes de funcoes
    vm.open = open;
    vm.openMenuOrRedirectToState = openMenuOrRedirectToState;

    // added to make the menu highlighted
    vm.currentNavItem = $state.current.name;
    // root state change watcher to highlight the tab on each state change
    $rootScope.$on('$stateChangeStart', function (event, toState, toParams, fromState, fromParams) {
      // console.log("state changed from - ", fromState, " to - ", toState);
      vm.currentNavItem = toState.name;
    });
    activate();

    function activate() {
      // Array contendo os itens que são mostrados no menu lateral
      vm.itensMenu = [];
    }

    function open() {}

    /**
     * Método que exibe o sub menu dos itens do menu lateral caso tenha sub itens
     * caso contrário redireciona para o state passado como parâmetro
     */
    function openMenuOrRedirectToState($mdMenu, ev, item) {
      if (angular.isDefined(item.subItens) && item.subItens.length > 0) {
        $mdMenu.open(ev);
      } else {
        $state.go(item.state);
        $mdSidenav('left').close();
      }
    }

    function getColor(colorPalettes) {
      return $mdColors.getThemeColor(colorPalettes);
    }
  }
})();
'use strict';

(function () {

  'use strict';

  VectorLayerController.$inject = ["$state", "VectorService", "lodash", "C2Dialog", "C2Toast", "$translate", "mapDialogInput"];
  angular.module('app').controller('VectorLayerController', VectorLayerController);

  function VectorLayerController($state, VectorService, lodash, C2Dialog, C2Toast, $translate, mapDialogInput) {

    var vm = this;
    vm.save = save;
    vm.close = close;
    vm.mode = null;

    vm.viewTitle = "Add Layer";
    vm.resource = {
      title: null,
      description: null,
      // layerName: "vertex_proj_id_projectId1_layer_id_layerId_latest",
      proj_id: null,
      user_id: null,
      layerName: null,
      layerId: null
    };

    function init() {
      // console.log(">>> VectorLayerController >>> init ");
      defineViewState();
      if (angular.isDefined(mapDialogInput.model)) {
        vm.resource.title = mapDialogInput.model.title;
        vm.resource.description = mapDialogInput.model.desc;
        vm.resource.layerName = mapDialogInput.model.layerName;
        vm.resource.layerId = mapDialogInput.model.layerId;
        // console.log("init ...... ", vm.resource);
      }
    }

    function save() {
      // console.log(">>> VectorLayerController >>> save ", vm.resource);
      var vectorService = new VectorService();
      if (angular.equals(vm.mode, "add")) {
        if (!lodash.isEmpty(sessionStorage.getItem("projId"))) {
          vm.resource.proj_id = sessionStorage.getItem("projId");
          vm.resource.user_id = sessionStorage.getItem("userId");
        }
        var reqParam = {
          "action": "createLayers",
          "data": []
        };
        reqParam.data.push(vm.resource);
        vectorService.createVectorLayers(reqParam).then(function (response) {
          // console.log("response ", response);
          if (response === "success") {
            C2Toast.success($translate.instant('messages.saveSuccess'));
            close();
            // $state.reload();
            location.reload();
          } else {
            C2Toast.error($translate.instant('messages.saveError'));
          }
        }, function (err) {
          console.log(err);
        });
      } else if (angular.equals(vm.mode, "edit")) {
        if (!lodash.isEmpty(sessionStorage.getItem("projId"))) {
          vm.resource.proj_id = sessionStorage.getItem("projId");
          vm.resource.user_id = sessionStorage.getItem("userId");
        }
        // console.log("edit saving...... ", vm.resource);
        var reqParam = {
          "action": "editLayers",
          "data": [{
            "title": vm.resource.title,
            "description": vm.resource.description,
            "layer_id": vm.resource.layerId,
            "user_id": vm.resource.user_id,
            "proj_id": vm.resource.proj_id
          }]
        };
        // reqParam.data.push(vm.resource);
        vectorService.editVectorLayers(reqParam).then(function (response) {
          // console.log("response ", response);
          if (response === "success") {
            C2Toast.success($translate.instant('messages.saveSuccess'));
            close();
            $state.reload();
          } else {
            C2Toast.error($translate.instant('messages.saveError'));
          }
        }, function (err) {
          console.log(err);
        });
      }
    }

    /**
     * Define the dialog view state as add or edit 
     * and parse the view title
     * 
     * @return void
     */
    function defineViewState() {
      vm.mode = angular.isDefined(mapDialogInput.model) ? 'edit' : 'add';
      if (vm.mode == 'add') {
        vm.viewTitle = $translate.instant('views.titles.addLayer');
      } else {
        vm.viewTitle = $translate.instant('views.titles.editLayer');
      }
    }

    /**
     * Close the dialog
     * 
     */
    function close() {
      C2Dialog.close();
    }

    init();
  }
})();
'use strict';

(function () {

  'use strict';

  VectorLeftSidenavController.$inject = ["Global", "$mdSidenav", "$mdDialog", "$window", "lodash", "$rootScope", "C2Dialog", "C2Toast", "$translate", "$state", "leaflet", "leafletData", "$sessionStorage", "VectorService"];
  angular.module('app').controller('VectorLeftSidenavController', VectorLeftSidenavController);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function VectorLeftSidenavController(Global, $mdSidenav, $mdDialog, $window, lodash, $rootScope, C2Dialog, C2Toast, $translate, $state, leaflet, leafletData, $sessionStorage, VectorService) {
    var vm = this;

    vm.layerClicked = layerClicked;
    vm.activateFeatureEdit = activateFeatureEdit;
    vm.deleteLayer = deleteLayer;
    vm.openAttributePopUp = openAttributePopUp;
    vm.layerVisibility = layerVisibility;
    vm.createLayer = createLayer;
    vm.save = save;
    vm.toggleLeft = toggleLeft;
    vm.exportLayer = exportLayer;
    vm.userAllow = userAllow;
    vm.drawControl = null; // toolbar control
    vm.drawnItems = null;
    vm.layers = [];
    vm.leafletLayers = [];
    vm.currentlyEditingLayer = null;
    vm.editMode = null;

    // Called from right side nav for adding newly created feature to leaflet layer
    $rootScope.$on('addFeatureToLayer', function (event, args) {
      // console.log(">>> VectorLeftSidenavController >>> addFeatureToLayer ", args);
      // leaflet.geoJSON(args, {}).addTo(vm.drawnItems);
      vm.drawnItems.addLayer(args);
      leafletData.getMap('leftMapViewer').then(function (map) {
        vm.drawnItems.addTo(map);
      });
    });

    /**
     * First function called after the controller is ran
     * here the stuff are initialized
     * 
     */
    function activate() {
      // console.log(">>> ge.left.sidenav.controller >>> activate ");
      if (!lodash.isEmpty($sessionStorage.getObject("projId").toString())) {
        var projId = $sessionStorage.getObject("projId").toString();
        var layerService = new VectorService();
        var reqParamData = {
          proj_id: projId,
          user_id: $sessionStorage.getObject("userId").toString(),
          fetch: 'allLayers'
        };
        layerService.getVectorLayers(reqParamData).then(function (result) {
          lodash.forEach(result, function (layer) {
            layer.layerName = "vertex_proj_id_" + projId + "_layer_id_" + layer.layer_id + "_latest";
            // load WFS layers from Geoserver
            loadWFSLayers(layer);
          });
        }, function (err) {
          console.log(err);
        });
      }

      // handle feature creation on map
      leafletData.getMap('leftMapViewer').then(function (map) {
        if (typeof vm.drawnItems !== "undefined") {
          // added this bloc of code for letting user get feature-info without entering edit-mode
          if (vm.drawnItems === null) {
            vm.drawnItems = new leaflet.FeatureGroup();
          }
          vm.drawnItems.on('click', onFeatureClicked);
          // vm.drawnItems.addTo(map);
          // map.addLayer(vm.drawnItems);
          // ----------------------
          if ($state.current.name === "app.vector") {
            map.on('draw:created', function (e) {
              var leafLayer = e.layer;
              // vm.drawnItems.addLayer(leafLayer);
              var drawsGeoJson = leafLayer.toGeoJSON();
              vm.editMode = "add";
              // openAttributePopUp(drawsGeoJson, vm.currentlyEditingLayer, vm.editMode, e);
              openAttributePopUp(leafLayer, vm.currentlyEditingLayer, vm.editMode, e);
            }.bind(vm.drawnItems));
            map.on('draw:editstart', function (e) {
              //  console.log(">>> draw:editstart ");
              vm.editMode = "edit-Geom";
              //  vm.drawnItems.off('click', onFeatureClicked);
            }.bind(vm.drawnItems));
            map.on('draw:editstop', function (e) {
              // console.log(">>> draw:editstop ");
              vm.editMode = null;
            }.bind(vm.drawnItems));
            map.on('draw:edited', function (e) {
              // console.log(">>> draw:edited ");
              var layers = e.layers;
              /* layers.eachLayer(function (layer) {
                  // console.log(layer);
                  // replace feature geom with the new editted geom value
                  layer.feature.geometry.coordinates = Object.values(layer.getLatLng());
                  $rootScope.$broadcast("addFeatureToUpdate", layer.feature);
              }); */
              $rootScope.$broadcast("geomUpdated", layers);
            });
            map.on('draw:deletestart', function (e) {
              // console.log(">>> draw:deletestart ");
              vm.editMode = "delete";
            }.bind(vm.drawnItems));
            map.on('draw:deletestop', function (e) {
              // console.log(">>> draw:deletestop ");
              vm.editMode = null;
            }.bind(vm.drawnItems));
            map.on('draw:deleted', function (e) {
              // console.log(">>> draw:deleted ");
              var layers = e.layers;
              prepareDeleteParams(layers);
            });
          }
        }
      });
    }

    function onFeatureClicked(e) {
      // console.log(">>> onFeatureClicked >>> ", e);
      if (!(vm.editMode === "edit-Geom" || vm.editMode === "delete")) {
        // expects only a single feature
        $rootScope.$broadcast("showFeatureAttr", e.layer.feature);
      }
    }

    function createLayer() {
      // console.log(">>> ge.left.sidenav.controller >>> createLayer");
      close();
      var config = {
        locals: {
          mapDialogInput: {
            // model: resource,
            removeFn: vm.remove
          }
        },
        controller: 'VectorLayerController',
        controllerAs: 'ctrl',
        templateUrl: Global.clientPath + '/vector/dialog/vectorLayer.html',
        hasBackdrop: false
      };

      C2Dialog.custom(config).then(function () {
        // reload the items from back-end
        // vm.search();
        // console.log("save done");
      });
    }

    function layerClicked(layer) {
      console.log(">>> vector.left.sidenav.controller >>> layerClicked ", layer);
      close();
      var config = {
        locals: {
          mapDialogInput: {
            model: layer
            // removeFn: vm.remove
            // mode: 'edit'
          }
        },
        controller: 'VectorLayerController',
        controllerAs: 'ctrl',
        templateUrl: Global.clientPath + '/vector/dialog/vectorLayer.html',
        hasBackdrop: false
      };

      C2Dialog.custom(config).then(function () {
        // reload the items from back-end
        // vm.search();
        // console.log("save done");
      });
    }

    /**
     * Activate Edit toolbar for particular layer
     * 
     * @param {any} layer 
     */
    function activateFeatureEdit(layer) {
      // console.log(">>> vector.left.sidenav.controller >>> activateFeatureEdit ", layer);

      leafletData.getMap('leftMapViewer').then(function (map) {
        if (vm.drawControl !== null) {
          vm.drawControl.remove();
          vm.drawControl = null;
          if (angular.isDefined(vm.drawnItems)) {
            vm.drawnItems = null;
          }
        }
        if (vm.drawControl === null) {
          // vm.drawnItems = new leaflet.FeatureGroup();
          // vm.drawnItems.on({
          //   'click': function (e) {
          //     // expects only a single feature
          //     $rootScope.$broadcast("showFeatureAttr", e.layer.feature);
          //   }
          // })
          // adding current layers features to drawnItems
          // lodash.forEach(layer.getLayers(), function(eachFeature) {
          //   // console.log(">>> eachFeature ", eachFeature);
          //   // eachFeature.editing.enable();
          //   eachFeature.addTo(vm.drawnItems);
          // });
          // vm.drawnItems.addTo(map);
          // map.addLayer(vm.drawnItems);
          // 
          vm.drawnItems = new leaflet.FeatureGroup();
          // adding current layers features to drawnItems
          lodash.forEach(layer.getLayers(), function (eachFeature) {
            // console.log(">>> eachFeature ", eachFeature);
            // eachFeature.editing.enable();
            // check is role is 3, if so than check if the feature's user is the same as logged in user
            if (eachFeature.feature.properties.layerName === layer.layerId) {
              // console.log("before adding to drawnitems ", eachFeature.feature);
              if ($sessionStorage.getObject("role").toString() === "3") {
                if (eachFeature.feature.properties.user_id === $sessionStorage.getObject("userId")) {
                  eachFeature.addTo(vm.drawnItems);
                  vm.drawnItems.addTo(map);
                }
              } else {
                eachFeature.addTo(vm.drawnItems);
                vm.drawnItems.addTo(map);
              }
            }
          });
          vm.drawControl = new leaflet.Control.Draw({
            draw: {
              polygon: true,
              polyline: true,
              rectangle: false,
              circle: false,
              marker: true,
              circlemarker: false
            },
            edit: {
              featureGroup: vm.drawnItems
            },
            position: 'topright'
          });
          map.addControl(vm.drawControl);
        }
        // set the currently editing layer
        vm.currentlyEditingLayer = layer;
        $rootScope.$broadcast("setCurrentEditLayer", { data: { layer: vm.currentlyEditingLayer } });
        close();
      });
    }

    function addNonGroupLayers(sourceLayer, targetGroup) {
      if (sourceLayer instanceof L.LayerGroup) {
        sourceLayer.eachLayer(function (layer) {
          addNonGroupLayers(layer, targetGroup);
        });
      } else {
        targetGroup.addLayer(sourceLayer);
      }
    }

    /**
     * Removes the layer from map and deletes it from our collection
     * 
     * @param {any} layer 
     */
    function deleteLayer(layer) {
      // console.log(">>> vector.left.sidenav.controller >>> deleteLayer ", layer);
      // check for draw control
      // if(vm.drawControl !== null) {
      //   vm.drawControl.remove();
      //   vm.drawControl = null;
      //   if(angular.isDefined(vm.drawnItems)) {
      //     console.log("vm.drawnItems = ", vm.drawnItems);
      //     vm.drawnItems = null;
      //   }
      // }

      // // clean features from map i.e remove layer from map
      // leafletData.getMap('leftMapViewer').then(function (map) {
      //   map.removeLayer(layer);
      // });

      // vm.leafletLayers = lodash.reject(vm.leafletLayers, function(layerToDelete) { 
      //   if(leaflet.stamp(layerToDelete) === leaflet.stamp(layer)) {
      //     return true;
      //   }
      // });
      // console.log("After deleteing ", vm.leafletLayers);

      var confirm = $mdDialog.confirm().title($translate.instant('messages.deleteLayerTitle')).textContent($translate.instant('messages.deleteLayerMessage')).ariaLabel('Lucky day')
      // .targetEvent(ev)
      .ok($translate.instant('messages.yes')).cancel($translate.instant('messages.no'));

      $mdDialog.show(confirm).then(function () {
        // $scope.status = 'You decided to get rid of your debt.';
        var reqParam = {
          "action": "deleteLayers",
          "data": [{
            "layer_id": layer.layerId,
            "user_id": sessionStorage.getItem("userId"),
            "proj_id": sessionStorage.getItem("projId")
          }]
        };
        // call delete API and state.reload
        var vectorService = new VectorService();
        vectorService.deleteVectorLayer(reqParam).then(function (res) {
          if (res === "success") {
            $state.reload();
            C2Toast.success($translate.instant('messages.operationSuccess'));
          } else {
            C2Toast.success($translate.instant('messages.operationError'));
          }
        }, function (err) {
          console.log("Error while deleting ", err);
        });
      }, function () {
        // console.log("Deleting Layer Cancelled");
      });
    }

    /**
     * Accepts array of layer names and fires WFS calls to load them as WFS layer
     * Generates an array of layer list "leafletLayers" which maintains a list of layers added to map
     * 
     * @param [{any}] layers 
     */
    function loadWFSLayers(layer) {
      // console.log(">>> vector.left.sidenav.controller >>> loadWFSLayers ", layer);
      // lodash.forEach(layers, function(layer) {
      // console.log("calling geoserver for layer = ", layer);
      leafletData.getMap('leftMapViewer').then(function (map) {
        // MapLayerService.addWFSLayer(layer.layerName, 'leftMapViewer');
        // create layer objects and keep it in vm.layers list 
        var tempLayer = new leaflet.WFST({
          // url: 'https://demo.geo-solutions.it:443/geoserver/ows',
          // typeNS: 'tiger',
          // typeName: 'tiger_roads',
          url: 'http://0.0.0.0:8081/geoserver/ows',
          typeNS: 'vector',
          typeName: layer.layerName,
          // crs: leaflet.CRS.EPSG4326,
          geometryField: 'the_geom',
          style: {
            color: "#" + ((1 << 24) * Math.random() | 0).toString(16)
            // weight: 1,
          },
          fillOpacity: 0.2
        }, new leaflet.Format.GeoJSON({
          crs: leaflet.CRS.EPSG4326 /* ,
                                    pointToLayer(geoJsonPoint, latlng) {
                                    const layer = new L.CircleMarker(latlng, {
                                    radius: 10,
                                    });
                                    return layer;
                                    }, */
        })).addTo(map).on('load', function () {
          // map.fitBounds(tempLayer.getLayers()[0].getBounds());
          if (tempLayer.getBounds().isValid()) {
            map.fitBounds(tempLayer.getBounds());
          }
          tempLayer.visible = true;
          tempLayer.layerName = "vertex_proj_id_" + sessionStorage.getItem("projId") + "_layer_id_" + layer.layer_id + "_latest";
          tempLayer.title = layer.title;
          tempLayer.layerId = layer.layer_id;
          tempLayer.desc = layer.description;
          // store in my collection to be used 
          vm.leafletLayers.push(tempLayer);

          lodash.forEach(tempLayer.getLayers(), function (eachFeature) {
            // console.log(">>> eachFeature ", eachFeature, layer.layer_id);
            eachFeature.feature.properties.layerName = layer.layer_id;
            eachFeature.addTo(vm.drawnItems);
          });
        });
      });
      // });
    }

    function openAttributePopUp(featureGeojson, layer, mode, ev) {
      // console.log(">>> vector.left.sidenav.controller >>> openAttributePopUp ", featureGeojson, layer);
      $rootScope.$broadcast("openRightNav", /* FeatureService.createObjectFromGeoJson(layer.feature) */
      { data: {
          layer: layer,
          layerId: layer.layerId,
          feature: featureGeojson,
          operation: "create"
        }
      });
    }

    /**
     * Changes the visibilty of a layer
     * 
     * @param {any} layer 
     */
    function layerVisibility(layer) {
      // console.log(">>> layerVisibility ", layer, layer.visible);
      leafletData.getMap('leftMapViewer').then(function (map) {
        // console.log(">>> layerVisibility >>> ", map);
        if (layer.visible) {
          map.addLayer(layer);
        } else {
          map.removeLayer(layer);
        }
      });
    }

    function prepareDeleteParams(features) {

      $rootScope.$broadcast("featureDeleted", { data: {
          features: features,
          operation: "delete"
        }
      });
    }

    function getLayerByName(layerName) {
      console.log(">>> getLayerByName >>> ", layerName);
      leafletData.getMap('leftMapViewer').then(function (map) {
        map.eachLayer(function (layer) {
          console.log("each layer = ", layer);
        });
      });
    }

    /**
     * Close this sidenav
     * 
     */
    function close() {
      $mdSidenav('left').close();
    }

    /**
     * Open this sidenav
     * 
     */
    function open() {
      $mdSidenav('left').open();
    }

    /**
     * Main function which send the Modifications to server
     * 
     */
    function save() {
      // console.log(">>> VectorLeftSidenavController >>> save ");
      var reqParam = {
        "action": "createFeatures",
        "user_id": $sessionStorage.getObject("userId"),
        "proj_id": $sessionStorage.getObject("projId"),
        "role": $sessionStorage.getObject("role"),
        "data": []
      };
      var createParam = {
        "action": "create",
        "data": []
      };
      var editParam = {
        "action": "edit",
        "data": []
      };
      var deleteParam = {
        "action": "delete",
        "data": []
      };
      if (angular.equals($sessionStorage.getObject("createParam"), {})) {
        reqParam.data.push(createParam);
      } else {
        reqParam.data.push($sessionStorage.getObject("createParam"));
      }
      if (angular.equals($sessionStorage.getObject("editParam"), {})) {
        reqParam.data.push(editParam);
      } else {
        reqParam.data.push($sessionStorage.getObject("editParam"));
      }
      if (angular.equals($sessionStorage.getObject("deleteParam"), {})) {
        reqParam.data.push(deleteParam);
      } else {
        reqParam.data.push($sessionStorage.getObject("deleteParam"));
      }
      // console.log("reqParam = ", reqParam);

      var layerService = new VectorService();
      layerService.createFeatures(reqParam).then(function (result) {
        // console.log("saved in API ", result);
        if (result === "success") {
          C2Toast.success($translate.instant('messages.saveSuccess'));
          // console.log("saved in API ", result);
          $sessionStorage.remove("createParam");
          $sessionStorage.remove("editParam");
          $sessionStorage.remove("deleteParam");
          $state.reload();
        } else {
          C2Toast.error($translate.instant('messages.saveError'));
        }
      }, function (err) {
        console.log("Error while saving ", err);
        $sessionStorage.remove("createParam");
        $sessionStorage.remove("editParam");
        $sessionStorage.remove("deleteParam");
      });
    }

    /**
     * Open/close the left side nav
     * 
     */
    function toggleLeft() {
      $mdSidenav('left').toggle();
    }

    /**
     * Export layer data as GeoJSON in a file
     * 
     */
    function exportLayer(layer) {
      // console.log(">>> leftSideNav >>> exportLayer ", layer);
      // $window.open("/heimap/vector?proj_id="+
      //   $sessionStorage.getObject("projId") +
      //   "&layer_id="+ layer.layerId +"&fetch=latestVersion",
      //   "_blank");

      var reqParam = {
        // "user_id": $sessionStorage.getObject("userId"),
        "layer_id": layer.layerId,
        "proj_id": $sessionStorage.getObject("projId"),
        "fetch": "latestVersion"
      };

      var layerService = new VectorService();
      layerService.exportLayerGeoJson(reqParam).then(function (result) {
        // console.log("exportLayerGeoJson ", result);
        var layerData = "data:application/octet-stream;charset=utf-8," + encodeURIComponent(JSON.stringify(result));
        var downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", layerData);
        downloadAnchorNode.setAttribute("download", "layer.json");
        document.body.appendChild(downloadAnchorNode); // required for firefox
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
      }, function (err) {
        console.log("Error while saving ", err);
      });
    }

    /**
     * Check functionality is allowed for a user based on his role
     * 
     * @returns boolean
     */
    function userAllow(functionality) {
      if (functionality === "featureEdit") {
        if (sessionStorage.getItem("role").toString() === "1") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "2") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "3") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "4") {
          return false;
        }
      }
      if (functionality === "layerCreate") {
        if (sessionStorage.getItem("role").toString() === "1") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "2") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "3") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "4") {
          return false;
        }
      }
      if (functionality === "layerEdit") {
        if (sessionStorage.getItem("role").toString() === "1") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "2") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "3") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "4") {
          return false;
        }
      }
      if (functionality === "layerDelete") {
        if (sessionStorage.getItem("role").toString() === "1") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "2") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "3") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "4") {
          return false;
        }
      }
      if (functionality === "layerExport") {
        if (sessionStorage.getItem("role").toString() === "1") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "2") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "3") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "4") {
          return false;
        }
      }
      if (functionality === "publishData") {
        if (sessionStorage.getItem("role").toString() === "1") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "2") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "3") {
          return true;
        } else if (sessionStorage.getItem("role").toString() === "4") {
          return false;
        }
      }
    }

    activate();
  }
})();
'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

(function () {

  'use strict';

  VectorRightSidenavController.$inject = ["$mdSidenav", "lodash", "$rootScope", "leaflet", "leafletData", "FeatureService", "$sessionStorage", "VectorService", "MapLayerService"];
  angular.module('app').controller('VectorRightSidenavController', VectorRightSidenavController);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function VectorRightSidenavController($mdSidenav, lodash, $rootScope, leaflet, leafletData, FeatureService, $sessionStorage, VectorService, MapLayerService) {
    var vm = this;

    vm.showAttributes = showAttributes;
    vm.update = update;
    vm.close = close;
    vm.open = open;
    vm.showAllFeatureVersions = showAllFeatureVersions;
    vm.toggleRight = toggleRight;
    vm.checkDependentValue = checkDependentValue;
    vm.getFormAttribute = getFormAttribute;
    vm.featureAttr = null;
    vm.gazzTypes = ["Physical Thing", "Event", "Place"];
    vm.editMode = null; // "edit", "create", "delete"
    vm.currentLayer = null;
    vm.createParam = {
      "action": "create",
      "data": []
    };
    vm.editParam = {
      "action": "edit",
      "data": []
    };
    vm.deleteParam = {
      "action": "delete",
      "data": []
    };
    vm.disableSave = false;
    vm.showAllVersions = true;
    vm.formParams = null;

    // used for Edit feature call (attribute update)
    $rootScope.$on('showFeatureAttr', function (event, args) {
      // console.log(">>> VectorRightSidenavController >>> showFeatureAttr ", args);
      vm.featureAttr = null;
      // close and open to let the divs refresh
      close();
      vm.editMode = "edit";
      vm.currentFeature = args;
      args = FeatureService.createObjectFromGeoJson(args);
      // check whether feature already exist in vm.editParam
      if (vm.editParam.data.length > 0) {
        var tempObj = searchFromCollectionToFeature(args, vm.editParam);
        if (tempObj !== null) {
          tempObj.type_crm = vm.currentFeature.properties.type_crm;
          args = tempObj;
        }
      }
      showAttributes(args);
      open();
      if (vm.currentLayer !== null) {
        if (vm.currentLayer.layerId === vm.currentFeature.properties.layerName) {
          // check for user's access on this feature
          // console.log(checkUserAccessOnFeature(vm.currentFeature, $sessionStorage.getObject("userId").toString()));
          if (checkUserAccessOnFeature(vm.currentFeature, $sessionStorage.getObject("userId").toString())) {
            vm.disableSave = false;
          } else {
            vm.disableSave = true;
          }
        } else {
          vm.disableSave = true;
        }
      } else {
        vm.disableSave = true;
      }
      vm.showAllVersions = true;
    });

    // geom update
    $rootScope.$on('geomUpdated', function (event, args) {
      // console.log(">>> VectorRightSidenavController >>> addFeatureToUpdate ", args);
      args.eachLayer(function (layer) {
        // console.log(layer);
        // replace feature geom with the new editted geom value
        // layer.feature.geometry.coordinates = Object.values(layer.getLatLng());
        layer.feature.geometry = layer.toGeoJSON().geometry;
        vm.currentFeature = layer.feature;
        // addFeatureToUpdateList(layer.feature);
        // ------
        if (vm.createParam.data.length > 0) {
          // find editted feature in editParam 
          var foundObjectInCreateParam = lodash.find(vm.createParam.data, function (eachFeature) {
            return parseInt(layer.feature.properties.type_crm) === eachFeature.type_crm || layer.feature.properties.type_crm === eachFeature.type_crm;
          });
          if (typeof foundObjectInCreateParam !== "undefined") {
            // console.log("found in createParam ", foundObjectInCreateParam);
            searchAndReplaceOnlyGeom(layer.feature, vm.createParam);
            // addFeatureToUpdateList(layer.feature);
            // fire back to left sidenav to add newly added feature to its layer
            // $rootScope.$broadcast("addFeatureToLayer", vm.currentFeature);
            $sessionStorage.setObject("createParam", vm.createParam);
          } else {
            // handleEditParam(vm.featureAttr, vm.editParam, vm.currentFeature);
            addFeatureToUpdateList(layer.feature);
            $sessionStorage.setObject("editParam", vm.editParam);
          }
        } else {
          // handleEditParam(vm.featureAttr, vm.editParam, vm.currentFeature);
          addFeatureToUpdateList(layer.feature);
          $sessionStorage.setObject("editParam", vm.editParam);
        }
      });
    });

    // used for create feature call
    $rootScope.$on('openRightNav', function (event, args) {
      // console.log(">>> VectorRightSidenavController >>> openRightNav ", args);
      vm.featureAttr = null;
      close();
      vm.editMode = args.data.operation;
      vm.currentLayer = args.data.layer;
      vm.currentLeafFeature = args.data.feature;
      vm.currentFeature = args.data.feature.toGeoJSON();
      vm.disableSave = false;
      open();
    });

    // used for delete feature call
    $rootScope.$on('featureDeleted', function (event, args) {
      // console.log(">>> VectorRightSidenavController >>> featureDeleted ", args);
      var layers = args.data.features;
      layers.eachLayer(function (layer) {
        // check for it exist in create or edit collection
        if (searchInCollection(vm.createParam, layer) === false && searchInCollection(vm.editParam, layer) === false) {
          var tempDeleteData = {
            "layer_id": vm.currentLayer.layerId,
            "type_crm": layer.feature.properties.type_crm
          };
          vm.deleteParam.data.push(tempDeleteData);
        } else {
          if (searchInCollection(vm.createParam, layer)) {
            // delete it from that collection
            deleteFeatureFromCollection(layer, vm.createParam);
            // console.log("vm.createParam = ", vm.createParam);
            $sessionStorage.setObject("createParam", vm.createParam);
          }
          if (searchInCollection(vm.editParam, layer)) {
            // console.log(">>> got a feature in collection");
            // delete it from that collection
            deleteFeatureFromCollection(layer, vm.editParam);
            // console.log("vm.editParam = ", vm.editParam);
            $sessionStorage.setObject("editParam", vm.editParam);
            // since a edited feature is deleted that means its a simple delete
            var tempDeleteData = {
              "layer_id": vm.currentLayer.layerId,
              "type_crm": layer.feature.properties.type_crm
            };
            vm.deleteParam.data.push(tempDeleteData);
          }
        }
      });
      // console.log("vm.deleteParam = ", vm.deleteParam);
      $sessionStorage.setObject("deleteParam", vm.deleteParam);
    });

    // Assign current Editing layer
    $rootScope.$on('setCurrentEditLayer', function (event, args) {
      // console.log(">>> VectorRightSidenavController >>> setCurrentEditLayer ", args);
      vm.currentLayer = args.data.layer;
    });

    /**
     * First function called after the controller is ran
     * here the stuff are initialized
     * 
     */
    function activate() {}
    // console.log(">>> vector.right.sidenav.controller >>> activate ", vm);


    /**
     * Close this sidenav
     * 
     */
    function close() {
      $mdSidenav('right').close();
      vm.editMode = null;
      vm.currentFeature = null;
    }

    /**
     * Open this sidenav
     * 
     */
    function open() {
      $mdSidenav('right').open();
    }

    /**
     * Displays feature's attribute in right-side-nav. Called from event broadcast from 
     * vector.left.sidenav.controller
     * 
     */
    function showAttributes(featureObject) {
      // console.log(">>> VectorRightSidenavController >>> showFeatureAttr() ", featureObject);
      // check if any value contains [] for attribute types like "Language" where values will be an array
      var tempFValObj = Object.values(featureObject);
      var tempFKeyObj = Object.keys(featureObject);
      for (var i = 0; i < tempFValObj.length; i++) {
        if (typeof tempFValObj[i] === "string") {
          if (tempFValObj[i].indexOf("[") !== -1) {
            featureObject[tempFKeyObj[i]] = JSON.parse(tempFValObj[i]);
          }
        }
      }

      vm.featureAttr = featureObject;
      getFormAttribute();
    }

    /**
     * Called when geom update is performed on feature. Expects 1 feature at a time. 
     * Hence called in loop from the caller. 
     * Checks for Edit + Edit scenarios, mentioned in Test cases of #225.
     * Doesn't returns anything but updates the vm.editParam
     * 
     * @param {any} feature
     */
    function addFeatureToUpdateList(feature) {
      // console.log(">>> VectorRightSidenavController >>> addFeatureToUpdateList ", feature);
      if (vm.editParam.data.length > 0) {
        // find editted feature in editParam 
        var foundObjectInEditParam = lodash.find(vm.editParam.data, function (eachFeature) {
          return parseInt(feature.properties.type_crm) === eachFeature.type_crm || feature.properties.type_crm === eachFeature.type_crm;
        });
        // if found than replace it in ediParam else its a new feature push to editParam
        // console.log("foundObjectInEditParam = ", foundObjectInEditParam);
        if (typeof foundObjectInEditParam !== "undefined") {
          // searchAndReplace(feature, vm.editParam);
          // lodash.remove(vm.editParam.data, function(eachFeature){
          //   return (parseInt(feature.type_crm) === eachFeature.type_crm || 
          //   feature.type_crm === eachFeature.type_crm) 
          // });
          searchAndReplaceOnlyGeom(feature, vm.editParam);
        } else {
          var tempFeature = {
            "layer_id": vm.currentLayer.layerId,
            "key_cidoc_array": feature.properties.key_cidoc_array.split("|"),
            "value_gazetteer_array": feature.properties.value_gazetteer_array.split("|"),
            "type_crm": feature.properties.type_crm
          };
          tempFeature.key_cidoc_array.push("geom");
          tempFeature.value_gazetteer_array.push(feature.geometry);
          vm.editParam.data.push(tempFeature);
        }
      } else {
        var tempFeature = {
          "layer_id": vm.currentLayer.layerId,
          "key_cidoc_array": feature.properties.key_cidoc_array.split("|"),
          "value_gazetteer_array": feature.properties.value_gazetteer_array.split("|"),
          "type_crm": feature.properties.type_crm
        };
        tempFeature.key_cidoc_array.push("geom");
        tempFeature.value_gazetteer_array.push(feature.geometry);
        vm.editParam.data.push(tempFeature);
      }
      // console.log("vm.editParam = ", vm.editParam);
      $sessionStorage.setObject("editParam", vm.editParam);
    }

    /**
     * Save function. Called when Save button in right-saide-nav is clicked, updated vm.createParam
     * and vm.editParam.
     * Not for Delete features, since this handles majorly only for Attribute Save/Update
     * 
     */
    function update() {
      // console.log(">>> VectorRightSidenavController >>> update >>> ", vm.editMode, vm.currentLayer, vm.featureAttr, vm.currentFeature);
      if (vm.editMode === "create") {
        // vm.featureAttr.type_crm = "crm_" + Math.floor(Math.random() * (9999 - 1 + 1)) + 1;
        var tempCrm = "crm_" + Math.floor(Math.random() * (9999 - 1 + 1)) + 1;
        var apiParamFormat = convertJsonToApiReqObj(vm.featureAttr, vm.currentFeature);
        var tempFeature = {
          "layer_id": vm.currentLayer.layerId,
          "key_cidoc_array": apiParamFormat.keys,
          "value_gazetteer_array": apiParamFormat.values,
          "type_crm": tempCrm
        };
        vm.createParam.data.push(tempFeature);
        // create the vm.currentFeature in same style as we receive it from wfs layer call
        // vm.currentFeature.properties = vm.featureAttr;
        vm.currentFeature.properties = {
          "key_cidoc_array": convertToSSV(apiParamFormat.keys),
          "value_gazetteer_array": convertToSSV(apiParamFormat.values),
          "type_crm": tempCrm
        };
        vm.currentLeafFeature.feature = vm.currentFeature;
        // console.log("vm.currentLeafFeature = ", vm.currentLeafFeature);
        // fire back to left sidenav to add newly added feature to its layer
        $rootScope.$broadcast("addFeatureToLayer", vm.currentLeafFeature);
        $sessionStorage.setObject("createParam", vm.createParam);
      } else if (vm.editMode === "edit") {
        // check if current feature already exist in vm.createParam
        if (vm.createParam.data.length > 0) {
          // find editted feature in editParam 
          var foundObjectInCreateParam = lodash.find(vm.createParam.data, function (eachFeature) {
            return parseInt(vm.featureAttr.type_crm) === eachFeature.type_crm || vm.featureAttr.type_crm === eachFeature.type_crm;
          });
          if (typeof foundObjectInCreateParam !== "undefined") {
            // console.log("found in createParam ", foundObjectInCreateParam);
            searchAndReplace(vm.featureAttr, vm.createParam);
            var apiParamFormat = convertJsonToApiReqObj(vm.featureAttr, vm.currentFeature);
            vm.currentFeature.properties = {
              "key_cidoc_array": convertToSSV(apiParamFormat.keys),
              "value_gazetteer_array": convertToSSV(apiParamFormat.values),
              "type_crm": vm.featureAttr.type_crm
            };
            vm.currentLeafFeature.feature = vm.currentFeature;
            // fire back to left sidenav to add newly added feature to its layer
            $rootScope.$broadcast("addFeatureToLayer", vm.currentLeafFeature);
            $sessionStorage.setObject("createParam", vm.createParam);
          } else {
            handleEditParam(vm.featureAttr, vm.editParam, vm.currentFeature);
            // console.log("vm.editParam = ", vm.editParam);
            $sessionStorage.setObject("editParam", vm.editParam);
          }
        } else {
          handleEditParam(vm.featureAttr, vm.editParam, vm.currentFeature);
          // console.log("vm.editParam = ", vm.editParam);
          $sessionStorage.setObject("editParam", vm.editParam);
        }
      }

      toggleSaveButton();
    }

    /**
     * Handles Edit + Edit operations on Right Save click
     * 
     * @param {any} featureAttr feature's attributes which are displayed in right sidenav
     * @param {any} editParamCollection Edit collection  
     * @param {any} currentFeature 
     * 
     */
    function handleEditParam(featureAttr, editParamCollection, currentFeature) {
      // check is current feature already exist in editParamCollection due to geom edit
      if (editParamCollection.data.length > 0) {
        // find editted feature in editParam 
        var foundObjectInEditParam = lodash.find(editParamCollection.data, function (eachFeature) {
          return parseInt(featureAttr.type_crm) === eachFeature.type_crm || featureAttr.type_crm === eachFeature.type_crm;
        });
        // if found than replace it in ediParam else its a new feature push to editParam
        if (typeof foundObjectInEditParam !== "undefined") {
          searchAndReplace(featureAttr, editParamCollection);
        } else {
          var tempFeature = {
            "layer_id": vm.currentLayer.layerId,
            "type_crm": parseInt(featureAttr.type_crm),
            "key_cidoc_array": Object.keys(featureAttr),
            "value_gazetteer_array": Object.values(featureAttr)
          };
          editParamCollection.data.push(tempFeature);
          currentFeature.properties.key_cidoc_array = Object.keys(featureAttr).toString();
          currentFeature.properties.value_gazetteer_array = Object.values(featureAttr).toString();
        }
      } else {
        var tempFeatureAttr = FeatureService.tearObject(featureAttr);
        var tempFeature = {
          "layer_id": vm.currentLayer.layerId,
          "type_crm": parseInt(featureAttr.type_crm),
          "key_cidoc_array": tempFeatureAttr.keys,
          "value_gazetteer_array": tempFeatureAttr.values
        };
        editParamCollection.data.push(tempFeature);
        currentFeature.properties.key_cidoc_array = Object.keys(featureAttr).toString();
        currentFeature.properties.value_gazetteer_array = Object.values(featureAttr).toString();
      }
    }

    /**
     * Since our API requires the data in a particular format. This funcion converts key: value 
     * combination to all keys together and all values together. Also adds geometry to 
     * that key and value style object
     * 
     * @param {any} attributes feature's attributes which are displayed in right sidenav
     * @param {any} feature 
     * 
     */
    function convertJsonToApiReqObj(attributes, feature) {
      // console.log(">>> convertJsonToApiReqObj >>> ", attributes, feature);
      for (var eachAttr in attributes) {
        if (Array.isArray(attributes[eachAttr])) {
          // eachAttr = eachAttr.toString();
          attributes[eachAttr] = JSON.stringify(attributes[eachAttr]);
          // console.log("attributes[eachAttr] = ", attributes[eachAttr]);
        }
      }
      var keys = Object.keys(attributes);
      var values = Object.values(attributes);

      // console.log(">>> convertJsonToApiReqObj >>> ", values);
      keys.push("geom");
      values.push(feature.geometry);
      return {
        "keys": keys,
        "values": values
      };
    }

    /**
     * Search for the feature in collection using 'type_crm' in feature to match with 'type_crm' 
     * in collection. Handles Edit + Edit operation
     * 
     * @param {any} feature 
     * @param {collection} collection
     * 
     * @returns collection modified collection
     */
    function searchAndReplace(feature, collection) {
      var returnData = [];
      var tempCollection = collection.data;
      lodash.forEach(tempCollection, function (eachFeature) {
        if (parseInt(feature.type_crm) === eachFeature.type_crm || feature.type_crm === eachFeature.type_crm) {
          feature = FeatureService.tearObject(feature);
          eachFeature.key_cidoc_array = feature.keys;
          eachFeature.value_gazetteer_array = feature.values;
        }
      });
      return returnData;
    }

    /**
     * Search for the feature in collection using 'type_crm' in feature to match with 'type_crm' 
     * in collection. Handles Edit + Edit operation
     * 
     * @param {any} feature 
     * @param {collection} collection
     * 
     * @returns collection modified collection
     */
    function searchFromCollectionToFeature(feature, collection) {
      var returnData = null;
      var tempCollection = collection.data;
      lodash.forEach(tempCollection, function (eachFeature) {
        if (feature.type_crm === eachFeature.type_crm) {
          eachFeature = FeatureService.stitchObject(eachFeature.key_cidoc_array, eachFeature.value_gazetteer_array);
          returnData = eachFeature;
        }
      });
      // console.log("searchFromCollectionToFeature >>> returnData = ", returnData);
      return returnData;
    }

    /**
     * Search for the feature in collection using 'type_crm' in feature to match with 'type_crm' 
     * in collection. and replace the Feature's geometry in Collection  with feature' geometry
     * Basically used in Add/Edit + Edit (geom) operation
     * 
     * @param {any} feature 
     * @param {collection} collection
     * 
     * @returns collection modified collection
     */
    function searchAndReplaceOnlyGeom(feature, collection) {
      var tempCollection = collection.data;
      lodash.forEach(tempCollection, function (eachFeature) {
        if (parseInt(feature.properties.type_crm) === eachFeature.type_crm || feature.properties.type_crm === eachFeature.type_crm) {
          eachFeature.value_gazetteer_array[eachFeature.key_cidoc_array.indexOf("geom")] = feature.geometry;
        }
      });
    }

    /**
     * Searches for a feature in a collection given. Returns true if found else false
     * 
     * @param {any} feature 
     * @param {collection} collection
     * 
     * @returns boolean
     */
    function searchInCollection(collection, layer) {
      // console.log("searchInCollection >>> ", collection, layer);
      var tempReturn = lodash.find(collection.data, function (eachFeature) {
        return parseInt(layer.feature.properties.type_crm) === eachFeature.type_crm || layer.feature.properties.type_crm === eachFeature.type_crm;
      });
      if (typeof tempReturn !== "undefined") {
        return true;
      } else {
        return false;
      }
    }

    /**
     * Deletes a feature from a collection given. Returns new collection
     * 
     * @param {any} feature 
     * @param {collection} collection
     * 
     * @returns collection
     */
    function deleteFeatureFromCollection(layer, collection) {
      return lodash.remove(collection.data, function (eachFeature) {
        return parseInt(layer.feature.properties.type_crm) === eachFeature.type_crm || layer.feature.properties.type_crm === eachFeature.type_crm;
      });
    }

    /**
     * Disables the Save button from accidental updates
     * Enables back when feature is clicked on map
     * 
     */
    function toggleSaveButton() {
      vm.disableSave = true;
    }

    /**
     * Calls the API for getting all versions of a particular feature
     * uses vm.currentFeature, vm.currentLayer
     * 
     */
    function showAllFeatureVersions() {
      // console.log(">>> >>> showAllFeatureVersions >>> ", vm.currentFeature, vm.currentLayer);
      MapLayerService.removeAllMapLayers('rightMapViewer');
      // call getAllFeatureVersion
      var reqParamData = {
        proj_id: $sessionStorage.getObject("projId").toString(),
        layer_id: vm.currentLayer.layerId,
        type_crm: vm.currentFeature.properties.type_crm,
        fetch: 'allVersions'
      };
      var layerService = new VectorService();
      layerService.getAllFeatureVersion(reqParamData).then(function (res) {
        if (res.length > 0) {
          showFeatureOnMap(res);
        }
      }, function (err) {
        console.log(err);
      });
    }

    /**
     * Shows / renders all versions of a particular feature on right map
     * Associates click event to each feature to show attributes on click
     * 
     * @param [{any}] features
     */
    function showFeatureOnMap(features) {

      if (angular.isDefined(vm.rightMapLayerGroup)) {
        vm.rightMapLayerGroup.clearLayers();
      }
      vm.rightMapLayerGroup = new leaflet.LayerGroup();

      leafletData.getMap('rightMapViewer').then(function (map) {
        lodash.forEach(features, function (feature) {
          feature.type_crm = vm.currentFeature.properties.type_crm + "_" + Math.floor(Math.random() * (9999 - 1 + 1)) + 1;
          var fgeom = JSON.parse(feature.geom);
          delete feature.geom;

          var geojsonFeature = {
            "type": "Feature",
            "properties": feature,
            "geometry": fgeom
          };
          // console.log("geojsonFeature = ", geojsonFeature);
          // vm.rightMapLayerGroup = leaflet.geoJSON(geojsonFeature, {
          //   onEachFeature: onEachFeature
          // }).addTo(map);
          leaflet.geoJSON(geojsonFeature, {
            onEachFeature: onEachFeature
          }).addTo(vm.rightMapLayerGroup);
        });
        vm.rightMapLayerGroup.addTo(map);
      });

      // inner fucntion used for binding click event to each feature
      function onEachFeature(feature, layer) {
        layer.on({
          'click': function click(e) {
            close();
            showAttributes(feature.properties);
            vm.disableSave = true;
            vm.showAllVersions = false;
            open();
          }
        });
      }
    }

    /**
     * Open/close the right side nav
     * 
     */
    function toggleRight() {
      $mdSidenav('right').toggle();
    }

    /**
     * Called when Feature Type Dropdown is changed. Gets attributes (only key)of the feature
     * to generate the Attribute form
     * 
     * @param {string} vm.featureAttr.feature dropdown selected value
     */
    function getFormAttribute() {
      // console.log("getFormAttribute ", vm.featureAttr.feature);
      // call API for vm.featureAttr.feature
      var featureType = vm.featureAttr.feature;
      if (featureType.indexOf(" ") !== -1) {
        featureType = featureType.replace(/\s/g, '');
      }
      var reqParamData = { type: featureType };
      var vectorService = new VectorService();
      vectorService.getFormData(reqParamData).then(function (res) {
        // console.log("response ", res);
        vm.formParams = res;
      }, function (err) {
        console.log(err);
      });
    }

    /**
     * Checks whether a field is dependent on other fields. Used for Dynamic form 
     * 
     * @param {string} field
     */
    function checkDependentValue(field) {
      // vm.formParams
      // featureAttr[field.name]
      if (vm.featureAttr !== null) {
        // console.log(field.name, " - ", field.dependent); 
        if (field.name !== field.dependent) {
          if (angular.isDefined(vm.featureAttr[field.dependent])) {
            // if(vm.featureAttr[field.dependent] !== "") {
            if (vm.featureAttr[field.dependent].length !== 0) {
              // console.log(">>> >>> checkDependentValue ", field, field.dependent, vm.featureAttr[field.dependent]);
              // field.required = true;
              // close();
              // open();
              return true;
            } else {
              return false;
            }
          } else {
            return false;
          }
        } else {
          return true;
        }
      }
    }

    /**
     * Converts comma sperated values to semi-colon seperated values
     * 
     * @param {*} csvString 
     */
    function convertToSSV(csvString) {
      // console.log("csvString = ", csvString);
      var resultString = "";
      for (var i = 0; i < csvString.length; i++) {
        if (_typeof(csvString[i]) !== "object" && typeof csvString[i] !== "string") {
          if (csvString[i].indexOf("[") !== -1) {
            if (resultString == "") {
              resultString = csvString[i];
            } else {
              resultString = resultString + ";" + csvString[i];
            }
          }
        } else {
          if (resultString == "") {
            resultString = csvString[i];
          } else {
            resultString = resultString + ";" + csvString[i];
          }
        }
      }
      // return csvString.replace(/,/g, ";");
      return resultString;
    }

    /**
     * Checks the user based on his role whether he/she is allowed access on the feature 
     * 
     * @param {object} feature
     * @param {object} user currently logged in user
     */
    function checkUserAccessOnFeature(feature, user) {
      // console.log(">>> checkUserAccessOnFeature >>> ", feature, user);
      // admin
      if ($sessionStorage.getObject("role").toString() === "1") {
        return true;
      }
      // senior user
      if ($sessionStorage.getObject("role").toString() === "2") {
        return true;
      }
      // user
      if ($sessionStorage.getObject("role").toString() === "3") {
        if (feature.properties.user_id === user) {
          return true;
        } else {
          return false;
        }
      }
      // guest user
      if ($sessionStorage.getObject("role").toString() === "4") {
        return false;
      }
    }

    activate();
  }
})();
'use strict';

(function () {

  'use strict';

  MapBottomNavController.$inject = ["$controller", "MapService", "lodash", "$mdSidenav", "$rootScope", "MapLayerService", "C2Dialog", "$translate", "MapViewerService", "$state"];
  angular.module('app').controller('MapBottomNavController', MapBottomNavController);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function MapBottomNavController($controller, MapService, lodash, $mdSidenav, $rootScope, MapLayerService, C2Dialog, $translate, MapViewerService, $state) {

    var vm = this;
    vm.afterSearch = afterSearch;
    vm.toggleBottom = toggleBottom;
    vm.applyFilters = applyFilters;
    vm.toggleIncludeToWorkingList = toggleIncludeToWorkingList;
    vm.isLoaded = isLoaded;
    vm.onActivate = onActivate;
    vm.showLoadMapInLeftButton = showLoadMapInLeftButton;
    vm.showLoadMapInRightButton = showLoadMapInRightButton;
    vm.loadGcpOnMap = loadGcpOnMap;
    vm.isNonGeorefLoaded = isNonGeorefLoaded;
    vm.showFilterCheckbox = false;
    vm.showOnlyChildMap = false;
    vm.showOnlyChildMapFunc = showOnlyChildMapFunc;
    vm.isChildMap = isChildMap;

    /**
     * Execute the action when this controller is activated
     * 
     */
    function onActivate() {
      vm.showBottomNav = false;
      vm.showLoadMapInRight = MapViewerService.getOption('rightMapViewer', 'showLoadMapInRight', true);
      vm.showLoadMapInLeft = MapViewerService.getOption('leftMapViewer', 'showLoadMapInLeft', true);
    }

    // instantiate base controller
    $controller('CRUDController', {
      vm: vm,
      modelService: MapService,
      options: {
        searchOnInit: false,
        perPage: 11
      }
    });

    /**
     * Listen to the view switch event and reload the data
     * from the back-end if the target view is the the form
     */
    $rootScope.$on('switchedView', function (event, data) {
      if (data === 'form') {
        vm.search(vm.paginator.currentPage);
      }
    });

    $rootScope.$on('viewerShown', function (event, viewerId) {
      if (viewerId === 'rightMapViewer') {
        vm.showLoadMapInRight = true;
      } else {
        vm.showLoadMapInLeft = true;
      }
    });

    $rootScope.$on('viewerHidden', function (event, viewerId) {
      if (viewerId === 'rightMapViewer') {
        vm.showLoadMapInRight = false;
      } else {
        vm.showLoadMapInLeft = false;
      }
    });

    // $scope.$on('showOnlyChildMap', function(newVal, oldVal) {
    //   console.log(">>> showOnlyChildMap >>> ", newVal, oldVal)
    //   // vm.search(vm.paginator.currentPage);
    // })
    /**
     * Here we listen to the applyFilters callback to add custom filters
     * 
     * @param {any} defaultQueryFilters 
     * @returns {}
     */
    function applyFilters(defaultQueryFilters) {
      if (angular.isUndefined(vm.queryFilters)) {
        vm.queryFilters = {};
      }
      return angular.extend(defaultQueryFilters, vm.queryFilters);
    }

    /**
     * Make some adjustments in the resources list after loading them
     * 
     * @param {any} response 
     */
    function afterSearch(response) {
      lodash.map(vm.resources, function (map) {
        map.mapImageFile = map.map_image_file;
        map.mapTypeName = map.map_type_name;
        return map;
      });
    }

    /**
    * Open/close the right side nav
    * 
    */
    function toggleBottom() {
      vm.showBottomNav = !vm.showBottomNav;
      if (vm.showBottomNav === true) {
        vm.paginator.currentPage = vm.paginator.currentPage > 0 ? vm.paginator.currentPage : 1;
        vm.search(vm.paginator.currentPage);
      }
    }

    /**
     * Add/remove a map to the working list
     * 
     * @param object resource 
     */
    function toggleIncludeToWorkingList(resource, viewerId) {
      var toggleLoadMap = function toggleLoadMap() {
        if (isLoaded(resource, viewerId)) {
          MapLayerService.removeMapLayer(resource, viewerId);
        } else {
          MapLayerService.addMapLayer(resource, viewerId);
        }
      };
      // Confirm before loading non georeferenced map    
      if (!isLoaded(resource, viewerId) && resource.georeferenced === false) {
        var config = {
          title: $translate.instant('dialog.confirmLoadUngeoreferencedTitle'),
          description: $translate.instant('dialog.LoadUngeoreferencedDescription'),
          yes: $translate.instant('global.yes'),
          no: $translate.instant('global.no')
        };
        C2Dialog.confirm(config).then(function () {
          toggleLoadMap();
          // look for Georef maps which are associated to currenctly nongeoref image
          checkAllGeoRefMaps(resource);
        });
      }
      // Confirm before loading georeferenced map when a non georeferenced map is already loaded   
      else if (MapLayerService.hasNonGeoreferencedLayer(viewerId)) {
          var config = {
            title: $translate.instant('dialog.confirmLoadGeoreferencedTitle'),
            description: $translate.instant('dialog.LoadGeoreferencedDescription'),
            yes: $translate.instant('global.yes'),
            no: $translate.instant('global.no')
          };
          C2Dialog.confirm(config).then(function () {
            MapLayerService.removeAllMapLayers(viewerId);
            toggleLoadMap();
          });
        } else {
          // in the other cases, run directly the toggleLoadMap to remove?/add a map
          toggleLoadMap();
        }
    }

    /**
     * check if a map resource is already loaded
     * 
     * @param object resource 
     */
    function isLoaded(resource, viewerId) {
      var isLoaded = MapLayerService.isAdded(resource, viewerId);
      return isLoaded;
    }

    /**
     * check if current page is Georeference and if the map resource is nongeoreferenced 
     * than only allow the user to load it in left map and georeferenced resource in right map
     * 
     * @param object resource 
     * @returns boolean
     */
    function showLoadMapInLeftButton(resource) {
      if ($state.current.name === "app.georeference") {
        if (resource.georeferenced === false) {
          return true;
        } else {
          return false;
        }
      } else {
        return true;
      }
    }

    /**
     * check if current page is Georeference and if the map resource is nongeoreferenced 
     * than only allow the user to load it in left map and georeferenced resource in right map
     * 
     * @param object resource 
     * @returns boolean
     */
    function showLoadMapInRightButton(resource) {
      if ($state.current.name === "app.georeference") {
        if (resource.georeferenced === true) {
          return true;
        } else {
          return false;
        }
      } else {
        return true;
      }
    }

    /**
     * Called when "Load GCP on Map button is clicked"
     * Triggers a event to Georeference controller to handle
     * 
     * @param object resource
     */
    function loadGcpOnMap(resource) {
      // console.log(">>> map.bottom.nav.controller >>> loadGcpOnMap");
      if (resource.georeferenced) {
        if (resource.gcps) {
          // broadcast to Georeference controller to create markers
          $rootScope.$broadcast("createGcpOnMap", JSON.parse(resource.gcps));
        }
      }
    }

    /**
     * checks if NonGeoreferenced image is loaded in left map
     * 
     * @param object resource 
     * @returns boolean 
     */
    function isNonGeorefLoaded(resource, mapViewer) {
      if (resource.canLoadGcp) {
        return true;
      }
    }

    /**
     * Once a NonGeoreferenced image is loaded, check for all Georeferenced maps to know 
     * which are associated to it. Once we have the list of georef maps, activate their Load GCP button
     * 
     * @param object resource
     */
    function checkAllGeoRefMaps(resource) {
      var fileName = resource.map_image_file.name;
      if (fileName.split('.') !== -1) {
        // let the checkbox be visible for the user to filter
        vm.showFilterCheckbox = true;
        fileName = fileName.split('.').slice(0, -1).join('.');
        // loop through all the resources
        lodash.forEach(vm.resources, function (eachResource) {
          if (eachResource.georeferenced) {
            var tempImageName = eachResource.map_image_file.name;
            tempImageName = tempImageName.split('_rect').slice(0, -1).join('_rect');
            if (tempImageName === fileName) {
              // console.log("eachResources = ", eachResource);
              eachResource.canLoadGcp = true;
              eachResource.isChildOfLoadedNongeoref = true;
            } else {
              eachResource.canLoadGcp = false;
              eachResource.isChildOfLoadedNongeoref = false;
            }
          } else {
            eachResource.isChildOfLoadedNongeoref = false;
          }
        });
      } else {
        console.log("file doesnt have extension");
      }
    }

    function isChildMap(resource) {
      if (angular.isDefined(vm.showOnlyChildMap)) {
        if (vm.showOnlyChildMap) {
          if (resource.isChildOfLoadedNongeoref) {
            return true;
          } else {
            return false;
          }
        } else {
          return true;
        }
      } else {
        return true;
      }
    }

    function showOnlyChildMapFunc() {
      if (vm.showOnlyChildMap) {
        // get currently loaded resource
        var resource = MapLayerService.getViewerOverlays('leftMapViewer');
        // console.log("resource = ", resource);
        // console.log(Object.values(resource)[0].resource.map_source_id);
        var tempMapId = Object.values(resource)[0].resource.map_source_id;
        // create a filter
        vm.queryFilters = { "parent_id": tempMapId };
        // call applyFilter, which will take care of rest
        vm.search(vm.paginator.currentPage);
        afterSearch("response");
      } else {
        vm.queryFilters = null;
        vm.search(vm.paginator.currentPage);
        afterSearch("response");
      }
    }
  }
})();
'use strict';

(function () {

  'use strict';

  MapRightSidenavController.$inject = ["$scope", "$timeout", "$mdSidenav", "$log", "$rootScope", "MapLayerService", "lodash", "$window"];
  angular.module('app').controller('MapRightSidenavController', MapRightSidenavController);

  /** @ngInject */
  // eslint-disable-next-line max-params
  function MapRightSidenavController($scope, $timeout, $mdSidenav, $log, $rootScope, MapLayerService, lodash, $window) {

    var vm = this;
    vm.close = close;
    vm.showMap = showMap;
    vm.hideMap = hideMap;
    vm.removeMap = removeMap;
    vm.applyOpacity = applyOpacity;
    vm.fitMapBounds = fitMapBounds;
    vm.filterMapLayers = filterMapLayers;

    /**
     * Run the initial actions when the controller is activated
     */
    function activate() {
      refreshOverlays();
      vm.sortableConf = { onUpdate: updateAfterSort, handle: '.grab-handle' };
    }

    /**
     * Close the sidenav
     */
    function close() {
      $mdSidenav('right').close().then(function () {
        // you can add some task after closing
      });
    };

    /**
     * Show a map already loaded in the viewer
     * @param {} layer 
     */
    function showMap(layer) {
      MapLayerService.showMap(layer.resource, layer.viewerId);
    }

    /**
     * Hide a map already loaded in the viewer
     * @param {} layer 
     */
    function hideMap(layer) {
      MapLayerService.hideMap(layer.resource, layer.viewerId);
    }

    /**
     * Remove (unload) a map from the viewer
     * @param {} layer 
     */
    function removeMap(layer) {
      MapLayerService.removeMapLayer(layer.resource, layer.viewerId);
    }

    /**
     * Fit the bounds of an already loaded map so the that all the map is visible
     * @param {} layer 
     */
    function fitMapBounds(layer) {
      MapLayerService.fitMapBounds(layer.resource, layer.viewerId);
    }

    /**
     * Apply the opacity defined in the layer.layerParams.opacity property
     * @param {} layer 
     */
    function applyOpacity(layer) {
      MapLayerService.applyOpacity(layer);
    }

    /**
     * Filter the map layers loaded in the viewer by name
     */
    function filterMapLayers() {
      refreshOverlays();
      vm.loadedMapsLayers = lodash.filter(vm.loadedMapsLayers, function (layer) {
        return layer.resource.title.toLowerCase().indexOf(vm.filterMapLayersTxt.toLowerCase()) != -1;
      });
    }

    /**
     * Refresh the maps layers in the sidebar list when the mapLayersChanged event is broadcasted
     */
    $rootScope.$on('mapLayersChanged', function (event) {
      refreshOverlays();
    });

    /**
     * Refresh the overlays in the property loadedMapsLayers getting it from MapLayerService
     * 
     */
    function refreshOverlays() {
      // initially define the overlays as an empty array
      vm.loadedMapsLayers = [];

      // As we want to list all the layers, then get the layers from both viewers
      var rightLayers = MapLayerService.getViewerOverlays('rightMapViewer');
      if (angular.isDefined(rightLayers)) {
        angular.forEach(rightLayers, function (value, key) {
          value.id = key;
          vm.loadedMapsLayers.push(value);
        });
      }

      var leftLayers = MapLayerService.getViewerOverlays('leftMapViewer');
      if (angular.isDefined(leftLayers)) {
        angular.forEach(leftLayers, function (value, key) {
          value.id = key;
          vm.loadedMapsLayers.push(value);
        });
      }
      // The layers must be show in reverse order (last added on the top)
      vm.loadedMapsLayers = vm.loadedMapsLayers.slice().reverse();
    }

    /**
     * Handle the reorder/sort event and apply it to the MapLayerService
     * 
     * @param {any} evt 
     */
    function updateAfterSort(evt) {
      MapLayerService.applyReorder(evt.models);
    }

    activate();
  }
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcGxpY2F0aW9uLmpzIiwiYXBwLmpzIiwiYXBwLmNvbmZpZy5qcyIsImFwcC5jb250cm9sbGVyLmpzIiwiYXBwLmV4dGVybmFsLmpzIiwiYXBwLmdsb2JhbC5qcyIsImFwcC5yb3V0ZXMuanMiLCJhcHAucnVuLmpzIiwiY29yZS9iYXNlLnNlcnZpY2UuanMiLCJjb3JlL2NydWQuY29udHJvbGxlci5qcyIsImdlb3JlZmVyZW5jZS9nZW9yZWZlcmVuY2UuY29udHJvbGxlci5qcyIsImdlb3JlZmVyZW5jZS9nZW9yZWZlcmVuY2Uucm91dGUuanMiLCJnZW9yZWZlcmVuY2UvZ2VvcmVmZXJlbmNlLnNlcnZpY2UuanMiLCJleHBvcnQvZXhwb3J0LmNvbnRyb2xsZXIuanMiLCJleHBvcnQvZXhwb3J0LnJvdXRlLmpzIiwiZXhwb3J0L2V4cG9ydC5zZXJ2aWNlLmpzIiwiaTE4bi9pc09yTm90R2VvcmVmZXJlbmNlZC5maWx0ZXIuanMiLCJpMThuL2xhbmd1YWdlLWxvYWRlci5zZXJ2aWNlLmpzIiwiaTE4bi90LWF0dHIuZmlsdGVyLmpzIiwiaTE4bi90LWJyZWFkY3J1bWIuZmlsdGVyLmpzIiwiaTE4bi90LW1vZGVsLmZpbHRlci5qcyIsImkxOG4veWVzT3JOby5maWx0ZXIuanMiLCJpbnRlcmNlcHRvcnMvc3Bpbm5lci5pbnRlcmNlcHRvci5qcyIsIm1hcC9mZWF0dXJlLnNlcnZpY2UuanMiLCJtYXAvbWFwLmNvbnRyb2xsZXIuanMiLCJtYXAvbWFwLnJvdXRlLmpzIiwibWFwL21hcC5zZXJ2aWNlLmpzIiwibWFwLXN1cHBvcnQtc2VydmljZXMvZmlsZS5zZXJ2aWNlLmpzIiwibWFwLXN1cHBvcnQtc2VydmljZXMvbWFwLWxheWVyLnNlcnZpY2UuanMiLCJtYXAtc3VwcG9ydC1zZXJ2aWNlcy9tYXAtbWFya2VyLnNlcnZpY2UuanMiLCJtYXAtc3VwcG9ydC1zZXJ2aWNlcy9tYXAtcHJvamVjdC5zZXJ2aWNlLmpzIiwibWFwLXN1cHBvcnQtc2VydmljZXMvbWFwLXByb2plY3Rpb24uc2VydmljZS5qcyIsIm1hcC1zdXBwb3J0LXNlcnZpY2VzL21hcC10eXBlLnNlcnZpY2UuanMiLCJtYXAtc3VwcG9ydC1zZXJ2aWNlcy9tYXAtdmlld2VyLnNlcnZpY2UuanMiLCJpbXBvcnQvaW1wb3J0LmNvbnRyb2xsZXIuanMiLCJpbXBvcnQvaW1wb3J0LnJvdXRlLmpzIiwiaW1wb3J0L2ltcG9ydC5zZXJ2aWNlLmpzIiwic2hhcmVkL3N1cHBvcnQuc2VydmljZS5qcyIsInByZWZlcmVuY2VzL3ByZWZlcmVuY2VzLmNvbnRyb2xsZXIuanMiLCJwcmVmZXJlbmNlcy9wcmVmZXJlbmNlcy5yb3V0ZS5qcyIsInByZWZlcmVuY2VzL3ByZWZlcmVuY2VzLnNlcnZpY2UuanMiLCJwcm9qZWN0L3Byb2plY3QuY29udHJvbGxlci5qcyIsInByb2plY3QvcHJvamVjdC5yb3V0ZS5qcyIsInByb2plY3QvcHJvamVjdC5zZXJ2aWNlLmpzIiwidmVjdG9yL2ZlYXR1cmUuc2VydmljZS5qcyIsInZlY3Rvci92ZWN0b3IuY29udHJvbGxlci5qcyIsInZlY3Rvci92ZWN0b3Iucm91dGUuanMiLCJ2ZWN0b3IvdmVjdG9yLnNlcnZpY2UuanMiLCJnZW9yZWZlcmVuY2UvbmF2cy9nY3BUYWJsZS5jb250cm9sbGVyLmpzIiwiZ2VvcmVmZXJlbmNlL25hdnMvZ2VvLmxlZnQuc2lkZW5hdi5jb250cm9sbGVyLmpzIiwiaTE4bi9lbi1HQi9hdHRyaWJ1dGVzLmpzIiwiaTE4bi9lbi1HQi9kaWFsb2cuanMiLCJpMThuL2VuLUdCL2dsb2JhbC5qcyIsImkxOG4vZW4tR0IvbWVzc2FnZXMuanMiLCJpMThuL2VuLUdCL21vZGVscy5qcyIsImkxOG4vZW4tR0Ivdmlld3MuanMiLCJpMThuL2RlLURFL2F0dHJpYnV0ZXMuanMiLCJpMThuL2RlLURFL2RpYWxvZy5qcyIsImkxOG4vZGUtREUvZ2xvYmFsLmpzIiwiaTE4bi9kZS1ERS9tZXNzYWdlcy5qcyIsImkxOG4vZGUtREUvbW9kZWxzLmpzIiwiaTE4bi9kZS1ERS92aWV3cy5qcyIsIm1hcC9kaWFsb2cvbWFwLWRpYWxvZy5jb250cm9sbGVyLmpzIiwibWFwL25hdnMvbWFwLmxlZnQuc2lkZW5hdi5jb250cm9sbGVyLmpzIiwic2hhcmVkL2ZhY3RvcnkvbG9jYWxzdG9yYWdlLmpzIiwic2hhcmVkL2ZhY3Rvcnkvc2Vzc2lvbnN0b3JhZ2UuanMiLCJzaGFyZWQvY29tcG9uZW50cy9ib3guY29tcG9uZW50LmpzIiwic2hhcmVkL2NvbXBvbmVudHMvY29udGVudC1ib2R5LmNvbXBvbmVudC5qcyIsInNoYXJlZC9jb21wb25lbnRzL2NvbnRlbnQtaGVhZGVyLmNvbXBvbmVudC5qcyIsInNoYXJlZC9tYXAtdmlld2VyL21hcC12aWV3ZXIuY29udHJvbGxlci5qcyIsInNoYXJlZC9wYXJ0aWFscy9tZW51LmNvbnRyb2xsZXIuanMiLCJ2ZWN0b3IvZGlhbG9nL3ZlY3RvckxheWVyLmNvbnRyb2xsZXIuanMiLCJ2ZWN0b3IvbmF2cy92ZWN0b3IubGVmdC5zaWRlbmF2LmNvbnRyb2xsZXIuanMiLCJ2ZWN0b3IvbmF2cy92ZWN0b3IucmlnaHQuc2lkZW5hdi5jb250cm9sbGVyLmpzIiwic2hhcmVkL21hcC12aWV3ZXIvbmF2cy9tYXAuYm90dHRvbS5uYXYuY29udHJvbGxlci5qcyIsInNoYXJlZC9tYXAtdmlld2VyL25hdnMvbWFwLnJpZ2h0LnNpZGVuYXYuY29udHJvbGxlci5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiR2xvYmFsIiwiJG1kVGhlbWluZ1Byb3ZpZGVyIiwiJG1vZGVsRmFjdG9yeVByb3ZpZGVyIiwiJHRyYW5zbGF0ZVByb3ZpZGVyIiwibW9tZW50IiwiJG1kQXJpYVByb3ZpZGVyIiwiJHdpbmRvd1Byb3ZpZGVyIiwidXNlTG9hZGVyIiwidXNlU2FuaXRpemVWYWx1ZVN0cmF0ZWd5IiwibG9jYWxlIiwiJHdpbmRvdyIsIiRnZXQiLCJkZWZhdWx0T3B0aW9ucyIsInByZWZpeCIsImFwaVBhdGgiLCJ0aGVtZSIsInByaW1hcnlQYWxldHRlIiwiZGVmYXVsdCIsImFjY2VudFBhbGV0dGUiLCJ3YXJuUGFsZXR0ZSIsImVuYWJsZUJyb3dzZXJDb2xvciIsImRpc2FibGVXYXJuaW5ncyIsImNvbnRyb2xsZXIiLCJBcHBDb250cm9sbGVyIiwiJHN0YXRlIiwiJGxvY2FsU3RvcmFnZSIsInZtIiwiY3VycmVudFllYXIiLCJhY3RpdmF0ZSIsImRhdGUiLCJEYXRlIiwiZ2V0RnVsbFllYXIiLCJzZXNzaW9uU3RvcmFnZSIsImNsZWFyIiwic2V0SXRlbSIsImdldEl0ZW0iLCJjb25zdGFudCIsIl8iLCJMIiwiYXBwTmFtZSIsImltYWdlUGF0aCIsImNsaWVudFBhdGgiLCJob21lU3RhdGUiLCJob21lVXJsIiwicm91dGVzIiwiJHN0YXRlUHJvdmlkZXIiLCIkdXJsUm91dGVyUHJvdmlkZXIiLCJzdGF0ZSIsInRlbXBsYXRlVXJsIiwiYWJzdHJhY3QiLCJyZXNvbHZlIiwidHJhbnNsYXRlUmVhZHkiLCIkdHJhbnNsYXRlIiwiJHEiLCJkZWZlcnJlZCIsImRlZmVyIiwidXNlIiwidGhlbiIsInByb21pc2UiLCJ3aGVuIiwib3RoZXJ3aXNlIiwicnVuIiwiJHJvb3RTY29wZSIsIiRzdGF0ZVBhcmFtcyIsImdsb2JhbCIsImZhY3RvcnkiLCJzZXJ2aWNlRmFjdG9yeSIsIiRtb2RlbEZhY3RvcnkiLCJ1cmwiLCJvcHRpb25zIiwibW9kZWwiLCJhY3Rpb25zIiwicGFnaW5hdGUiLCJtZXRob2QiLCJpc0FycmF5Iiwid3JhcCIsImFmdGVyUmVxdWVzdCIsInJlc3BvbnNlIiwiTGlzdCIsIm1lcmdlIiwiQ1JVRENvbnRyb2xsZXIiLCJtb2RlbFNlcnZpY2UiLCJDMlRvYXN0IiwiQzJQYWdpbmF0aW9uIiwiQzJEaWFsb2ciLCJzZWFyY2giLCJwYWdpbmF0ZVNlYXJjaCIsIm5vcm1hbFNlYXJjaCIsImVkaXQiLCJzYXZlIiwicmVtb3ZlIiwiZ29UbyIsImNsZWFuRm9ybSIsInJlZGlyZWN0QWZ0ZXJTYXZlIiwic2VhcmNoT25Jbml0IiwicGVyUGFnZSIsInNraXBQYWdpbmF0aW9uIiwidmlld0Zvcm0iLCJyZXNvdXJjZSIsImlzRnVuY3Rpb24iLCJvbkFjdGl2YXRlIiwibGFiZWxPcHRpb25zIiwibGFiZWxzIiwidG90YWwiLCJpbnN0YW50IiwiaXRlbXMiLCJwYWdpbmF0b3IiLCJnZXRJbnN0YW5jZSIsInBhZ2UiLCJjdXJyZW50UGFnZSIsImlzRGVmaW5lZCIsImRlZmF1bHRRdWVyeUZpbHRlcnMiLCJhcHBseUZpbHRlcnMiLCJiZWZvcmVTZWFyY2giLCJjYWxjTnVtYmVyT2ZQYWdlcyIsInJlc291cmNlcyIsImFmdGVyU2VhcmNoIiwicXVlcnkiLCJmb3JtIiwiYmVmb3JlQ2xlYW4iLCIkc2V0UHJpc3RpbmUiLCIkc2V0VW50b3VjaGVkIiwiYWZ0ZXJDbGVhbiIsImNvcHkiLCJhZnRlckVkaXQiLCJiZWZvcmVTYXZlIiwiJHNhdmUiLCJhZnRlclNhdmUiLCJzdWNjZXNzIiwicmVzcG9uc2VEYXRhIiwib25TYXZlRXJyb3IiLCJyZXRyaWV2ZWdlb2pzb24iLCJwYXJhbXMiLCJjb25zb2xlIiwibG9nIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsInllcyIsIm5vIiwiY29uZmlybSIsImJlZm9yZVJlbW92ZSIsIiRkZXN0cm95IiwiYWZ0ZXJSZW1vdmUiLCJpbmZvIiwidmlld05hbWUiLCJHZW9yZWZlcmVuY2VDb250cm9sbGVyIiwiJGNvbnRyb2xsZXIiLCIkc2NvcGUiLCJNYXBNYXJrZXJTZXJ2aWNlIiwibGVhZmxldE1hcmtlckV2ZW50cyIsIk1hcFZpZXdlclNlcnZpY2UiLCIkbWRDb2xvcnMiLCIkbWRTaWRlbmF2IiwiJHRpbWVvdXQiLCJsb2Rhc2giLCJvblZpZXdlckFjdGl2YXRlIiwidG9nZ2xlQ3JlYXRlTWFya2VyIiwiYmVmb3JlVmlld2VyQWN0aXZhdGUiLCJ0b2dnbGVSZW1vdmVNYXJrZXIiLCJvcGVuU2F2ZUdlb1JlZiIsInZhbGlkR0NQIiwibnVtT2ZHQ1AiLCJyZWRyYXdNYXJrZXJzIiwic3VwcG9ydExpc3RpbmdWaWV3Iiwic3VwcG9ydERyYXdpbmciLCJ0aXRsZVRyYW5zbEtleSIsInNob3dHZW9SZWZUb29scyIsImxlZnRTaWRlQmFyIiwic2hvd0djcFRhYmxlIiwiZ2NwVGFibGUiLCJyaWdodE1hcmtlcnMiLCJsZWZ0TWFya2VycyIsIiRvbiIsImV2ZW50IiwiYXJncyIsInJpZ2h0Q3JlYXRlTWFya2VyRW5hYmxlIiwicmlnaHRSZW1vdmVNYXJrZXJFbmFibGUiLCJpZCIsInJlbW92ZU1hcmtlciIsIiRicm9hZGNhc3QiLCJldmVudEZyb20iLCJsZWZ0UmVtb3ZlTWFya2VyRW5hYmxlIiwiYWRkTWFya2VyIiwibGVhZmxldEV2ZW50Iiwic2l6ZSIsImxlZnRDcmVhdGVNYXJrZXJFbmFibGUiLCJtYXJrZXJzS2VlcGVyIiwiZm9yRWFjaCIsInBvc2l0aW9uIiwicHJlcGFyZWRNYXJrZXJEYXRhIiwicHJlcGFyZURhdGFGb3JBZGRNYXJrZXIiLCJpbWFnZVBvc2l0aW9uIiwic2V0VGltZW91dCIsIm1hcFBvc2l0aW9uIiwibGVhZkV2ZW50IiwibWFya2VyRGF0YSIsImxhdCIsImxhdGxuZyIsImxuZyIsImZvY3VzIiwibmV3TWFya2VyIiwiYnVpbGRNYXJrZXIiLCJtYXJrZXJJZCIsInRlbXBNYXJrZXJJZCIsImljb24iLCJjbGFzc05hbWUiLCJzcGxpdCIsImRlbGV0ZWRNYXJrZXJJZCIsImZvck93biIsIm1hcmtlciIsImtleSIsInRlbXBJZE51bSIsIm5ld01hcmtlck5vIiwiaHRtbCIsIm9sZEtleSIsIm5ld0tleSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwicmlnaHRWaWV3ZXJFdmVudHMiLCJtYXJrZXJzIiwiZW5hYmxlIiwiZ2V0QXZhaWxhYmxlRXZlbnRzIiwibWFwIiwibGVmdFZpZXdlckV2ZW50cyIsInNldE9wdGlvbiIsInZpZXdlcklkIiwidG9nZ2xlIiwiJGVtaXQiLCJ0b29sYmFyQmdDb2xvciIsImdldFRoZW1lQ29sb3IiLCJva0JnQ29sb3IiLCJvayIsImFsZXJ0Iiwia2V5cyIsImxlbmd0aCIsImxlZnRDb3VudCIsInJpZ2h0Q291bnQiLCJpbWFnZVBvc2l0aW9uSW5MYXRMbmciLCJQcm9qZWN0aW9uIiwiU3BoZXJpY2FsTWVyY2F0b3IiLCJ1bnByb2plY3QiLCJwb2ludCIsInBhcnNlRmxvYXQiLCJwaXhlbFgiLCJwaXhlbFkiLCJsb24iLCJkYXRhIiwiR2VvcmVmZXJlbmNlU2VydmljZSIsIiRodHRwIiwiYXBwbHlFbmRQb2ludCIsInByZXZpZXdHY3BFbmRQb2ludCIsImluc3RhbmNlIiwic2F2ZUdlb1JlZiIsInByZXZpZXdHQ1AiLCJwYXJhbURhdGEiLCJmb3JtRGF0YSIsIkZvcm1EYXRhIiwicG9zdCIsInJlc3VsdCIsImVyciIsInJlamVjdCIsInRyYW5zZm9ybVJlcXVlc3QiLCJpZGVudGl0eSIsImhlYWRlcnMiLCJ1bmRlZmluZWQiLCJFeHBvcnRDb250cm9sbGVyIiwiRXhwb3J0U2VydmljZSIsImZpbHRlciIsImlzT3JOb3RHZW9yZWZlcmVuY2VkIiwiJGZpbHRlciIsImlucHV0IiwiaXNUcnVlIiwidHJhbnNsYXRlZCIsIkxhbmd1YWdlTG9hZGVyIiwiJGxvZyIsIiRpbmplY3RvciIsInNlcnZpY2UiLCJ0cmFuc2xhdGUiLCJnZXQiLCJ2aWV3cyIsImF0dHJpYnV0ZXMiLCJkaWFsb2ciLCJtZXNzYWdlcyIsIm1vZGVscyIsInRyYW5zbGF0aW9uIiwidEF0dHIiLCJuYW1lIiwidEJyZWFkY3J1bWIiLCJ0TW9kZWwiLCJ0b0xvd2VyQ2FzZSIsInllc09yTm8iLCJzcGlubmVySW50ZXJjZXB0b3IiLCIkaHR0cFByb3ZpZGVyIiwiJHByb3ZpZGUiLCJzaG93SGlkZVNwaW5uZXIiLCJwZW5kaW5nUmVxdWVzdHMiLCJyZXF1ZXN0Iiwic2hvdyIsImhpZGUiLCJyZXNwb25zZUVycm9yIiwicmVqZWN0aW9uIiwiaW50ZXJjZXB0b3JzIiwicHVzaCIsIkZlYXR1cmVTZXJ2aWNlIiwiTWFwQ29udHJvbGxlciIsIm9wZW5BZGRNYXAiLCJvcGVuRWRpdE1hcCIsImRyYXdzR2VvSnNvbiIsImRyYXdzIiwib3BlbkF0dHJpYnV0ZURhaWxvZyIsIm9wZW5EaWFsb2ciLCJsb2NhbHMiLCJtYXBEaWFsb2dJbnB1dCIsInJlbW92ZUZuIiwiY29udHJvbGxlckFzIiwiaGFzQmFja2Ryb3AiLCJjdXN0b20iLCJNYXBTZXJ2aWNlIiwiRmlsZVNlcnZpY2UiLCJlbmRQb2ludCIsInVwbG9hZCIsImFwcGVuZCIsImZpbGUiLCJtYXBfaW1hZ2VfZmlsZV9pZCIsIm1hcF9nZW9fZmlsZV9wcm9qZWN0aW9uIiwiTWFwTGF5ZXJTZXJ2aWNlIiwibGVhZmxldERhdGEiLCJsZWFmbGV0IiwiU3VwcG9ydFNlcnZpY2UiLCJidWlsZERlZmF1bHRMYXllcnMiLCJhZGRNYXBMYXllciIsInJlbW92ZU1hcExheWVyIiwiaGlkZU1hcCIsInNob3dNYXAiLCJzZXJ2ZXJDb25maWciLCJpc0FkZGVkIiwiZml0TWFwQm91bmRzIiwiYXBwbHlPcGFjaXR5IiwiaGFzTm9uR2VvcmVmZXJlbmNlZExheWVyIiwicmVtb3ZlQWxsTWFwTGF5ZXJzIiwiZ2V0Vmlld2VyT3ZlcmxheXMiLCJnZXRWaWV3ZXJEYXRhIiwiZ2V0RGVmYXVsdENlbnRlciIsInJlZnJlc2hNYXBSZXNvdXJjZSIsImhpZGVWaWV3ZXIiLCJzaG93Vmlld2VyIiwiYXBwbHlSZW9yZGVyIiwic2V0V2hlZWxab29tU3RhdHVzIiwiZ2V0Vmlld2VyRHJhd3MiLCJnZXRPdmVybGF5c0NvdW50Qm9vbCIsImFkZFdGU0xheWVyIiwic2VydmljZURhdGEiLCJ2aWV3ZXJEYXRhIiwib3ZlcmxheXMiLCJkcmF3IiwiZW5hYmxlZCIsImdldE1hcCIsInNjcm9sbFdoZWVsWm9vbSIsImRpc2FibGUiLCJ2YWx1ZXMiLCJwYXJzZU1hcFZpZXdlcklkIiwiaXNVbmRlZmluZWQiLCJsZWZ0TWFwVmlld2VyIiwiYmFzZWxheWVycyIsImdldEJhc2VMYXllcnMiLCJ0eXBlIiwidmlzaWJsZSIsImxheWVyUGFyYW1zIiwic2hvd09uU2VsZWN0b3IiLCJyaWdodE1hcFZpZXdlciIsImxpc3RlbkFuZEFwcGx5RHJhdyIsImtlZXBEcmF3IiwiZ2V0TGF5ZXJzIiwiZHJhd25JdGVtcyIsIm9uIiwiZSIsImxheWVyIiwiYWRkTGF5ZXIiLCJ0b0dlb0pTT04iLCJiaW5kIiwiem9vbSIsInh5eiIsIm9wYWNpdHkiLCJsYXllck9wdGlvbnMiLCJ6SW5kZXgiLCJiaW5nQWVyaWFsIiwiYmluZ1JvYWQiLCJiaW5nQWVyaWFsV2l0aExhYmVscyIsImJ1aWxkTWFwT3ZlcmxheSIsImJhc2Vfb3dzX3VybCIsImxheWVycyIsImdlb3NlcnZlcl9sYXllcl9pZCIsImZvcm1hdCIsInRyYW5zcGFyZW50IiwidGlsZWQiLCJib3VuZHMiLCJtYXBfdG9wX2xlZnRfbG9uZyIsIm1hcF90b3BfbGVmdF9sYXQiLCJtYXBfcmlnaHRfYm90dG9tX2xvbmciLCJtYXBfcmlnaHRfYm90dG9tX2xhdCIsImZpdEJvdW5kcyIsIm92ZXJsYXlJZCIsInBhcnNlTWFwT3ZlcmxheUlkIiwic2V0T3BhY2l0eSIsInByZXBhcmVWaWV3ZXIiLCJuZXdMYXllciIsImdlb3JlZmVyZW5jZWQiLCJwcmVwYXJlRm9yVW5nZW9yZWZlcmVuY2VkIiwicHJlcGFyZUZvckdlb3JlZmVyZW5jZWQiLCJub25HZW9MYXllcnMiLCJyZWZyZXNoTGF5ZXJSZXNvdXJjZSIsImxheWVyc0luT3JkZXIiLCJjb3VudGVyIiwic2xpY2UiLCJyZXZlcnNlIiwidmFsdWUiLCJzZXRaSW5kZXgiLCJsYXllck5hbWUiLCJ0ZW1wTGF5ZXIiLCJXRlMiLCJ0eXBlTlMiLCJ0eXBlTmFtZSIsImNycyIsIkNSUyIsIkVQU0c0MzI2IiwiZ2VvbWV0cnlGaWVsZCIsInN0eWxlIiwiY29sb3IiLCJ3ZWlnaHQiLCJhZGRUbyIsImdldEJvdW5kcyIsIm1hcmtlcnNIb2xkZXIiLCJtYXJrZXJPcHRpb25zIiwiZHJhZ2dhYmxlIiwibUtleSIsImdldE5leHRNYXJrZXJLZXkiLCJtSWQiLCJjbGFzc2VzIiwibUljb24iLCJpY29uU2l6ZSIsIm1lc3NhZ2UiLCJtYXgiLCJrZXlJbmRleCIsInBhcnNlSW50IiwicmVwbGFjZSIsInRvU3RyaW5nIiwiTWFwUHJvamVjdFNlcnZpY2UiLCJNYXBQcm9qZWN0aW9uU2VydmljZSIsIk1hcFR5cGVTZXJ2aWNlIiwiZ2V0T3B0aW9uIiwib3B0aW9uIiwicGFyc2VWaWV3ZXIiLCJjaGFuZ2VkIiwiZGVmYXVsdFZhbHVlIiwiSW1wb3J0Q29udHJvbGxlciIsIkltcG9ydFNlcnZpY2UiLCJQcmVmZXJlbmNlc0NvbnRyb2xsZXIiLCJQcmVmZXJlbmNlc1NlcnZpY2UiLCJQcm9qZWN0Q29udHJvbGxlciIsIiRsb2NhdGlvbiIsInFQYXJhbXMiLCJyb2xlIiwicHJvaklkIiwidXNlcklkIiwiUHJvamVjdFNlcnZpY2UiLCJnZXRBdHRyaWJ1dGUiLCJzZXRBdHRyaWJ1dGUiLCJjcmVhdGVPYmplY3QiLCJzdGl0Y2hPYmplY3QiLCJjcmVhdGVPYmplY3RGcm9tR2VvSnNvbiIsImNyZWF0ZUdlb0pzb24iLCJ0ZWFyT2JqZWN0IiwiZmVhdHVyZUlkIiwiZmVhdHVyZVByb3BlcnRpZXMiLCJvYmoiLCJwcm9wZXJ0aWVzIiwia2V5X2NpZG9jX2FycmF5IiwidmFsdWVfZ2F6ZXR0ZWVyX2FycmF5Iiwia2V5QXJyIiwidmFsdWVBcnIiLCJ0ZW1wIiwidHlwZV9jcm0iLCJpIiwiaW5kZXhPZiIsIkpTT04iLCJwYXJzZSIsImdlb21ldHJ5IiwicmV0dXJuT2JqIiwicmVzdWx0VmFsIiwiQXJyYXkiLCJzdHJpbmdpZnkiLCJnZW9qc29uIiwiVmVjdG9yQ29udHJvbGxlciIsIlZlY3RvclNlcnZpY2UiLCJzaG93VmVjdG9yTGF5ZXJzIiwicmlnaHRTaWRlQmFyIiwibGF5ZXJOYW1lcyIsImdldExheWVyTmFtZXMiLCJsYXllclNlcnZpY2UiLCJnZXRWZWN0b3JMYXllcnMiLCJnZXRWZWN0b3JMYXllcnNVcmwiLCJjcmVhdGVWZWN0b3JMYXllcnMiLCJjcmVhdGVGZWF0dXJlcyIsImVkaXRWZWN0b3JMYXllcnMiLCJkZWxldGVWZWN0b3JMYXllciIsImdldEFsbEZlYXR1cmVWZXJzaW9uIiwiZ2V0Rm9ybURhdGEiLCJleHBvcnRMYXllckdlb0pzb24iLCJnZXRMYXllclVybCIsInN1Y2Nlc3NDYWxsYmFjayIsImVycm9yQ2FsbGJhY2siLCJjcmVhdGVMYXllclVybCIsImNyZWF0ZUZlYXR1cmVVcmwiLCJkZWxMYXllclVybCIsImVkaXRMYXllclVybCIsImdldEFsbFZlcnNpb25VcmwiLCJnZXRGb3JtVXJsIiwiZXhwb3J0VXJsIiwiR2NwVGFibGVDb250cm9sbGVyIiwiZGVsZXRlR0NQRnJvbVRhYmxlIiwiZGVsZXRlR0NQRnJvbU1hcCIsInJlZnJlc2hHQ1BUYWJsZSIsImF2Z1Jtc2UiLCJzaG93VGFibGUiLCJ0YWJsZURhdGEiLCJwYWdpbmF0aW9uTGltaXQiLCJwYWdpbmF0aW9uQ3VycmVudFBhZ2UiLCJnZW9SZWYiLCJwcmV2aWV3R2NwIiwiY2xlYXJEYXRhIiwiaW5pdCIsInByZXZpZXdHY3BJblRhYmxlIiwibWFya2VyRnJvbURCIiwiZ2NwTm8iLCJnZW5lcmF0ZUxlZnRNYXJrZXIiLCJjYWxsYmFjayIsImltYWdlWCIsImltYWdlWSIsImdlbmVyYXRlUmlnaHRNYXJrZXIiLCJnY3BJZCIsImZpbmQiLCJvIiwiaW1hZ2VDb29yZGluYXRlcyIsIndvcmxkQ29vcmRpbmF0ZXMiLCJHZW9MZWZ0U2lkZW5hdkNvbnRyb2xsZXIiLCIkbWRTZWxlY3QiLCIkbWREaWFsb2ciLCJjbG9zZSIsInJlY3RpZnlEaXNhYmxlIiwiZ2VuZXJhdGVGaWxlbmFtZWFuZEV4dGVudCIsIm1pbngiLCJtaW55IiwibWF4eCIsIm1heHkiLCJnY3AiLCJtYW51YWxFeHRlbnQiLCJleHRlbnRTZWxlY3Rpb24iLCIkd2F0Y2giLCJuZXdWYWwiLCJvbGQiLCJkcmF3UmVjdGFuZ2xlRm9yRXh0ZW50IiwiY2xlYW5VcCIsImNhbGNNaW5NYXhWYWx1ZXMiLCJnZXRSZXNhbXBsaW5nTWV0aG9kc0Jhc2VkT25HQ1AiLCJnZXRSZWN0aWZ5TWV0aG9kc0Jhc2VkT25HQ1AiLCJyZWN0aWZ5TWV0aG9kcyIsImdldFJlY3RpZnlNZXRob2RzIiwicmVjdGlmeU1ldGhvZCIsInJtIiwicmVzYW1wbGluZ01ldGhvZHMiLCJnZXRSZXNhbXBsaW5nTWV0aG9kcyIsInJlc2FtcGxpbmdNZXRob2QiLCJtb25pdG9yQ2xvc2VTZWxlY3QiLCJvbkNsb3NlIiwiZ2VvUmVmRmlsZW5hbWUiLCJpc0VtcHR5IiwiZ2V0T2JqZWN0Iiwib3BlbiIsImZpcnN0TGF5ZXJLZXkiLCJnZXRNb250aCIsImdldERhdGUiLCJiYm94Q3JvcEltYWdlIiwiJHBhcmVudCIsIk1hdGgiLCJtaW4iLCJhcHBseSIsInRvRml4ZWQiLCIkJHdpbmRvdyIsImVsZW1lbnQiLCJ0YXJnZXQiLCJjbGFzc0xpc3QiLCJtYXBJZCIsIm51bUNvb3JkaW5hdGVzIiwibmV3RmlsZU5hbWUiLCJ0ZXh0Q29udGVudCIsImNhbmNlbCIsInRlbXBMZWZ0TGF5ZXIiLCIkJGFycmF5Iiwic2V0T2JqZWN0IiwicmVsb2FkIiwiZ28iLCJyZW1vdmVHY3BUYWJsZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImVtcHR5IiwiRmVhdHVyZUdyb3VwIiwicG9seWdvbkRyYXdlciIsIkRyYXciLCJSZWN0YW5nbGUiLCJwcm9wcyIsImdldFNvdXRoV2VzdCIsImdldE5vcnRoRWFzdCIsIl9sYXllcnMiLCJmZWF0dXJlIiwicmVtb3ZlTGF5ZXIiLCJyZW1vdmVFeHRlbnRSZWN0YW5nbGUiLCJlbWFpbCIsInBhc3N3b3JkIiwiaW1hZ2UiLCJyb2xlcyIsImluaXRpYWxEYXRlIiwiZmluYWxEYXRlIiwibWFwVHlwZSIsInByb2plY3Rpb24iLCJpc0dlb3JlZmVyZW5jZWQiLCJpc05vdEdlb3JlZmVyZW5jZWQiLCJtYXBPcHRpb25zIiwidmVyaWZpZWQiLCJlbnRlckdlb3JlZkZpbGVOYW1lIiwiZXh0ZW50R2VvUmVmIiwiY3JvcEltYWdlIiwiY3JvcEltYWdlQnlEcmF3IiwiY3JvcEltYWdlTm9uZSIsInNob3dPbmx5Q2hpbGRNYXAiLCJnYXp6VHlwZSIsImJ1aWxkaW5nVHlwZSIsImNvdW50cnkiLCJ0aW1lU3BhbiIsIm1hdGVyaWFsIiwicmVmRG9jdW1lbnQiLCJjcmVhdGVkRGF0ZSIsImtpbmciLCJjb25maXJtVGl0bGUiLCJjb25maXJtRGVzY3JpcHRpb24iLCJjb25maXJtTG9hZFVuZ2VvcmVmZXJlbmNlZFRpdGxlIiwiY29uZmlybUxvYWRHZW9yZWZlcmVuY2VkVGl0bGUiLCJMb2FkVW5nZW9yZWZlcmVuY2VkRGVzY3JpcHRpb24iLCJMb2FkR2VvcmVmZXJlbmNlZERlc2NyaXB0aW9uIiwicmVtb3ZlRGVzY3JpcHRpb24iLCJpbnZhbGlkR2VvcmVmVGl0bGUiLCJpbnZhbGlkR2VvcmVmVGV4dCIsImxvZ2luIiwicmVzZXRQYXNzd29yZCIsImNhbnRMb2FkVGl0bGUiLCJjYW50TG9hZERlc2NyaXB0aW9uIiwiY2FudFByZXZpZXdHY3B0YWJsZVRpdGxlIiwiY2FudFByZXZpZXdHY3B0YWJsZVRleHQiLCJsb2FkaW5nIiwicHJvY2Vzc2luZyIsImFsbCIsImludGVybmFsRXJyb3IiLCJtYXBGaWxlSXNNYW5kYXRvcnkiLCJpbnZhbGlkSW1hZ2VGaWxlIiwiZmlsZVRvb0JpZyIsIm5vdEZvdW5kIiwibm90QXV0aG9yaXplZCIsInNlYXJjaEVycm9yIiwic2F2ZVN1Y2Nlc3MiLCJzYXZlR2VvcmVmZXJlbmNlU3VjY2VzcyIsIm9wZXJhdGlvblN1Y2Nlc3MiLCJvcGVyYXRpb25FcnJvciIsInNhdmVFcnJvciIsInJlbW92ZVN1Y2Nlc3MiLCJyZW1vdmVFcnJvciIsInJlc291cmNlTm90Rm91bmRFcnJvciIsIm5vdE51bGxFcnJvciIsImR1cGxpY2F0ZWRSZXNvdXJjZUVycm9yIiwiZGVsZXRlTGF5ZXJUaXRsZSIsImRlbGV0ZUxheWVyTWVzc2FnZSIsInZhbGlkYXRlIiwiZmllbGRSZXF1aXJlZCIsImxheW91dCIsImVycm9yNDA0IiwibG9nb3V0SW5hY3RpdmUiLCJpbnZhbGlkQ3JlZGVudGlhbHMiLCJ1bmtub3duRXJyb3IiLCJ1c2VyTm90Rm91bmQiLCJkYXNoYm9hcmQiLCJ3ZWxjb21lIiwibWFpbCIsIm1haWxFcnJvcnMiLCJzZW5kTWFpbFN1Y2Nlc3MiLCJzZW5kTWFpbEVycm9yIiwicGFzc3dvcmRTZW5kaW5nU3VjY2VzcyIsInVzZXIiLCJyZW1vdmVZb3VyU2VsZkVycm9yIiwidXNlckV4aXN0cyIsInByb2ZpbGUiLCJ1cGRhdGVFcnJvciIsImRyb3BNYXAiLCJzZWxlY3RBTWFwIiwic2VsZWN0QUdlb0ZpbGUiLCJjbGlja1RvQWRkIiwiZ2VvcmVmU3RhcnRSZWN0YW5nbGVFeHRlbnQiLCJicmVhZGNydW1icyIsImF1ZGl0IiwicHJvamVjdCIsInRpdGxlcyIsIm1haWxTZW5kIiwidGFza0xpc3QiLCJ1c2VyTGlzdCIsImF1ZGl0TGlzdCIsInJlZ2lzdGVyIiwidXBkYXRlIiwiYWRkTWFwIiwiZWRpdE1hcCIsIm1hcExpc3QiLCJtYXBWaWV3IiwibWFwRWxlbWVudHMiLCJtYXBMYXllcnMiLCJuZXdNYXAiLCJtYXBHZW9yZWZlcmVuY2luZyIsInNhdmVDb250cm9sUG9pbnRzIiwidmVjdG9yVGl0bGUiLCJmZWF0dXJlQXR0ciIsImxheWVyTGlzdCIsImVkaXRMYXllciIsInNlbmQiLCJjbGVhckFsbCIsInJlc3RhcnQiLCJsaXN0IiwiZ2V0T3V0IiwiYWRkIiwiaW4iLCJsb2FkSW1hZ2UiLCJ2aWV3IiwiZmlsdGVyTWFwcyIsImxvYWRNYXBJbkxlZnQiLCJsb2FkTWFwSW5SaWdodCIsImhpZGVNYXBMYXllciIsInNob3dNYXBMYXllciIsInpvb21Ub01hcExheWVyIiwibG9hZGVkSW5MZWZ0Vmlld2VyIiwibG9hZGVkSW5SaWdodFZpZXdlciIsInJlc2V0IiwidW5saW5rTGluayIsInRvZ2dsZVZlcmlmaWVkIiwidG9nZ2xlRmF2b3JpdGUiLCJ0b2dnbGVXaGVlbFpvb20iLCJ0b2dnbGVNYXJrZXJDcmVhdGlvbiIsInRvZ2dsZU1hcmtlclJlbW92YWwiLCJzYXZlR2VvcmVmIiwibG9hZEdjcE9uTWFwIiwiY3JlYXRlbGF5ZXIiLCJwdWJsaXNoIiwic2hvd0ZlYXR1cmVWZXJzaW9uIiwiZmllbGRzIiwiYWN0aW9uIiwiY29uZmlybVBhc3N3b3JkIiwidG8iLCJzdWJqZWN0IiwibmFtZU9yRW1haWwiLCJtZW51IiwiZXhwb3J0IiwiaW1wb3J0IiwidmVjdG9yIiwiZ2VvcmVmZXJlbmNlIiwicHJlZmVyZW5jZXMiLCJzZWxlY3QiLCJ0b29sdGlwcyIsInRyYW5zZmVyIiwicGFnaW5hdGlvbiIsInRhc2siLCJkb25lIiwicHJpb3JpdHkiLCJzY2hlZHVsZWRfdG8iLCJjb3N0IiwiYXVkaXRNb2RlbCIsImNyZWF0ZWQiLCJ1cGRhdGVkQmVmb3JlIiwidXBkYXRlZEFmdGVyIiwiZGVsZXRlZCIsImFkbWluIiwiZXhhbXBsZXMiLCJNYXBEaWFsb2dDb250cm9sbGVyIiwib25GaWxlUmVtb3ZlIiwicmVtb3ZlRmlsZSIsImdlb0ZpbGVOZWVkZWQiLCJvbkltYWdlRmlsZUNoYW5nZSIsIm9uR2VvRmlsZUNoYW5nZSIsInNob3dHZW9GaWxlSW5wdXQiLCJzaG93UHJvamVjdGlvbklucHV0Iiwic2hvd0dlb3JlZkJhZGdlIiwic2F2aW5nIiwiZGVmaW5lVmlld1N0YXRlIiwicmVtb3ZlTWFwIiwibWFwVHlwZXMiLCJhZGp1c3RSZXNvdXJjZSIsInByb2plY3Rpb25zIiwicHJvamVjdHMiLCJtb2RlIiwidmlld1RpdGxlIiwibSIsImZpZWxkX21hcF90eXBlIiwibWFwSW1hZ2VGaWxlIiwib25TYXZlIiwicmVzb3VyY2VVcGRhdGVkIiwiZXJyb3IiLCJpbWFnZV9maWxlX2lkIiwibWFwX3R5cGVfaWQiLCJtYXBHZW9GaWxlIiwiZmllbGRfbWFwX2dlb19pZCIsIm1hcF9wcm9qZWN0X2lkIiwiZmlsZVNlcnZpY2UiLCJzZXRTdGF0ZUFmdGVyRmlsZVJlbW92YWwiLCJyZW1vdmVkRmlsZSIsInNldElzR2VvcmVmZXJlbmNlZCIsImlzSW1hZ2UiLCJ0aHVtYiIsImZpbGVPYmoiLCJpbWFnZUZpbGUiLCJpc1JlbW90ZSIsImxmVGFnVHlwZSIsImxmRmlsZSIsInVwbG9hZEZpbGUiLCJpbWFnZUlkIiwiZ2VvRmlsZSIsInNhdmVkRmlsZURhdGEiLCJzZXRTdGF0ZUFmdGVyRmlsZVVwbG9hZCIsImlzZ2VvcmVmIiwiTWFwTGVmdFNpZGVuYXZDb250cm9sbGVyIiwiZGVidWciLCJhcHAiLCJzZXQiLCJsb2NhbFN0b3JhZ2UiLCJjb21wb25lbnQiLCJ0cmFuc2NsdWRlIiwidG9vbGJhckJ1dHRvbnMiLCJmb290ZXJCdXR0b25zIiwiYmluZGluZ3MiLCJib3hUaXRsZSIsInRvb2xiYXJDbGFzcyIsIiR0cmFuc2NsdWRlIiwiY3RybCIsIiRvbkluaXQiLCJsYXlvdXRBbGlnbiIsIk1hcFZpZXdlckNvbnRyb2xsZXIiLCJ0b2dnbGVMZWZ0IiwidG9nZ2xlUmlnaHQiLCJzd2l0Y2hUb1ZpZXciLCJ0b2dnbGVWaWV3ZXJzQ2VudGVyTGluayIsInNob3dCb3RoVmlld2VycyIsInRvZ2dsZUFkZEdDUCIsImRpc3BsYXlCb3R0b21OYXYiLCJib3R0b21OYXYiLCJzaG93Qm90dG9tTmF2IiwicmlnaHRDb250cm9scyIsImxlZnRDb250cm9scyIsImxlZnRDZW50ZXIiLCJzaG93UmlnaHRNYXBWaWV3ZXIiLCJzaG93TGVmdE1hcFZpZXdlciIsInJpZ2h0Q2VudGVyIiwicmVmcmVzaE1hcFZpZXdlciIsInJpZ2h0V2hlZWxab29tRW5hYmxlZCIsImxlZnRXaGVlbFpvb21FbmFibGVkIiwiZGlzcGF0Y2hFdmVudCIsIkV2ZW50Iiwidmlld2VyV2lkdGgiLCJib3RoVmlld2Vyc1Zpc2libGUiLCJtYXN0ZXJWaWV3ZXIiLCJtYXBfaW1hZ2VfZmlsZSIsIm1hcFR5cGVOYW1lIiwibWFwX3R5cGVfbmFtZSIsImZpZWxkX21hcF9nZW9maWxlIiwiZmlsdGVycyIsInF1ZXJ5RmlsdGVycyIsImV4dGVuZCIsImRlbGV0ZUdDUCIsIk1lbnVDb250cm9sbGVyIiwib3Blbk1lbnVPclJlZGlyZWN0VG9TdGF0ZSIsImN1cnJlbnROYXZJdGVtIiwiY3VycmVudCIsInRvU3RhdGUiLCJ0b1BhcmFtcyIsImZyb21TdGF0ZSIsImZyb21QYXJhbXMiLCJpdGVuc01lbnUiLCIkbWRNZW51IiwiZXYiLCJpdGVtIiwic3ViSXRlbnMiLCJnZXRDb2xvciIsImNvbG9yUGFsZXR0ZXMiLCJWZWN0b3JMYXllckNvbnRyb2xsZXIiLCJwcm9qX2lkIiwidXNlcl9pZCIsImxheWVySWQiLCJkZXNjIiwidmVjdG9yU2VydmljZSIsImVxdWFscyIsInJlcVBhcmFtIiwibG9jYXRpb24iLCJWZWN0b3JMZWZ0U2lkZW5hdkNvbnRyb2xsZXIiLCIkc2Vzc2lvblN0b3JhZ2UiLCJsYXllckNsaWNrZWQiLCJhY3RpdmF0ZUZlYXR1cmVFZGl0IiwiZGVsZXRlTGF5ZXIiLCJvcGVuQXR0cmlidXRlUG9wVXAiLCJsYXllclZpc2liaWxpdHkiLCJjcmVhdGVMYXllciIsImV4cG9ydExheWVyIiwidXNlckFsbG93IiwiZHJhd0NvbnRyb2wiLCJsZWFmbGV0TGF5ZXJzIiwiY3VycmVudGx5RWRpdGluZ0xheWVyIiwiZWRpdE1vZGUiLCJyZXFQYXJhbURhdGEiLCJmZXRjaCIsImxheWVyX2lkIiwibG9hZFdGU0xheWVycyIsIm9uRmVhdHVyZUNsaWNrZWQiLCJsZWFmTGF5ZXIiLCJwcmVwYXJlRGVsZXRlUGFyYW1zIiwiZWFjaEZlYXR1cmUiLCJDb250cm9sIiwicG9seWdvbiIsInBvbHlsaW5lIiwicmVjdGFuZ2xlIiwiY2lyY2xlIiwiY2lyY2xlbWFya2VyIiwiZmVhdHVyZUdyb3VwIiwiYWRkQ29udHJvbCIsImFkZE5vbkdyb3VwTGF5ZXJzIiwic291cmNlTGF5ZXIiLCJ0YXJnZXRHcm91cCIsIkxheWVyR3JvdXAiLCJlYWNoTGF5ZXIiLCJhcmlhTGFiZWwiLCJyZXMiLCJXRlNUIiwicmFuZG9tIiwiZmlsbE9wYWNpdHkiLCJGb3JtYXQiLCJHZW9KU09OIiwiaXNWYWxpZCIsImZlYXR1cmVHZW9qc29uIiwib3BlcmF0aW9uIiwiZmVhdHVyZXMiLCJnZXRMYXllckJ5TmFtZSIsImNyZWF0ZVBhcmFtIiwiZWRpdFBhcmFtIiwiZGVsZXRlUGFyYW0iLCJsYXllckRhdGEiLCJlbmNvZGVVUklDb21wb25lbnQiLCJkb3dubG9hZEFuY2hvck5vZGUiLCJjcmVhdGVFbGVtZW50IiwiYm9keSIsImFwcGVuZENoaWxkIiwiY2xpY2siLCJmdW5jdGlvbmFsaXR5IiwiVmVjdG9yUmlnaHRTaWRlbmF2Q29udHJvbGxlciIsInNob3dBdHRyaWJ1dGVzIiwic2hvd0FsbEZlYXR1cmVWZXJzaW9ucyIsImNoZWNrRGVwZW5kZW50VmFsdWUiLCJnZXRGb3JtQXR0cmlidXRlIiwiZ2F6elR5cGVzIiwiY3VycmVudExheWVyIiwiZGlzYWJsZVNhdmUiLCJzaG93QWxsVmVyc2lvbnMiLCJmb3JtUGFyYW1zIiwiY3VycmVudEZlYXR1cmUiLCJ0ZW1wT2JqIiwic2VhcmNoRnJvbUNvbGxlY3Rpb25Ub0ZlYXR1cmUiLCJjaGVja1VzZXJBY2Nlc3NPbkZlYXR1cmUiLCJmb3VuZE9iamVjdEluQ3JlYXRlUGFyYW0iLCJzZWFyY2hBbmRSZXBsYWNlT25seUdlb20iLCJhZGRGZWF0dXJlVG9VcGRhdGVMaXN0IiwiY3VycmVudExlYWZGZWF0dXJlIiwic2VhcmNoSW5Db2xsZWN0aW9uIiwidGVtcERlbGV0ZURhdGEiLCJkZWxldGVGZWF0dXJlRnJvbUNvbGxlY3Rpb24iLCJmZWF0dXJlT2JqZWN0IiwidGVtcEZWYWxPYmoiLCJ0ZW1wRktleU9iaiIsImZvdW5kT2JqZWN0SW5FZGl0UGFyYW0iLCJ0ZW1wRmVhdHVyZSIsInRlbXBDcm0iLCJmbG9vciIsImFwaVBhcmFtRm9ybWF0IiwiY29udmVydEpzb25Ub0FwaVJlcU9iaiIsImNvbnZlcnRUb1NTViIsInNlYXJjaEFuZFJlcGxhY2UiLCJoYW5kbGVFZGl0UGFyYW0iLCJ0b2dnbGVTYXZlQnV0dG9uIiwiZWRpdFBhcmFtQ29sbGVjdGlvbiIsInRlbXBGZWF0dXJlQXR0ciIsImVhY2hBdHRyIiwiY29sbGVjdGlvbiIsInJldHVybkRhdGEiLCJ0ZW1wQ29sbGVjdGlvbiIsInRlbXBSZXR1cm4iLCJzaG93RmVhdHVyZU9uTWFwIiwicmlnaHRNYXBMYXllckdyb3VwIiwiY2xlYXJMYXllcnMiLCJmZ2VvbSIsImdlb20iLCJnZW9qc29uRmVhdHVyZSIsImdlb0pTT04iLCJvbkVhY2hGZWF0dXJlIiwiZmVhdHVyZVR5cGUiLCJmaWVsZCIsImRlcGVuZGVudCIsImNzdlN0cmluZyIsInJlc3VsdFN0cmluZyIsIk1hcEJvdHRvbU5hdkNvbnRyb2xsZXIiLCJ0b2dnbGVCb3R0b20iLCJ0b2dnbGVJbmNsdWRlVG9Xb3JraW5nTGlzdCIsImlzTG9hZGVkIiwic2hvd0xvYWRNYXBJbkxlZnRCdXR0b24iLCJzaG93TG9hZE1hcEluUmlnaHRCdXR0b24iLCJpc05vbkdlb3JlZkxvYWRlZCIsInNob3dGaWx0ZXJDaGVja2JveCIsInNob3dPbmx5Q2hpbGRNYXBGdW5jIiwiaXNDaGlsZE1hcCIsInNob3dMb2FkTWFwSW5SaWdodCIsInNob3dMb2FkTWFwSW5MZWZ0IiwidG9nZ2xlTG9hZE1hcCIsImNoZWNrQWxsR2VvUmVmTWFwcyIsImdjcHMiLCJtYXBWaWV3ZXIiLCJjYW5Mb2FkR2NwIiwiZmlsZU5hbWUiLCJqb2luIiwiZWFjaFJlc291cmNlIiwidGVtcEltYWdlTmFtZSIsImlzQ2hpbGRPZkxvYWRlZE5vbmdlb3JlZiIsInRlbXBNYXBJZCIsIm1hcF9zb3VyY2VfaWQiLCJNYXBSaWdodFNpZGVuYXZDb250cm9sbGVyIiwiZmlsdGVyTWFwTGF5ZXJzIiwicmVmcmVzaE92ZXJsYXlzIiwic29ydGFibGVDb25mIiwib25VcGRhdGUiLCJ1cGRhdGVBZnRlclNvcnQiLCJoYW5kbGUiLCJsb2FkZWRNYXBzTGF5ZXJzIiwiZmlsdGVyTWFwTGF5ZXJzVHh0IiwicmlnaHRMYXllcnMiLCJsZWZ0TGF5ZXJzIiwiZXZ0Il0sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQ0EsQ0FBQyxZQUFXO0VBQ1I7O0VBRUFBLFFBQVFDLE9BQU8sT0FBTyxDQUNwQixhQUNBLFVBQ0EsYUFDQSxRQUNBLGtCQUNBLGFBQ0EsY0FDQSxnQkFDQSxpQkFDQSx3QkFD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SDs7OztNQUk3QnRZLEdBQUc0L0IsbUJBQW1CNS9CLEdBQUc0L0IsaUJBQWlCeG5CLFFBQVFDOzs7Ozs7OztJQVFwRCxTQUFTcW5CLGdCQUFnQk0sS0FBSTtNQUMzQnB0QixnQkFBZ0JxQixhQUFhK3JCLElBQUk5dkI7OztJQUduQ2hROztLQXhJSiIsImZpbGUiOiJhcHBsaWNhdGlvbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuLyplc2xpbnQgYW5ndWxhci9maWxlLW5hbWU6IDAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbJ25nQW5pbWF0ZScsICduZ0FyaWEnLCAndWkucm91dGVyJywgJ25nQzInLCAndWkudXRpbHMubWFza3MnLCAndGV4dC1tYXNrJywgJ25nTWF0ZXJpYWwnLCAnbW9kZWxGYWN0b3J5JywgJ21kLmRhdGEudGFibGUnLCAnbmdNYXRlcmlhbERhdGVQaWNrZXInLCAncGFzY2FscHJlY2h0LnRyYW5zbGF0ZScsICdhbmd1bGFyRmlsZVVwbG9hZCcsICduZ01hdGVyaWFsJywgJ25nQW5pbWF0ZScsICduZ01lc3NhZ2VzJywgJ25nQXJpYScsICd1aS5yb3V0ZXInLCAnbGZOZ01kRmlsZUlucHV0JywgJ25lbUxvZ2dpbmcnLCAndWktbGVhZmxldCcsICduZy1zb3J0YWJsZSddKTtcbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbmZpZyhjb25maWcpO1xuXG4gICAgLyoqIEBuZ0luamVjdCAqL1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gICAgZnVuY3Rpb24gY29uZmlnKEdsb2JhbCwgJG1kVGhlbWluZ1Byb3ZpZGVyLCAkbW9kZWxGYWN0b3J5UHJvdmlkZXIsICR0cmFuc2xhdGVQcm92aWRlciwgbW9tZW50LCAkbWRBcmlhUHJvdmlkZXIsICR3aW5kb3dQcm92aWRlcikge1xuXG4gICAgICAgICR0cmFuc2xhdGVQcm92aWRlci51c2VMb2FkZXIoJ2xhbmd1YWdlTG9hZGVyJykudXNlU2FuaXRpemVWYWx1ZVN0cmF0ZWd5KCdlc2NhcGUnKTtcblxuICAgICAgICAvLyR0cmFuc2xhdGVQcm92aWRlci51c2VQb3N0Q29tcGlsaW5nKHRydWUpO1xuXG4gICAgICAgIG1vbWVudC5sb2NhbGUoJ2VuLUdCJyk7XG5cbiAgICAgICAgLy90aGUgcHJlZml4IHRvIGJlIHVzZWQgaW4gYWxsIGJhY2stZW5kIGFwaSByZXF1ZXN0c1xuICAgICAgICB2YXIgJHdpbmRvdyA9ICR3aW5kb3dQcm92aWRlci4kZ2V0KCk7XG4gICAgICAgICRtb2RlbEZhY3RvcnlQcm92aWRlci5kZWZhdWx0T3B0aW9ucy5wcmVmaXggPSBHbG9iYWwuYXBpUGF0aDtcblxuICAgICAgICAvLyBDb25maWd1cmF0aW9uIHRoZW1lIC0gc2VlOiBodHRwczovL21hdGVyaWFsLmFuZ3VsYXJqcy5vcmcvbGF0ZXN0L1RoZW1pbmcvMDNfY29uZmlndXJpbmdfYV90aGVtZVxuICAgICAgICAkbWRUaGVtaW5nUHJvdmlkZXIudGhlbWUoJ2RlZmF1bHQnKS5wcmltYXJ5UGFsZXR0ZSgnYmx1ZScsIHtcbiAgICAgICAgICAgIGRlZmF1bHQ6ICc3MDAnXG4gICAgICAgIH0pLmFjY2VudFBhbGV0dGUoJ2luZGlnbycpLndhcm5QYWxldHRlKCdkZWVwLW9yYW5nZScpO1xuXG4gICAgICAgIC8vIEVuYWJsZSBicm93c2VyIGNvbG9yXG4gICAgICAgICRtZFRoZW1pbmdQcm92aWRlci5lbmFibGVCcm93c2VyQ29sb3IoKTtcblxuICAgICAgICAkbWRBcmlhUHJvdmlkZXIuZGlzYWJsZVdhcm5pbmdzKCk7XG4gICAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdBcHBDb250cm9sbGVyJywgQXBwQ29udHJvbGxlcik7XG5cbiAgICAvKiogQG5nSW5qZWN0ICovXG4gICAgLyoqXG4gICAgICogQ29udHJvbGxlciByZXNwb25zaWJsZSBmb3IgZnVuY3Rpb25hbGl0aWVzIHRoYXQgYXJlIHVzZWQgaW4gYW55IHN5c3RlbSBzdGF0ZS9wYWdlXG4gICAgICovXG4gICAgZnVuY3Rpb24gQXBwQ29udHJvbGxlcigkc3RhdGUsIEdsb2JhbCwgJGxvY2FsU3RvcmFnZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIC8vIEN1cnJlbnQgeWVhciB0byBiZSBzaG93biBpbiB0aGUgZm9vdGVyXG4gICAgICAgIHZtLmN1cnJlbnRZZWFyID0gbnVsbDtcbiAgICAgICAgYWN0aXZhdGUoKTtcblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgIHZtLmN1cnJlbnRZZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpO1xuICAgICAgICB9XG5cbiAgICAgICAgc2Vzc2lvblN0b3JhZ2UuY2xlYXIoKTtcbiAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShcInJvbGVcIiwgXCJhZG1pblwiKTtcbiAgICAgICAgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpID09PSBcImFkbWluXCIpIHtcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oXCJyb2xlXCIsIFwiMVwiKTtcbiAgICAgICAgfSBlbHNlIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKSA9PT0gXCJzZW5pb3JcIikge1xuICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShcInJvbGVcIiwgXCIyXCIpO1xuICAgICAgICB9IGVsc2UgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpID09PSBcInVzZXJcIikge1xuICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShcInJvbGVcIiwgXCIzXCIpO1xuICAgICAgICB9IGVsc2UgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpID09PSBcImd1ZXN0XCIpIHtcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oXCJyb2xlXCIsIFwiNFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiYXBwY29udHJvbGxlciBcIiwgJGxvY2FsU3RvcmFnZSk7XG4gICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oXCJwcm9qSWRcIiwgXCIzMTAyNDI4M1wiKTtcbiAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShcInVzZXJJZFwiLCBcIjEwMDBcIik7XG4gICAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuLyplc2xpbnQgYW5ndWxhci9maWxlLW5hbWU6IDAsIG5vLXVuZGVmOiAwKi9cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICAvKipcbiAgICogVHJhbnNmb3JtcyBleHRlcm5hbCBsaWJzIGluIGFuZ3VsYXIgc2VydmljZXMgc28gd2UgY2FuIHVzZSB0aGVtIHdpdGggZGVwZW5kZW5jZSBpbmplY3Rpb25cbiAgICovXG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnN0YW50KCdsb2Rhc2gnLCBfKS5jb25zdGFudCgnbW9tZW50JywgbW9tZW50KS5jb25zdGFudCgnbGVhZmxldCcsIEwpO1xufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25zdGFudCgnR2xvYmFsJywge1xuICAgIGFwcE5hbWU6ICdIZWlNQVAnLFxuICAgIGltYWdlUGF0aDogJy9pbWFnZXMnLFxuICAgIGNsaWVudFBhdGg6ICcvd2ViYXBwL2FwcCcsXG4gICAgaG9tZVN0YXRlOiAnYXBwLm1hcCcsXG4gICAgaG9tZVVybDogJy9tYXAnLFxuICAgIGFwaVBhdGg6ICcnXG4gIH0pO1xufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25maWcocm91dGVzKTtcblxuICAvKiogQG5nSW5qZWN0ICovXG4gIGZ1bmN0aW9uIHJvdXRlcygkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyLCBHbG9iYWwpIHtcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnYXBwJywge1xuICAgICAgdGVtcGxhdGVVcmw6IEdsb2JhbC5jbGllbnRQYXRoICsgJy9zaGFyZWQvcGFydGlhbHMvYXBwLmh0bWwnLFxuICAgICAgYWJzdHJhY3Q6IHRydWUsXG4gICAgICByZXNvbHZlOiB7IC8vZW5zdXJlIGxhbmdzIGlzIHJlYWR5IGJlZm9yZSByZW5kZXIgdmlld1xuICAgICAgICB0cmFuc2xhdGVSZWFkeTogWyckdHJhbnNsYXRlJywgJyRxJywgZnVuY3Rpb24gKCR0cmFuc2xhdGUsICRxKSB7XG4gICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICR0cmFuc2xhdGUudXNlKCdlbi1HQicpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgIH1dXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAkdXJsUm91dGVyUHJvdmlkZXIud2hlbignL2FwcCcsIEdsb2JhbC5ob21lVXJsKTtcbiAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKEdsb2JhbC5ob21lVXJsKTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5ydW4ocnVuKTtcblxuICAvKiogQG5nSW5qZWN0ICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gIGZ1bmN0aW9uIHJ1bigkcm9vdFNjb3BlLCAkc3RhdGUsICRzdGF0ZVBhcmFtcywgR2xvYmFsKSB7XG4gICAgLy9TZXRzIHRoZSByb290U2NvcGUgc28gaXQgY2FuIGJlIGFjY2Vzc2VkIGluIHRoZSB2aWV3cyB3aXRob3V0IHRoZSBjb250cm9sbGVyIHByZWZpeFxuICAgICRyb290U2NvcGUuJHN0YXRlID0gJHN0YXRlO1xuICAgICRyb290U2NvcGUuJHN0YXRlUGFyYW1zID0gJHN0YXRlUGFyYW1zO1xuICAgICRyb290U2NvcGUuZ2xvYmFsID0gR2xvYmFsO1xuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4vKmVzbGludCBhbmd1bGFyL2ZpbGUtbmFtZTogMCovXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ3NlcnZpY2VGYWN0b3J5Jywgc2VydmljZUZhY3RvcnkpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgLyoqXHJcbiAgICogTW9yZSBpbmZvcm1hdGlvbjpcclxuICAgKiBodHRwczovL2dpdGh1Yi5jb20vc3dpbWxhbmUvYW5ndWxhci1tb2RlbC1mYWN0b3J5L3dpa2kvQVBJXHJcbiAgICovXG4gIGZ1bmN0aW9uIHNlcnZpY2VGYWN0b3J5KCRtb2RlbEZhY3RvcnkpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHVybCwgb3B0aW9ucykge1xuICAgICAgdmFyIG1vZGVsO1xuICAgICAgdmFyIGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICBhY3Rpb25zOiB7XG4gICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgKiBBY3Rpb24gdG8gZG8gYSBwYWdpbmF0ZWQgc2VhcmNoXHJcbiAgICAgICAgICAgKiBFeHBlY3RzIHRoYXQgYSBqc29uIG9iamVjdCB3aXRoIHRoZSBwcm9wZXJ0aWVzIGl0ZW1zIGFuZCB0b3RhbFxyXG4gICAgICAgICAgICovXG4gICAgICAgICAgcGFnaW5hdGU6IHtcbiAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgICBpc0FycmF5OiBmYWxzZSxcbiAgICAgICAgICAgIHdyYXA6IGZhbHNlLFxuICAgICAgICAgICAgYWZ0ZXJSZXF1ZXN0OiBmdW5jdGlvbiBhZnRlclJlcXVlc3QocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlWydpdGVtcyddKSB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2VbJ2l0ZW1zJ10gPSBtb2RlbC5MaXN0KHJlc3BvbnNlWydpdGVtcyddKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIG1vZGVsID0gJG1vZGVsRmFjdG9yeSh1cmwsIGFuZ3VsYXIubWVyZ2UoZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpKTtcblxuICAgICAgcmV0dXJuIG1vZGVsO1xuICAgIH07XG4gIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdDUlVEQ29udHJvbGxlcicsIENSVURDb250cm9sbGVyKTtcblxuICAvKiogQG5nSW5qZWN0ICovXG4gIC8qKlxyXG4gICAqIEJhc2UgQ29udHJvbGxlciB0aGF0ICBpbXBsZW1lbnRzIGFsIHRoZSBzdGFuZGFyZCBDUlVEIGZ1bmN0aW9uc1xyXG4gICAqXHJcbiAgICogSW1wbGVtZW50ZWQgYWN0aW9uczpcclxuICAgKiBhY3RpdmF0ZSgpXHJcbiAgICogc2VhcmNoKHBhZ2UpXHJcbiAgICogZWRpdChyZXNvdXJjZSlcclxuICAgKiBzYXZlKClcclxuICAgKiByZW1vdmUocmVzb3VyY2UpXHJcbiAgICogZ29Ubyh2aWV3TmFtZSlcclxuICAgKiBjbGVhbkZvcm0oKVxyXG4gICAqXHJcbiAgICogVHJpZ2dlcnM6XHJcbiAgICpcclxuICAgKiBvbkFjdGl2YXRlKClcclxuICAgKiBhcHBseUZpbHRlcnMoZGVmYXVsdFF1ZXJ5RmlsdGVycylcclxuICAgKiBiZWZvcmVTZWFyY2gocGFnZSkgLy9yZXR1cm5pbmcgZmFsc2UgY2FuY2VsIHRoZSBzdWJtaXNzaW9uL2Zsb3dcclxuICAgKiBhZnRlclNlYXJjaChyZXNwb25zZSlcclxuICAgKiBiZWZvcmVDbGVhbiAvL3JldHVybmluZyBmYWxzZSBjYW5jZWwgdGhlIHN1Ym1pc3Npb24vZmxvd1xyXG4gICAqIGFmdGVyQ2xlYW4oKVxyXG4gICAqIGJlZm9yZVNhdmUoKSAvL3JldHVybmluZyBmYWxzZSBjYW5jZWwgdGhlIHN1Ym1pc3Npb24vZmxvd1xyXG4gICAqIGFmdGVyU2F2ZShyZXNvdXJjZSlcclxuICAgKiBvblNhdmVFcnJvcihlcnJvcilcclxuICAgKiBiZWZvcmVSZW1vdmUocmVzb3VyY2UpIC8vcmV0dXJuaW5nIGZhbHNlIGNhbmNlbCB0aGUgc3VibWlzc2lvbi9mbG93XHJcbiAgICogYWZ0ZXJSZW1vdmUocmVzb3VyY2UpXHJcbiAgICpcclxuICAgKiBAcGFyYW0ge2FueX0gdm0gY2hpbGQgY29udHJvbGxlciBpbnN0YW5jZVxyXG4gICAqIEBwYXJhbSB7YW55fSBtb2RlbFNlcnZpY2UgbW9kZWwgc2VydmljZSB0aGF0IHRoZSBjb250cm9sbGVyIHdpbGwgdXNlIGZvciB0aGUgcmVzdGZ1bCByZXF1ZXN0c1xyXG4gICAqIEBwYXJhbSB7YW55fSBvcHRpb25zIG9wdGlvbnMgdG8gb3ZlcndyaXRlIHRoZSBkZWZhdWx0IGJlaGF2aW9yc1xyXG4gICAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICBmdW5jdGlvbiBDUlVEQ29udHJvbGxlcih2bSwgbW9kZWxTZXJ2aWNlLCBvcHRpb25zLCBDMlRvYXN0LCBDMlBhZ2luYXRpb24sIC8vIE5PU09OQVJcbiAgQzJEaWFsb2csICR0cmFuc2xhdGUpIHtcblxuICAgIC8vRnVuY3Rpb25zIEJsb2NrXG4gICAgdm0uc2VhcmNoID0gc2VhcmNoO1xuICAgIHZtLnBhZ2luYXRlU2VhcmNoID0gcGFnaW5hdGVTZWFyY2g7XG4gICAgdm0ubm9ybWFsU2VhcmNoID0gbm9ybWFsU2VhcmNoO1xuICAgIHZtLmVkaXQgPSBlZGl0O1xuICAgIHZtLnNhdmUgPSBzYXZlO1xuICAgIHZtLnJlbW92ZSA9IHJlbW92ZTtcbiAgICB2bS5nb1RvID0gZ29UbztcbiAgICB2bS5jbGVhbkZvcm0gPSBjbGVhbkZvcm07XG5cbiAgICBhY3RpdmF0ZSgpO1xuXG4gICAgLyoqXHJcbiAgICAgKiBQcmVwYXJlIHRoZSBjb250cm9sbGVyXHJcbiAgICAgKiBEbyBhbiBvcHRpb25zIG1lcmdlXHJcbiAgICAgKiBJbml0aWFsaXplIHRoZSByZXNvdXJjZVxyXG4gICAgICogSW5pdGlhbGl6ZSB0aGUgcGFnaW5nIG9iamVjdCBhbmQgZG8gdGhlIGluaXRpYWwgc2VhcmNoIChpZiBzZWFyY2hPbkluaXQgaXMgdHJ1ZSApXHJcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgICAgIHZtLmRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICByZWRpcmVjdEFmdGVyU2F2ZTogdHJ1ZSxcbiAgICAgICAgc2VhcmNoT25Jbml0OiB0cnVlLFxuICAgICAgICBwZXJQYWdlOiA4LFxuICAgICAgICBza2lwUGFnaW5hdGlvbjogZmFsc2VcbiAgICAgIH07XG5cbiAgICAgIGFuZ3VsYXIubWVyZ2Uodm0uZGVmYXVsdE9wdGlvbnMsIG9wdGlvbnMpO1xuXG4gICAgICB2bS52aWV3Rm9ybSA9IGZhbHNlO1xuICAgICAgdm0ucmVzb3VyY2UgPSBuZXcgbW9kZWxTZXJ2aWNlKCk7XG5cbiAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24odm0ub25BY3RpdmF0ZSkpIHZtLm9uQWN0aXZhdGUoKTtcblxuICAgICAgdmFyIGxhYmVsT3B0aW9ucyA9IHtcbiAgICAgICAgbGFiZWxzOiB7XG4gICAgICAgICAgdG90YWw6ICR0cmFuc2xhdGUuaW5zdGFudCgndmlld3MucGFnaW5hdGlvbi50b3RhbCcpLFxuICAgICAgICAgIGl0ZW1zOiAkdHJhbnNsYXRlLmluc3RhbnQoJ3ZpZXdzLnBhZ2luYXRpb24uaXRlbXMnKVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICB2bS5wYWdpbmF0b3IgPSBDMlBhZ2luYXRpb24uZ2V0SW5zdGFuY2Uodm0uc2VhcmNoLCB2bS5kZWZhdWx0T3B0aW9ucy5wZXJQYWdlLCBsYWJlbE9wdGlvbnMpO1xuXG4gICAgICBpZiAodm0uZGVmYXVsdE9wdGlvbnMuc2VhcmNoT25Jbml0KSB2bS5zZWFyY2goKTtcbiAgICB9XG5cbiAgICAvKipcclxuICAgICAqIERvIGEgc2VhcmNoXHJcbiAgICAgKiBDaGVja3Mgd2hpY2ggb2YgdGhlIHNlYXJjaCBmdW5jdGlvbnMgbXVzdCBiZSB1c2VkXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHthbnl9IHBhZ2UgcGFnZSB0aGF0IG11c3QgYmUgcmVxdWVzdGVkXHJcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzZWFyY2gocGFnZSkge1xuICAgICAgdm0uZGVmYXVsdE9wdGlvbnMuc2tpcFBhZ2luYXRpb24gPyBub3JtYWxTZWFyY2goKSA6IHBhZ2luYXRlU2VhcmNoKHBhZ2UpO1xuICAgIH1cblxuICAgIC8qKlxyXG4gICAgICogRG8gYSBwYWdlZCBzZWFyY2ggd2l0aCB0aGUgYXBwbGllZCBmaWx0ZXJzXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHthbnl9IHBhZ2UgcGFnZSB0aGF0IG11c3QgYmUgcmVxdWVzdGVkXHJcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBwYWdpbmF0ZVNlYXJjaChwYWdlKSB7XG4gICAgICB2bS5wYWdpbmF0b3IuY3VycmVudFBhZ2UgPSBhbmd1bGFyLmlzRGVmaW5lZChwYWdlKSA/IHBhZ2UgOiAxO1xuICAgICAgdm0uZGVmYXVsdFF1ZXJ5RmlsdGVycyA9IHtcbiAgICAgICAgcGFnZTogdm0ucGFnaW5hdG9yLmN1cnJlbnRQYWdlLFxuICAgICAgICBwZXJQYWdlOiB2bS5wYWdpbmF0b3IucGVyUGFnZVxuICAgICAgfTtcblxuICAgICAgaWYgKGFuZ3VsYXIuaXNGdW5jdGlvbih2bS5hcHBseUZpbHRlcnMpKSB7XG4gICAgICAgIHZtLmRlZmF1bHRRdWVyeUZpbHRlcnMgPSB2bS5hcHBseUZpbHRlcnModm0uZGVmYXVsdFF1ZXJ5RmlsdGVycyk7XG4gICAgICB9XG4gICAgICBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKHZtLmJlZm9yZVNlYXJjaCkgJiYgdm0uYmVmb3JlU2VhcmNoKHBhZ2UpID09PSBmYWxzZSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICBtb2RlbFNlcnZpY2UucGFnaW5hdGUodm0uZGVmYXVsdFF1ZXJ5RmlsdGVycykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgdm0ucGFnaW5hdG9yLmNhbGNOdW1iZXJPZlBhZ2VzKHJlc3BvbnNlLnRvdGFsKTtcbiAgICAgICAgdm0ucmVzb3VyY2VzID0gcmVzcG9uc2UuaXRlbXM7XG5cbiAgICAgICAgaWYgKGFuZ3VsYXIuaXNGdW5jdGlvbih2bS5hZnRlclNlYXJjaCkpIHZtLmFmdGVyU2VhcmNoKHJlc3BvbnNlKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxyXG4gICAgICogRG8gYSBzZWFyY2ggd2l0aCB0aGUgYXBwbGllZCBmaWx0ZXJzXHJcbiAgICAgKlxyXG4gICAgICovXG4gICAgZnVuY3Rpb24gbm9ybWFsU2VhcmNoKCkge1xuICAgICAgdm0uZGVmYXVsdFF1ZXJ5RmlsdGVycyA9IHt9O1xuXG4gICAgICBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKHZtLmFwcGx5RmlsdGVycykpIHZtLmRlZmF1bHRRdWVyeUZpbHRlcnMgPSB2bS5hcHBseUZpbHRlcnModm0uZGVmYXVsdFF1ZXJ5RmlsdGVycyk7XG4gICAgICBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKHZtLmJlZm9yZVNlYXJjaCkgJiYgdm0uYmVmb3JlU2VhcmNoKCkgPT09IGZhbHNlKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgIG1vZGVsU2VydmljZS5xdWVyeSh2bS5kZWZhdWx0UXVlcnlGaWx0ZXJzKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICB2bS5yZXNvdXJjZXMgPSByZXNwb25zZTtcblxuICAgICAgICBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKHZtLmFmdGVyU2VhcmNoKSkgdm0uYWZ0ZXJTZWFyY2gocmVzcG9uc2UpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBDbGVhciB0aGUgZm9ybVxyXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2xlYW5Gb3JtKGZvcm0pIHtcbiAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24odm0uYmVmb3JlQ2xlYW4pICYmIHZtLmJlZm9yZUNsZWFuKCkgPT09IGZhbHNlKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgIHZtLnJlc291cmNlID0gbmV3IG1vZGVsU2VydmljZSgpO1xuXG4gICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQoZm9ybSkpIHtcbiAgICAgICAgZm9ybS4kc2V0UHJpc3RpbmUoKTtcbiAgICAgICAgZm9ybS4kc2V0VW50b3VjaGVkKCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24odm0uYWZ0ZXJDbGVhbikpIHZtLmFmdGVyQ2xlYW4oKTtcbiAgICB9XG5cbiAgICAvKipcclxuICAgICAqIExvYWQgdGhlIHNlbGVjdGVkIHJlc291cmNlIGluIHRoZSBmb3JtXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHthbnl9IHJlc291cmNlIHNlbGVjdGVkIHJlc291cmNlXHJcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBlZGl0KHJlc291cmNlKSB7XG4gICAgICB2bS5nb1RvKCdmb3JtJyk7XG4gICAgICB2bS5yZXNvdXJjZSA9IG5ldyBhbmd1bGFyLmNvcHkocmVzb3VyY2UpO1xuXG4gICAgICBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKHZtLmFmdGVyRWRpdCkpIHZtLmFmdGVyRWRpdCgpO1xuICAgIH1cblxuICAgIC8qKlxyXG4gICAgICogU2F2ZSBvciB1cGRhdGUgdGhlIHJlc291cmNlXHJcbiAgICAgKiBJbiB0aGUgZGVmYXVsdCBiZWhhdmlvciwgcmVkaXJlY3QgdGhlIHVzZXIgdG8gdGhlIGxpc3QgdmlldyBhZnRlciBzYXZpbmdcclxuICAgICAqXHJcbiAgICAgKiBAcmV0dXJuc1xyXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2F2ZShmb3JtKSB7XG4gICAgICBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKHZtLmJlZm9yZVNhdmUpICYmIHZtLmJlZm9yZVNhdmUoKSA9PT0gZmFsc2UpIHJldHVybiBmYWxzZTtcblxuICAgICAgLy8gY29uc29sZS5sb2codm0ucmVzb3VyY2UpXG5cbiAgICAgIHZtLnJlc291cmNlLiRzYXZlKCkudGhlbihmdW5jdGlvbiAocmVzb3VyY2UpIHtcbiAgICAgICAgLy92bS5yZXNvdXJjZSA9IHJlc291cmNlO1xuXG4gICAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24odm0uYWZ0ZXJTYXZlKSkgdm0uYWZ0ZXJTYXZlKHJlc291cmNlKTtcblxuICAgICAgICBpZiAodm0uZGVmYXVsdE9wdGlvbnMucmVkaXJlY3RBZnRlclNhdmUpIHtcbiAgICAgICAgICB2bS5jbGVhbkZvcm0oZm9ybSk7XG4gICAgICAgICAgdm0uc2VhcmNoKHZtLnBhZ2luYXRvci5jdXJyZW50UGFnZSk7XG4gICAgICAgICAgdm0uZ29UbygnbGlzdCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgQzJUb2FzdC5zdWNjZXNzKCR0cmFuc2xhdGUuaW5zdGFudCgnbWVzc2FnZXMuc2F2ZVN1Y2Nlc3MnKSk7XG4gICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2VEYXRhKSB7XG4gICAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24odm0ub25TYXZlRXJyb3IpKSB2bS5vblNhdmVFcnJvcihyZXNwb25zZURhdGEpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gLyoqXG4gICAgLy8gICogU2F2ZSB2ZWN0b3IgR2VvSlNPTiBkYXRhXG4gICAgLy8gICogXG4gICAgLy8gICogQHJldHVybnNcbiAgICAvLyAgKi9cbiAgICAvLyBmdW5jdGlvbiBzYXZlZ2VvanNvbihkYXRhKXtcbiAgICAvLyAgIGRhdGEgPSBcInthZHNzZH1cIlxuICAgIC8vICAgdm0ucmVzb3VyY2UuZ2Vvc2pvbmRhdGEgPSBkYXRhXG4gICAgLy8gICBjb25zb2xlLmxvZyh2bS5yZXNvdXJjZSlcbiAgICAvLyAgIC8vIHZtLnJlc291cmNlLiRzYXZlKCkudGhlbihmdW5jdGlvbiAocmVzb3VyY2UpIHtcbiAgICAvLyAgIC8vICAgLy8gdm0ucmVzb3VyY2UgPSByZXNvdXJjZTtcblxuICAgIC8vICAgLy8gICAvLyBjb25zb2xlLmxvZyhcInJlc291cmNlXCIpXG5cbiAgICAvLyAgIC8vIH0sIGZ1bmN0aW9uIChyZXNwb25zZURhdGEpIHtcbiAgICAvLyAgIC8vICAgLy8gY29uc29sZS5sb2coXCJyZXNwb25zZURhdGFcIik7XG4gICAgLy8gICAvLyB9KTtcbiAgICAvLyB9XG5cbiAgICAvKipcclxuICAgICAqIFJldHJpZXZlIHZlY3RvciBHZW9KU09OIGRhdGFcclxuICAgICAqIFxyXG4gICAgICogQHJldHVybnNcclxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJldHJpZXZlZ2VvanNvbihwYXJhbXMpIHtcbiAgICAgIGNvbnNvbGUubG9nKHBhcmFtcyk7XG4gICAgfVxuXG4gICAgLyoqXHJcbiAgICAgKiBSZW1vdmUgdGhlIHJlc291cmNlLCBidXQgYmVmb3JlIHNob3cgYSBkaWFsb2cgdG8gY29uZmlybSAgICAgXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHthbnl9IHJlc291cmNlIHJlc291cmNlIHNlbGVjdGVkXHJcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZW1vdmUocmVzb3VyY2UpIHtcbiAgICAgIHZhciBjb25maWcgPSB7XG4gICAgICAgIHRpdGxlOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2RpYWxvZy5jb25maXJtVGl0bGUnKSxcbiAgICAgICAgZGVzY3JpcHRpb246ICR0cmFuc2xhdGUuaW5zdGFudCgnZGlhbG9nLmNvbmZpcm1EZXNjcmlwdGlvbicpLFxuICAgICAgICB5ZXM6ICR0cmFuc2xhdGUuaW5zdGFudCgnZ2xvYmFsLnllcycpLFxuICAgICAgICBubzogJHRyYW5zbGF0ZS5pbnN0YW50KCdnbG9iYWwubm8nKVxuICAgICAgfTtcblxuICAgICAgQzJEaWFsb2cuY29uZmlybShjb25maWcpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKHZtLmJlZm9yZVJlbW92ZSkgJiYgdm0uYmVmb3JlUmVtb3ZlKHJlc291cmNlKSA9PT0gZmFsc2UpIHJldHVybiBmYWxzZTtcblxuICAgICAgICByZXNvdXJjZS4kZGVzdHJveSgpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24odm0uYWZ0ZXJSZW1vdmUpKSB2bS5hZnRlclJlbW92ZShyZXNvdXJjZSk7XG5cbiAgICAgICAgICB2bS5zZWFyY2goKTtcbiAgICAgICAgICBDMlRvYXN0LmluZm8oJHRyYW5zbGF0ZS5pbnN0YW50KCdtZXNzYWdlcy5yZW1vdmVTdWNjZXNzJykpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxyXG4gICAgICogU3dpdGNoIGJldHdlZW4gdGhlIGxpc3QgYW5kIGZvcm0gbW9kZVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7YW55fSB2aWV3TmFtZSB2aWV3IG5hbWUgdG8gd2l0Y2ggdG9cclxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdvVG8odmlld05hbWUpIHtcbiAgICAgIHZtLnZpZXdGb3JtID0gZmFsc2U7XG5cbiAgICAgIGlmICh2aWV3TmFtZSA9PT0gJ2Zvcm0nKSB7XG4gICAgICAgIHZtLmNsZWFuRm9ybSgpO1xuICAgICAgICB2bS52aWV3Rm9ybSA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29udHJvbGxlcignR2VvcmVmZXJlbmNlQ29udHJvbGxlcicsIEdlb3JlZmVyZW5jZUNvbnRyb2xsZXIpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgZnVuY3Rpb24gR2VvcmVmZXJlbmNlQ29udHJvbGxlcigkY29udHJvbGxlciwgJHNjb3BlLCBNYXBNYXJrZXJTZXJ2aWNlLCBsZWFmbGV0TWFya2VyRXZlbnRzLCAkcm9vdFNjb3BlLCBNYXBWaWV3ZXJTZXJ2aWNlLCAkdHJhbnNsYXRlLCBDMkRpYWxvZywgJG1kQ29sb3JzLCAkbWRTaWRlbmF2LCBHbG9iYWwsICR0aW1lb3V0LCBsb2Rhc2gpIHtcbiAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgLy8gRnVuY3Rpb25zIEJsb2NrICAgICBcbiAgICB2bS5vblZpZXdlckFjdGl2YXRlID0gb25WaWV3ZXJBY3RpdmF0ZTtcbiAgICB2bS50b2dnbGVDcmVhdGVNYXJrZXIgPSB0b2dnbGVDcmVhdGVNYXJrZXI7XG4gICAgdm0uYmVmb3JlVmlld2VyQWN0aXZhdGUgPSBiZWZvcmVWaWV3ZXJBY3RpdmF0ZTtcbiAgICB2bS50b2dnbGVSZW1vdmVNYXJrZXIgPSB0b2dnbGVSZW1vdmVNYXJrZXI7XG4gICAgdm0ub3BlblNhdmVHZW9SZWYgPSBvcGVuU2F2ZUdlb1JlZjtcbiAgICB2bS52YWxpZEdDUCA9IHZhbGlkR0NQO1xuICAgIHZtLm51bU9mR0NQID0gbnVtT2ZHQ1A7XG4gICAgdm0ucmVkcmF3TWFya2VycyA9IHJlZHJhd01hcmtlcnM7XG5cbiAgICAvLyBTZXQgdGhlIG1hcCB2aWV3ZXIgb3B0aW9uc1xuICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgc3VwcG9ydExpc3RpbmdWaWV3OiBmYWxzZSxcbiAgICAgIHN1cHBvcnREcmF3aW5nOiBmYWxzZSxcbiAgICAgIHRpdGxlVHJhbnNsS2V5OiAndmlld3MudGl0bGVzLm1hcEdlb3JlZmVyZW5jaW5nJyxcbiAgICAgIHNob3dHZW9SZWZUb29sczogdHJ1ZSxcbiAgICAgIGxlZnRTaWRlQmFyOiBHbG9iYWwuY2xpZW50UGF0aCArICcvZ2VvcmVmZXJlbmNlL25hdnMvZ2VvLWxlZnQtc2lkZW5hdi5odG1sJyxcbiAgICAgIHNob3dHY3BUYWJsZTogdHJ1ZSxcbiAgICAgIGdjcFRhYmxlOiBHbG9iYWwuY2xpZW50UGF0aCArICcvZ2VvcmVmZXJlbmNlL25hdnMvZ2NwLVRhYmxlLmh0bWwnXG4gICAgfTtcblxuICAgIC8vIGluaXRpYWxpemUgZW1wdHkgbWFya2VycyBvYmplY3RcbiAgICB2bS5yaWdodE1hcmtlcnMgPSB7fTtcbiAgICB2bS5sZWZ0TWFya2VycyA9IHt9O1xuXG4gICAgLy8gaW5zdGFudGlhdGUgdGhlIGJhc2UgTWFwVmlld2VyQ29udHJvbGxlclxuICAgICRjb250cm9sbGVyKCdNYXBWaWV3ZXJDb250cm9sbGVyJywgeyB2bTogdm0sICRzY29wZTogJHNjb3BlLCBvcHRpb25zOiBvcHRpb25zIH0pO1xuXG4gICAgLy8gTGlzdGVuIHRvIHRoZSByaWdodE1hcFZpZXdlciBkcmFnZW5kXG4gICAgJHJvb3RTY29wZS4kb24oJ2xlYWZsZXREaXJlY3RpdmVNYXJrZXIucmlnaHRNYXBWaWV3ZXIuZHJhZ2VuZCcsIGZ1bmN0aW9uIChldmVudCwgYXJncykge1xuICAgICAgaWYgKHZtLnJpZ2h0Q3JlYXRlTWFya2VyRW5hYmxlID09PSB0cnVlKSB7XG4gICAgICAgIC8vIGRvaW5nIG5vdGhpbmcgZm9yIGEgd2hpbGVcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIExpc3RlbiB0byB0aGUgcmlnaHRNYXBWaWV3ZXIgY2xpY2sgYW5kIHJlbW92ZSB0aGUgbWFya2VyIGlmIHRoZSByZW1vdmFsIHRvb2wgaXMgZW5hYmxlZFxuICAgICRyb290U2NvcGUuJG9uKCdsZWFmbGV0RGlyZWN0aXZlTWFya2VyLnJpZ2h0TWFwVmlld2VyLmNsaWNrJywgZnVuY3Rpb24gKGV2ZW50LCBhcmdzKSB7XG4gICAgICBpZiAodm0ucmlnaHRSZW1vdmVNYXJrZXJFbmFibGUgPT09IHRydWUpIHtcbiAgICAgICAgdmFyIGlkID0gYXJncy5tb2RlbC5pZDtcbiAgICAgICAgcmVtb3ZlTWFya2VyKGlkKTtcbiAgICAgICAgLy8gY2FsbCBhbiBldmVudCB0byBkZWxldGUgaXQgZnJvbSBHQ1AgVGFibGVcbiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KFwiZGVsZXRlR2NwRnJvbVRhYmxlRXZlbnRcIiwgaWQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZW5zdXJlIHRoZSBldmVudCBpcyBmaXJlZCBmcm9tIEdDUCBUYWJsZSBkZWxldGUgYnV0dG9uXG4gICAgICAgIGlmIChhcmdzLm1vZGVsLmV2ZW50RnJvbSA9PT0gXCJnY3BUYWJsZVwiKSB7XG4gICAgICAgICAgdmFyIGlkID0gYXJncy5tb2RlbC5pZDtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhpZClcbiAgICAgICAgICByZW1vdmVNYXJrZXIoaWQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBMaXN0ZW4gdG8gdGhlIGxlZnRNYXBWaWV3ZXIgY2xpY2sgYW5kIHJlbW92ZSB0aGUgbWFya2VyIGlmIHRoZSByZW1vdmFsIHRvb2wgaXMgZW5hYmxlZFxuICAgICRyb290U2NvcGUuJG9uKCdsZWFmbGV0RGlyZWN0aXZlTWFya2VyLmxlZnRNYXBWaWV3ZXIuY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQsIGFyZ3MpIHtcbiAgICAgIGlmICh2bS5sZWZ0UmVtb3ZlTWFya2VyRW5hYmxlID09PSB0cnVlKSB7XG4gICAgICAgIHZhciBpZCA9IGFyZ3MubW9kZWwuaWQ7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGlkKVxuICAgICAgICByZW1vdmVNYXJrZXIoaWQpO1xuICAgICAgICAvLyBjYWxsIGFuIGV2ZW50IHRvIGRlbGV0ZSBpdCBmcm9tIEdDUCBUYWJsZVxuICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoXCJkZWxldGVHY3BGcm9tVGFibGVFdmVudFwiLCBpZCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBlbnN1cmUgdGhlIGV2ZW50IGlzIGZpcmVkIGZyb20gR0NQIFRhYmxlIGRlbGV0ZSBidXR0b25cbiAgICAgICAgaWYgKGFyZ3MubW9kZWwuZXZlbnRGcm9tID09PSBcImdjcFRhYmxlXCIpIHtcbiAgICAgICAgICB2YXIgaWQgPSBhcmdzLm1vZGVsLmlkO1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGlkKVxuICAgICAgICAgIHJlbW92ZU1hcmtlcihpZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIExpc3RlbiB0byB0aGUgcmlnaHRNYXBWaWV3ZXIgY2xpY2sgYW5kIGFkZCBhIG1hcmtlciBvbiB0aGUgY2xpY2tlZCBwb3NpdGlvblxuICAgIC8vIGlmIHRoZSBtYXJrZXIgY3JlYXRpb24gdG9vbCBpcyBlbmFibGVkXG4gICAgJHJvb3RTY29wZS4kb24oXCJsZWFmbGV0RGlyZWN0aXZlTWFwLnJpZ2h0TWFwVmlld2VyLmNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCwgYXJncykge1xuICAgICAgaWYgKHZtLnJpZ2h0Q3JlYXRlTWFya2VyRW5hYmxlID09PSB0cnVlKSB7XG4gICAgICAgIGFkZE1hcmtlcihhcmdzLmxlYWZsZXRFdmVudCwgJ3JpZ2h0TWFya2VycycpO1xuICAgICAgICAvLyBlbnN1cmUgYm90aCB0aGUgbWFwcyBoYXZlIGVxdWFsIG51bWJlciBvZiBtYXJrZXJzXG4gICAgICAgIGlmIChsb2Rhc2guc2l6ZSh2bVsnbGVmdE1hcmtlcnMnXSkgPT09IF8uc2l6ZSh2bVsncmlnaHRNYXJrZXJzJ10pKSB7XG4gICAgICAgICAgLy8gZmlyZSBldmVudCB0byBHQ1AgY29udHJvbGxlciBmb3IgY2FxbGwgcmVmcmVzaEdDUFRhYmxlXG4gICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KFwicmVmcmVzaEdjcFRhYmxlRXZlbnRcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIExpc3RlbiB0byB0aGUgbGVmdE1hcFZpZXdlciBjbGljayBhbmQgYWRkIGEgbWFya2VyIG9uIHRoZSBjbGlja2VkIHBvc2l0aW9uXG4gICAgLy8gaWYgdGhlIG1hcmtlciBjcmVhdGlvbiB0b29sIGlzIGVuYWJsZWRcbiAgICAkcm9vdFNjb3BlLiRvbihcImxlYWZsZXREaXJlY3RpdmVNYXAubGVmdE1hcFZpZXdlci5jbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQsIGFyZ3MpIHtcbiAgICAgIGlmICh2bS5sZWZ0Q3JlYXRlTWFya2VyRW5hYmxlID09PSB0cnVlKSB7XG4gICAgICAgIGFkZE1hcmtlcihhcmdzLmxlYWZsZXRFdmVudCwgJ2xlZnRNYXJrZXJzJyk7XG4gICAgICAgIC8vIGVuc3VyZSBib3RoIHRoZSBtYXBzIGhhdmUgZXF1YWwgbnVtYmVyIG9mIG1hcmtlcnNcbiAgICAgICAgaWYgKF8uc2l6ZSh2bVsnbGVmdE1hcmtlcnMnXSkgPT09IF8uc2l6ZSh2bVsncmlnaHRNYXJrZXJzJ10pKSB7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coXCJtYXJrZXIgc2l5ZSBlcXVhbCBvbiBib3RoIG1hcHNcIik7XG4gICAgICAgICAgLy8gZmlyZSBldmVudCB0byBHQ1AgY29udHJvbGxlciBmb3IgY2FxbGwgcmVmcmVzaEdDUFRhYmxlXG4gICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KFwicmVmcmVzaEdjcFRhYmxlRXZlbnRcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIExpc3RlbiB0byB0aGUgcmlnaHRNYXBWaWV3ZXIgY2xpY2sgYW5kIGFkZCBhIG1hcmtlciBvbiB0aGUgY2xpY2tlZCBwb3NpdGlvblxuICAgIC8vIGlmIHRoZSBtYXJrZXIgY3JlYXRpb24gdG9vbCBpcyBlbmFibGVkXG4gICAgJHJvb3RTY29wZS4kb24oXCJjcmVhdGVNYXJrZXJGb3JUYWJsZVwiLCBmdW5jdGlvbiAoZXZlbnQsIGFyZ3MpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IGdlb3JlZmVyZW5jZS5jb250cm9sbGVyID4+PiBjcmVhdGVNYXJrZXJGb3JUYWJsZSBcIiwgYXJncyk7XG4gICAgICBpZiAoYXJncy5tYXJrZXJzS2VlcGVyID09PSBcImxlZnRNYXJrZXJzXCIpIHtcbiAgICAgICAgYWRkTWFya2VyKGFyZ3MsICdsZWZ0TWFya2VycycpO1xuICAgICAgfVxuICAgICAgaWYgKGFyZ3MubWFya2Vyc0tlZXBlciA9PT0gXCJyaWdodE1hcmtlcnNcIikge1xuICAgICAgICBhZGRNYXJrZXIoYXJncywgJ3JpZ2h0TWFya2VycycpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gTGlzdGVuIHRvIHRoZSBkaXNhYmxlIG1hcmtlciBjcmVhdGlvbiBcbiAgICAkcm9vdFNjb3BlLiRvbihcInRvZ2dsZU1hcmtlckNyZWF0aW9uXCIsIGZ1bmN0aW9uIChldmVudCwgYXJncykge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gZ2VvcmVmZXJlbmNlLmNvbnRyb2xsZXIgPj4+IHRvZ2dsZU1hcmtlckNyZWF0aW9uIFwiLCBhcmdzKTtcbiAgICAgIHZhciBtYXJrZXJzS2VlcGVyID0gYXJncy5tYXJrZXJzS2VlcGVyOyAvLyAnbGVmdE1hcFZpZXdlcidcbiAgICAgIHRvZ2dsZUNyZWF0ZU1hcmtlcihtYXJrZXJzS2VlcGVyKTtcbiAgICB9KTtcblxuICAgIC8vIExpc3RlbiB0byBjcmVhdGUgbWFya2VycyBvbiBtYXAgYmFzZWQgb24gR0NQIHBvc2l0aW9uc1xuICAgICRyb290U2NvcGUuJG9uKFwiY3JlYXRlR2NwT25NYXBcIiwgZnVuY3Rpb24gKGV2ZW50LCBhcmdzKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBnZW9yZWZlcmVuY2UuY29udHJvbGxlciA+Pj4gY3JlYXRlR2NwT25NYXAgXCIsIGFyZ3MpO1xuXG4gICAgICBsb2Rhc2guZm9yRWFjaChhcmdzLCBmdW5jdGlvbiAocG9zaXRpb24pIHtcbiAgICAgICAgdmFyIHByZXBhcmVkTWFya2VyRGF0YSA9IHByZXBhcmVEYXRhRm9yQWRkTWFya2VyKHBvc2l0aW9uKTtcbiAgICAgICAgYWRkTWFya2VyKHByZXBhcmVkTWFya2VyRGF0YS5pbWFnZVBvc2l0aW9uLCAnbGVmdE1hcmtlcnMnKTtcblxuICAgICAgICAvLyBkZWxheSBpcyBhZGRlZCBvdGhlcndpc2Ugb25seSBvbmUgb2YgdGhlIG1hcCBoYXMgbWFya2VycyBvbiBpdFxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBhZGRNYXJrZXIocHJlcGFyZWRNYXJrZXJEYXRhLm1hcFBvc2l0aW9uLCAncmlnaHRNYXJrZXJzJyk7XG4gICAgICAgIH0sIDEwKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogQWRkIGEgbWFya2VyIG9uIGEgZ2l2ZW4gbWFya2VycyBrZWVwZXIgb2JqZWN0XG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IGxlYWZFdmVudCBcbiAgICAgKiBAcGFyYW0ge2FueX0gbWFya2Vyc0tlZXBlciBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhZGRNYXJrZXIobGVhZkV2ZW50LCBtYXJrZXJzS2VlcGVyKSB7XG4gICAgICB2YXIgbWFya2VyRGF0YSA9IHtcbiAgICAgICAgbGF0OiBsZWFmRXZlbnQubGF0bG5nLmxhdCxcbiAgICAgICAgbG5nOiBsZWFmRXZlbnQubGF0bG5nLmxuZyxcbiAgICAgICAgZm9jdXM6IHRydWVcbiAgICAgIH07XG5cbiAgICAgIHZhciBuZXdNYXJrZXIgPSBNYXBNYXJrZXJTZXJ2aWNlLmJ1aWxkTWFya2VyKHZtW21hcmtlcnNLZWVwZXJdLCBtYXJrZXJEYXRhKTtcbiAgICAgIHZtW21hcmtlcnNLZWVwZXJdW25ld01hcmtlci5pZF0gPSBuZXdNYXJrZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGEgZ2l2ZW4gbWFya2VyIGlkIGZyb20gYm90IHZpZXdlcnNcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gbWFya2VySWQgXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmVtb3ZlTWFya2VyKG1hcmtlcklkKSB7XG4gICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQodm0ubGVmdE1hcmtlcnNbbWFya2VySWRdKSkge1xuICAgICAgICAvLyB2YXIgdGVtcE1hcmtlcklkID0gdm0ubGVmdE1hcmtlcnNbbWFya2VySWRdLmljb24uY2xhc3NOYW1lLnNwbGl0KFwiIFwiKVsxXTtcbiAgICAgICAgZGVsZXRlIHZtLmxlZnRNYXJrZXJzW21hcmtlcklkXTtcbiAgICAgICAgLy8gcmVkcmF3TWFya2Vycyh2bS5sZWZ0TWFya2VycywgdGVtcE1hcmtlcklkKTtcbiAgICAgIH1cbiAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZCh2bS5yaWdodE1hcmtlcnNbbWFya2VySWRdKSkge1xuICAgICAgICB2YXIgdGVtcE1hcmtlcklkID0gdm0ucmlnaHRNYXJrZXJzW21hcmtlcklkXS5pY29uLmNsYXNzTmFtZS5zcGxpdChcIiBcIilbMV07XG4gICAgICAgIC8vIGFkZGVkIGEgdGltZW91dCBvdGhlciB3aXNlLCBhZnRlciBkZWxldGluZyBtYXJrZXIgb24gbGVmdHNpZGUgbWFwIGFuZCB0aGVuIGNyZWF0aW5nIGEgXG4gICAgICAgIC8vIG1hcmtlciBvbiByaWdodHNpZGUgd2FzIG5vdCBpbi1zeW5jXG4gICAgICAgIC8vIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBkZWxldGUgdm0ucmlnaHRNYXJrZXJzW21hcmtlcklkXTtcbiAgICAgICAgLy8gICByZWRyYXdNYXJrZXJzKHZtLnJpZ2h0TWFya2VycywgdGVtcE1hcmtlcklkKTsgICAgXG4gICAgICAgIC8vIH0sIDEwKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWRyYXcvdXBkYXRlcyBhIGdpdmVuIG1hcCAobWFya2Vyc2tlZXBlciAtIG9iamVjdCkgYWxsIHRoZSBtYXJrZXJzIFxuICAgICAqIGV4Y2VwdCB0aGUgZGVsZXRlZCBvbmVcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gbWFya2Vyc0tlZXBlciBcbiAgICAgKiBAcGFyYW0ge2FueX0gZGVsZXRlZE1hcmtlcklkIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlZHJhd01hcmtlcnMobWFya2Vyc0tlZXBlciwgZGVsZXRlZE1hcmtlcklkKSB7XG5cbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+Z2VvcmVmZXJlbmNlQ29udHJvbGxsZXIgPj4+IHJlZHJhd01hcmtlcnMgXCIsIG1hcmtlcnNLZWVwZXIsIGRlbGV0ZWRNYXJrZXJJZFsxXSk7XG4gICAgICBfLmZvck93bihtYXJrZXJzS2VlcGVyLCBmdW5jdGlvbiAobWFya2VyLCBrZXkpIHtcbiAgICAgICAgdmFyIHRlbXBJZE51bSA9IG1hcmtlci5pY29uLmNsYXNzTmFtZS5zcGxpdChcIiBcIilbMV1bMV07XG4gICAgICAgIGlmICh0ZW1wSWROdW0gPiBkZWxldGVkTWFya2VySWRbMV0pIHtcbiAgICAgICAgICB2YXIgbmV3TWFya2VyTm8gPSB0ZW1wSWROdW0gLSAxO1xuICAgICAgICAgIC8vIHVpIGNoYW5nZXMgb2YgbWFya2VyIGljb25cbiAgICAgICAgICBtYXJrZXIuaWNvbi5odG1sID0gXCI8ZGl2IGNsYXNzPVxcXCJtay1pY29uLWNvbnRhaW5lciBtay1va1xcXCI+XCIgKyBuZXdNYXJrZXJObyArIFwiPC9kaXY+XCI7XG4gICAgICAgICAgbWFya2VyLmljb24uY2xhc3NOYW1lID0gXCJtay1kaXYtaWNvbiBtXCIgKyBuZXdNYXJrZXJObztcblxuICAgICAgICAgIC8vIGNoYW5nZSB0aGUgb2xkIGtleSBvZiB0aGUgbWFya2VyIHdpdGggbmV3IG9uZSwgb3RoZXJ3aXNlIHRoZSBuZXdseSBjcmVhdGVkIG1hcmtlcidzIG51bWJlcmluZyBcbiAgICAgICAgICAvLyB3aWxsIG5vdCBiZSBpbiBzeW5jXG4gICAgICAgICAgdmFyIG9sZEtleSA9IGtleTtcbiAgICAgICAgICB2YXIgbmV3S2V5ID0gXCJtXCIgKyBuZXdNYXJrZXJObztcbiAgICAgICAgICBpZiAob2xkS2V5ICE9PSBuZXdLZXkpIHtcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtYXJrZXJzS2VlcGVyLCBuZXdLZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobWFya2Vyc0tlZXBlciwgb2xkS2V5KSk7XG4gICAgICAgICAgICBkZWxldGUgbWFya2Vyc0tlZXBlcltvbGRLZXldO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIm1hcmtlciA9IFwiLCBtYXJrZXIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBY3Rpb25zIGV4ZWN1dGVkIGJlZm9yZSB0aGUgYmFzZSB2aWV3ZXIgaXMgYWN0aXZhdGVkXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmVmb3JlVmlld2VyQWN0aXZhdGUoKSB7XG5cbiAgICAgIC8vIGFjdGl2YXRlIHRoZSBldmVudCBsaXN0ZW5pbmcgZm9yIHJpZ2h0IHZpZXdlciBhbmQgcmlnaHQgbWFya2VyIGV2ZW50c1xuICAgICAgdm0ucmlnaHRWaWV3ZXJFdmVudHMgPSB7XG4gICAgICAgIG1hcmtlcnM6IHtcbiAgICAgICAgICBlbmFibGU6IGxlYWZsZXRNYXJrZXJFdmVudHMuZ2V0QXZhaWxhYmxlRXZlbnRzKClcbiAgICAgICAgfSxcbiAgICAgICAgbWFwOiB7XG4gICAgICAgICAgZW5hYmxlOiBbJ2RyYWdlbmQnLCAnZHJhZycsICdjbGljaycsICdtb3VzZW1vdmUnXVxuICAgICAgICAgIC8vbG9naWM6ICdlbWl0J1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgLy8gYWN0aXZhdGUgdGhlIGV2ZW50IGxpc3RlbmluZyBmb3IgbGVmdCB2aWV3ZXIgYW5kIGxlZnQgbWFya2VyIGV2ZW50c1xuICAgICAgdm0ubGVmdFZpZXdlckV2ZW50cyA9IHtcbiAgICAgICAgbWFya2Vyczoge1xuICAgICAgICAgIGVuYWJsZTogbGVhZmxldE1hcmtlckV2ZW50cy5nZXRBdmFpbGFibGVFdmVudHMoKVxuICAgICAgICB9LFxuICAgICAgICBtYXA6IHtcbiAgICAgICAgICBlbmFibGU6IFsnZHJhZ2VuZCcsICdkcmFnJywgJ2NsaWNrJywgJ21vdXNlbW92ZSddXG4gICAgICAgICAgLy9sb2dpYzogJ2VtaXQnXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWN0aW9ucyBleGVjdXRlZCBhZnRlciB0aGUgYmFzZSB2aWV3ZXIgaXMgYWN0aXZhdGVkXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gb25WaWV3ZXJBY3RpdmF0ZSgpIHtcbiAgICAgIC8vIFNldCBnbG9iYWwgdmlld2VyIG9wdGlvbnNcbiAgICAgIC8vIGNoYW5nZWQgZm9yIHJlc29sdmluZyAjMTg0IFxuICAgICAgLy8gTWFwVmlld2VyU2VydmljZS5zZXRPcHRpb24oJ3JpZ2h0TWFwVmlld2VyJywgJ3Nob3dMb2FkTWFwSW5SaWdodCcsIGZhbHNlKTtcbiAgICAgIE1hcFZpZXdlclNlcnZpY2Uuc2V0T3B0aW9uKCdyaWdodE1hcFZpZXdlcicsICdzaG93TG9hZE1hcEluUmlnaHQnLCB0cnVlKTtcbiAgICAgIE1hcFZpZXdlclNlcnZpY2Uuc2V0T3B0aW9uKCdsZWZ0TWFwVmlld2VyJywgJ3Nob3dMb2FkTWFwSW5SaWdodCcsIHRydWUpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVuYWJsZS9kaXNhYmxlIHRoZSBtYXJrZXIgY3JlYXRpb25cbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gdmlld2VySWQgXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9nZ2xlQ3JlYXRlTWFya2VyKHZpZXdlcklkKSB7XG4gICAgICBpZiAodmlld2VySWQgPT09ICdyaWdodE1hcFZpZXdlcicpIHtcbiAgICAgICAgdm0ucmlnaHRDcmVhdGVNYXJrZXJFbmFibGUgPSAhdm0ucmlnaHRDcmVhdGVNYXJrZXJFbmFibGU7XG5cbiAgICAgICAgLy8gaXQgaXMgbm90IHBvc3NpYmxlIHRvIGhhdmUgcmVtb3ZhbCBhbmQgY3JlYXRlIHRvb2wgZW5hYmxlZCBhdCB0aGUgc2FtZSB0aW1lXG4gICAgICAgIC8vIHNvLCBpZiB0aGUgcmVtb3ZhbCBhbmQgY3JlYXRlIHRvb2wgYXJlIGVuYWJsZWQsIHRoZSByaWdodCByZW1vdmFsIHRvb2wgaXMgZGlzYWJsZWRcbiAgICAgICAgaWYgKHZtLnJpZ2h0Q3JlYXRlTWFya2VyRW5hYmxlID09PSB0cnVlICYmIHZtLnJpZ2h0UmVtb3ZlTWFya2VyRW5hYmxlID09PSB0cnVlKSB7XG4gICAgICAgICAgdm0ucmlnaHRSZW1vdmVNYXJrZXJFbmFibGUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdm0ubGVmdENyZWF0ZU1hcmtlckVuYWJsZSA9ICF2bS5sZWZ0Q3JlYXRlTWFya2VyRW5hYmxlO1xuXG4gICAgICAgIC8vIGl0IGlzIG5vdCBwb3NzaWJsZSB0byBoYXZlIHJlbW92YWwgYW5kIGNyZWF0ZSB0b29sIGVuYWJsZWQgYXQgdGhlIHNhbWUgdGltZVxuICAgICAgICAvLyBzbywgaWYgdGhlIHJlbW92YWwgYW5kIGNyZWF0ZSB0b29sIGFyZSBlbmFibGVkLCB0aGUgbGVmdCByZW1vdmFsIHRvb2wgaXMgZGlzYWJsZWRcbiAgICAgICAgaWYgKHZtLmxlZnRDcmVhdGVNYXJrZXJFbmFibGUgPT09IHRydWUgJiYgdm0ubGVmdFJlbW92ZU1hcmtlckVuYWJsZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgIHZtLmxlZnRSZW1vdmVNYXJrZXJFbmFibGUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVuYWJsZS9kaXNhYmxlIHRoZSBtYXJrZXIgcmVtb3ZhbFxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7YW55fSB2aWV3ZXJJZFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHRvZ2dsZVJlbW92ZU1hcmtlcih2aWV3ZXJJZCkge1xuICAgICAgaWYgKHZpZXdlcklkID09PSAncmlnaHRNYXBWaWV3ZXInKSB7XG4gICAgICAgIHZtLnJpZ2h0UmVtb3ZlTWFya2VyRW5hYmxlID0gIXZtLnJpZ2h0UmVtb3ZlTWFya2VyRW5hYmxlO1xuXG4gICAgICAgIC8vIGl0IGlzIG5vdCBwb3NzaWJsZSB0byBoYXZlIHJlbW92YWwgYW5kIGNyZWF0ZSB0b29sIGVuYWJsZWQgYXQgdGhlIHNhbWUgdGltZVxuICAgICAgICAvLyBzbywgaWYgdGhlIHJlbW92YWwgYW5kIGNyZWF0ZSB0b29sIGFyZSBlbmFibGVkLCB0aGUgcmlnaHQgY3JlYXRlIHRvb2wgaXMgZGlzYWJsZWRcbiAgICAgICAgaWYgKHZtLnJpZ2h0UmVtb3ZlTWFya2VyRW5hYmxlID09PSB0cnVlICYmIHZtLnJpZ2h0Q3JlYXRlTWFya2VyRW5hYmxlID09PSB0cnVlKSB7XG4gICAgICAgICAgdm0ucmlnaHRDcmVhdGVNYXJrZXJFbmFibGUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdm0ubGVmdFJlbW92ZU1hcmtlckVuYWJsZSA9ICF2bS5sZWZ0UmVtb3ZlTWFya2VyRW5hYmxlO1xuXG4gICAgICAgIC8vIGl0IGlzIG5vdCBwb3NzaWJsZSB0byBoYXZlIHJlbW92YWwgYW5kIGNyZWF0ZSB0b29sIGVuYWJsZWQgYXQgdGhlIHNhbWUgdGltZVxuICAgICAgICAvLyBzbywgaWYgdGhlIHJlbW92YWwgYW5kIGNyZWF0ZSB0b29sIGFyZSBlbmFibGVkLCB0aGUgbGVmdCBjcmVhdGUgdG9vbCBpcyBkaXNhYmxlZFxuICAgICAgICBpZiAodm0ubGVmdFJlbW92ZU1hcmtlckVuYWJsZSA9PT0gdHJ1ZSAmJiB2bS5sZWZ0Q3JlYXRlTWFya2VyRW5hYmxlID09PSB0cnVlKSB7XG4gICAgICAgICAgdm0ubGVmdENyZWF0ZU1hcmtlckVuYWJsZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT3BlbnMgdGhlIHNpZGUgbmF2IHdpdGggc2F2ZSBvcHRpb25zIGZvciB0aGUgZ2VvcmVmZXJlbmNlXG4gICAgICogVGhpcyBmdW5jdGlvbiBqdXN0IG9wZW4gdGhlIHNpZGUgbmF2LiBUaGUgZ2VvcmVmZXJlbmNlIHNhdmUgZnVuY3Rpb24gaXMgZGVmaW5lZCBcbiAgICAgKiBpbiB0aGUgc2lkZSBuYXYgY29udHJvbGxlciBAc2VlIGFwcC9nZW9yZWZlcmVuY2UvbmF2cy5nZW8ubGVmdC5zaWRlbmF2LmNvbnRyb2xsZXIuanNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvcGVuU2F2ZUdlb1JlZigpIHtcbiAgICAgIC8vIGlmIHRoZSBHcm91bmQgQ29udHJvbCBQb2ludHMgYXJlIHZhbGlkLCB3ZSBqdXN0IG9wZW4gdGhlIHNpZGUgbmF2XG4gICAgICBpZiAodmFsaWRHQ1AoKSkge1xuICAgICAgICAkc2NvcGUudm0gPSB2bTtcbiAgICAgICAgJG1kU2lkZW5hdignbGVmdCcpLnRvZ2dsZSgpO1xuICAgICAgICAkcm9vdFNjb3BlLiRlbWl0KCdzYXZlR2VvUmVmJywgdm0ubGVmdE1hcmtlcnMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gaWYgbm90LCB3ZSB3YXJuIHRoZSB1c2VyIGFib3V0IGl0XG4gICAgICAgIHZhciBjb25maWcgPSB7XG4gICAgICAgICAgdGl0bGU6ICR0cmFuc2xhdGUuaW5zdGFudCgnZGlhbG9nLmludmFsaWRHZW9yZWZUaXRsZScpLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2RpYWxvZy5pbnZhbGlkR2VvcmVmVGV4dCcpLFxuICAgICAgICAgIHRvb2xiYXJCZ0NvbG9yOiAkbWRDb2xvcnMuZ2V0VGhlbWVDb2xvcigncHJpbWFyeScpLFxuICAgICAgICAgIG9rQmdDb2xvcjogJG1kQ29sb3JzLmdldFRoZW1lQ29sb3IoJ3ByaW1hcnknKSxcbiAgICAgICAgICBvazogJHRyYW5zbGF0ZS5pbnN0YW50KCdnbG9iYWwub2snKVxuICAgICAgICB9O1xuICAgICAgICBDMkRpYWxvZy5hbGVydChjb25maWcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG51bU9mR0NQKCkge1xuICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHZtLmxlZnRNYXJrZXJzKS5sZW5ndGg7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVmFsaWRhdGUgdGhlIEdyb3VuZCBDb250cm9sIFBvaW50cyBhYm91dCB0byBiZSB1c2VkIGZvciB0aGUgZ2VvcmVmZXJlbmNlXG4gICAgICogXG4gICAgICogQHJldHVybnMgXG4gICAgICovXG4gICAgZnVuY3Rpb24gdmFsaWRHQ1AoKSB7XG4gICAgICAvLyBnZXQgdGhlIHByb3BlcnRpZXMgY291bnQgb2YgYm90aCB2aWV3ZXJzXG4gICAgICB2YXIgbGVmdENvdW50ID0gT2JqZWN0LmtleXModm0ubGVmdE1hcmtlcnMpLmxlbmd0aDtcbiAgICAgIHZhciByaWdodENvdW50ID0gT2JqZWN0LmtleXModm0ucmlnaHRNYXJrZXJzKS5sZW5ndGg7XG5cbiAgICAgIC8vIHRvIGJlIHZhbGlkIGEgbWluaW11bSBvZiAzIEdDUCBtdXN0IGJlIHNlbGVjdGVkIFxuICAgICAgLy8gYW5kIGJvdGggdmlld2VycyBtdXN0IGhhdmUgdGhlIHNhbWUgYW1vdW50IG9mIEdDUCBkZWZpbmVkXG4gICAgICByZXR1cm4gbGVmdENvdW50ID49IDMgJiYgbGVmdENvdW50ID09PSByaWdodENvdW50O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnQgR0NQIGRhdGEgcmVjZWl2ZWQgZnJvbSAvbWFwIHJlc3BvbnNlIHRvIG1hcmtlciBmb3JtYXQgZGF0YVxuICAgICAqIFxuICAgICAqIEBwYXJhbSBwb3NpdGlvbiBnY3AgcmVzcG9uc2Ugb2YgL21hcCByZXF1ZXN0XG4gICAgICogQHJldHVybnMgT2JqZWN0IEluIGZvcm1hdCBob3cgYWRkTWFya2VyIGZ1bmN0aW9uIG5lZWRzIG1hcmtlciBkYXRhXG4gICAgICovXG4gICAgZnVuY3Rpb24gcHJlcGFyZURhdGFGb3JBZGRNYXJrZXIocG9zaXRpb24pIHtcbiAgICAgIHZhciBpbWFnZVBvc2l0aW9uSW5MYXRMbmcgPSBMLlByb2plY3Rpb24uU3BoZXJpY2FsTWVyY2F0b3IudW5wcm9qZWN0KFxuICAgICAgLy8gTC5sYXRMbmcocG9zaXRpb24ucGl4ZWxZLHBhcnNlRmxvYXQocG9zaXRpb24ucGl4ZWxYKSlcbiAgICAgIEwucG9pbnQocGFyc2VGbG9hdChwb3NpdGlvbi5waXhlbFgpLCBwb3NpdGlvbi5waXhlbFkpKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKGltYWdlUG9zaXRpb25JbkxhdExuZyk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIFwiaW1hZ2VQb3NpdGlvblwiOiB7XG4gICAgICAgICAgXCJsYXRsbmdcIjoge1xuICAgICAgICAgICAgXCJsYXRcIjogaW1hZ2VQb3NpdGlvbkluTGF0TG5nLmxhdCxcbiAgICAgICAgICAgIFwibG5nXCI6IGltYWdlUG9zaXRpb25JbkxhdExuZy5sbmdcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwibWFwUG9zaXRpb25cIjoge1xuICAgICAgICAgIFwibGF0bG5nXCI6IHtcbiAgICAgICAgICAgIFwibGF0XCI6IHBvc2l0aW9uLmxhdCxcbiAgICAgICAgICAgIFwibG5nXCI6IHBvc2l0aW9uLmxvblxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uZmlnKHJvdXRlcyk7XG5cbiAgLyoqXG4gICAqIENvbmZpZ3VyYXRpb24gZmlsZSBmb3IgZ2VvcmVmZXJlbmNlIHJvdXRlXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSAkc3RhdGVQcm92aWRlclxuICAgKiBAcGFyYW0ge29iamVjdH0gR2xvYmFsXG4gICAqL1xuICAvKiogQG5nSW5qZWN0ICovXG4gIGZ1bmN0aW9uIHJvdXRlcygkc3RhdGVQcm92aWRlciwgR2xvYmFsKSB7XG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2FwcC5nZW9yZWZlcmVuY2UnLCB7XG4gICAgICB1cmw6ICcvZ2VvcmVmZXJlbmNlJyxcbiAgICAgIHRlbXBsYXRlVXJsOiBHbG9iYWwuY2xpZW50UGF0aCArICcvZ2VvcmVmZXJlbmNlL2dlb3JlZmVyZW5jZS5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdHZW9yZWZlcmVuY2VDb250cm9sbGVyIGFzIG1hcEN0cmwnLFxuICAgICAgZGF0YToge31cbiAgICB9KTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdHZW9yZWZlcmVuY2VTZXJ2aWNlJywgR2VvcmVmZXJlbmNlU2VydmljZSk7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICBmdW5jdGlvbiBHZW9yZWZlcmVuY2VTZXJ2aWNlKHNlcnZpY2VGYWN0b3J5LCAkaHR0cCwgJHEpIHtcbiAgICB2YXIgYXBwbHlFbmRQb2ludCA9IFwiL2hlaW1hcC9nZW9yZWYvYXBwbHlcIjtcbiAgICB2YXIgcHJldmlld0djcEVuZFBvaW50ID0gXCIvaGVpbWFwL2dlb3JlZi9ybXNlXCI7XG5cbiAgICB2YXIgbW9kZWwgPSBzZXJ2aWNlRmFjdG9yeShhcHBseUVuZFBvaW50LCB7XG4gICAgICBhY3Rpb25zOiB7fSxcbiAgICAgIGluc3RhbmNlOiB7XG4gICAgICAgIHNhdmVHZW9SZWY6IHNhdmVHZW9SZWYsXG4gICAgICAgIHByZXZpZXdHQ1A6IHByZXZpZXdHQ1BcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHByZXZpZXdHQ1AocGFyYW1EYXRhKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBHZW9yZWZlcmVuY2VTZXJ2aWNlID4+PiBwcmV2aWV3R0NQIFwiLCBwcmV2aWV3R2NwRW5kUG9pbnQsIHBhcmFtRGF0YSk7XG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAvKiBcbiAgICAgIHBhcmFtRGF0YSA9IHtcbiAgICAgICAgICBcImltYWdlQ29vcmRpbmF0ZXNcIjp7XG4gICAgICAgICAgICBcIm0xXCI6e1xuICAgICAgICAgICAgICBcImlkXCI6XCJtMVwiLFxuICAgICAgICAgICAgICBcImxhdFwiOjAuMDA2NzM3NzA5MDI5ODk1NTQ3NixcbiAgICAgICAgICAgICAgXCJsbmdcIjowLjAwNDI5OTg5NDU1NTgxNDgxLFxuICAgICAgICAgICAgICBcImZvY3VzXCI6dHJ1ZSxcbiAgICAgICAgICAgICAgXCJkcmFnZ2FibGVcIjp0cnVlLFxuICAgICAgICAgICAgICBcImljb25cIjp7XG4gICAgICAgICAgICAgICAgXCJ0eXBlXCI6XCJkaXZcIixcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOlwibWstZGl2LWljb24gbTFcIixcbiAgICAgICAgICAgICAgICBcImljb25TaXplXCI6bnVsbCxcbiAgICAgICAgICAgICAgICBcImh0bWxcIjpcIjxkaXYgY2xhc3M9XFxcIm1rLWljb24tY29udGFpbmVyIG1rLW9rXFxcIj4xPC9kaXY+XCJcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwibTJcIjp7XG4gICAgICAgICAgICAgIFwiaWRcIjpcIm0yXCIsXG4gICAgICAgICAgICAgIFwibGF0XCI6MC4wMDAzODYyMzgwOTgxNDIzMTA3LFxuICAgICAgICAgICAgICBcImxuZ1wiOjAuMDAyOTI0NjIxODc5Mjc0NDQ3NixcbiAgICAgICAgICAgICAgXCJmb2N1c1wiOnRydWUsXG4gICAgICAgICAgICAgIFwiZHJhZ2dhYmxlXCI6dHJ1ZSxcbiAgICAgICAgICAgICAgXCJpY29uXCI6e1xuICAgICAgICAgICAgICAgIFwidHlwZVwiOlwiZGl2XCIsXG4gICAgICAgICAgICAgICAgXCJjbGFzc05hbWVcIjpcIm1rLWRpdi1pY29uIG0yXCIsXG4gICAgICAgICAgICAgICAgXCJpY29uU2l6ZVwiOm51bGwsXG4gICAgICAgICAgICAgICAgXCJodG1sXCI6XCI8ZGl2IGNsYXNzPVxcXCJtay1pY29uLWNvbnRhaW5lciBtay1va1xcXCI+MjwvZGl2PlwiXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIm0zXCI6e1xuICAgICAgICAgICAgICBcImlkXCI6XCJtM1wiLFxuICAgICAgICAgICAgICBcImxhdFwiOjAuMDAwNzI5NTYwODUyMDM1Mjc4MixcbiAgICAgICAgICAgICAgXCJsbmdcIjowLjAxMjg1MjM3MTUxMzA1MDE4OSxcbiAgICAgICAgICAgICAgXCJmb2N1c1wiOnRydWUsXG4gICAgICAgICAgICAgIFwiZHJhZ2dhYmxlXCI6dHJ1ZSxcbiAgICAgICAgICAgICAgXCJpY29uXCI6e1xuICAgICAgICAgICAgICAgIFwidHlwZVwiOlwiZGl2XCIsXG4gICAgICAgICAgICAgICAgXCJjbGFzc05hbWVcIjpcIm1rLWRpdi1pY29uIG0zXCIsXG4gICAgICAgICAgICAgICAgXCJpY29uU2l6ZVwiOm51bGwsXG4gICAgICAgICAgICAgICAgXCJodG1sXCI6XCI8ZGl2IGNsYXNzPVxcXCJtay1pY29uLWNvbnRhaW5lciBtay1va1xcXCI+MzwvZGl2PlwiXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIm00XCI6e1xuICAgICAgICAgICAgICBcImlkXCI6XCJtNFwiLFxuICAgICAgICAgICAgICBcImxhdFwiOjAuMDA2MDUxMDYzNTI2MzQ2MTExLFxuICAgICAgICAgICAgICBcImxuZ1wiOjAuMDEwOTYxMzcxNTgyODA3MTksXG4gICAgICAgICAgICAgIFwiZm9jdXNcIjp0cnVlLFxuICAgICAgICAgICAgICBcImRyYWdnYWJsZVwiOnRydWUsXG4gICAgICAgICAgICAgIFwiaWNvblwiOntcbiAgICAgICAgICAgICAgICBcInR5cGVcIjpcImRpdlwiLFxuICAgICAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6XCJtay1kaXYtaWNvbiBtNFwiLFxuICAgICAgICAgICAgICAgIFwiaWNvblNpemVcIjpudWxsLFxuICAgICAgICAgICAgICAgIFwiaHRtbFwiOlwiPGRpdiBjbGFzcz1cXFwibWstaWNvbi1jb250YWluZXIgbWstb2tcXFwiPjQ8L2Rpdj5cIlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBcIndvcmxkQ29vcmRpbmF0ZXNcIjp7XG4gICAgICAgICAgICBcIm0xXCI6e1xuICAgICAgICAgICAgICBcImlkXCI6XCJtMVwiLFxuICAgICAgICAgICAgICBcImxhdFwiOjQ5LjM2MDkxMTU0NzEyNjE2NSxcbiAgICAgICAgICAgICAgXCJsbmdcIjo4LjAzNzE1Mjk3MTU0MDE3LFxuICAgICAgICAgICAgICBcImZvY3VzXCI6dHJ1ZSxcbiAgICAgICAgICAgICAgXCJkcmFnZ2FibGVcIjp0cnVlLFxuICAgICAgICAgICAgICBcImljb25cIjp7XG4gICAgICAgICAgICAgICAgXCJ0eXBlXCI6XCJkaXZcIixcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOlwibWstZGl2LWljb24gbTFcIixcbiAgICAgICAgICAgICAgICBcImljb25TaXplXCI6bnVsbCxcbiAgICAgICAgICAgICAgICBcImh0bWxcIjpcIjxkaXYgY2xhc3M9XFxcIm1rLWljb24tY29udGFpbmVyIG1rLW9rXFxcIj4xPC9kaXY+XCJcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwibTJcIjp7XG4gICAgICAgICAgICAgIFwiaWRcIjpcIm0yXCIsXG4gICAgICAgICAgICAgIFwibGF0XCI6NDguODMyMTgxNjI1Njk4NDc1LFxuICAgICAgICAgICAgICBcImxuZ1wiOjcuOTk4NjQ1MzM2NTk3LFxuICAgICAgICAgICAgICBcImZvY3VzXCI6dHJ1ZSxcbiAgICAgICAgICAgICAgXCJkcmFnZ2FibGVcIjp0cnVlLFxuICAgICAgICAgICAgICBcImljb25cIjp7XG4gICAgICAgICAgICAgICAgXCJ0eXBlXCI6XCJkaXZcIixcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOlwibWstZGl2LWljb24gbTJcIixcbiAgICAgICAgICAgICAgICBcImljb25TaXplXCI6bnVsbCxcbiAgICAgICAgICAgICAgICBcImh0bWxcIjpcIjxkaXYgY2xhc3M9XFxcIm1rLWljb24tY29udGFpbmVyIG1rLW9rXFxcIj4yPC9kaXY+XCJcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwibTNcIjp7XG4gICAgICAgICAgICAgIFwiaWRcIjpcIm0zXCIsXG4gICAgICAgICAgICAgIFwibGF0XCI6NDguODUzODcyNzMxNjU2NTYsXG4gICAgICAgICAgICAgIFwibG5nXCI6OS4wNDkzNTM2NjE0NzUyMzUsXG4gICAgICAgICAgICAgIFwiZm9jdXNcIjp0cnVlLFxuICAgICAgICAgICAgICBcImRyYWdnYWJsZVwiOnRydWUsXG4gICAgICAgICAgICAgIFwiaWNvblwiOntcbiAgICAgICAgICAgICAgICBcInR5cGVcIjpcImRpdlwiLFxuICAgICAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6XCJtay1kaXYtaWNvbiBtM1wiLFxuICAgICAgICAgICAgICAgIFwiaWNvblNpemVcIjpudWxsLFxuICAgICAgICAgICAgICAgIFwiaHRtbFwiOlwiPGRpdiBjbGFzcz1cXFwibWstaWNvbi1jb250YWluZXIgbWstb2tcXFwiPjM8L2Rpdj5cIlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJtNFwiOntcbiAgICAgICAgICAgICAgXCJpZFwiOlwibTRcIixcbiAgICAgICAgICAgICAgXCJsYXRcIjo0OS40Nzg4MzI0NDA3MTA0NyxcbiAgICAgICAgICAgICAgXCJsbmdcIjo5LjIwMzM4NDIwMTI0Nzk1NyxcbiAgICAgICAgICAgICAgXCJmb2N1c1wiOnRydWUsXG4gICAgICAgICAgICAgIFwiZHJhZ2dhYmxlXCI6dHJ1ZSxcbiAgICAgICAgICAgICAgXCJpY29uXCI6e1xuICAgICAgICAgICAgICAgIFwidHlwZVwiOlwiZGl2XCIsXG4gICAgICAgICAgICAgICAgXCJjbGFzc05hbWVcIjpcIm1rLWRpdi1pY29uIG00XCIsXG4gICAgICAgICAgICAgICAgXCJpY29uU2l6ZVwiOm51bGwsXG4gICAgICAgICAgICAgICAgXCJodG1sXCI6XCI8ZGl2IGNsYXNzPVxcXCJtay1pY29uLWNvbnRhaW5lciBtay1va1xcXCI+NDwvZGl2PlwiXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIFwicmVjdGlmeU1ldGhvZFwiOlwiMXN0T3JkZXJQb2x5blwiLFxuICAgICAgICAgIFwicmVzYW1wbGluZ01ldGhvZFwiOlwibmVhclwiLFxuICAgICAgICAgIFwibWFwSWRcIjpcIjIzXCIsXG4gICAgICAgICAgXCJuZXdGaWxlTmFtZVwiOlwiMV9nXzFzdE9yZGVyUG9seW5fbmVhcl83LjE5LjIwMThcIixcbiAgICAgICAgICBcImJib3hDcm9wSW1hZ2VcIjpcIjcuOTk4NjQ1MzM2NTk3IDQ4LjgzMjE4MTYyNTY5ODQ3NSA5LjIwMzM4NDIwMTI0Nzk1NyA0OS40Nzg4MzI0NDA3MTA0N1wiXG4gICAgICAgIH1cbiAgICAgICAqL1xuICAgICAgJGh0dHAucG9zdChwcmV2aWV3R2NwRW5kUG9pbnQsIHBhcmFtRGF0YSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzdWx0LmRhdGEpO1xuICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgLy8gbm90IHVzZWRcbiAgICBmdW5jdGlvbiBzYXZlR2VvUmVmKCkge1xuICAgICAgY29uc29sZS5sb2coXCI+Pj4gR2VvcmVmZXJlbmNlU2VydmljZSA+Pj4gc2F2ZUdlb1JlZiBcIiwgdGhpcy5hcHBseUVuZFBvaW50KTtcblxuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuXG4gICAgICAkaHR0cC5wb3N0KHRoaXMuYXBwbHlFbmRQb2ludCwgZm9ybURhdGEsIHtcbiAgICAgICAgdHJhbnNmb3JtUmVxdWVzdDogYW5ndWxhci5pZGVudGl0eSxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdDb250ZW50LVR5cGUnOiB1bmRlZmluZWRcbiAgICAgICAgfVxuICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzdWx0LmRhdGEpO1xuICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1vZGVsO1xuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29udHJvbGxlcignRXhwb3J0Q29udHJvbGxlcicsIEV4cG9ydENvbnRyb2xsZXIpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgZnVuY3Rpb24gRXhwb3J0Q29udHJvbGxlcigkY29udHJvbGxlciwgRXhwb3J0U2VydmljZSkge1xuICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAvL0F0dHJpYnV0ZXMgQmxvY2tcblxuICAgIC8vRnVuY3Rpb25zIEJsb2NrXG5cbiAgICAvLyBpbnN0YW50aWF0ZSBiYXNlIGNvbnRyb2xsZXJcbiAgICAkY29udHJvbGxlcignQ1JVRENvbnRyb2xsZXInLCB7IHZtOiB2bSwgbW9kZWxTZXJ2aWNlOiBFeHBvcnRTZXJ2aWNlLCBvcHRpb25zOiB7IHNlYXJjaE9uSW5pdDogZmFsc2UgfSB9KTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25maWcocm91dGVzKTtcblxuICAvKipcbiAgICogQXJxdWl2byBkZSBjb25maWd1cmHDp8OjbyBjb20gYXMgcm90YXMgZXNwZWPDrWZpY2FzIGRvIHJlY3Vyc28gZXhwb3J0XG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSAkc3RhdGVQcm92aWRlclxuICAgKiBAcGFyYW0ge29iamVjdH0gR2xvYmFsXG4gICAqL1xuICAvKiogQG5nSW5qZWN0ICovXG4gIGZ1bmN0aW9uIHJvdXRlcygkc3RhdGVQcm92aWRlciwgR2xvYmFsKSB7XG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2FwcC5leHBvcnQnLCB7XG4gICAgICB1cmw6ICcvZXhwb3J0JyxcbiAgICAgIHRlbXBsYXRlVXJsOiBHbG9iYWwuY2xpZW50UGF0aCArICcvZXhwb3J0L2V4cG9ydC5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdFeHBvcnRDb250cm9sbGVyIGFzIGV4cG9ydEN0cmwnLFxuICAgICAgZGF0YToge31cbiAgICB9KTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdFeHBvcnRTZXJ2aWNlJywgRXhwb3J0U2VydmljZSk7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICBmdW5jdGlvbiBFeHBvcnRTZXJ2aWNlKHNlcnZpY2VGYWN0b3J5KSB7XG4gICAgdmFyIG1vZGVsID0gc2VydmljZUZhY3RvcnkoJ2V4cG9ydCcsIHtcbiAgICAgIGFjdGlvbnM6IHt9LFxuICAgICAgaW5zdGFuY2U6IHt9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbW9kZWw7XG4gIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5maWx0ZXIoJ2lzT3JOb3RHZW9yZWZlcmVuY2VkJywgaXNPck5vdEdlb3JlZmVyZW5jZWQpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgZnVuY3Rpb24gaXNPck5vdEdlb3JlZmVyZW5jZWQoJGZpbHRlcikge1xuICAgIC8qKlxyXG4gICAgICogRmlsdGVyIHRvIGNvbnZlcnQgYm9vbGVhbiB0byB5ZXMgb3Igbm90IHN0cmluZ1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7YW55fSBpbnB1dCBwcm9wZXJ0eS92YXJpYWJsZVxyXG4gICAgICogQHJldHVybnMgdGhlIHRyYW5zbGF0ZWQgeWVzL25vIHN0cmluZ1xyXG4gICAgICovXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgdmFyIGlzVHJ1ZSA9IGlucHV0ID09PSB0cnVlIHx8IGlucHV0ID09PSAndHJ1ZScgfHwgaW5wdXQgPT09IDEgfHwgYW5ndWxhci5pc0RlZmluZWQoaW5wdXQpICYmIGlucHV0ICE9PSBmYWxzZTtcbiAgICAgIHZhciBrZXkgPSAnYXR0cmlidXRlcy4nICsgKGlzVHJ1ZSA/ICdpc0dlb3JlZmVyZW5jZWQnIDogJ2lzTm90R2VvcmVmZXJlbmNlZCcpO1xuICAgICAgdmFyIHRyYW5zbGF0ZWQgPSAkZmlsdGVyKCd0cmFuc2xhdGUnKShrZXkpO1xuICAgICAgcmV0dXJuIHRyYW5zbGF0ZWQ7XG4gICAgfTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ2xhbmd1YWdlTG9hZGVyJywgTGFuZ3VhZ2VMb2FkZXIpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgZnVuY3Rpb24gTGFuZ3VhZ2VMb2FkZXIoJHEsICRsb2csICRpbmplY3Rvcikge1xuICAgIHZhciBzZXJ2aWNlID0gdGhpcztcblxuICAgIHNlcnZpY2UudHJhbnNsYXRlID0gZnVuY3Rpb24gKGxvY2FsZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZ2xvYmFsOiAkaW5qZWN0b3IuZ2V0KGxvY2FsZSArICcuaTE4bi5nbG9iYWwnKSxcbiAgICAgICAgdmlld3M6ICRpbmplY3Rvci5nZXQobG9jYWxlICsgJy5pMThuLnZpZXdzJyksXG4gICAgICAgIGF0dHJpYnV0ZXM6ICRpbmplY3Rvci5nZXQobG9jYWxlICsgJy5pMThuLmF0dHJpYnV0ZXMnKSxcbiAgICAgICAgZGlhbG9nOiAkaW5qZWN0b3IuZ2V0KGxvY2FsZSArICcuaTE4bi5kaWFsb2cnKSxcbiAgICAgICAgbWVzc2FnZXM6ICRpbmplY3Rvci5nZXQobG9jYWxlICsgJy5pMThuLm1lc3NhZ2VzJyksXG4gICAgICAgIG1vZGVsczogJGluamVjdG9yLmdldChsb2NhbGUgKyAnLmkxOG4ubW9kZWxzJylcbiAgICAgIH07XG4gICAgfTtcblxuICAgIC8vIHJldHVybiBsb2FkZXJGblxuICAgIHJldHVybiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgJGxvZy5pbmZvKCdMb2FkaW5nIHRoZSBsYW5ndWFnZSBjb250ZW50ICcgKyBvcHRpb25zLmtleSk7XG4gICAgICB2YXIgdHJhbnNsYXRpb24gPSBzZXJ2aWNlLnRyYW5zbGF0ZShvcHRpb25zLmtleSk7XG4gICAgICByZXR1cm4gJHEud2hlbih0cmFuc2xhdGlvbik7XG4gICAgfTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZpbHRlcigndEF0dHInLCB0QXR0cik7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICBmdW5jdGlvbiB0QXR0cigkZmlsdGVyKSB7XG4gICAgLyoqXHJcbiAgICAgKiBGaWx0cm8gcGFyYSB0cmFkdcOnw6NvIGRlIHVtIGF0cmlidXRvIGRlIHVtIG1vZGVsXHJcbiAgICAgKiBcclxuICAgICAqIEBwYXJhbSB7YW55fSBuYW1lIG5vbWUgZG8gYXRyaWJ1dG9cclxuICAgICAqIEByZXR1cm5zIG8gbm9tZSBkbyBhdHJpYnV0byB0cmFkdXppZG8gY2FzbyBlbmNvbnRyZSBzZSBuw6NvIG8gbm9tZSBwYXNzYWRvIHBvciBwYXJhbWV0cm9cclxuICAgICAqL1xuICAgIHJldHVybiBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgdmFyIGtleSA9ICdhdHRyaWJ1dGVzLicgKyBuYW1lO1xuICAgICAgdmFyIHRyYW5zbGF0ZSA9ICRmaWx0ZXIoJ3RyYW5zbGF0ZScpKGtleSk7XG5cbiAgICAgIHJldHVybiB0cmFuc2xhdGUgPT09IGtleSA/IG5hbWUgOiB0cmFuc2xhdGU7XG4gICAgfTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZpbHRlcigndEJyZWFkY3J1bWInLCB0QnJlYWRjcnVtYik7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICBmdW5jdGlvbiB0QnJlYWRjcnVtYigkZmlsdGVyKSB7XG4gICAgLyoqXHJcbiAgICAgKiBGaWx0cm8gcGFyYSB0cmFkdcOnw6NvIGRvIGJyZWFkY3J1bWIgKHRpdHVsbyBkYSB0ZWxhIGNvbSByYXN0cmVpbylcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ge2FueX0gaWQgY2hhdmUgY29tIG8gbm9tZSBkbyBzdGF0ZSByZWZlcmVudGUgdGVsYVxyXG4gICAgICogQHJldHVybnMgYSB0cmFkdcOnw6NvIGNhc28gZW5jb250cmUgc2UgbsOjbyBvIGlkIHBhc3NhZG8gcG9yIHBhcmFtZXRyb1xyXG4gICAgICovXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChpZCkge1xuICAgICAgLy9wZWdhIGEgc2VndW5kYSBwYXJ0ZSBkbyBub21lIGRvIHN0YXRlLCByZXRpcmFuZG8gYSBwYXJ0ZSBhYnN0cmF0YSAoYXBwLilcbiAgICAgIHZhciBrZXkgPSAndmlld3MuYnJlYWRjcnVtYnMuJyArIGlkLnNwbGl0KCcuJylbMV07XG4gICAgICB2YXIgdHJhbnNsYXRlID0gJGZpbHRlcigndHJhbnNsYXRlJykoa2V5KTtcblxuICAgICAgcmV0dXJuIHRyYW5zbGF0ZSA9PT0ga2V5ID8gaWQgOiB0cmFuc2xhdGU7XG4gICAgfTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZpbHRlcigndE1vZGVsJywgdE1vZGVsKTtcblxuICAvKiogQG5nSW5qZWN0ICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gIGZ1bmN0aW9uIHRNb2RlbCgkZmlsdGVyKSB7XG4gICAgLyoqXHJcbiAgICAgKiBGaWx0cm8gcGFyYSB0cmFkdcOnw6NvIGRlIHVtIGF0cmlidXRvIGRlIHVtIG1vZGVsXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHthbnl9IG5hbWUgbm9tZSBkbyBhdHJpYnV0b1xyXG4gICAgICogQHJldHVybnMgbyBub21lIGRvIGF0cmlidXRvIHRyYWR1emlkbyBjYXNvIGVuY29udHJlIHNlIG7Do28gbyBub21lIHBhc3NhZG8gcG9yIHBhcmFtZXRyb1xyXG4gICAgICovXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICB2YXIga2V5ID0gJ21vZGVscy4nICsgbmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgdmFyIHRyYW5zbGF0ZSA9ICRmaWx0ZXIoJ3RyYW5zbGF0ZScpKGtleSk7XG5cbiAgICAgIHJldHVybiB0cmFuc2xhdGUgPT09IGtleSA/IG5hbWUgOiB0cmFuc2xhdGU7XG4gICAgfTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZpbHRlcigneWVzT3JObycsIHllc09yTm8pO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgZnVuY3Rpb24geWVzT3JObygkZmlsdGVyKSB7XG4gICAgLyoqXHJcbiAgICAgKiBGaWx0ZXIgdG8gY29udmVydCBib29sZWFuIHRvIHllcyBvciBub3Qgc3RyaW5nXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHthbnl9IGlucHV0IHByb3BlcnR5L3ZhcmlhYmxlXHJcbiAgICAgKiBAcmV0dXJucyB0aGUgdHJhbnNsYXRlZCB5ZXMvbm8gc3RyaW5nXHJcbiAgICAgKi9cbiAgICByZXR1cm4gZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgICB2YXIgaXNUcnVlID0gaW5wdXQgPT09IHRydWUgfHwgaW5wdXQgPT09ICd0cnVlJyB8fCBpbnB1dCA9PT0gMSB8fCBhbmd1bGFyLmlzRGVmaW5lZChpbnB1dCkgJiYgaW5wdXQgIT09IGZhbHNlO1xuICAgICAgdmFyIGtleSA9ICdnbG9iYWwuJyArIChpc1RydWUgPyAneWVzJyA6ICdubycpO1xuICAgICAgdmFyIHRyYW5zbGF0ZWQgPSAkZmlsdGVyKCd0cmFuc2xhdGUnKShrZXkpO1xuICAgICAgcmV0dXJuIHRyYW5zbGF0ZWQ7XG4gICAgfTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25maWcoc3Bpbm5lckludGVyY2VwdG9yKTtcblxuICBmdW5jdGlvbiBzcGlubmVySW50ZXJjZXB0b3IoJGh0dHBQcm92aWRlciwgJHByb3ZpZGUpIHtcbiAgICAvKipcbiAgICAgKiBUaGlzIGludGVyY2VwdG9yIGlzIHJlc3BvbnNpYmxlIGZvciBzaG93aW5nIGFuZCBoaWRpbmcgdGhlIEMyU3Bpbm5lclxuICAgICAqIHdoZW4gYSBhc3luYyByZXF1ZXN0IGlzIHN0YXJ0ZWQvZW5kZWRcbiAgICAgKlxuICAgICAqIEBwYXJhbSB7YW55fSAkcVxuICAgICAqIEBwYXJhbSB7YW55fSAkaW5qZWN0b3JcbiAgICAgKiBAcmV0dXJuc1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNob3dIaWRlU3Bpbm5lcigkcSwgJGluamVjdG9yLCBHbG9iYWwpIHtcblxuICAgICAgLyoqXG4gICAgICAgKiBDdXJyZW50IHBlbmRpbmcgcmVxdWVzdHNcbiAgICAgICAqL1xuICAgICAgR2xvYmFsLnBlbmRpbmdSZXF1ZXN0cyA9IDA7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJlcXVlc3Q6IGZ1bmN0aW9uIHJlcXVlc3QoY29uZmlnKSB7XG4gICAgICAgICAgR2xvYmFsLnBlbmRpbmdSZXF1ZXN0cysrO1xuICAgICAgICAgICRpbmplY3Rvci5nZXQoJ0MyU3Bpbm5lcicpLnNob3coKTtcbiAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlc3BvbnNlOiBmdW5jdGlvbiByZXNwb25zZShfcmVzcG9uc2UpIHtcbiAgICAgICAgICBHbG9iYWwucGVuZGluZ1JlcXVlc3RzLS07XG4gICAgICAgICAgLy8gdGhlIHNwaW5uZXIgaXMgb25seSBoaWRkZW4gaWYgdGhlcmUgYXJlIG5vIG1vcmUgIHBlbmRpbmcgcmVxdWVzdHMgICAgICBcbiAgICAgICAgICBpZiAoR2xvYmFsLnBlbmRpbmdSZXF1ZXN0cyA9PT0gMCkge1xuICAgICAgICAgICAgJGluamVjdG9yLmdldCgnQzJTcGlubmVyJykuaGlkZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gX3Jlc3BvbnNlO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlc3BvbnNlRXJyb3I6IGZ1bmN0aW9uIHJlc3BvbnNlRXJyb3IocmVqZWN0aW9uKSB7XG4gICAgICAgICAgR2xvYmFsLnBlbmRpbmdSZXF1ZXN0cy0tO1xuICAgICAgICAgIC8vIHRoZSBzcGlubmVyIGlzIG9ubHkgaGlkZGVuIGlmIHRoZXJlIGFyZSBub21vcmUgIHBlbmRpbmcgcmVxdWVzdHMgICAgICBcbiAgICAgICAgICBpZiAoR2xvYmFsLnBlbmRpbmdSZXF1ZXN0cyA9PT0gMCkge1xuICAgICAgICAgICAgJGluamVjdG9yLmdldCgnQzJTcGlubmVyJykuaGlkZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHJlamVjdGlvbik7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gRGVmaW5lIGEgZmFjdG9yeSB0byB0aGUgJGh0dHBJbnRlcmNlcHRvclxuICAgICRwcm92aWRlLmZhY3RvcnkoJ3Nob3dIaWRlU3Bpbm5lcicsIHNob3dIaWRlU3Bpbm5lcik7XG5cbiAgICAvLyBQdXNoIHRoZSBuZXcgZmFjdG9yeSBvbnRvIHRoZSAkaHR0cCBpbnRlcmNlcHRvciBhcnJheVxuICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ3Nob3dIaWRlU3Bpbm5lcicpO1xuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ0ZlYXR1cmVTZXJ2aWNlJywgRmVhdHVyZVNlcnZpY2UpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgZnVuY3Rpb24gRmVhdHVyZVNlcnZpY2Uoc2VydmljZUZhY3RvcnkpIHtcbiAgICB2YXIgbW9kZWwgPSBzZXJ2aWNlRmFjdG9yeSgnL2hlaW1hcC9mZWF0dXJlLycsIHtcbiAgICAgIGFjdGlvbnM6IHt9LFxuICAgICAgaW5zdGFuY2U6IHt9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbW9kZWw7XG4gIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdNYXBDb250cm9sbGVyJywgTWFwQ29udHJvbGxlcik7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICBmdW5jdGlvbiBNYXBDb250cm9sbGVyKCRjb250cm9sbGVyLCBDMkRpYWxvZywgJHNjb3BlLCBHbG9iYWwsIE1hcFZpZXdlclNlcnZpY2UsICRyb290U2NvcGUpIHtcbiAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgLy8gRnVuY3Rpb25zIEJsb2NrXG4gICAgdm0ub3BlbkFkZE1hcCA9IG9wZW5BZGRNYXA7XG4gICAgdm0ub3BlbkVkaXRNYXAgPSBvcGVuRWRpdE1hcDtcbiAgICB2bS5vblZpZXdlckFjdGl2YXRlID0gb25WaWV3ZXJBY3RpdmF0ZTtcblxuICAgIC8vIFNldCB0aGUgbWFwIHZpZXdlciBvcHRpb25zXG4gICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICBzdXBwb3J0TGlzdGluZ1ZpZXc6IHRydWUsXG4gICAgICBzdXBwb3J0RHJhd2luZzogZmFsc2UsXG4gICAgICB0aXRsZVRyYW5zbEtleTogJ3ZpZXdzLnRpdGxlcy5tYXBWaWV3JyxcbiAgICAgIGxlZnRTaWRlQmFyOiBHbG9iYWwuY2xpZW50UGF0aCArICcvbWFwL25hdnMvbWFwLWxlZnQtc2lkZW5hdi5odG1sJ1xuXG4gICAgICAvLyBpbnN0YW50aWF0ZSB0aGUgYmFzZSBNYXBWaWV3ZXJDb250cm9sbGVyXG4gICAgfTskY29udHJvbGxlcignTWFwVmlld2VyQ29udHJvbGxlcicsIHsgdm06IHZtLCAkc2NvcGU6ICRzY29wZSwgb3B0aW9uczogb3B0aW9ucyB9KTtcblxuICAgIC8qKlxuICAgICAqIEFjdGlvbnMgZXhlY3V0ZWQgYWZ0ZXIgdGhlIGJhc2Ugdmlld2VyIGlzIGFjdGl2YXRlZFxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG9uVmlld2VyQWN0aXZhdGUoKSB7XG4gICAgICAvLyBTZXQgZ2xvYmFsIHZpZXdlciBvcHRpb25zXG4gICAgICBNYXBWaWV3ZXJTZXJ2aWNlLnNldE9wdGlvbigncmlnaHRNYXBWaWV3ZXInLCAnc2hvd0xvYWRNYXBJblJpZ2h0JywgdHJ1ZSk7XG4gICAgICBNYXBWaWV3ZXJTZXJ2aWNlLnNldE9wdGlvbignbGVmdE1hcFZpZXdlcicsICdzaG93TG9hZE1hcEluUmlnaHQnLCB0cnVlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMaXN0ZW4gdG8gdGhlIGFkZGVkIG1hcCBkcmF3ICBldmVudCBhbmQgc2F2ZSB0aGUgbWFwXG4gICAgICogaW4gdGhlIGJhY2stZW5kXG4gICAgICovXG4gICAgJHJvb3RTY29wZS4kb24oJ2FkZGVkTWFwRHJhdycsIGZ1bmN0aW9uIChldmVudCwgZHJhd3NHZW9Kc29uKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIj4+Pm1hcC5jb250cm9sbGVyID4+PiBhZGRlZE1hcERyYXcgXCIsIGRyYXdzR2VvSnNvbik7XG4gICAgICB2bS5yZXNvdXJjZS5kcmF3cyA9IGRyYXdzR2VvSnNvbjtcbiAgICAgIG9wZW5BdHRyaWJ1dGVEYWlsb2coZHJhd3NHZW9Kc29uKTtcbiAgICAgIC8vIGl0IGlzIG5lZWRlZCB0byBkZWZpbmUgYSB3YXkgdG8gaWRlbnRpZnkgdGhlIHRhcmdldCBtYXAgb3ZlciB3aGljaCB0aGUgcG9seWdvbiB3YXMgZHJhd24sIHNvIGl0IGNhbiBiZSBzYXZlZCBhcyBhIHZlY3RvciBkYXRhIHRvIHRoYXQgbWFwXG4gICAgICAvL3ZtLnJlc291cmNlLiRzYXZlKCk7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBPcGVuIHRoZSBkaWFsb2cgdG8gYWRkIGEgbWFwXG4gICAgICogQHJldHVybiB2b2lkXG4gICAgICovXG4gICAgZnVuY3Rpb24gb3BlbkFkZE1hcCgpIHtcbiAgICAgIG9wZW5EaWFsb2coKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVuIHRoZSBkaWFsb2cgdG8gZWRpdCBhIG1hcFxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7YW55fSByZXNvdXJjZSBcbiAgICAgKiAgQHJldHVybiB2b2lkXG4gICAgICovXG4gICAgZnVuY3Rpb24gb3BlbkVkaXRNYXAocmVzb3VyY2UpIHtcbiAgICAgIG9wZW5EaWFsb2cocmVzb3VyY2UpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9wZW4gdGhlIGRpYWxvZyB0aGF0IGFsbG93cyBhZGQgb3IgZWRpdCBhIG1hcFxuICAgICAqIFdoZW4gY2xvc2VkLCB0aGUgcmVzb3VyY2VzIChtYXBzKSB3aWxsIGJlIHJlZnJlc2hlZFxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7YW55fSByZXNvdXJjZSBcbiAgICAgKiBAcmV0dXJuIHZvaWRcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvcGVuRGlhbG9nKHJlc291cmNlKSB7XG4gICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICBsb2NhbHM6IHtcbiAgICAgICAgICBtYXBEaWFsb2dJbnB1dDoge1xuICAgICAgICAgICAgbW9kZWw6IHJlc291cmNlLFxuICAgICAgICAgICAgcmVtb3ZlRm46IHZtLnJlbW92ZVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgY29udHJvbGxlcjogJ01hcERpYWxvZ0NvbnRyb2xsZXInLFxuICAgICAgICBjb250cm9sbGVyQXM6ICdjdHJsJyxcbiAgICAgICAgdGVtcGxhdGVVcmw6IEdsb2JhbC5jbGllbnRQYXRoICsgJy9tYXAvZGlhbG9nL21hcC1kaWFsb2cuaHRtbCcsXG4gICAgICAgIGhhc0JhY2tkcm9wOiB0cnVlXG4gICAgICB9O1xuXG4gICAgICBDMkRpYWxvZy5jdXN0b20oY29uZmlnKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gcmVsb2FkIHRoZSBpdGVtcyBmcm9tIGJhY2stZW5kXG4gICAgICAgIHZtLnNlYXJjaCgpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbmZpZyhyb3V0ZXMpO1xuXG4gIC8qKlxuICAgKiBDb25maWd1cmF0aW9uIGZpbGUgZm9yIG1hcCByb3V0ZVxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gJHN0YXRlUHJvdmlkZXJcbiAgICogQHBhcmFtIHtvYmplY3R9IEdsb2JhbFxuICAgKi9cbiAgLyoqIEBuZ0luamVjdCAqL1xuICBmdW5jdGlvbiByb3V0ZXMoJHN0YXRlUHJvdmlkZXIsIEdsb2JhbCkge1xuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdhcHAubWFwJywge1xuICAgICAgdXJsOiAnL21hcCcsXG4gICAgICB0ZW1wbGF0ZVVybDogR2xvYmFsLmNsaWVudFBhdGggKyAnL21hcC9tYXAuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnTWFwQ29udHJvbGxlciBhcyBtYXBDdHJsJyxcbiAgICAgIGRhdGE6IHt9XG4gICAgfSk7XG4gIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnTWFwU2VydmljZScsIE1hcFNlcnZpY2UpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgZnVuY3Rpb24gTWFwU2VydmljZShzZXJ2aWNlRmFjdG9yeSkge1xuICAgIHZhciBtb2RlbCA9IHNlcnZpY2VGYWN0b3J5KCcvaGVpbWFwL21hcC8nLCB7XG4gICAgICBhY3Rpb25zOiB7fSxcbiAgICAgIGluc3RhbmNlOiB7fVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG1vZGVsO1xuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ0ZpbGVTZXJ2aWNlJywgRmlsZVNlcnZpY2UpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgZnVuY3Rpb24gRmlsZVNlcnZpY2Uoc2VydmljZUZhY3RvcnksICRodHRwLCAkcSkge1xuICAgIHZhciBlbmRQb2ludCA9ICcvaGVpbWFwL2ZpbGUnO1xuICAgIHZhciBtb2RlbCA9IHNlcnZpY2VGYWN0b3J5KGVuZFBvaW50LCB7XG4gICAgICBhY3Rpb25zOiB7fSxcbiAgICAgIGluc3RhbmNlOiB7XG4gICAgICAgIHVwbG9hZDogdXBsb2FkXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiB1cGxvYWQoKSB7XG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCB0aGlzLmZpbGUpO1xuICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHRoaXMubWFwX2ltYWdlX2ZpbGVfaWQpICYmIHRoaXMubWFwX2ltYWdlX2ZpbGVfaWQgIT09IG51bGwpIHtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdtYXBfaW1hZ2VfZmlsZV9pZCcsIHRoaXMubWFwX2ltYWdlX2ZpbGVfaWQpO1xuICAgICAgfVxuICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHRoaXMubWFwX2dlb19maWxlX3Byb2plY3Rpb24pICYmIHRoaXMubWFwX2dlb19maWxlX3Byb2plY3Rpb24gIT09IG51bGwpIHtcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdtYXBfZ2VvX2ZpbGVfcHJvamVjdGlvbicsIHRoaXMubWFwX2dlb19maWxlX3Byb2plY3Rpb24pO1xuICAgICAgfVxuXG4gICAgICAkaHR0cC5wb3N0KGVuZFBvaW50LCBmb3JtRGF0YSwge1xuICAgICAgICB0cmFuc2Zvcm1SZXF1ZXN0OiBhbmd1bGFyLmlkZW50aXR5LFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6IHVuZGVmaW5lZFxuICAgICAgICB9XG4gICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXN1bHQuZGF0YSk7XG4gICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG4gICAgcmV0dXJuIG1vZGVsO1xuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIE1hcCBMYXllciBTZXJ2aWNlIHJlc3BvbnNpYmxlIGZvciBidWlsZGluZyBiYXNpYyBsYXllcnMsIG1hbmFnaW5nIHRoZSBzdGF0ZSBvZiB0aGUgcmlnaHQgYW5kIGxlZnQgdmlld2VycyBcbiAqIGFuZCBpdHMgbGF5ZXJzLCBhcyB3ZWxsIGFzIGJhc2ljIGludGVyYWN0aW9ucyBzdXBwb3J0ZWQgYnkgbGVhZmxldCwgbGlrZSBjaGFuZ2Ugb3BhY2l0eSwgcmVvcmRlciBldGMuXG4gKiBcbiAqIEFzIGEgY2VudHJhbGl6ZWQgc2VydmljZSB0aGlzIHNlcnZpY2UgZXhlY3V0ZSBhY3Rpb25zIGFuZCBicm9hZGNhc3QgZXZlbnRzIHdoZW4gdGhlIHN0YXRlIGNoYW5nZXNcbiAqIFRoZSBmb2xsb3dpbmcgZXZlbnRzIGFyZSBicm9hZGNhc3RlZDpcbiAqIFxuICogdW5nZW9yZWZlcmVuY2VkTGF5ZXJUb0JlTG9hZGVkXG4gKiBnZW9yZWZlcmVuY2VkTGF5ZXJUb0JlTG9hZGVkXG4gKiBtYXBMYXllcnNDaGFuZ2VkXG4gKiBhZGRlZE1hcExheWVyXG4gKiByZW1vdmVkTWFwTGF5ZXJcbiAqIHJlbW92ZWRBbGxNYXBMYXllcnNcbiAqIG1hcEhpZGRlblxuICogbWFwU2hvd25cbiAqIHZpZXdlckhpZGRlblxuICogdmlld2VyU2hvd25cbiAqIG1hcExheWVyc1Jlb3JkZXJlZFxuICogYWRkZWRNYXBEcmF3XG4gKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdNYXBMYXllclNlcnZpY2UnLCBNYXBMYXllclNlcnZpY2UpO1xuXG4gIGZ1bmN0aW9uIE1hcExheWVyU2VydmljZShsZWFmbGV0RGF0YSwgbGVhZmxldCwgbG9kYXNoLCBTdXBwb3J0U2VydmljZSwgJHJvb3RTY29wZSwgJHEsICR0aW1lb3V0KSB7XG4gICAgdmFyIHNlcnZpY2UgPSB7XG4gICAgICBidWlsZERlZmF1bHRMYXllcnM6IGJ1aWxkRGVmYXVsdExheWVycyxcbiAgICAgIGFkZE1hcExheWVyOiBhZGRNYXBMYXllcixcbiAgICAgIHJlbW92ZU1hcExheWVyOiByZW1vdmVNYXBMYXllcixcbiAgICAgIGhpZGVNYXA6IGhpZGVNYXAsXG4gICAgICBzaG93TWFwOiBzaG93TWFwLFxuICAgICAgLy8gYWRkTWFwTGF5ZXI6IGFkZE1hcExheWVyLFxuICAgICAgc2VydmVyQ29uZmlnOiBudWxsLFxuICAgICAgaXNBZGRlZDogaXNBZGRlZCxcbiAgICAgIGZpdE1hcEJvdW5kczogZml0TWFwQm91bmRzLFxuICAgICAgYXBwbHlPcGFjaXR5OiBhcHBseU9wYWNpdHksXG4gICAgICBoYXNOb25HZW9yZWZlcmVuY2VkTGF5ZXI6IGhhc05vbkdlb3JlZmVyZW5jZWRMYXllcixcbiAgICAgIHJlbW92ZUFsbE1hcExheWVyczogcmVtb3ZlQWxsTWFwTGF5ZXJzLFxuICAgICAgZ2V0Vmlld2VyT3ZlcmxheXM6IGdldFZpZXdlck92ZXJsYXlzLFxuICAgICAgZ2V0Vmlld2VyRGF0YTogZ2V0Vmlld2VyRGF0YSxcbiAgICAgIGdldERlZmF1bHRDZW50ZXI6IGdldERlZmF1bHRDZW50ZXIsXG4gICAgICByZWZyZXNoTWFwUmVzb3VyY2U6IHJlZnJlc2hNYXBSZXNvdXJjZSxcbiAgICAgIGhpZGVWaWV3ZXI6IGhpZGVWaWV3ZXIsXG4gICAgICBzaG93Vmlld2VyOiBzaG93Vmlld2VyLFxuICAgICAgYXBwbHlSZW9yZGVyOiBhcHBseVJlb3JkZXIsXG4gICAgICBzZXRXaGVlbFpvb21TdGF0dXM6IHNldFdoZWVsWm9vbVN0YXR1cyxcbiAgICAgIGdldFZpZXdlckRyYXdzOiBnZXRWaWV3ZXJEcmF3cyxcbiAgICAgIGdldE92ZXJsYXlzQ291bnRCb29sOiBnZXRPdmVybGF5c0NvdW50Qm9vbCxcbiAgICAgIGFkZFdGU0xheWVyOiBhZGRXRlNMYXllclxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBQcml2YXRlIHByb3BlcnR5IHRoYXQgc3RvcmVzIHRoZSBiYXNlIGxheWVycyAvIG92ZXJsYXlzIFxuICAgICAqICBcbiAgICAgKi9cbiAgICB2YXIgc2VydmljZURhdGEgPSB7fTtcblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgdmlld2VyIG92ZXJsYXlzXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IHZpZXdlcklkIFxuICAgICAqIEByZXR1cm5zIHt9XG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0Vmlld2VyT3ZlcmxheXModmlld2VySWQpIHtcbiAgICAgIHZhciB2aWV3ZXJEYXRhID0gZ2V0Vmlld2VyRGF0YSh2aWV3ZXJJZCk7XG4gICAgICB2YXIgb3ZlcmxheXMgPSBhbmd1bGFyLmNvcHkodmlld2VyRGF0YS5vdmVybGF5cyk7XG4gICAgICBpZiAob3ZlcmxheXMgJiYgYW5ndWxhci5pc0RlZmluZWQob3ZlcmxheXMuZHJhdykpIHtcbiAgICAgICAgZGVsZXRlIG92ZXJsYXlzLmRyYXc7XG4gICAgICB9XG4gICAgICByZXR1cm4gb3ZlcmxheXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSB2aWV3ZXIgZHJhd3NcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gdmlld2VySWQgXG4gICAgICogQHJldHVybnMge31cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRWaWV3ZXJEcmF3cyh2aWV3ZXJJZCkge1xuICAgICAgdmFyIHZpZXdlckRhdGEgPSBnZXRWaWV3ZXJEYXRhKHZpZXdlcklkKTtcbiAgICAgIHZhciBvdmVybGF5cyA9IGFuZ3VsYXIuY29weSh2aWV3ZXJEYXRhLm92ZXJsYXlzKTtcbiAgICAgIGlmIChvdmVybGF5cyAmJiBhbmd1bGFyLmlzRGVmaW5lZChvdmVybGF5cy5kcmF3KSkge1xuICAgICAgICByZXR1cm4gb3ZlcmxheXMuZHJhdztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIG1vdXNlIHdoZWVsIHNjcm9sbCB6b29tIGNvbnRyb2wgYXMgZW5hYmxlZC9kaXNhYmxlZCBmb3IgYSBjZXJ0YWluIHZpZXdlclxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2aWV3ZXJJZCBcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGVuYWJsZWRcbiAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2V0V2hlZWxab29tU3RhdHVzKHZpZXdlcklkLCBlbmFibGVkKSB7XG4gICAgICBsZWFmbGV0RGF0YS5nZXRNYXAodmlld2VySWQpLnRoZW4oZnVuY3Rpb24gKG1hcCkge1xuICAgICAgICBpZiAoZW5hYmxlZCA9PT0gdHJ1ZSkge1xuICAgICAgICAgIG1hcC5zY3JvbGxXaGVlbFpvb20uZW5hYmxlKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbWFwLnNjcm9sbFdoZWVsWm9vbS5kaXNhYmxlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBib29sZWFuLiBUcnVlIGlmIHRoZXJlIGFyZSBubyBvdmVybGF5cyBhZGRlZC5cbiAgICAgKiBcbiAgICAgKiBcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRPdmVybGF5c0NvdW50Qm9vbCgpIHtcbiAgICAgIGlmIChPYmplY3QudmFsdWVzKHNlcnZpY2VEYXRhKVswXVtcIm92ZXJsYXlzXCJdID09IHVuZGVmaW5lZCAmJiBPYmplY3QudmFsdWVzKHNlcnZpY2VEYXRhKVsxXVtcIm92ZXJsYXlzXCJdID09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdmlldyBkYXRhIGJ5IHZpZXdlciBJRFxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7YW55fSB2aWV3ZXJJZCBcbiAgICAgKiBAcmV0dXJucyB7fVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldFZpZXdlckRhdGEodmlld2VySWQpIHtcbiAgICAgIHZpZXdlcklkID0gcGFyc2VNYXBWaWV3ZXJJZCh2aWV3ZXJJZCk7XG4gICAgICBpZiAodmlld2VySWQgaW4gc2VydmljZURhdGEpIHtcbiAgICAgICAgcmV0dXJuIHNlcnZpY2VEYXRhW3ZpZXdlcklkXTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBCdWlsZCB0aGUgZGVmYXVsdCBiYXNlIGxheWVyc1xuICAgICAqIEBwYXJhbSB7fSBvcHRpb25zXG4gICAgICovXG4gICAgZnVuY3Rpb24gYnVpbGREZWZhdWx0TGF5ZXJzKG9wdGlvbnMpIHtcbiAgICAgIG9wdGlvbnMgPSBhbmd1bGFyLmlzVW5kZWZpbmVkKG9wdGlvbnMpID8ge30gOiBvcHRpb25zO1xuXG4gICAgICBTdXBwb3J0U2VydmljZS5jb25maWcoKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICBzZXJ2aWNlLnNlcnZlckNvbmZpZyA9IHJlc3BvbnNlO1xuICAgICAgfSk7XG5cbiAgICAgIHNlcnZpY2VEYXRhLmxlZnRNYXBWaWV3ZXIgPSB7XG4gICAgICAgIGJhc2VsYXllcnM6IGdldEJhc2VMYXllcnMoKVxuICAgICAgfTtcblxuICAgICAgaWYgKG9wdGlvbnMuc3VwcG9ydERyYXdpbmcpIHtcbiAgICAgICAgc2VydmljZURhdGEubGVmdE1hcFZpZXdlci5vdmVybGF5cyA9IHtcbiAgICAgICAgICBkcmF3OiB7XG4gICAgICAgICAgICBuYW1lOiAnZHJhdycsXG4gICAgICAgICAgICB0eXBlOiAnZ3JvdXAnLFxuICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGxheWVyUGFyYW1zOiB7XG4gICAgICAgICAgICAgIHNob3dPblNlbGVjdG9yOiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIC8vIEF0IHRoZSBiZWdpbm5pbmcgYm90aCBtYXAgbGF5ZXJzIGFyZSBlcXVhbFxuICAgICAgc2VydmljZURhdGEucmlnaHRNYXBWaWV3ZXIgPSBhbmd1bGFyLmNvcHkoc2VydmljZURhdGEubGVmdE1hcFZpZXdlcik7XG4gICAgICBsaXN0ZW5BbmRBcHBseURyYXcoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBcHBseSBkcmF3IGFzIG5ldyBsYXllciBvbiBkcmF3XG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gbGlzdGVuQW5kQXBwbHlEcmF3KCkge1xuICAgICAgZnVuY3Rpb24ga2VlcERyYXcodmlld2VySWQpIHtcbiAgICAgICAgbGVhZmxldERhdGEuZ2V0TWFwKHZpZXdlcklkKS50aGVuKGZ1bmN0aW9uIChtYXApIHtcbiAgICAgICAgICBsZWFmbGV0RGF0YS5nZXRMYXllcnModmlld2VySWQpLnRoZW4oZnVuY3Rpb24gKGJhc2VsYXllcnMpIHtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiYmFzZWx5ZXIgPSBcIiwgYmFzZWxheWVycyk7XG4gICAgICAgICAgICB2YXIgZHJhd25JdGVtcyA9IGJhc2VsYXllcnMub3ZlcmxheXMuZHJhdztcbiAgICAgICAgICAgIC8vIGFkZGVkIGNvbmRpdGlvbiB0byBoYW5kbGUgcmVjdGFuZ2xlIHNlbGVjdGlvbiBmb3IgR2VvcmVmXG4gICAgICAgICAgICBpZiAodHlwZW9mIGRyYXduSXRlbXMgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgbWFwLm9uKCdkcmF3OmNyZWF0ZWQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIHZhciBsYXllciA9IGUubGF5ZXI7XG4gICAgICAgICAgICAgICAgZHJhd25JdGVtcy5hZGRMYXllcihsYXllcik7XG4gICAgICAgICAgICAgICAgdmFyIGRyYXdzR2VvSnNvbiA9IGxheWVyLnRvR2VvSlNPTigpO1xuICAgICAgICAgICAgICAgIC8vIGJyb2FkY2FzdCB0aGUgZXZlbnRzXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdtYXBMYXllcnNDaGFuZ2VkJyk7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdhZGRlZE1hcERyYXcnLCBkcmF3c0dlb0pzb24pO1xuICAgICAgICAgICAgICB9LmJpbmQoZHJhd25JdGVtcykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGtlZXBEcmF3KCdsZWZ0TWFwVmlld2VyJyk7XG4gICAgICBrZWVwRHJhdygncmlnaHRNYXBWaWV3ZXInKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGRlZmF1bHQgY2VudGVyIGZvciBhIGxheWVyXG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0RGVmYXVsdENlbnRlcigpIHtcbiAgICAgIC8vIEhlaWRlbGJlcmcsIEdlcm1hbnlcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxhdDogNDkuMzk5MjI4LFxuICAgICAgICBsbmc6IDguNjgwNTIyLFxuICAgICAgICB6b29tOiA4XG4gICAgICB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgYmFzZSBsYXllcnNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRCYXNlTGF5ZXJzKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgeHl6OiB7XG4gICAgICAgICAgbmFtZTogJ09wZW5TdHJlZXRNYXAnLFxuICAgICAgICAgIHVybDogJ2h0dHA6Ly97c30udGlsZS5vcGVuc3RyZWV0bWFwLm9yZy97en0ve3h9L3t5fS5wbmcnLFxuICAgICAgICAgIHR5cGU6ICd4eXonLFxuICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgbGF5ZXJPcHRpb25zOiB7XG4gICAgICAgICAgICB6SW5kZXg6IDBcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGJpbmdBZXJpYWw6IHtcbiAgICAgICAgICBuYW1lOiAnQWVyaWFsJyxcbiAgICAgICAgICB0eXBlOiAnYmluZycsXG4gICAgICAgICAga2V5OiAnQWo2WHRFMVExckl2ZWhtam4yUmgxTFIycXZNR1otOHZQUzlIbjNqQ2VVaVRvTTc3SkZuZi1rRlJ6eU1FTERvbCcsXG4gICAgICAgICAgbGF5ZXJPcHRpb25zOiB7XG4gICAgICAgICAgICB0eXBlOiAnQWVyaWFsJyxcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICB6SW5kZXg6IDBcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGJpbmdSb2FkOiB7XG4gICAgICAgICAgbmFtZTogJ1JvYWQnLFxuICAgICAgICAgIHR5cGU6ICdiaW5nJyxcbiAgICAgICAgICBrZXk6ICdBajZYdEUxUTFySXZlaG1qbjJSaDFMUjJxdk1HWi04dlBTOUhuM2pDZVVpVG9NNzdKRm5mLWtGUnp5TUVMRG9sJyxcbiAgICAgICAgICBsYXllck9wdGlvbnM6IHtcbiAgICAgICAgICAgIHR5cGU6ICdSb2FkJyxcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICB6SW5kZXg6IDBcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGJpbmdBZXJpYWxXaXRoTGFiZWxzOiB7XG4gICAgICAgICAgbmFtZTogJ0FlcmlhbCBXaXRoIExhYmVscycsXG4gICAgICAgICAgdHlwZTogJ2JpbmcnLFxuICAgICAgICAgIGtleTogJ0FqNlh0RTFRMXJJdmVobWpuMlJoMUxSMnF2TUdaLTh2UFM5SG4zakNlVWlUb003N0pGbmYta0ZSenlNRUxEb2wnLFxuICAgICAgICAgIGxheWVyT3B0aW9uczoge1xuICAgICAgICAgICAgdHlwZTogJ0FlcmlhbFdpdGhMYWJlbHMnLFxuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIHpJbmRleDogMFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBCdWlsZCBhbiBhZGRpdGlvbmFsIG92ZXJsYXlzXG4gICAgICogQHBhcmFtIHt9IHJlc291cmNlIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJ1aWxkTWFwT3ZlcmxheShyZXNvdXJjZSkge1xuICAgICAgdmFyIGxheWVyID0ge1xuICAgICAgICBuYW1lOiByZXNvdXJjZS50aXRsZSxcbiAgICAgICAgdHlwZTogJ3dtcycsXG4gICAgICAgIHZpc2libGU6IHRydWUsXG4gICAgICAgIHVybDogc2VydmljZS5zZXJ2ZXJDb25maWcuYmFzZV9vd3NfdXJsLFxuICAgICAgICBsYXllclBhcmFtczoge1xuICAgICAgICAgIGxheWVyczogcmVzb3VyY2UuZ2Vvc2VydmVyX2xheWVyX2lkLFxuICAgICAgICAgIGZvcm1hdDogJ2ltYWdlL3BuZycsXG4gICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsXG4gICAgICAgICAgb3BhY2l0eTogMC43XG4gICAgICAgIH0sXG4gICAgICAgIGxheWVyT3B0aW9uczoge1xuICAgICAgICAgIG9wYWNpdHk6IDAuNyxcbiAgICAgICAgICB0aWxlZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICByZXNvdXJjZTogcmVzb3VyY2VcbiAgICAgIH07XG4gICAgICByZXR1cm4gbGF5ZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRml0IHRoZSBtYXAgdmlldyB0byB0aGUgYm91bmRzIG9mIGEgbGF5ZXJcbiAgICAgKiBAcGFyYW0gb2JqZWN0IHJlc291cmNlIFxuICAgICAqIEBwYXJhbSBzdHJpbmcgbWFwQ29tcG9uZW50SWQgXG4gICAgICovXG4gICAgZnVuY3Rpb24gZml0TWFwQm91bmRzKHJlc291cmNlLCB2aWV3ZXJJZCkge1xuICAgICAgdmlld2VySWQgPSBwYXJzZU1hcFZpZXdlcklkKHZpZXdlcklkKTtcbiAgICAgIGxlYWZsZXREYXRhLmdldE1hcCh2aWV3ZXJJZCkudGhlbihmdW5jdGlvbiAobWFwKSB7XG4gICAgICAgIHZhciBib3VuZHMgPSBbW3Jlc291cmNlLm1hcF90b3BfbGVmdF9sb25nLCByZXNvdXJjZS5tYXBfdG9wX2xlZnRfbGF0XSwgW3Jlc291cmNlLm1hcF9yaWdodF9ib3R0b21fbG9uZywgcmVzb3VyY2UubWFwX3JpZ2h0X2JvdHRvbV9sYXRdXTtcbiAgICAgICAgbWFwLmZpdEJvdW5kcyhib3VuZHMpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXBwbHkgdGhlIGxheWVyIGRlZmluZWQgb3BhY2l0eSBvciB0aGUgdmFsdWUgZGVmaW5lZCBpbiB0aGUgbGF5ZXIgdHJhbnNwYXJlbmN5IHByb3BlcnR5XG4gICAgICogQHBhcmFtIHt9IGxheWVyIFxuICAgICAqIEBwYXJhbSBzdHJpbmcgdmlld2VySWQgXG4gICAgICovXG4gICAgZnVuY3Rpb24gYXBwbHlPcGFjaXR5KGxheWVyKSB7XG4gICAgICBsZWFmbGV0RGF0YS5nZXRMYXllcnMobGF5ZXIudmlld2VySWQpLnRoZW4oZnVuY3Rpb24gKGxheWVycykge1xuICAgICAgICB2YXIgb3ZlcmxheUlkID0gcGFyc2VNYXBPdmVybGF5SWQobGF5ZXIudmlld2VySWQsIGxheWVyLnJlc291cmNlKTtcbiAgICAgICAgbGF5ZXJzLm92ZXJsYXlzW292ZXJsYXlJZF0uc2V0T3BhY2l0eShsYXllci5sYXllclBhcmFtcy5vcGFjaXR5KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZCBhIG1hcCBhcyBhIGxheWVyIHRvIHRoZSBtYXBzIChsZWZ0IGFuZCByaWdodClcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gb2JqZWN0IHJlc291cmNlIHJlcHJlc2VudGluZyBtYXBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhZGRNYXBMYXllcihyZXNvdXJjZSwgdmlld2VySWQpIHtcblxuICAgICAgLy8gY29uc29sZS5sb2cocmVzb3VyY2UpXG5cbiAgICAgIGlmIChpc0FkZGVkKHJlc291cmNlLCB2aWV3ZXJJZCkgPT09IGZhbHNlKSB7XG5cbiAgICAgICAgcHJlcGFyZVZpZXdlcihyZXNvdXJjZSwgdmlld2VySWQpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgIC8vIHBhcnNlIHRoZSB2aWV3ZXIgaWQgYW5kIG1ha2Ugc3VyZSB0aGF0XG4gICAgICAgICAgLy8gdGhlIG92ZXJsYXlzIHByb3BlcnR5IGlzIGluaXRpYWxpemVkXG4gICAgICAgICAgdmlld2VySWQgPSBwYXJzZU1hcFZpZXdlcklkKHZpZXdlcklkKTtcbiAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChzZXJ2aWNlRGF0YVt2aWV3ZXJJZF0ub3ZlcmxheXMpKSB7XG4gICAgICAgICAgICBzZXJ2aWNlRGF0YVt2aWV3ZXJJZF0ub3ZlcmxheXMgPSB7fTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBidWlsZCBhIG5ldyBvdmVybGF5XG4gICAgICAgICAgdmFyIG5ld0xheWVyID0gYnVpbGRNYXBPdmVybGF5KHJlc291cmNlKTtcbiAgICAgICAgICAvLyBzZXQgdGhlIHZpZXdlcklkIGluIGFzIGEgcHJvcGVydHkgKGluIHNvbWUgbG9vcCBpdCBjYW4gYmUgdXNlZnVsKVxuICAgICAgICAgIG5ld0xheWVyLnZpZXdlcklkID0gdmlld2VySWQ7XG4gICAgICAgICAgdmFyIG92ZXJsYXlJZCA9IHBhcnNlTWFwT3ZlcmxheUlkKHZpZXdlcklkLCByZXNvdXJjZSk7XG5cbiAgICAgICAgICAvLyBhZGQgdGhlIG5ldyBsYXllciBhcyBhIHByb3BlcnR5IG9mIHRoZSBsYXllclxuICAgICAgICAgIHNlcnZpY2VEYXRhW3ZpZXdlcklkXS5vdmVybGF5c1tvdmVybGF5SWRdID0gbmV3TGF5ZXI7XG5cbiAgICAgICAgICAvLyBmaXQgdGhlIGJvdW5kcyBvZiB0aGUgbmV3IGxvYWRlZCBtYXAgbGF5ZXIsIHNvIGl0IGlzIHZpc2libGVcbiAgICAgICAgICBmaXRNYXBCb3VuZHMocmVzb3VyY2UsIHZpZXdlcklkKTtcbiAgICAgICAgICBsaXN0ZW5BbmRBcHBseURyYXcoKTtcblxuICAgICAgICAgIC8vIGJyb2FkY2FzdCB0aGUgZXZlbnRzXG4gICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdtYXBMYXllcnNDaGFuZ2VkJyk7XG4gICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdhZGRlZE1hcExheWVyJywgcmVzb3VyY2UpO1xuICAgICAgICAgIHNob3dNYXAocmVzb3VyY2UsIHZpZXdlcklkKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUHJlcGFyZSBzYSB2aWV3ZXIgZm9yIGxvYWRpbmcgbWFwIGxheWVyIGFjY29yZGluZyBpdHMgZ2VvcmVmZXJlbmNpbmcgc3RhdHVzXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IHJlc291cmNlIFxuICAgICAqIEBwYXJhbSB7YW55fSB2aWV3ZXJJZCBcbiAgICAgKiBAcmV0dXJucyBwcm9taXNlIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHByZXBhcmVWaWV3ZXIocmVzb3VyY2UsIHZpZXdlcklkKSB7XG4gICAgICBpZiAocmVzb3VyY2UuZ2VvcmVmZXJlbmNlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuIHByZXBhcmVGb3JVbmdlb3JlZmVyZW5jZWQodmlld2VySWQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHByZXBhcmVGb3JHZW9yZWZlcmVuY2VkKHZpZXdlcklkKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQcmVwYXJlIHRoZSB2aWV3ZXIgdG8gbG9hZCBhbiB1bmdlb3JlZmVyZW5jZWQgbGF5ZXIsIHJlbW92aW5nIGFsbCB0aGUgYmFzZSBsYXllcnMgYW5kIG92ZXJsYXlzXG4gICAgICogQHBhcmFtIHt9IHZpZXdlcklkIFxuICAgICAqIEByZXR1cm5zIHByb21pc2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBwcmVwYXJlRm9yVW5nZW9yZWZlcmVuY2VkKHZpZXdlcklkKSB7XG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCd1bmdlb3JlZmVyZW5jZWRMYXllclRvQmVMb2FkZWQnLCB2aWV3ZXJJZCk7XG5cbiAgICAgIC8vIHRvIGdpdmUgdGhlIG9wcG9ydHVuaXR5IHRvIHRoZSB1bmdlb3JlZmVyZW5jZWRMYXllclRvQmVMb2FkZWQgZXZlbnQgbGlzdGVuZXJzXG4gICAgICAvLyB0byBkbyBzb21lIGFjdGlvbiBiZWZvcmUgdGhlIHZpZXdlciBpcyBwcmVwYXJlZCwgaXQgaXMgbmVjZXNzYXJ5IHRvIHdhaXQgYSBsaXR0bGVcbiAgICAgIC8vIHNvIHdlIHVzZSB0aGUgdGltZW91dCBmb3IgdGhhdC4gMjAwIG1pbGxpc2Vjb25kcyBhcHBlYXJzIHRvIGJlIGVub3VnaFxuICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBzZXJ2aWNlRGF0YVt2aWV3ZXJJZF0ub3ZlcmxheXMgPSB7fTtcbiAgICAgICAgc2VydmljZURhdGFbdmlld2VySWRdLmJhc2VsYXllcnMgPSB7fTtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgfSwgMjAwKTtcblxuICAgICAgLy8gcmV0dXJuIHRoZSBwcm9taXNlXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQcmVwYXJlIHRoZSB2aWV3ZXIgdG8gbG9hZCBhbiB1bmdlb3JlZmVyZW5jZWQgbGF5ZXIsIHJlbW92aW5nIGFsbCB0aGUgYmFzZSBsYXllcnMgYW5kIG92ZXJsYXlzXG4gICAgICogQHBhcmFtIHt9IHZpZXdlcklkIFxuICAgICAqIEByZXR1cm5zIHByb21pc2VcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBwcmVwYXJlRm9yR2VvcmVmZXJlbmNlZCh2aWV3ZXJJZCkge1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnZ2VvcmVmZXJlbmNlZExheWVyVG9CZUxvYWRlZCcsIHZpZXdlcklkKTtcblxuICAgICAgLy8gdG8gZ2l2ZSB0aGUgb3Bwb3J0dW5pdHkgdG8gdGhlIHVuZ2VvcmVmZXJlbmNlZExheWVyVG9CZUxvYWRlZCBldmVudCBsaXN0ZW5lcnNcbiAgICAgIC8vIHRvIGRvIHNvbWUgYWN0aW9uIGJlZm9yZSB0aGUgdmlld2VyIGlzIHByZXBhcmVkLCBpdCBpcyBuZWNlc3NhcnkgdG8gd2FpdCBhIGxpdHRsZVxuICAgICAgLy8gc28gd2UgdXNlIHRoZSB0aW1lb3V0IGZvciB0aGF0LiAyMDAgbWlsbGlzZWNvbmRzIGFwcGVhcnMgdG8gYmUgZW5vdWdoXG4gICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlcnZpY2VEYXRhW3ZpZXdlcklkXS5iYXNlbGF5ZXJzID0gZ2V0QmFzZUxheWVycygpO1xuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICB9LCAyMDApO1xuXG4gICAgICAvLyByZXR1cm4gdGhlIHByb21pc2VcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhIG1hcCByZXNvdXJjZSBmcm9tIHRoZSBvdmVybGF5c1xuICAgICAqIEBwYXJhbSB7fSByZXNvdXJjZSBtYXBcbiAgICAgKiBAcGFyYW0gc3RyaW5nIHZpZXdlcklkIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlbW92ZU1hcExheWVyKHJlc291cmNlLCB2aWV3ZXJJZCkge1xuICAgICAgdmlld2VySWQgPSBwYXJzZU1hcFZpZXdlcklkKHZpZXdlcklkKTtcbiAgICAgIHZhciBvdmVybGF5SWQgPSBwYXJzZU1hcE92ZXJsYXlJZCh2aWV3ZXJJZCwgcmVzb3VyY2UpO1xuICAgICAgZGVsZXRlIHNlcnZpY2VEYXRhW3ZpZXdlcklkXS5vdmVybGF5c1tvdmVybGF5SWRdO1xuICAgICAgbGlzdGVuQW5kQXBwbHlEcmF3KCk7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ21hcExheWVyc0NoYW5nZWQnKTtcbiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVtb3ZlZE1hcExheWVyJywgcmVzb3VyY2UpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhIG1hcCByZXNvdXJjZSBmcm9tIHRoZSBvdmVybGF5c1xuICAgICAqIEBwYXJhbSB7fSByZXNvdXJjZSBtYXBcbiAgICAgKiBAcGFyYW0gc3RyaW5nIHZpZXdlcklkIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlbW92ZUFsbE1hcExheWVycyh2aWV3ZXJJZCkge1xuICAgICAgdmlld2VySWQgPSBwYXJzZU1hcFZpZXdlcklkKHZpZXdlcklkKTtcbiAgICAgIHNlcnZpY2VEYXRhW3ZpZXdlcklkXS5vdmVybGF5cyA9IHt9O1xuICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdtYXBMYXllcnNDaGFuZ2VkJyk7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbW92ZWRBbGxNYXBMYXllcnMnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIaWRlIGEgbWFwIGJ1dCBrZWVwIGl0IGluIHRoZSBsb2FkZWQgbGlzdFxuICAgICAqIEBwYXJhbSB7fSByZXNvdXJjZSBtYXBcbiAgICAgKiBAcGFyYW0gc3RyaW5nIHZpZXdlcklkIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGhpZGVNYXAocmVzb3VyY2UsIHZpZXdlcklkKSB7XG4gICAgICB2aWV3ZXJJZCA9IHBhcnNlTWFwVmlld2VySWQodmlld2VySWQpO1xuICAgICAgdmFyIG92ZXJsYXlJZCA9IHBhcnNlTWFwT3ZlcmxheUlkKHZpZXdlcklkLCByZXNvdXJjZSk7XG4gICAgICBzZXJ2aWNlRGF0YVt2aWV3ZXJJZF0ub3ZlcmxheXNbb3ZlcmxheUlkXS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ21hcExheWVyc0NoYW5nZWQnKTtcbiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbWFwSGlkZGVuJywgcmVzb3VyY2UpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNob3cgYSBtYXAgcHJldmlvdXNseSBsb2FkZWRcbiAgICAgKiBAcGFyYW0ge30gcmVzb3VyY2UgbWFwXG4gICAgICogQHBhcmFtIHN0cmluZyB2aWV3ZXJJZCBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzaG93TWFwKHJlc291cmNlLCB2aWV3ZXJJZCkge1xuICAgICAgdmlld2VySWQgPSBwYXJzZU1hcFZpZXdlcklkKHZpZXdlcklkKTtcbiAgICAgIHZhciBvdmVybGF5SWQgPSBwYXJzZU1hcE92ZXJsYXlJZCh2aWV3ZXJJZCwgcmVzb3VyY2UpO1xuICAgICAgc2VydmljZURhdGFbdmlld2VySWRdLm92ZXJsYXlzW292ZXJsYXlJZF0udmlzaWJsZSA9IHRydWU7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ21hcExheWVyc0NoYW5nZWQnKTtcbiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbWFwU2hvd24nLCByZXNvdXJjZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGlkZSBhIHZpZXdlclxuICAgICAqIEBwYXJhbSBzdHJpbmcgdmlld2VySWQgXG4gICAgICovXG4gICAgZnVuY3Rpb24gaGlkZVZpZXdlcih2aWV3ZXJJZCkge1xuICAgICAgdmlld2VySWQgPSBwYXJzZU1hcFZpZXdlcklkKHZpZXdlcklkKTtcbiAgICAgIHNlcnZpY2VEYXRhW3ZpZXdlcklkXS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ21hcFZpZXdlcnNDaGFuZ2VkJyk7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3ZpZXdlckhpZGRlbicsIHZpZXdlcklkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaG93IGEgdmlld2VyICAgICBcbiAgICAgKiBAcGFyYW0gc3RyaW5nIHZpZXdlcklkIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNob3dWaWV3ZXIodmlld2VySWQpIHtcbiAgICAgIHZpZXdlcklkID0gcGFyc2VNYXBWaWV3ZXJJZCh2aWV3ZXJJZCk7XG4gICAgICBzZXJ2aWNlRGF0YVt2aWV3ZXJJZF0udmlzaWJsZSA9IHRydWU7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ21hcFZpZXdlcnNDaGFuZ2VkJyk7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3ZpZXdlclNob3duJywgdmlld2VySWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFBhcnNlIGEgZGVmYXVsdCBsYXllciBpZFxuICAgICAqIEBwYXJhbSBzdHJpbmcgdmlld2VySWQgXG4gICAgICovXG4gICAgZnVuY3Rpb24gcGFyc2VNYXBWaWV3ZXJJZCh2aWV3ZXJJZCkge1xuICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQodmlld2VySWQpIHx8IHZpZXdlcklkID09PSBudWxsKSB7XG4gICAgICAgIHZpZXdlcklkID0gJ3JpZ2h0TWFwVmlld2VyJztcbiAgICAgIH1cbiAgICAgIHJldHVybiB2aWV3ZXJJZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQYXJzZSBhIGRlZmF1bHQgbGF5ZXIgaWRcbiAgICAgKiBAcGFyYW0gc3RyaW5nIHZpZXdlcklkIFxuICAgICAqIEBwYXJhbSB7fSByZXNvdXJjZSBtYXAgXG4gICAgICovXG4gICAgZnVuY3Rpb24gcGFyc2VNYXBPdmVybGF5SWQodmlld2VySWQsIHJlc291cmNlKSB7XG4gICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZCh2aWV3ZXJJZCkgfHwgdmlld2VySWQgPT09IG51bGwpIHtcbiAgICAgICAgdmlld2VySWQgPSAncmlnaHRNYXBWaWV3ZXInO1xuICAgICAgfVxuICAgICAgdmFyIG92ZXJsYXlJZCA9IHZpZXdlcklkICsgcmVzb3VyY2UuaWQ7XG4gICAgICByZXR1cm4gb3ZlcmxheUlkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGNoZWNrIGlmIGEgbWFwIHJlc291cmNlIGlzIGFscmVhZHkgbG9hZGVkXG4gICAgICogXG4gICAgICogQHBhcmFtIG9iamVjdCByZXNvdXJjZSBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc0FkZGVkKHJlc291cmNlLCB2aWV3ZXJJZCkge1xuICAgICAgdmlld2VySWQgPSBwYXJzZU1hcFZpZXdlcklkKHZpZXdlcklkKTtcbiAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKHNlcnZpY2VEYXRhW3ZpZXdlcklkXS5vdmVybGF5cykpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdmFyIG92ZXJsYXlJZCA9IHBhcnNlTWFwT3ZlcmxheUlkKHZpZXdlcklkLCByZXNvdXJjZSk7XG4gICAgICByZXR1cm4gYW5ndWxhci5pc0RlZmluZWQoc2VydmljZURhdGFbdmlld2VySWRdLm92ZXJsYXlzW292ZXJsYXlJZF0pO1xuICAgICAgLy9yZXR1cm4gKHJlc291cmNlLmlkIGluIHNlcnZpY2VEYXRhW3ZpZXdlcklkXS5vdmVybGF5cyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgIHRoZXJlIGFyZSBub24gZ2VvcmVmZXJlbmNlZCBsYXllcnMgbG9hZGVkIGluIHRoZSB2aWV3ZXJcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gc3RyaW5nIHZpZXdlcklkIFxuICAgICAqIEByZXR1cm5zIGJvb2xlYW5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBoYXNOb25HZW9yZWZlcmVuY2VkTGF5ZXIodmlld2VySWQpIHtcbiAgICAgIHZpZXdlcklkID0gcGFyc2VNYXBWaWV3ZXJJZCh2aWV3ZXJJZCk7XG4gICAgICB2YXIgbm9uR2VvTGF5ZXJzID0gbG9kYXNoLmZpbHRlcihnZXRWaWV3ZXJPdmVybGF5cyh2aWV3ZXJJZCksIGZ1bmN0aW9uIChsYXllcikge1xuICAgICAgICByZXR1cm4gbGF5ZXIucmVzb3VyY2UuZ2VvcmVmZXJlbmNlZCA9PT0gZmFsc2U7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBhbmd1bGFyLmlzQXJyYXkobm9uR2VvTGF5ZXJzKSAmJiBub25HZW9MYXllcnMubGVuZ3RoID4gMDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWZyZXNoIHRoZSByZXNvdXJjZSBvZiBhIGxheWVyXG4gICAgICogQHBhcmFtIHtyZXNvdXJjZX0gcmVzb3VyY2UgXG4gICAgICogQHBhcmFtIHN0cmluZyB2aWV3ZXJJZCBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZWZyZXNoTGF5ZXJSZXNvdXJjZShyZXNvdXJjZSwgdmlld2VySWQpIHtcbiAgICAgIHZpZXdlcklkID0gcGFyc2VNYXBWaWV3ZXJJZCh2aWV3ZXJJZCk7XG4gICAgICB2YXIgb3ZlcmxheUlkID0gcGFyc2VNYXBPdmVybGF5SWQodmlld2VySWQsIHJlc291cmNlKTtcbiAgICAgIGRlbGV0ZSBzZXJ2aWNlRGF0YVt2aWV3ZXJJZF0ub3ZlcmxheXNbb3ZlcmxheUlkXTtcbiAgICAgIGFkZE1hcExheWVyKHJlc291cmNlLCB2aWV3ZXJJZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogV2hlbiBhIG1hcCBpcyBlZGl0ZWQsIHJlZnJlc2ggdGhlIG1hcCB0aGUgbWFwIGxheWVyXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmVmcmVzaE1hcFJlc291cmNlKHJlc291cmNlKSB7XG4gICAgICBpZiAoaXNBZGRlZChyZXNvdXJjZSwgJ3JpZ2h0TWFwVmlld2VyJykpIHtcbiAgICAgICAgcmVmcmVzaExheWVyUmVzb3VyY2UocmVzb3VyY2UsICdyaWdodE1hcFZpZXdlcicpO1xuICAgICAgfVxuICAgICAgaWYgKGlzQWRkZWQocmVzb3VyY2UsICdsZWZ0TWFwVmlld2VyJykpIHtcbiAgICAgICAgcmVmcmVzaExheWVyUmVzb3VyY2UocmVzb3VyY2UsICdsZWZ0TWFwVmlld2VyJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXBwbHkgdGhlIG5ldyBvcmRlciBhbmQgYnJvYWRjYXN0IHRoZSBtYXBMYXllcnNSZW9yZGVyZWQgZXZlbnRcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gbGF5ZXJzSW5PcmRlciBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhcHBseVJlb3JkZXIobGF5ZXJzSW5PcmRlcikge1xuICAgICAgdmFyIGNvdW50ZXIgPSAxO1xuICAgICAgLy8gaXRlcmF0ZSBvdmVyIHRoZSBsYXllcnNJbk9yZGVyIGFuZCBhcHBseSB0aGUgbmV3IHotaW5kZXggb2YgZWFjaCBvbmVcbiAgICAgIGxheWVyc0luT3JkZXIuc2xpY2UoKS5yZXZlcnNlKCkuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgLy8gZm9yIGVhY2ggbGF5ZXIgaWRlbnRpZmljYXRpb24sIHdlIGdldCB0aGUgbGVhZmxldCBsYXllcnMgb2JqZWN0XG4gICAgICAgIGxlYWZsZXREYXRhLmdldExheWVycyh2YWx1ZS52aWV3ZXJJZCkudGhlbihmdW5jdGlvbiAobGF5ZXJzKSB7XG4gICAgICAgICAgLy8gd2UgcGFyc2UgdGhlIG1hcE92ZXJsYXlJZFxuICAgICAgICAgIHZhciBvdmVybGF5SWQgPSBwYXJzZU1hcE92ZXJsYXlJZCh0aGlzLnZhbHVlLnZpZXdlcklkLCB0aGlzLnZhbHVlLnJlc291cmNlKTtcbiAgICAgICAgICAvLyBhcHBseSB0aGUgbmV3IHotaW5kZXhcbiAgICAgICAgICBsYXllcnMub3ZlcmxheXNbb3ZlcmxheUlkXS5zZXRaSW5kZXgodGhpcy5jb3VudGVyKTtcbiAgICAgICAgfS5iaW5kKHsgdmFsdWU6IHZhbHVlLCBjb3VudGVyOiBjb3VudGVyIH0pKTtcbiAgICAgICAgY291bnRlcisrO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIGJyb2FkY2FzdCB0aGUgZXZlbnRcbiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbWFwTGF5ZXJzUmVvcmRlcmVkJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYWRkV0ZTTGF5ZXIobGF5ZXJOYW1lLCB2aWV3ZXJJZCkge1xuICAgICAgY29uc29sZS5sb2coXCI+Pj4gTWFwbGF5ZXJTZXJ2aWNlID4+PiBhZGRXRlNMYXllciA+Pj4gXCIsIGxheWVyTmFtZSk7XG4gICAgICBsZWFmbGV0RGF0YS5nZXRNYXAodmlld2VySWQpLnRoZW4oZnVuY3Rpb24gKG1hcCkge1xuICAgICAgICB2YXIgdGVtcExheWVyID0gbmV3IGxlYWZsZXQuV0ZTKHtcbiAgICAgICAgICB1cmw6ICdodHRwczovL2RlbW8uZ2VvLXNvbHV0aW9ucy5pdDo0NDMvZ2Vvc2VydmVyL293cycsXG4gICAgICAgICAgdHlwZU5TOiAndG9wcCcsXG4gICAgICAgICAgdHlwZU5hbWU6ICd0YXNtYW5pYV9zdGF0ZV9ib3VuZGFyaWVzJyxcbiAgICAgICAgICAvKiB1cmw6ICdodHRwOi8vMC4wLjAuMDo4MDgxL2dlb3NlcnZlci9vd3MnLFxuICAgICAgICAgIHR5cGVOUzogJ3B1YmxpYycsXG4gICAgICAgICAgdHlwZU5hbWU6ICcwXzE1MzYxNDk4NzUnLCAvLyBsYXllck5hbWUgKi9cbiAgICAgICAgICBjcnM6IGxlYWZsZXQuQ1JTLkVQU0c0MzI2LFxuICAgICAgICAgIGdlb21ldHJ5RmllbGQ6ICd0aGVfZ2VvbScsXG4gICAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAgIGNvbG9yOiAnYmx1ZScsXG4gICAgICAgICAgICB3ZWlnaHQ6IDJcbiAgICAgICAgICB9XG4gICAgICAgIH0pLmFkZFRvKG1hcCkub24oJ2xvYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgbWFwLmZpdEJvdW5kcyh0ZW1wTGF5ZXIuZ2V0TGF5ZXJzKClbMF0uZ2V0Qm91bmRzKCkpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBzZXJ2aWNlO1xuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ01hcE1hcmtlclNlcnZpY2UnLCBNYXBNYXJrZXJTZXJ2aWNlKTtcblxuICBmdW5jdGlvbiBNYXBNYXJrZXJTZXJ2aWNlKGxvZGFzaCwgbGVhZmxldCkge1xuICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgYnVpbGRNYXJrZXI6IGJ1aWxkTWFya2VyXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEJ1aWxkcyBhIG1hcmtlciBvYmplY3RcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gZGVmYXVsdE9wdGlvbnMgXG4gICAgICogQHBhcmFtIHtvYmplY3R9IG1hcmtlck9wdGlvbnNcbiAgICAgKiBAcmV0dXJucyB7b2JqZWN0fSBtYXJrZXJcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBidWlsZE1hcmtlcihtYXJrZXJzSG9sZGVyLCBtYXJrZXJPcHRpb25zKSB7XG4gICAgICB2YXIgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICAgIGZvY3VzOiB0cnVlLFxuICAgICAgICBkcmFnZ2FibGU6IHRydWVcbiAgICAgIH07XG5cbiAgICAgIGFuZ3VsYXIubWVyZ2UoZGVmYXVsdE9wdGlvbnMsIG1hcmtlck9wdGlvbnMpO1xuICAgICAgdmFyIG1LZXkgPSBnZXROZXh0TWFya2VyS2V5KG1hcmtlcnNIb2xkZXIpO1xuICAgICAgdmFyIG1JZCA9ICdtJyArIG1LZXk7XG4gICAgICB2YXIgY2xhc3NlcyA9ICdtay1kaXYtaWNvbiAnICsgbUlkO1xuXG4gICAgICAvLyBidWlsZCB0aGUgaWNvbiBvYmplY3QgdG8gYmUgdXNlZCBpbiB0aGUgbWFya2VyXG4gICAgICB2YXIgbUljb24gPSB7XG4gICAgICAgIHR5cGU6ICdkaXYnLFxuICAgICAgICBjbGFzc05hbWU6IGNsYXNzZXMsXG4gICAgICAgIGljb25TaXplOiBudWxsLFxuICAgICAgICBodG1sOiAnPGRpdiBjbGFzcz1cIm1rLWljb24tY29udGFpbmVyIG1rLW9rXCI+JyArIG1LZXkgKyAnPC9kaXY+JyAvLyBtay1vaywgbWstd2FybiBvciBtay1lcnJvclxuXG5cbiAgICAgICAgLy8gcmV0dXJuIHRoZSBtYXJrZXIgb2JqZWN0IHdpdGggaXRzIHByb3BlcnRpZXMvdmFsdWVzXG4gICAgICB9O3JldHVybiB7XG4gICAgICAgIGlkOiBtSWQsXG4gICAgICAgIGxhdDogZGVmYXVsdE9wdGlvbnMubGF0LFxuICAgICAgICBsbmc6IGRlZmF1bHRPcHRpb25zLmxuZyxcbiAgICAgICAgZm9jdXM6IGRlZmF1bHRPcHRpb25zLmZvY3VzLFxuICAgICAgICBtZXNzYWdlOiBkZWZhdWx0T3B0aW9ucy5tZXNzYWdlLFxuICAgICAgICBkcmFnZ2FibGU6IGRlZmF1bHRPcHRpb25zLmRyYWdnYWJsZSxcbiAgICAgICAgaWNvbjogbUljb25cbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBuZXh0IGF1dG8gaW5jcmVtZW50IGlkIHRoYXQgbXVzdCBiZSB1c2VkIGZvciBhIG5ldyBtYXJrZXJcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gbWFya2Vyc0hvbGRlciBcbiAgICAgKiBAcmV0dXJucyBuZXh0SW5kZXhcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXROZXh0TWFya2VyS2V5KG1hcmtlcnNIb2xkZXIpIHtcbiAgICAgIHZhciBtYXggPSAwO1xuICAgICAgbG9kYXNoLmZvck93bihtYXJrZXJzSG9sZGVyLCBmdW5jdGlvbiAodmFsdWUsIGtleSkge1xuICAgICAgICB2YXIga2V5SW5kZXggPSBwYXJzZUludChrZXkucmVwbGFjZSgnbScsICcnKSk7XG4gICAgICAgIGlmIChrZXlJbmRleCA+IG1heCkge1xuICAgICAgICAgIG1heCA9IGtleUluZGV4O1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIChtYXggKyAxKS50b1N0cmluZygpO1xuICAgIH1cblxuICAgIHJldHVybiBzZXJ2aWNlO1xuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ01hcFByb2plY3RTZXJ2aWNlJywgTWFwUHJvamVjdFNlcnZpY2UpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgZnVuY3Rpb24gTWFwUHJvamVjdFNlcnZpY2Uoc2VydmljZUZhY3RvcnksICRxKSB7XG4gICAgdmFyIG1vZGVsID0gc2VydmljZUZhY3RvcnkoJy9oZWltYXAvbWFwLXByb2plY3QnLCB7XG4gICAgICBhY3Rpb25zOiB7fSxcbiAgICAgIGluc3RhbmNlOiB7fVxuICAgIH0pO1xuICAgIHJldHVybiBtb2RlbDtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdNYXBQcm9qZWN0aW9uU2VydmljZScsIE1hcFByb2plY3Rpb25TZXJ2aWNlKTtcblxuICAvKiogQG5nSW5qZWN0ICovXG4gIGZ1bmN0aW9uIE1hcFByb2plY3Rpb25TZXJ2aWNlKHNlcnZpY2VGYWN0b3J5LCAkcSkge1xuICAgIHZhciBtb2RlbCA9IHNlcnZpY2VGYWN0b3J5KCcvaGVpbWFwL21hcC1wcm9qZWN0aW9uJywge1xuICAgICAgYWN0aW9uczoge30sXG4gICAgICBpbnN0YW5jZToge31cbiAgICB9KTtcbiAgICByZXR1cm4gbW9kZWw7XG4gIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnTWFwVHlwZVNlcnZpY2UnLCBNYXBUeXBlU2VydmljZSk7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICBmdW5jdGlvbiBNYXBUeXBlU2VydmljZShzZXJ2aWNlRmFjdG9yeSwgJHEpIHtcbiAgICB2YXIgbW9kZWwgPSBzZXJ2aWNlRmFjdG9yeSgnL2hlaW1hcC9tYXAtdHlwZScsIHtcbiAgICAgIGFjdGlvbnM6IHt9LFxuICAgICAgaW5zdGFuY2U6IHt9XG4gICAgfSk7XG4gICAgcmV0dXJuIG1vZGVsO1xuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIE1hcCBMYXllciBTZXJ2aWNlIHJlc3BvbnNpYmxlIGZvciBzdG9yaW5nIGFuZCByZXR1cm5pbmcgZ2xvYmFsIHZpZXdlciBvcHRpb24gdXNlZCBieSBtdWx0aXBsZSBjb250cm9sbGVycy5cbiAqIFxuICogQXMgYSBjZW50cmFsaXplZCBzZXJ2aWNlIHRoaXMgc2VydmljZSBjaGFuZ2UgdGhlIG9wdGlvbiB2YWx1ZSB3aGVuIGFza2VkIGZvciBhbmQgYnJvYWRjYXN0IGFuIGV2ZW50IHdoZW5cbiAqIHRoaXMgY2hhbmdlIG9jY3Vycy4gVGhlIGZvbGxvd2luZyBldmVudCBpcyBicm9hZGNhc3RlZDpcbiAqIFxuICogdmlld2VyT3B0aW9uQ2hhbmdlZFxuXG4gKi9cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuc2VydmljZSgnTWFwVmlld2VyU2VydmljZScsIE1hcFZpZXdlclNlcnZpY2UpO1xuXG4gIGZ1bmN0aW9uIE1hcFZpZXdlclNlcnZpY2UoJHJvb3RTY29wZSkge1xuICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgc2V0T3B0aW9uOiBzZXRPcHRpb24sXG4gICAgICBnZXRPcHRpb246IGdldE9wdGlvblxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBQcml2YXRlIHByb3BlcnR5IHRoYXQgc3RvcmVzIHRoZSB2aWV3ZXIgZ2xvYmFsIG9wdGlvbnMgXG4gICAgICogIFxuICAgICAqL1xuICAgIHZhciBzZXJ2aWNlRGF0YSA9IHt9O1xuXG4gICAgLyoqXG4gICAgICogRGVmaW5lIGFuIG9wdGlvbiBmb3IgYSB2aWV3ZXIgd2l0aCBhIGdpdmVuIHZhbHVlXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IHZpZXdlcklkIFxuICAgICAqIEBwYXJhbSB7YW55fSBvcHRpb24gXG4gICAgICogQHBhcmFtIHthbnl9IHZhbHVlIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNldE9wdGlvbih2aWV3ZXJJZCwgb3B0aW9uLCB2YWx1ZSkge1xuICAgICAgcGFyc2VWaWV3ZXIodmlld2VySWQsIG9wdGlvbik7XG4gICAgICBzZXJ2aWNlRGF0YVt2aWV3ZXJJZF1bb3B0aW9uXSA9IHZhbHVlO1xuICAgICAgdmFyIGNoYW5nZWQgPSB7IHZpZXdlcklkOiB2aWV3ZXJJZCwgb3B0aW9uOiB2aWV3ZXJJZCwgdmFsdWU6IHZhbHVlIH07XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3ZpZXdlck9wdGlvbkNoYW5nZWQnLCBjaGFuZ2VkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYW4gZ2xvYmFsIG9wdGlvbiB2YWx1ZSwgb3IsIGlmIGl0IGlzIG5vdCBkZWZpbmVkLCB0aGUgZGVmYXVsdCB2YWx1ZVxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7YW55fSB2aWV3ZXJJZCBcbiAgICAgKiBAcGFyYW0ge2FueX0gb3B0aW9uIFxuICAgICAqIEBwYXJhbSB7YW55fSBkZWZhdWx0VmFsdWUgXG4gICAgICogQHJldHVybnMgXG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0T3B0aW9uKHZpZXdlcklkLCBvcHRpb24sIGRlZmF1bHRWYWx1ZSkge1xuICAgICAgcGFyc2VWaWV3ZXIodmlld2VySWQsIG9wdGlvbik7XG4gICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChzZXJ2aWNlRGF0YVt2aWV3ZXJJZF1bb3B0aW9uXSkpIHtcbiAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzZXJ2aWNlRGF0YVt2aWV3ZXJJZF1bb3B0aW9uXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFbnN1cmVzIHRoYXQgdGhlIHZpZXdlciBwcm9wZXJ0eSBleGlzdHNcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gdmlld2VySWQgXG4gICAgICovXG4gICAgZnVuY3Rpb24gcGFyc2VWaWV3ZXIodmlld2VySWQpIHtcbiAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKHNlcnZpY2VEYXRhW3ZpZXdlcklkXSkpIHtcbiAgICAgICAgc2VydmljZURhdGFbdmlld2VySWRdID0ge307XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBzZXJ2aWNlO1xuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29udHJvbGxlcignSW1wb3J0Q29udHJvbGxlcicsIEltcG9ydENvbnRyb2xsZXIpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgZnVuY3Rpb24gSW1wb3J0Q29udHJvbGxlcigkY29udHJvbGxlciwgSW1wb3J0U2VydmljZSkge1xuICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAvL0F0dHJpYnV0ZXMgQmxvY2tcblxuICAgIC8vRnVuY3Rpb25zIEJsb2NrXG5cbiAgICAvLyBpbnN0YW50aWF0ZSBiYXNlIGNvbnRyb2xsZXJcbiAgICAkY29udHJvbGxlcignQ1JVRENvbnRyb2xsZXInLCB7IHZtOiB2bSwgbW9kZWxTZXJ2aWNlOiBJbXBvcnRTZXJ2aWNlLCBvcHRpb25zOiB7IHNlYXJjaE9uSW5pdDogZmFsc2UgfSB9KTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25maWcocm91dGVzKTtcblxuICAvKipcbiAgICogQXJxdWl2byBkZSBjb25maWd1cmHDp8OjbyBjb20gYXMgcm90YXMgZXNwZWPDrWZpY2FzIGRvIHJlY3Vyc28gaW1wb3J0XG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSAkc3RhdGVQcm92aWRlclxuICAgKiBAcGFyYW0ge29iamVjdH0gR2xvYmFsXG4gICAqL1xuICAvKiogQG5nSW5qZWN0ICovXG4gIGZ1bmN0aW9uIHJvdXRlcygkc3RhdGVQcm92aWRlciwgR2xvYmFsKSB7XG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2FwcC5pbXBvcnQnLCB7XG4gICAgICB1cmw6ICcvaW1wb3J0JyxcbiAgICAgIHRlbXBsYXRlVXJsOiBHbG9iYWwuY2xpZW50UGF0aCArICcvaW1wb3J0L2ltcG9ydC5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdJbXBvcnRDb250cm9sbGVyIGFzIGltcG9ydEN0cmwnLFxuICAgICAgZGF0YToge31cbiAgICB9KTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdJbXBvcnRTZXJ2aWNlJywgSW1wb3J0U2VydmljZSk7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICBmdW5jdGlvbiBJbXBvcnRTZXJ2aWNlKHNlcnZpY2VGYWN0b3J5KSB7XG4gICAgdmFyIG1vZGVsID0gc2VydmljZUZhY3RvcnkoJ2ltcG9ydCcsIHtcbiAgICAgIGFjdGlvbnM6IHt9LFxuICAgICAgaW5zdGFuY2U6IHt9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbW9kZWw7XG4gIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnU3VwcG9ydFNlcnZpY2UnLCBTdXBwb3J0U2VydmljZSk7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICBmdW5jdGlvbiBTdXBwb3J0U2VydmljZShzZXJ2aWNlRmFjdG9yeSwgJGh0dHAsICRxKSB7XG4gICAgdmFyIGVuZFBvaW50ID0gJy9oZWltYXAvc3VwcG9ydCc7XG4gICAgdmFyIG1vZGVsID0gc2VydmljZUZhY3RvcnkoZW5kUG9pbnQsIHtcbiAgICAgIGFjdGlvbnM6IHtcbiAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgICBpc0FycmF5OiBmYWxzZSxcbiAgICAgICAgICB3cmFwOiBmYWxzZSxcbiAgICAgICAgICB1cmw6ICdjb25maWcnLFxuICAgICAgICAgIGFmdGVyUmVxdWVzdDogZnVuY3Rpb24gYWZ0ZXJSZXF1ZXN0KHJlc3BvbnNlKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaW5zdGFuY2U6IHt9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbW9kZWw7XG4gIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdQcmVmZXJlbmNlc0NvbnRyb2xsZXInLCBQcmVmZXJlbmNlc0NvbnRyb2xsZXIpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgZnVuY3Rpb24gUHJlZmVyZW5jZXNDb250cm9sbGVyKCRjb250cm9sbGVyLCBQcmVmZXJlbmNlc1NlcnZpY2UpIHtcbiAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgLy9BdHRyaWJ1dGVzIEJsb2NrXG5cbiAgICAvL0Z1bmN0aW9ucyBCbG9ja1xuXG4gICAgLy8gaW5zdGFudGlhdGUgYmFzZSBjb250cm9sbGVyXG4gICAgJGNvbnRyb2xsZXIoJ0NSVURDb250cm9sbGVyJywgeyB2bTogdm0sIG1vZGVsU2VydmljZTogUHJlZmVyZW5jZXNTZXJ2aWNlLCBvcHRpb25zOiB7IHNlYXJjaE9uSW5pdDogZmFsc2UgfSB9KTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25maWcocm91dGVzKTtcblxuICAvKipcbiAgICogQXJxdWl2byBkZSBjb25maWd1cmHDp8OjbyBjb20gYXMgcm90YXMgZXNwZWPDrWZpY2FzIGRvIHJlY3Vyc28gcHJlZmVyZW5jZXNcbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9ICRzdGF0ZVByb3ZpZGVyXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBHbG9iYWxcbiAgICovXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgZnVuY3Rpb24gcm91dGVzKCRzdGF0ZVByb3ZpZGVyLCBHbG9iYWwpIHtcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnYXBwLnByZWZlcmVuY2VzJywge1xuICAgICAgdXJsOiAnL3ByZWZlcmVuY2VzJyxcbiAgICAgIHRlbXBsYXRlVXJsOiBHbG9iYWwuY2xpZW50UGF0aCArICcvcHJlZmVyZW5jZXMvcHJlZmVyZW5jZXMuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnUHJlZmVyZW5jZXNDb250cm9sbGVyIGFzIHByZWZlcmVuY2VzQ3RybCcsXG4gICAgICBkYXRhOiB7fVxuICAgIH0pO1xuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmZhY3RvcnkoJ1ByZWZlcmVuY2VzU2VydmljZScsIFByZWZlcmVuY2VzU2VydmljZSk7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICBmdW5jdGlvbiBQcmVmZXJlbmNlc1NlcnZpY2Uoc2VydmljZUZhY3RvcnkpIHtcbiAgICB2YXIgbW9kZWwgPSBzZXJ2aWNlRmFjdG9yeSgncHJlZmVyZW5jZXMnLCB7XG4gICAgICBhY3Rpb25zOiB7fSxcbiAgICAgIGluc3RhbmNlOiB7fVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG1vZGVsO1xuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnRyb2xsZXIoJ1Byb2plY3RDb250cm9sbGVyJywgUHJvamVjdENvbnRyb2xsZXIpO1xuXG4gICAgLyoqIEBuZ0luamVjdCAqL1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gICAgZnVuY3Rpb24gUHJvamVjdENvbnRyb2xsZXIoJGxvY2F0aW9uLCBHbG9iYWwpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAvL0F0dHJpYnV0ZXMgQmxvY2tcblxuICAgICAgICAvL0Z1bmN0aW9ucyBCbG9ja1xuXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCRsb2NhdGlvbi5zZWFyY2goKSk7XG4gICAgICAgIHZhciBxUGFyYW1zID0gJGxvY2F0aW9uLnNlYXJjaCgpO1xuICAgICAgICBzZXNzaW9uU3RvcmFnZS5jbGVhcigpO1xuICAgICAgICAvLyBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKFwicm9sZVwiLCBcImFkbWluXCIpO1xuICAgICAgICBpZiAocVBhcmFtcy5yb2xlID09PSBcImFkbWluXCIpIHtcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oXCJyb2xlXCIsIFwiMVwiKTtcbiAgICAgICAgfSBlbHNlIGlmIChxUGFyYW1zLnJvbGUgPT09IFwic2VuaW9yXCIpIHtcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oXCJyb2xlXCIsIFwiMlwiKTtcbiAgICAgICAgfSBlbHNlIGlmIChxUGFyYW1zLnJvbGUgPT09IFwidXNlclwiKSB7XG4gICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKFwicm9sZVwiLCBcIjNcIik7XG4gICAgICAgIH0gZWxzZSBpZiAocVBhcmFtcy5yb2xlID09PSBcImd1ZXN0XCIpIHtcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oXCJyb2xlXCIsIFwiNFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiYXBwY29udHJvbGxlciBcIiwgJGxvY2FsU3RvcmFnZSk7XG4gICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oXCJwcm9qSWRcIiwgcVBhcmFtcy5wcm9qSWQpO1xuICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKFwidXNlcklkXCIsIHFQYXJhbXMudXNlcklkKTtcbiAgICAgICAgJGxvY2F0aW9uLnVybChHbG9iYWwuY2xpZW50UGF0aCk7XG4gICAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25maWcocm91dGVzKTtcblxuICAvKipcbiAgICogQXJxdWl2byBkZSBjb25maWd1cmHDp8OjbyBjb20gYXMgcm90YXMgZXNwZWPDrWZpY2FzIGRvIHJlY3Vyc28gZXhwb3J0XG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSAkc3RhdGVQcm92aWRlclxuICAgKiBAcGFyYW0ge29iamVjdH0gR2xvYmFsXG4gICAqL1xuICAvKiogQG5nSW5qZWN0ICovXG4gIGZ1bmN0aW9uIHJvdXRlcygkc3RhdGVQcm92aWRlciwgR2xvYmFsKSB7XG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2FwcC5wcm9qZWN0Jywge1xuICAgICAgdXJsOiAnL3Byb2plY3QnLFxuICAgICAgdGVtcGxhdGVVcmw6IEdsb2JhbC5jbGllbnRQYXRoICsgJy9wcm9qZWN0L3Byb2plY3QuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnUHJvamVjdENvbnRyb2xsZXIgYXMgcHJvamVjdEN0cmwnLFxuICAgICAgZGF0YToge31cbiAgICB9KTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5mYWN0b3J5KCdQcm9qZWN0U2VydmljZScsIFByb2plY3RTZXJ2aWNlKTtcblxuICAvKiogQG5nSW5qZWN0ICovXG4gIGZ1bmN0aW9uIFByb2plY3RTZXJ2aWNlKHNlcnZpY2VGYWN0b3J5KSB7XG4gICAgdmFyIG1vZGVsID0gc2VydmljZUZhY3RvcnkoJ2V4cG9ydCcsIHtcbiAgICAgIGFjdGlvbnM6IHt9LFxuICAgICAgaW5zdGFuY2U6IHt9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbW9kZWw7XG4gIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnRmVhdHVyZVNlcnZpY2UnLCBGZWF0dXJlU2VydmljZSk7XG5cbiAgZnVuY3Rpb24gRmVhdHVyZVNlcnZpY2UobG9kYXNoKSB7XG5cbiAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgIGdldEF0dHJpYnV0ZTogZ2V0QXR0cmlidXRlLFxuICAgICAgc2V0QXR0cmlidXRlOiBzZXRBdHRyaWJ1dGUsXG4gICAgICBjcmVhdGVPYmplY3Q6IGNyZWF0ZU9iamVjdCxcbiAgICAgIHN0aXRjaE9iamVjdDogc3RpdGNoT2JqZWN0LFxuICAgICAgY3JlYXRlT2JqZWN0RnJvbUdlb0pzb246IGNyZWF0ZU9iamVjdEZyb21HZW9Kc29uLFxuICAgICAgY3JlYXRlR2VvSnNvbjogY3JlYXRlR2VvSnNvbixcbiAgICAgIHRlYXJPYmplY3Q6IHRlYXJPYmplY3RcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gZ2V0QXR0cmlidXRlKGZlYXR1cmVJZCkge1xuICAgICAgcmV0dXJuIHsgXCJhYmNcIjogXCJkZWZcIiB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNldEF0dHJpYnV0ZShmZWF0dXJlUHJvcGVydGllcykge1xuICAgICAgY29uc29sZS5sb2coXCI+Pj4gRmVhdHVyZVNlcnZpY2UgPj4+IHNldEF0dHJpYnV0ZSBcIiwgZmVhdHVyZVByb3BlcnRpZXMpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZU9iamVjdChvYmopIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiPj4+IEZlYXR1cmVTZXJ2aWNlID4+PiBjcmVhdGVPYmplY3QgXCIsIG9iaik7XG4gICAgICByZXR1cm4gb2JqO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZU9iamVjdEZyb21HZW9Kc29uKG9iaikge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gRmVhdHVyZVNlcnZpY2UgPj4+IGNyZWF0ZU9iamVjdEZyb21HZW9Kc29uIFwiLCBvYmoucHJvcGVydGllcyk7XG5cbiAgICAgIGlmIChsb2Rhc2guc2l6ZShvYmoucHJvcGVydGllcy5rZXlfY2lkb2NfYXJyYXkuc3BsaXQoXCJ8XCIpKSA9PT0gbG9kYXNoLnNpemUob2JqLnByb3BlcnRpZXMudmFsdWVfZ2F6ZXR0ZWVyX2FycmF5LnNwbGl0KFwifFwiKSkpIHtcbiAgICAgICAgdmFyIGtleUFyciA9IG9iai5wcm9wZXJ0aWVzLmtleV9jaWRvY19hcnJheS5zcGxpdChcInxcIik7XG4gICAgICAgIHZhciB2YWx1ZUFyciA9IG9iai5wcm9wZXJ0aWVzLnZhbHVlX2dhemV0dGVlcl9hcnJheS5zcGxpdChcInxcIik7XG4gICAgICAgIHZhciB0ZW1wID0ge1xuICAgICAgICAgIC8vIFwiaWRcIjogb2JqLnByb3BlcnRpZXMudHlwZV9jcm1cbiAgICAgICAgICBcInR5cGVfY3JtXCI6IG9iai5wcm9wZXJ0aWVzLnR5cGVfY3JtXG4gICAgICAgIH07XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiIGtleUFyciBcIiwga2V5QXJyLCB2YWx1ZUFycik7XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlBcnIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAodmFsdWVBcnJbaV0uaW5kZXhPZihcIltcIikgIT09IC0xKSB7XG4gICAgICAgICAgICBpZiAodmFsdWVBcnJbaV0gIT09IFwiW29iamVjdCBPYmplY3RdXCIpIHtcbiAgICAgICAgICAgICAgdGVtcFtrZXlBcnJbaV1dID0gSlNPTi5wYXJzZSh2YWx1ZUFycltpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChrZXlBcnJbaV0gIT09IFwidHlwZV9jcm1cIikge1xuICAgICAgICAgICAgICB0ZW1wW2tleUFycltpXV0gPSB2YWx1ZUFycltpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGVtcFtcImdlb21cIl0gPSBvYmouZ2VvbWV0cnk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwidGVtcCA9IFwiLCB0ZW1wKTtcbiAgICAgICAgcmV0dXJuIHRlbXA7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogZ2VuZXJhdGUgYSBvYmplY3Qgd2l0aCBoYXMga2V5IDogdmFsdWUgcGFpclxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7Kn0ga2V5cyBcbiAgICAgKiBAcGFyYW0geyp9IHZhbHVlcyBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzdGl0Y2hPYmplY3Qoa2V5cywgdmFsdWVzKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBGZWF0dXJlU2VydmljZSA+Pj4gc3RpdGNoT2JqZWN0IFwiLCBrZXlzLCB2YWx1ZXMpO1xuICAgICAgdmFyIHJldHVybk9iaiA9IHt9O1xuICAgICAgaWYgKGxvZGFzaC5zaXplKGtleXMpID09PSBsb2Rhc2guc2l6ZSh2YWx1ZXMpKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHJldHVybk9ialtrZXlzW2ldXSA9IHZhbHVlc1tpXTtcbiAgICAgICAgfVxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBGZWF0dXJlU2VydmljZSA+Pj4gc3RpdGNoT2JqZWN0IFwiLCByZXR1cm5PYmopO1xuICAgICAgICByZXR1cm4gcmV0dXJuT2JqO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHRlYXJPYmplY3Qob2JqKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBGZWF0dXJlU2VydmljZSA+Pj4gdGVhck9iamVjdCBcIiwgb2JqKTtcbiAgICAgIC8vIHZhciByZXR1cm5PYmogPSB7fTtcbiAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqKTtcbiAgICAgIHZhciB2YWx1ZXMgPSBPYmplY3QudmFsdWVzKG9iaik7XG5cbiAgICAgIHZhciByZXN1bHRWYWwgPSBbXTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlc1tpXSkpIHtcbiAgICAgICAgICByZXN1bHRWYWwucHVzaChKU09OLnN0cmluZ2lmeSh2YWx1ZXNbaV0pKTtcbiAgICAgICAgICAvLyB9IGVsc2UgaWYodHlwZW9mIHZhbHVlc1tpXSA9PT0gXCJzdHJpbmdcIiB8fCB0eXBlb2YgdmFsdWVzW2ldID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0VmFsLnB1c2godmFsdWVzW2ldKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8ga2V5cy5wdXNoKFwiZ2VvbVwiKTtcbiAgICAgIC8vIHZhbHVlcy5wdXNoKGZlYXR1cmUuZ2VvbWV0cnkpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgXCJrZXlzXCI6IGtleXMsXG4gICAgICAgIFwidmFsdWVzXCI6IHJlc3VsdFZhbFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVHZW9Kc29uKGdlb2pzb24sIHByb3BlcnRpZXMpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiPj4+IEZlYXR1cmVTZXJ2aWNlID4+PiBjcmVhdGVHZW9Kc29uIFwiLCBnZW9qc29uLCBwcm9wZXJ0aWVzKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc2VydmljZTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnRyb2xsZXIoJ1ZlY3RvckNvbnRyb2xsZXInLCBWZWN0b3JDb250cm9sbGVyKTtcblxuICAvKiogQG5nSW5qZWN0ICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gIGZ1bmN0aW9uIFZlY3RvckNvbnRyb2xsZXIoJGNvbnRyb2xsZXIsICRzY29wZSwgVmVjdG9yU2VydmljZSwgR2xvYmFsKSB7XG4gICAgdmFyIHZtID0gdGhpcztcblxuICAgIC8vIEZ1bmN0aW9ucyBCbG9jayAgICAgXG4gICAgdm0ub25WaWV3ZXJBY3RpdmF0ZSA9IG9uVmlld2VyQWN0aXZhdGU7XG4gICAgdm0uYmVmb3JlVmlld2VyQWN0aXZhdGUgPSBiZWZvcmVWaWV3ZXJBY3RpdmF0ZTtcblxuICAgIC8vIFNldCB0aGUgbWFwIHZpZXdlciBvcHRpb25zXG4gICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICBzdXBwb3J0TGlzdGluZ1ZpZXc6IGZhbHNlLFxuICAgICAgc3VwcG9ydERyYXdpbmc6IGZhbHNlLFxuICAgICAgdGl0bGVUcmFuc2xLZXk6ICd2aWV3cy50aXRsZXMudmVjdG9yVGl0bGUnLFxuICAgICAgc2hvd1ZlY3RvckxheWVyczogdHJ1ZSxcbiAgICAgIGxlZnRTaWRlQmFyOiBHbG9iYWwuY2xpZW50UGF0aCArICcvdmVjdG9yL25hdnMvdmVjdG9yLWxlZnQtc2lkZW5hdi5odG1sJyxcbiAgICAgIHJpZ2h0U2lkZUJhcjogR2xvYmFsLmNsaWVudFBhdGggKyAnL3ZlY3Rvci9uYXZzL3ZlY3Rvci1yaWdodC1zaWRlbmF2Lmh0bWwnXG4gICAgICAvLyBib3R0b21OYXYgOiBmYWxzZVxuICAgIH07XG5cbiAgICAvLyBpbml0aWFsaXplIGVtcHR5IG1hcmtlcnMgb2JqZWN0XG4gICAgdm0ucmlnaHRNYXJrZXJzID0ge307XG4gICAgdm0ubGVmdE1hcmtlcnMgPSB7fTtcbiAgICB2bS5sYXllck5hbWVzID0gW107XG5cbiAgICAvLyBpbnN0YW50aWF0ZSB0aGUgYmFzZSBNYXBWaWV3ZXJDb250cm9sbGVyXG4gICAgJGNvbnRyb2xsZXIoJ01hcFZpZXdlckNvbnRyb2xsZXInLCB7IHZtOiB2bSwgJHNjb3BlOiAkc2NvcGUsIG9wdGlvbnM6IG9wdGlvbnMgfSk7XG5cbiAgICAvKipcbiAgICAgKiBBY3Rpb25zIGV4ZWN1dGVkIGJlZm9yZSB0aGUgYmFzZSB2aWV3ZXIgaXMgYWN0aXZhdGVkXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gYmVmb3JlVmlld2VyQWN0aXZhdGUoKSB7fVxuICAgIC8vIGdldCB2ZWN0b3IgbGF5ZXJzIGZyb20gQVBJIGFuZCBsaXN0IHRoZW0gaW4gbGVmdCBzaWRlIG5hdlxuICAgIC8vIGdldExheWVyTmFtZXMoKTtcbiAgICAvLyBnZXQgUHJvaklkXG4gICAgLy8gY29uc29sZS5sb2coJHNjb3BlLiRwYXJlbnQpO1xuXG5cbiAgICAvKipcbiAgICAgKiBBY3Rpb25zIGV4ZWN1dGVkIGFmdGVyIHRoZSBiYXNlIHZpZXdlciBpcyBhY3RpdmF0ZWRcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvblZpZXdlckFjdGl2YXRlKCkge31cbiAgICAvLyBTZXQgZ2xvYmFsIHZpZXdlciBvcHRpb25zXG4gICAgLy8gY2hhbmdlZCBmb3IgcmVzb2x2aW5nICMxODQgXG4gICAgLy8gTWFwVmlld2VyU2VydmljZS5zZXRPcHRpb24oJ3JpZ2h0TWFwVmlld2VyJywgJ3Nob3dMb2FkTWFwSW5SaWdodCcsIGZhbHNlKTtcbiAgICAvLyBNYXBWaWV3ZXJTZXJ2aWNlLnNldE9wdGlvbigncmlnaHRNYXBWaWV3ZXInLCAnc2hvd0xvYWRNYXBJblJpZ2h0JywgdHJ1ZSk7XG4gICAgLy8gTWFwVmlld2VyU2VydmljZS5zZXRPcHRpb24oJ2xlZnRNYXBWaWV3ZXInLCAnc2hvd0xvYWRNYXBJblJpZ2h0JywgdHJ1ZSk7XG5cblxuICAgIC8qKlxuICAgICAqIEdldCBMYXllciBuYW1lIGZyb20gQVBJXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0TGF5ZXJOYW1lcygpIHtcbiAgICAgIHZhciBsYXllclNlcnZpY2UgPSBuZXcgVmVjdG9yU2VydmljZSgpO1xuICAgICAgbGF5ZXJTZXJ2aWNlLmdldFZlY3RvckxheWVycygpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICB2bS5sYXllck5hbWVzID0gcmVzdWx0O1xuICAgICAgICBjb25zb2xlLmxvZyhcImxheWVyTmFtZXMgPSBcIiwgdm0ubGF5ZXJOYW1lcyk7XG4gICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgIC8vIHRoZSBjb2RlIGluc2lkZSB0aGlzIGJsb2NrIHdpbGwgYmUgZmlyZWQgaWYgc29tZSBlcnJvciBvY2N1clxuICAgICAgICAvLyBoZXJlIHlvdSBjYW4gc2hvdyBzb21lIGVycm9yIG1lc3NhZ2Ugb3IgZG8gbm90aGluZywgZGVwZW5kaW5nIG9uIHRoZSBidXNpbmVzcyBydWxlXG5cbiAgICAgICAgLy9UT0RPOiBub3RpZnkgdGhlIHVzZXIgYWJvdXQgdGhlIGVycm9yP1xuICAgICAgfSk7XG4gICAgfVxuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbmZpZyhyb3V0ZXMpO1xuXG4gIC8qKlxuICAgKiBDb25maWd1cmF0aW9uIGZpbGUgZm9yIGdlb3JlZmVyZW5jZSByb3V0ZVxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gJHN0YXRlUHJvdmlkZXJcbiAgICogQHBhcmFtIHtvYmplY3R9IEdsb2JhbFxuICAgKi9cbiAgLyoqIEBuZ0luamVjdCAqL1xuICBmdW5jdGlvbiByb3V0ZXMoJHN0YXRlUHJvdmlkZXIsIEdsb2JhbCkge1xuICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdhcHAudmVjdG9yJywge1xuICAgICAgdXJsOiAnL3ZlY3RvcicsXG4gICAgICB0ZW1wbGF0ZVVybDogR2xvYmFsLmNsaWVudFBhdGggKyAnL3ZlY3Rvci92ZWN0b3IuaHRtbCcsXG4gICAgICBjb250cm9sbGVyOiAnVmVjdG9yQ29udHJvbGxlciBhcyBtYXBDdHJsJyxcbiAgICAgIGRhdGE6IHt9XG4gICAgfSk7XG4gIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZmFjdG9yeSgnVmVjdG9yU2VydmljZScsIFZlY3RvclNlcnZpY2UpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgZnVuY3Rpb24gVmVjdG9yU2VydmljZShzZXJ2aWNlRmFjdG9yeSwgJGh0dHAsICRxKSB7XG4gICAgdmFyIGdldFZlY3RvckxheWVyc1VybCA9IFwiL2hlaW1hcC92ZWN0b3IvbGF5ZXJzXCI7XG5cbiAgICB2YXIgbW9kZWwgPSBzZXJ2aWNlRmFjdG9yeShnZXRWZWN0b3JMYXllcnNVcmwsIHtcbiAgICAgIGFjdGlvbnM6IHt9LFxuICAgICAgaW5zdGFuY2U6IHtcbiAgICAgICAgZ2V0VmVjdG9yTGF5ZXJzOiBnZXRWZWN0b3JMYXllcnMsXG4gICAgICAgIGNyZWF0ZVZlY3RvckxheWVyczogY3JlYXRlVmVjdG9yTGF5ZXJzLFxuICAgICAgICBjcmVhdGVGZWF0dXJlczogY3JlYXRlRmVhdHVyZXMsXG4gICAgICAgIGVkaXRWZWN0b3JMYXllcnM6IGVkaXRWZWN0b3JMYXllcnMsXG4gICAgICAgIGRlbGV0ZVZlY3RvckxheWVyOiBkZWxldGVWZWN0b3JMYXllcixcbiAgICAgICAgZ2V0QWxsRmVhdHVyZVZlcnNpb246IGdldEFsbEZlYXR1cmVWZXJzaW9uLFxuICAgICAgICBnZXRGb3JtRGF0YTogZ2V0Rm9ybURhdGEsXG4gICAgICAgIGV4cG9ydExheWVyR2VvSnNvbjogZXhwb3J0TGF5ZXJHZW9Kc29uXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBnZXRWZWN0b3JMYXllcnMocGFyYW1EYXRhKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBWZWN0b3JTZXJ2aWNlID4+PiBnZXRWZWN0b3JMYXllcnMgXCIsIHByZXZpZXdHY3BFbmRQb2ludCwgcGFyYW1EYXRhKTtcbiAgICAgIC8vIGh0dHA6Ly9sb2NhbGhvc3Q6ODA4MC9oZWltYXAvdmVjdG9yP3VzZXJfaWQ9MTEyMzQ1JnByb2pfaWQ9MzEyMzQ0JmZldGNoPWFsbExheWVyc1xuICAgICAgdmFyIGdldExheWVyVXJsID0gXCIvaGVpbWFwL3ZlY3RvclwiO1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgJGh0dHAoe1xuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICB1cmw6IGdldExheWVyVXJsLFxuICAgICAgICBwYXJhbXM6IHBhcmFtRGF0YVxuICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJyZXNwb25zZSBcIiwgcmVzcG9uc2UpO1xuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlLmRhdGEuaXRlbXMpO1xuICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVzcG9uc2UpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZVZlY3RvckxheWVycyhwYXJhbURhdGEpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IFZlY3RvclNlcnZpY2UgPj4+IGNyZWF0ZVZlY3RvckxheWVycyBcIiwgcGFyYW1EYXRhKTtcbiAgICAgIHZhciBjcmVhdGVMYXllclVybCA9IFwiL2hlaW1hcC92ZWN0b3IvbGF5ZXJcIjtcbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICRodHRwLnBvc3QoY3JlYXRlTGF5ZXJVcmwsIHBhcmFtRGF0YSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzdWx0LmRhdGEpO1xuICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICBkZWZlcnJlZC5yZWplY3QoZXJyKTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVGZWF0dXJlcyhwYXJhbURhdGEpIHtcbiAgICAgIHZhciBjcmVhdGVGZWF0dXJlVXJsID0gXCIvaGVpbWFwL3ZlY3Rvci9mZWF0dXJlXCI7XG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAkaHR0cC5wb3N0KGNyZWF0ZUZlYXR1cmVVcmwsIHBhcmFtRGF0YSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcbiAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgZGVmZXJyZWQucmVqZWN0KHJlc3BvbnNlKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGVsZXRlVmVjdG9yTGF5ZXIocGFyYW1EYXRhKSB7XG4gICAgICB2YXIgZGVsTGF5ZXJVcmwgPSBcIi9oZWltYXAvdmVjdG9yL2xheWVyXCI7XG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAkaHR0cC5wb3N0KGRlbExheWVyVXJsLCBwYXJhbURhdGEpLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UuZGF0YSk7XG4gICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgIGRlZmVycmVkLnJlamVjdChyZXNwb25zZSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGVkaXRWZWN0b3JMYXllcnMocGFyYW1EYXRhKSB7XG4gICAgICB2YXIgZWRpdExheWVyVXJsID0gXCIvaGVpbWFwL3ZlY3Rvci9sYXllclwiO1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgJGh0dHAucG9zdChlZGl0TGF5ZXJVcmwsIHBhcmFtRGF0YSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcbiAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgZGVmZXJyZWQucmVqZWN0KHJlc3BvbnNlKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0QWxsRmVhdHVyZVZlcnNpb24ocGFyYW1EYXRhKSB7XG4gICAgICB2YXIgZ2V0QWxsVmVyc2lvblVybCA9IFwiL2hlaW1hcC92ZWN0b3JcIjtcbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICRodHRwKHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgdXJsOiBnZXRBbGxWZXJzaW9uVXJsLFxuICAgICAgICBwYXJhbXM6IHBhcmFtRGF0YVxuICAgICAgfSkudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJyZXNwb25zZSBcIiwgcmVzcG9uc2UpO1xuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlLmRhdGEuaXRlbXMpO1xuICAgICAgfSwgZnVuY3Rpb24gZXJyb3JDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVzcG9uc2UpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldEZvcm1EYXRhKHBhcmFtRGF0YSkge1xuICAgICAgdmFyIGdldEZvcm1VcmwgPSBcIi9oZWltYXAvZmVhdHVyZS1zb3VyY2UtdHlwZVwiO1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgJGh0dHAoe1xuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICB1cmw6IGdldEZvcm1VcmwsXG4gICAgICAgIHBhcmFtczogcGFyYW1EYXRhXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInJlc3BvbnNlIFwiLCByZXNwb25zZSk7XG4gICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UuZGF0YS5pdGVtcyk7XG4gICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgIGRlZmVycmVkLnJlamVjdChyZXNwb25zZSk7XG4gICAgICB9KTtcbiAgICAgIC8vIGRlZmVycmVkLnJlc29sdmUoW1xuICAgICAgLy8gICB7XCJuYW1lXCI6XCJidWlsZGluZ1R5cGVcIixcInJlcXVpcmVkXCI6ZmFsc2UsXCJ0eXBlXCI6XCJ0ZXh0XCIsXCJvcmRlclwiOjEsXCJwbGFjZWhvbGRlclwiOlwiYnVpbGRpbmdUeXBlXCIsXCJkZXBlbmRlbnRcIjpcImJ1aWxkaW5nVHlwZVwifSxcbiAgICAgIC8vICAge1wibmFtZVwiOlwiY291bnRyeVwiLFwicmVxdWlyZWRcIjpmYWxzZSxcInR5cGVcIjpcInRleHRcIixcIm9yZGVyXCI6MyxcInBsYWNlaG9sZGVyXCI6XCJjb3VudHJ5XCIsXCJkZXBlbmRlbnRcIjpcImNvdW50cnlcIn0sXG4gICAgICAvLyAgIHtcIm5hbWVcIjpcInN0YXRlXCIsXCJyZXF1aXJlZFwiOmZhbHNlLFwidHlwZVwiOlwidGV4dFwiLFwib3JkZXJcIjoyLFwicGxhY2Vob2xkZXJcIjpcInN0YXRlXCIsXCJkZXBlbmRlbnRcIjpcImNvdW50cnlcIn0sXG4gICAgICAvLyAgIHtcIm5hbWVcIjpcImtpbmdcIixcInJlcXVpcmVkXCI6ZmFsc2UsXCJ0eXBlXCI6XCJ0ZXh0XCIsXCJvcmRlclwiOjQsXCJwbGFjZWhvbGRlclwiOlwia2luZ1wiLFwiZGVwZW5kZW50XCI6XCJraW5nXCJ9LFxuICAgICAgLy8gICB7XCJuYW1lXCI6XCJjaXR5XCIsXCJvcmRlclwiOjUsXCJwbGFjZWhvbGRlclwiOlwiY2l0eVwiLFwiZGVwZW5kZW50XCI6XCJjb3VudHJ5XCIsXCJ0eXBlXCI6XCJzZWxlY3RcIixcIm9wdGlvbnNcIjpbe1wib3JkZXJcIjowLFwibmFtZVwiOlwibXVtYmFpXCIsXCJ2YWx1ZVwiOlwibXVtYmFpXCJ9LHtcIm9yZGVyXCI6MSxcIm5hbWVcIjpcImhlaWRlbGJlcmdcIixcInZhbHVlXCI6XCJoZWlkZWxiZXJnXCJ9XX0sXG4gICAgICAvLyAgIHtcIm5hbWVcIjpcImxhbmd1YWdlXCIsXCJvcmRlclwiOjYsXCJwbGFjZWhvbGRlclwiOlwibGFuZ3VhZ2VcIixcInR5cGVcIjpcIm11bHRpcGxlXCIsXCJkZXBlbmRlbnRcIjpcImxhbmd1YWdlXCIsXCJvcHRpb25zXCI6W3tcIm9yZGVyXCI6MCxcIm5hbWVcIjpcImVuZ2xpc2hcIixcInZhbHVlXCI6XCJlbmdsaXNoXCJ9LHtcIm9yZGVyXCI6MSxcIm5hbWVcIjpcImdlcm1hblwiLFwidmFsdWVcIjpcImdlcm1hblwifV0sXCJ2YWx1ZVwiOltcImVuZ2xpc2hcIl19LFxuICAgICAgLy8gICB7XCJuYW1lXCI6XCJkZXNjcmlwdGlvblwiLFwib3JkZXJcIjo3LFwidHlwZVwiOlwidGV4dGFyZWFcIixcInBsYWNlaG9sZGVyXCI6XCJkZXNjcmlwdGlvblwiLFwidmFsdWVcIjpcIlwiLFwiZGVwZW5kZW50XCI6XCJkZXNjcmlwdGlvblwiLFwicmVxdWlyZWRcIjpmYWxzZX1cbiAgICAgIC8vIF0pO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBleHBvcnRMYXllckdlb0pzb24ocGFyYW1EYXRhKSB7XG4gICAgICB2YXIgZXhwb3J0VXJsID0gXCIvaGVpbWFwL3ZlY3RvclwiO1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgJGh0dHAoe1xuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICB1cmw6IGV4cG9ydFVybCxcbiAgICAgICAgcGFyYW1zOiBwYXJhbURhdGFcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwicmVzcG9uc2UgXCIsIHJlc3BvbnNlKTtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNwb25zZS5kYXRhKTtcbiAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgZGVmZXJyZWQucmVqZWN0KHJlc3BvbnNlKTtcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gbW9kZWw7XG4gIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdHY3BUYWJsZUNvbnRyb2xsZXInLCBHY3BUYWJsZUNvbnRyb2xsZXIpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgZnVuY3Rpb24gR2NwVGFibGVDb250cm9sbGVyKCRzY29wZSwgJHJvb3RTY29wZSwgJHRyYW5zbGF0ZSwgQzJEaWFsb2csICRtZENvbG9ycywgR2xvYmFsLCBHZW9yZWZlcmVuY2VTZXJ2aWNlLCBsb2Rhc2gpIHtcbiAgICB2YXIgdm0gPSB0aGlzO1xuICAgIHZtLmRlbGV0ZUdDUEZyb21UYWJsZSA9IGRlbGV0ZUdDUEZyb21UYWJsZTtcbiAgICB2bS5kZWxldGVHQ1BGcm9tTWFwID0gZGVsZXRlR0NQRnJvbU1hcDtcbiAgICB2bS5yZWZyZXNoR0NQVGFibGUgPSByZWZyZXNoR0NQVGFibGU7XG4gICAgdm0uYXZnUm1zZSA9IG51bGw7XG4gICAgJHNjb3BlLnNob3dUYWJsZSA9IGZhbHNlO1xuICAgICRzY29wZS50YWJsZURhdGEgPSBbXTtcbiAgICAkc2NvcGUucGFnaW5hdGlvbkxpbWl0ID0gNTtcbiAgICAkc2NvcGUucGFnaW5hdGlvbkN1cnJlbnRQYWdlID0gMTtcblxuICAgIC8vIGdsb2JhbCB2YXJpYWJsZSB1c2VkIGZvciByZWZyZXNoXG4gICAgdm0uZ2VvUmVmID0gbnVsbDtcblxuICAgICRyb290U2NvcGUuJG9uKCdwcmV2aWV3R2NwJywgZnVuY3Rpb24gKGV2ZW50LCBhcmdzKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBHY3BUYWJsZUNvbnRyb2xsZXIgPj4+IHByZXZpZXdHY3BFdmVudFwiLCBhcmdzKTtcbiAgICAgIHByZXZpZXdHY3AoYXJncyk7XG4gICAgfSk7XG5cbiAgICAkcm9vdFNjb3BlLiRvbignZGVsZXRlR2NwRnJvbVRhYmxlRXZlbnQnLCBmdW5jdGlvbiAoZXZlbnQsIGFyZ3MpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IEdjcFRhYmxlQ29udHJvbGxlciA+Pj4gZGVsZXRlR2NwRnJvbVRhYmxlRXZlbnRcIiwgYXJncyk7XG4gICAgICBkZWxldGVHQ1BGcm9tVGFibGUoYXJncyk7XG4gICAgfSk7XG5cbiAgICAkcm9vdFNjb3BlLiRvbigncmVmcmVzaEdjcFRhYmxlRXZlbnQnLCBmdW5jdGlvbiAoZXZlbnQsIGFyZ3MpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IEdjcFRhYmxlQ29udHJvbGxlciA+Pj4gcmVmcmVzaEdjcFRhYmxlRXZlbnRcIiwgYXJncyk7XG4gICAgICByZWZyZXNoR0NQVGFibGUoKTtcbiAgICB9KTtcblxuICAgICRyb290U2NvcGUuJG9uKCdjbGVhckdjcCcsIGZ1bmN0aW9uIChldmVudCwgYXJncykge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gR2NwVGFibGVDb250cm9sbGVyID4+PiBjbGVhckdjcFwiLCBhcmdzKTtcbiAgICAgIGNsZWFyRGF0YSgpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogU3RhcnQgb2YgdGhlIEdDUCBUYWJsZSBjb250cm9sbGVyXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IEdjcFRhYmxlQ29udHJvbGxlciA+Pj4gaW5pdFwiKTtcbiAgICAgIC8vIHByZXZpZXdHY3AoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwcmV2aWV3R2NwSW5UYWJsZSh0YWJsZURhdGEpIHt9XG4gICAgLy8gY29uc29sZS5sb2coXCI+Pj4gR2NwVGFibGVDb250cm9sbGVyID4+PiBwcmV2aWV3R2NwSW5UYWJsZVwiLCB0YWJsZURhdGEpO1xuICAgIC8vICRzY29wZS50YWJsZURhdGEgPSByZXN1bHQuaXRlbXNbM107XG5cblxuICAgIC8qKlxuICAgICAqIENhbGwgdGhlIFJNU0UgYXBpIHRvIGNhbGN1bGF0ZSB0aGUgUk1TIGVycm9yIGZvciBlYWNoIEdDUG9pbnRzXG4gICAgICogYW5kIGZpbGwgdGhlIEdDUCB0YWJsZSBiZWxvdyB0byByZXNwb25zZSBkYXRhIGFuZCBjcmVhdGVzIG1hcmtlciBvbiBMZWZ0IGFuZCBSaWdodCBNYXBcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gZ2VvUmVmXG4gICAgICovXG4gICAgZnVuY3Rpb24gcHJldmlld0djcChnZW9SZWYpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IEdjcFRhYmxlQ29udHJvbGxlciA+Pj4gcHJldmlld0djcFwiKTtcbiAgICAgIC8vICRzY29wZS5zaG93VGFibGUgPSB0cnVlO1xuICAgICAgLy8gdmFyIGdlb1JlZiA9IG5ldyBHZW9yZWZlcmVuY2VTZXJ2aWNlKCk7XG4gICAgICBpZiAoIXZtLmdlb1JlZikge1xuICAgICAgICB2bS5nZW9SZWYgPSBnZW9SZWY7XG4gICAgICB9XG5cbiAgICAgIGdlb1JlZi5wcmV2aWV3R0NQKGdlb1JlZikudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwicmVzdWx0IGZyb20gQVBJIFwiLCByZXN1bHQpO1xuICAgICAgICAkc2NvcGUudGFibGVEYXRhID0gcmVzdWx0Lml0ZW1zWzNdO1xuICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQocmVzdWx0Lml0ZW1zWzJdW1wiYXZlcmFnZSBlcnJvclwiXSkpIHtcbiAgICAgICAgICB2bS5hdmdSbXNlID0gcmVzdWx0Lml0ZW1zWzJdW1wiYXZlcmFnZSBlcnJvclwiXTtcbiAgICAgICAgfVxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInJlc3VsdCBmcm9tIEFQSSBcIiwgJHNjb3BlLnRhYmxlRGF0YSk7XG4gICAgICAgIC8vY3JlYXRlIG1hcmtlciBvYmplY3QgYXMgcmVxdWlyZWQgYnkgbGVhZmxldCBtYXJrZXIgb2JqZWN0XG4gICAgICAgICRzY29wZS5zaG93VGFibGUgPSB0cnVlO1xuICAgICAgICBsb2Rhc2guZm9yRWFjaCgkc2NvcGUudGFibGVEYXRhLCBmdW5jdGlvbiAobWFya2VyRnJvbURCKSB7XG4gICAgICAgICAgLy8gcmVtb3ZlIFwibVwiIGZyb20gaWQgYXR0cmlidXRlXG4gICAgICAgICAgbWFya2VyRnJvbURCLmdjcE5vID0gbWFya2VyRnJvbURCLmlkWzFdO1xuICAgICAgICAgIC8vIG1hcmtlcnMgZm9yIGxlZnQgbWFwIGllIE5vbiBnZW9yZWZlcmVuY2VcbiAgICAgICAgICAvLyBnZW5lcmF0ZUxlZnRNYXJrZXIobWFya2VyRnJvbURCLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAvLyAgIGdlbmVyYXRlUmlnaHRNYXJrZXIobWFya2VyRnJvbURCKTtcbiAgICAgICAgICAvLyB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgIC8vIHRoZSBjb2RlIGluc2lkZSB0aGlzIGJsb2NrIHdpbGwgYmUgZmlyZWQgaWYgc29tZSBlcnJvciBvY2N1clxuICAgICAgICAvLyBoZXJlIHlvdSBjYW4gc2hvdyBzb21lIGVycm9yIG1lc3NhZ2Ugb3IgZG8gbm90aGluZywgZGVwZW5kaW5nIG9uIHRoZSBidXNpbmVzcyBydWxlXG5cbiAgICAgICAgLy9UT0RPOiBub3RpZnkgdGhlIHVzZXIgYWJvdXQgdGhlIGVycm9yP1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2VuZXJhdGUgbWFya2VycyBvbiBMZWZ0IE1hcFxuICAgICAqIFxuICAgICAqIFRvIGJlIHVzZWQgd2hlbiBhIHVzZXIgd2FudHMgdG8gdmlldyBoaXMgb3Igc29tZW9uZSBlbHNlJ3MgR0NQXG4gICAgICogXG4gICAgICogQHBhcmFtIHtvYmplY3R9IG1hcmtlckZyb21EQlxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBjYWxsYmFja1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdlbmVyYXRlTGVmdE1hcmtlcihtYXJrZXJGcm9tREIsIGNhbGxiYWNrKSB7XG4gICAgICB2YXIgbWFya2VyID0gbnVsbDtcbiAgICAgIG1hcmtlciA9IHtcbiAgICAgICAgXCJkcmFnZ2FibGVcIjogdHJ1ZSxcbiAgICAgICAgLy8gXCJpY29uXCI6IHt0eXBlOiBcImRpdlwiLCBjbGFzc05hbWU6IFwibWstZGl2LWljb24gXCIrbWFya2VyRnJvbURCLmlkLCBpY29uU2l6ZTogbnVsbCwgaHRtbDogXCI8ZGl2IGNsYXNzPVxcXCJtay1pY29uLWNvbnRhaW5lciBtay1va1xcXCI+XCIrIHRlbXBNYXJrZXJObyArXCI8L2Rpdj5cIn0sXG4gICAgICAgIFwiaWRcIjogbWFya2VyRnJvbURCLmlkLFxuICAgICAgICBcImxhdGxuZ1wiOiB7XG4gICAgICAgICAgXCJsYXRcIjogbWFya2VyRnJvbURCLmltYWdlWCxcbiAgICAgICAgICBcImxuZ1wiOiBtYXJrZXJGcm9tREIuaW1hZ2VZXG4gICAgICAgIH0sXG4gICAgICAgIFwibWVzc2FnZVwiOiB1bmRlZmluZWQsXG4gICAgICAgIFwibWFya2Vyc0tlZXBlclwiOiBcImxlZnRNYXJrZXJzXCJcblxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInRocm93IG1hcmtlciB0byBnZW9yZWZlcmVuY2UuY29udHJvbGxlciBcIiwgbWFya2VyKTtcbiAgICAgIH07JHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjcmVhdGVNYXJrZXJGb3JUYWJsZScsIG1hcmtlcik7XG4gICAgICAvLyBhIGRlbGF5IG9mIDEwIG1pbGxzZWNvbmRzIGZvciBsZXR0aW5nIHRoZSBtYXJrZXJzIGJlIHJlbmRlcmVkIG9uIG1hcCBhbmQgdGhlbiBmaXJpbmcgZm9yIGFub3RoZXIgbWFwXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgIH0sIDEwKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZW5lcmF0ZSBtYXJrZXJzIG9uIFJpZ2h0IE1hcFxuICAgICAqIFxuICAgICAqIFRvIGJlIHVzZWQgd2hlbiBhIHVzZXIgd2FudHMgdG8gdmlldyBoaXMgb3Igc29tZW9uZSBlbHNlJ3MgR0NQXG4gICAgICogXG4gICAgICogQHBhcmFtIHtvYmplY3R9IG1hcmtlckZyb21EQlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdlbmVyYXRlUmlnaHRNYXJrZXIobWFya2VyRnJvbURCKSB7XG4gICAgICB2YXIgbWFya2VyID0gbnVsbDtcblxuICAgICAgbWFya2VyID0ge1xuICAgICAgICBcImRyYWdnYWJsZVwiOiB0cnVlLFxuICAgICAgICAvLyBcImljb25cIjoge3R5cGU6IFwiZGl2XCIsIGNsYXNzTmFtZTogXCJtay1kaXYtaWNvbiBcIittYXJrZXJGcm9tREIuaWQsIGljb25TaXplOiBudWxsLCBodG1sOiBcIjxkaXYgY2xhc3M9XFxcIm1rLWljb24tY29udGFpbmVyIG1rLW9rXFxcIj5cIisgdGVtcE1hcmtlck5vICtcIjwvZGl2PlwifSxcbiAgICAgICAgXCJpZFwiOiBtYXJrZXJGcm9tREIuaWQsXG4gICAgICAgIFwibGF0bG5nXCI6IHtcbiAgICAgICAgICBcImxhdFwiOiBtYXJrZXJGcm9tREIubGF0LFxuICAgICAgICAgIFwibG5nXCI6IG1hcmtlckZyb21EQi5sb25cbiAgICAgICAgfSxcbiAgICAgICAgXCJtZXNzYWdlXCI6IHVuZGVmaW5lZCxcbiAgICAgICAgXCJtYXJrZXJzS2VlcGVyXCI6IFwicmlnaHRNYXJrZXJzXCJcblxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInRocm93IG1hcmtlciB0byBnZW9yZWZlcmVuY2UuY29udHJvbGxlciBcIiwgbWFya2VyKTtcbiAgICAgIH07JHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjcmVhdGVNYXJrZXJGb3JUYWJsZScsIG1hcmtlcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogZGVsZXRlIGV2ZW50IGZpcmVkIGZyb20gR0NQIFRhYmxlIHRvIGRlbGV0ZSB0aGUgR0NQIGZyb20gTGVmdCBhbmQgUmlnaHQgTWFwIFxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBnY3BJZFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGRlbGV0ZUdDUEZyb21NYXAoZ2NwSWQpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IEdjcFRhYmxlQ29udHJvbGxlciA+Pj4gZGVsZXRlR0NQRnJvbU1hcCBcIiwgZ2NwSWQsICRzY29wZS50YWJsZURhdGEpO1xuICAgICAgLy8gY2hlY2sgaWYgZ2NwSWQgYWV4aXN0IGluIFRhYmxlIGRhdGFcbiAgICAgIC8vIGNvbnNvbGUubG9nKF8uZmluZCgkc2NvcGUudGFibGVEYXRhLCBbJ2lkJywgZ2NwSWRdKSk7XG4gICAgICBpZiAoXy5maW5kKCRzY29wZS50YWJsZURhdGEsIFsnaWQnLCBnY3BJZF0pKSB7XG4gICAgICAgIC8vIFRPRE8gOiBjYWxsIHNvbWUgZXZlbnQgdG8gZGVsZXRlIG1hcmtlcnMgZnJvbSBib3RoIHRoZSBtYXBzIFxuICAgICAgICB2YXIgdGVtcCA9IHtcbiAgICAgICAgICBtb2RlbDoge1xuICAgICAgICAgICAgaWQ6IGdjcElkLFxuICAgICAgICAgICAgZXZlbnRGcm9tOiBcImdjcFRhYmxlXCJcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8vIGZpcmUgYSBldmVudCB0byByZW1vdmUgbWFya2VycyBmcm9tIG1hcHNcbiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KFwibGVhZmxldERpcmVjdGl2ZU1hcmtlci5sZWZ0TWFwVmlld2VyLmNsaWNrXCIsIHRlbXApO1xuICAgICAgICAvLyAkcm9vdFNjb3BlLiRicm9hZGNhc3QoXCJsZWFmbGV0RGlyZWN0aXZlTWFya2VyLmxlZnRNYXBWaWV3ZXIuY2xpY2tcIiwgdGVtcCk7XG4gICAgICAgIC8vIGRlbGV0ZSBmcm9tIHRhYmxlXG4gICAgICAgICRzY29wZS50YWJsZURhdGEgPSBfLmZpbHRlcigkc2NvcGUudGFibGVEYXRhLCBmdW5jdGlvbiAobykge1xuICAgICAgICAgIHJldHVybiAhKG8uaWQgPT09IGdjcElkKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZmlsdGVyZWRUYWJsZURhdGEgPSBcIiwgJHNjb3BlLnRhYmxlRGF0YSk7XG4gICAgICB9XG4gICAgICByZWZyZXNoR0NQVGFibGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWxldGUgZXZlbnQgZmlyZWQgZnJvbSBtYXAgdG8gZGVsZXRlIHRoZSBHQ1AgZnJvbSBUYWJsZSBcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZ2NwSWRcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkZWxldGVHQ1BGcm9tVGFibGUoZ2NwSWQpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IEdjcFRhYmxlQ29udHJvbGxlciA+Pj4gZGVsZXRlR0NQRnJvbVRhYmxlIFwiLCBnY3BJZCwgJHNjb3BlLnRhYmxlRGF0YSk7XG4gICAgICAvLyBjaGVjayBpZiBnY3BJZCBhZXhpc3QgaW4gVGFibGUgZGF0YVxuICAgICAgLy8gY29uc29sZS5sb2coXy5maW5kKCRzY29wZS50YWJsZURhdGEsIFsnaWQnLCBnY3BJZF0pKTtcbiAgICAgIGlmIChfLmZpbmQoJHNjb3BlLnRhYmxlRGF0YSwgWydpZCcsIGdjcElkXSkpIHtcbiAgICAgICAgJHNjb3BlLnRhYmxlRGF0YSA9IF8uZmlsdGVyKCRzY29wZS50YWJsZURhdGEsIGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgcmV0dXJuICEoby5pZCA9PT0gZ2NwSWQpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJmaWx0ZXJlZFRhYmxlRGF0YSA9IFwiLCAkc2NvcGUudGFibGVEYXRhKTtcbiAgICAgIH1cbiAgICAgIHJlZnJlc2hHQ1BUYWJsZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlZnJlc2ggR0NQIGZyb20gVGFibGUgd2l0aCBjdXJyZW50IEdDUFxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlZnJlc2hHQ1BUYWJsZSgpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IEdjcFRhYmxlQ29udHJvbGxlciA+Pj4gcmVmcmVzaEdDUFRhYmxlIFwiLCB2bS5nZW9SZWYpO1xuICAgICAgaWYgKHZtLmdlb1JlZikge1xuICAgICAgICAkc2NvcGUuc2hvd1RhYmxlID0gZmFsc2U7XG4gICAgICAgIGlmIChfLnNpemUodm0uZ2VvUmVmLmltYWdlQ29vcmRpbmF0ZXMpID49IDMgJiYgXy5zaXplKHZtLmdlb1JlZi53b3JsZENvb3JkaW5hdGVzKSA+PSAzKSB7XG4gICAgICAgICAgLy8gY2hlY2sgaWYgYm90aCB0aGUgbWFwcyBoYXZlIHNhbWUgbnVtYmVyIG9mIEdDUHNcbiAgICAgICAgICBpZiAoXy5zaXplKHZtLmdlb1JlZi5pbWFnZUNvb3JkaW5hdGVzKSA9PT0gXy5zaXplKHZtLmdlb1JlZi53b3JsZENvb3JkaW5hdGVzKSkge1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXy5zaXplKHZtLmdlb1JlZi5pbWFnZUNvb3JkaW5hdGVzKSArIFwiIC0gXCIrIF8uc2l6ZSh2bS5nZW9SZWYud29ybGRDb29yZGluYXRlcykpXG4gICAgICAgICAgICBwcmV2aWV3R2NwKHZtLmdlb1JlZik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBjb25maWcgPSB7XG4gICAgICAgICAgICAgIHRpdGxlOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2RpYWxvZy5pbnZhbGlkR2VvcmVmVGl0bGUnKSxcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICR0cmFuc2xhdGUuaW5zdGFudCgnZGlhbG9nLmludmFsaWRHZW9yZWZUZXh0JyksXG4gICAgICAgICAgICAgIHRvb2xiYXJCZ0NvbG9yOiAkbWRDb2xvcnMuZ2V0VGhlbWVDb2xvcigncHJpbWFyeScpLFxuICAgICAgICAgICAgICBva0JnQ29sb3I6ICRtZENvbG9ycy5nZXRUaGVtZUNvbG9yKCdwcmltYXJ5JyksXG4gICAgICAgICAgICAgIG9rOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2dsb2JhbC5vaycpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgQzJEaWFsb2cuYWxlcnQoY29uZmlnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbGVhckRhdGEoKSB7XG4gICAgICB2bS5nZW9SZWYgPSBudWxsO1xuICAgICAgJHNjb3BlLnNob3dUYWJsZSA9IGZhbHNlO1xuICAgICAgJHNjb3BlLnRhYmxlRGF0YSA9IFtdO1xuICAgIH1cblxuICAgIGluaXQoKTtcbiAgfVxufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnRyb2xsZXIoJ0dlb0xlZnRTaWRlbmF2Q29udHJvbGxlcicsIEdlb0xlZnRTaWRlbmF2Q29udHJvbGxlcik7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICBmdW5jdGlvbiBHZW9MZWZ0U2lkZW5hdkNvbnRyb2xsZXIoJHNjb3BlLCAkdGltZW91dCwgJG1kU2lkZW5hdiwgJGxvZywgJHJvb3RTY29wZSwgbG9kYXNoLCAkbWRTZWxlY3QsICR3aW5kb3csIE1hcExheWVyU2VydmljZSwgR2VvcmVmZXJlbmNlU2VydmljZSwgQzJUb2FzdCwgJHRyYW5zbGF0ZSwgR2xvYmFsLCAkbWRDb2xvcnMsIEMyRGlhbG9nLCAkbWREaWFsb2csICRzdGF0ZSwgbGVhZmxldERhdGEsICRsb2NhbFN0b3JhZ2UpIHtcbiAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgdm0uY2xvc2UgPSBjbG9zZTtcbiAgICB2bS5zYXZlID0gc2F2ZTtcbiAgICB2bS5yZWN0aWZ5RGlzYWJsZSA9IHJlY3RpZnlEaXNhYmxlO1xuICAgIHZtLnByZXZpZXdHY3AgPSBwcmV2aWV3R2NwO1xuICAgIHZtLmdlbmVyYXRlRmlsZW5hbWVhbmRFeHRlbnQgPSBnZW5lcmF0ZUZpbGVuYW1lYW5kRXh0ZW50O1xuICAgIHZtLm1pbnggPSBudWxsO1xuICAgIHZtLm1pbnkgPSBudWxsO1xuICAgIHZtLm1heHggPSBudWxsO1xuICAgIHZtLm1heHkgPSBudWxsO1xuICAgIHZtLmdjcCA9IG51bGw7XG4gICAgdm0ubWFudWFsRXh0ZW50ID0gZmFsc2U7XG4gICAgJHNjb3BlLmV4dGVudFNlbGVjdGlvbiA9ICcwJztcblxuICAgICRzY29wZS4kd2F0Y2goXCJleHRlbnRTZWxlY3Rpb25cIiwgZnVuY3Rpb24gKG5ld1ZhbCwgb2xkKSB7XG4gICAgICAvLyBpZiAyIHNlbGVjdGVkIG1lYW5zIGRyYXcgbWFuYXVsIHJlY3RcbiAgICAgIGlmIChuZXdWYWwgPT09IDIpIHtcbiAgICAgICAgLy8gcmVtb3ZlRXh0ZW50UmVjdGFuZ2xlKGZ1bmN0aW9uKCkge1xuICAgICAgICBkcmF3UmVjdGFuZ2xlRm9yRXh0ZW50KCk7XG4gICAgICAgIC8vIH0pO1xuICAgICAgfSBlbHNlIGlmIChuZXdWYWwgPT09IDEpIHtcbiAgICAgICAgY2xlYW5VcCgpO1xuICAgICAgICAvLyBjYWxjdWxhdGUgbWlueCwgbWlueSB2YWx1ZXNcbiAgICAgICAgY2FsY01pbk1heFZhbHVlcygpO1xuICAgICAgfSBlbHNlIGlmIChuZXdWYWwgPT09IDApIHtcbiAgICAgICAgLy8gcmVtb3ZlIEV4dGVudCByZWN0YW5nbGUgZnJvbSBtYXBcbiAgICAgICAgY2xlYW5VcCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gZW1pdCBsaXN0ZW5lciB3aGVuIHNhdmUgb2YgR2VvcmVmZXJlbmNlIGNvbnRyb2xsZXIgY2FsbGVkLiBJdCBwYXNzZXMgdGhlIEdDUCBvbiBsZWZ0IHBhbmVsXG4gICAgJHJvb3RTY29wZS4kb24oJ3NhdmVHZW9SZWYnLCBmdW5jdGlvbiAoZXZlbnQsIGFyZ3MpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IGdlLmxlZnQuc2lkZW5hdi5jb250cm9sbGVyID4+PiBzYXZlR2VvUmVmIFwiLCBhcmdzKTtcbiAgICAgIHZtLmdjcCA9IGFyZ3M7XG4gICAgICAvLyByZWRyYXcgdGhlIHJlc2FtcGxpbmcgbWV0aG9kIGRyb3Bkb3duXG4gICAgICBnZXRSZXNhbXBsaW5nTWV0aG9kc0Jhc2VkT25HQ1AoT2JqZWN0LmtleXModm0uZ2NwKS5sZW5ndGgpO1xuICAgICAgLy8gcmVkcmF3IHRoZSByZWN0aWZ5IG1ldGhvZCBkcm9wZG93blxuICAgICAgZ2V0UmVjdGlmeU1ldGhvZHNCYXNlZE9uR0NQKE9iamVjdC5rZXlzKHZtLmdjcCkubGVuZ3RoKTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEVuYWJsZXMgLyBEaXNhYmxlcyBSZWN0aWZ5IG9wdGlvbnMgaW4gZHJvcGRvd24gYmFzZWQgb24gbnVtYmVyIG9mIEdDUFNcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZWN0aWZ5RGlzYWJsZShpZCkge1xuICAgICAgLy8gQ2FuJ3QgYWNjZXNzIG51bU9mR0NQKCkgZnVuIG9mIGdlb3JlZmVyZW5jZS5jb250cm9sbGVyLmpzIGhlcmUuXG4gICAgICBpZiAoaWQgPT0gXCIybmRPcmRlclBvbHluXCIpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBHZW9yZWZlcmVuY2VDb250cm9sbGVyLm51bU9mR0NQID49IDZcbiAgICAgIH0gZWxzZSBpZiAoaWQgPT0gXCIzcmRPcmRlclBvbHluXCIpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBHZW9yZWZlcmVuY2VDb250cm9sbGVyLm51bU9mR0NQID49IDEwXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gS2VlcCB0aGUgYnV0dG9uIGVuYWJsZWQgZm9yIEF1dG8gYW5kIDFzdCBPcmRlclxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmlyc3QgZnVuY3Rpb24gY2FsbGVkIGFmdGVyIHRoZSBjb250cm9sbGVyIGlzIHJhblxuICAgICAqIGhlcmUgdGhlIHN0dWZmIGFyZSBpbml0aWFsaXplZFxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gZ2UubGVmdC5zaWRlbmF2LmNvbnRyb2xsZXIgPj4+IGFjdGl2YXRlIFwiKTtcbiAgICAgIHZtLnJlY3RpZnlNZXRob2RzID0gZ2V0UmVjdGlmeU1ldGhvZHMoKTtcbiAgICAgIHZtLnJlY3RpZnlNZXRob2QgPSBsb2Rhc2guZmluZCh2bS5yZWN0aWZ5TWV0aG9kcywgZnVuY3Rpb24gKHJtKSB7XG4gICAgICAgIC8vIHJldHVybiBybS5pZCA9PT0gJ0F1dG9CYXNlZE9uR0NQJztcbiAgICAgICAgcmV0dXJuIHJtLmlkID09PSAnJzsgLy8gVG8gbm90IGFsbG93ICdBdXRvQmFzZWRPbkdDUCcgdG8gYmUgdGhlcmUgYnkgZGVmYXVsdFxuICAgICAgfSk7XG4gICAgICB2bS5yZXNhbXBsaW5nTWV0aG9kcyA9IGdldFJlc2FtcGxpbmdNZXRob2RzKCk7XG4gICAgICB2bS5yZXNhbXBsaW5nTWV0aG9kID0gbG9kYXNoLmZpbmQodm0ucmVzYW1wbGluZ01ldGhvZHMsIGZ1bmN0aW9uIChybSkge1xuICAgICAgICAvLyByZXR1cm4gcm0uaWQgPT09ICduZWFyJztcbiAgICAgICAgcmV0dXJuIHJtLmlkID09PSAnJzsgLy8gVG8gbm90IGFsbG93ICduZWFyJyB0byBiZSB0aGVyZSBieSBkZWZhdWx0LlxuICAgICAgfSk7XG4gICAgICBtb25pdG9yQ2xvc2VTZWxlY3QoKTtcbiAgICAgICRtZFNpZGVuYXYoJ2xlZnQnKS5vbkNsb3NlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJG1kU2VsZWN0LmhpZGUoKTtcbiAgICAgIH0pO1xuICAgICAgdm0uZ2VvUmVmRmlsZW5hbWUgPSAnJztcbiAgICAgIC8vIHJlc29sdmluZyAjMjA4XG4gICAgICBpZiAoIWxvZGFzaC5pc0VtcHR5KCRsb2NhbFN0b3JhZ2UuZ2V0T2JqZWN0KFwiZ2VvcmVmTGF5ZXJcIikpKSB7XG4gICAgICAgIC8vIHJlbW92ZSBiYXNlIGxheWVyXG4gICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBNYXBMYXllclNlcnZpY2UucmVtb3ZlQWxsTWFwTGF5ZXJzKFwibGVmdE1hcFZpZXdlclwiKTtcbiAgICAgICAgfSwgMjAwKTtcbiAgICAgICAgLy8gQWRkIGxheWVyIHRvIHJpZ2h0IG1hcFxuICAgICAgICBNYXBMYXllclNlcnZpY2UuYWRkTWFwTGF5ZXIoJGxvY2FsU3RvcmFnZS5nZXRPYmplY3QoXCJnZW9yZWZMYXllclwiKSwgXCJyaWdodE1hcFZpZXdlclwiKTtcbiAgICAgICAgLy8gQWRkIGltYWdlIGxheWVyIHRvIGxlZnQgbWFwXG4gICAgICAgIE1hcExheWVyU2VydmljZS5hZGRNYXBMYXllcigkbG9jYWxTdG9yYWdlLmdldE9iamVjdChcIm5vbmdlb3JlZkxheWVyXCIpLCBcImxlZnRNYXBWaWV3ZXJcIik7XG4gICAgICAgICRsb2NhbFN0b3JhZ2UucmVtb3ZlKFwiZ2VvcmVmTGF5ZXJcIik7XG4gICAgICAgICRsb2NhbFN0b3JhZ2UucmVtb3ZlKFwibm9uZ2VvcmVmTGF5ZXJcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xvc2UgdGhpcyBzaWRlbmF2XG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2xvc2UoKSB7XG4gICAgICAkbWRTaWRlbmF2KCdsZWZ0JykuY2xvc2UoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVuIHRoaXMgc2lkZW5hdlxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG9wZW4oKSB7XG4gICAgICAkbWRTaWRlbmF2KCdsZWZ0Jykub3BlbigpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgdGhlIHJlY3RpZnkgbWV0aG9kcyBhdmFpbGFibGUgdG8gYmUgdXNlZFxuICAgICAqIFxuICAgICAqIEByZXR1cm5zIHthcnJheX1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRSZWN0aWZ5TWV0aG9kcygpIHtcbiAgICAgIHJldHVybiBbeyBuYW1lOiAnQXV0byAoYmFzZWQgb24gR0NQKScsIGlkOiAnQXV0b0Jhc2VkT25HQ1AnLCBkaXNhYmxlOiB0cnVlIH0sIHsgbmFtZTogJzFzdCBPcmRlciBQb2x5bi4gKG1pbiAzIHBvaW50cyByZXF1aXJlZCknLCBpZDogJzFzdE9yZGVyUG9seW4nLCBkaXNhYmxlOiB0cnVlIH0sIHsgbmFtZTogJzJuZCBPcmRlciBQb2x5bi4gKG1pbiA2IHBvaW50cyByZXF1aXJlZCknLCBpZDogJzJuZE9yZGVyUG9seW4nLCBkaXNhYmxlOiB0cnVlIH0sIHsgbmFtZTogJzNyZCBPcmRlciBQb2x5bi4gKG1pbiAxMCBwb2ludHMgcmVxdWlyZWQpJywgaWQ6ICczcmRPcmRlclBvbHluJywgZGlzYWJsZTogdHJ1ZSB9XTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHRoZSByZWN0aWZ5IG1ldGhvZHMgYmFzZWQgb24gbnVtYmVyIG9mIEdDUFxuICAgICAqIFxuICAgICAqIEByZXR1cm5zIHthcnJheX1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRSZWN0aWZ5TWV0aG9kc0Jhc2VkT25HQ1AoKSB7XG4gICAgICAvKiB2bS5yZWN0aWZ5TWV0aG9kcyA9IFtcbiAgICAgICAge25hbWU6ICdBdXRvIChiYXNlZCBvbiBHQ1ApJywgaWQ6ICdBdXRvQmFzZWRPbkdDUCcsIGRpc2FibGU6IGZhbHNlfSxcbiAgICAgICAgeyBuYW1lOiAnMXN0IE9yZGVyIFBvbHluLiAobWluIDMgcG9pbnRzIHJlcXVpcmVkKScsaWQ6ICcxc3RPcmRlclBvbHluJywgZGlzYWJsZTogZmFsc2V9LFxuICAgICAgICB7IG5hbWU6ICcybmQgT3JkZXIgUG9seW4uIChtaW4gNiBwb2ludHMgcmVxdWlyZWQpJyxpZDogJzJuZE9yZGVyUG9seW4nLCBkaXNhYmxlOiBmYWxzZX0sXG4gICAgICAgIHsgbmFtZTogJzNyZCBPcmRlciBQb2x5bi4gKG1pbiAxMCBwb2ludHMgcmVxdWlyZWQpJyxpZDogJzNyZE9yZGVyUG9seW4nLCBkaXNhYmxlOiBmYWxzZX1cbiAgICAgIF07ICovXG4gICAgICBpZiAoT2JqZWN0LmtleXModm0uZ2NwKS5sZW5ndGggPj0gMyAmJiBPYmplY3Qua2V5cyh2bS5nY3ApLmxlbmd0aCA8IDYpIHtcbiAgICAgICAgdm0ucmVjdGlmeU1ldGhvZHMgPSBbeyBuYW1lOiAnQXV0byAoYmFzZWQgb24gR0NQKScsIGlkOiAnQXV0b0Jhc2VkT25HQ1AnLCBkaXNhYmxlOiBmYWxzZSB9LCB7IG5hbWU6ICcxc3QgT3JkZXIgUG9seW4uIChtaW4gMyBwb2ludHMgcmVxdWlyZWQpJywgaWQ6ICcxc3RPcmRlclBvbHluJywgZGlzYWJsZTogZmFsc2UgfSwgeyBuYW1lOiAnMm5kIE9yZGVyIFBvbHluLiAobWluIDYgcG9pbnRzIHJlcXVpcmVkKScsIGlkOiAnMm5kT3JkZXJQb2x5bicsIGRpc2FibGU6IHRydWUgfSwgeyBuYW1lOiAnM3JkIE9yZGVyIFBvbHluLiAobWluIDEwIHBvaW50cyByZXF1aXJlZCknLCBpZDogJzNyZE9yZGVyUG9seW4nLCBkaXNhYmxlOiB0cnVlIH1dO1xuICAgICAgfSBlbHNlIGlmIChPYmplY3Qua2V5cyh2bS5nY3ApLmxlbmd0aCA+PSA2ICYmIE9iamVjdC5rZXlzKHZtLmdjcCkubGVuZ3RoIDwgMTApIHtcbiAgICAgICAgdm0ucmVjdGlmeU1ldGhvZHMgPSBbeyBuYW1lOiAnQXV0byAoYmFzZWQgb24gR0NQKScsIGlkOiAnQXV0b0Jhc2VkT25HQ1AnLCBkaXNhYmxlOiBmYWxzZSB9LCB7IG5hbWU6ICcxc3QgT3JkZXIgUG9seW4uIChtaW4gMyBwb2ludHMgcmVxdWlyZWQpJywgaWQ6ICcxc3RPcmRlclBvbHluJywgZGlzYWJsZTogZmFsc2UgfSwgeyBuYW1lOiAnMm5kIE9yZGVyIFBvbHluLiAobWluIDYgcG9pbnRzIHJlcXVpcmVkKScsIGlkOiAnMm5kT3JkZXJQb2x5bicsIGRpc2FibGU6IGZhbHNlIH0sIHsgbmFtZTogJzNyZCBPcmRlciBQb2x5bi4gKG1pbiAxMCBwb2ludHMgcmVxdWlyZWQpJywgaWQ6ICczcmRPcmRlclBvbHluJywgZGlzYWJsZTogdHJ1ZSB9XTtcbiAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LmtleXModm0uZ2NwKS5sZW5ndGggPj0gMTApIHtcbiAgICAgICAgdm0ucmVjdGlmeU1ldGhvZHMgPSBbeyBuYW1lOiAnQXV0byAoYmFzZWQgb24gR0NQKScsIGlkOiAnQXV0b0Jhc2VkT25HQ1AnLCBkaXNhYmxlOiBmYWxzZSB9LCB7IG5hbWU6ICcxc3QgT3JkZXIgUG9seW4uIChtaW4gMyBwb2ludHMgcmVxdWlyZWQpJywgaWQ6ICcxc3RPcmRlclBvbHluJywgZGlzYWJsZTogZmFsc2UgfSwgeyBuYW1lOiAnMm5kIE9yZGVyIFBvbHluLiAobWluIDYgcG9pbnRzIHJlcXVpcmVkKScsIGlkOiAnMm5kT3JkZXJQb2x5bicsIGRpc2FibGU6IGZhbHNlIH0sIHsgbmFtZTogJzNyZCBPcmRlciBQb2x5bi4gKG1pbiAxMCBwb2ludHMgcmVxdWlyZWQpJywgaWQ6ICczcmRPcmRlclBvbHluJywgZGlzYWJsZTogZmFsc2UgfV07XG4gICAgICB9XG4gICAgICAvLyBpZiB1c2VyIGhhdmUgYWxyZWFkeSBzZWxlY3RlZCBhbiBvcHRpb24gZnJvbSBkcm9wZG93biB0aGFuIHJlc2VsZWN0ZWQgaXRcbiAgICAgIGlmICh0eXBlb2Ygdm0ucmVjdGlmeU1ldGhvZCAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICBsb2Rhc2guZm9yRWFjaCh2bS5yZWN0aWZ5TWV0aG9kcywgZnVuY3Rpb24gKG1ldGhvZCkge1xuICAgICAgICAgIGlmIChtZXRob2QuaWQgPT09IHZtLnJlY3RpZnlNZXRob2QuaWQpIHtcbiAgICAgICAgICAgIHZtLnJlY3RpZnlNZXRob2QgPSBtZXRob2Q7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHRoZSByZXNhbXBsaW5nIG1ldGhvZHMgYXZhaWxhYmxlIHRvIGJlIHVzZWRcbiAgICAgKiBcbiAgICAgKiBAcmV0dXJucyB7YXJyYXl9XG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0UmVzYW1wbGluZ01ldGhvZHMoKSB7XG4gICAgICByZXR1cm4gW1xuICAgICAgLy8gaWQgPSBnZGFsd2FycCBwYXJhbWV0ZXJcbiAgICAgIHsgbmFtZTogJ05lYXJlc3QgbmVpZ2hib3VyIHJlc2FtcGxpbmcnLCBpZDogJ25lYXInLCBkaXNhYmxlOiB0cnVlIH0sIHsgbmFtZTogJ0JpbGluZWFyIHJlc2FtcGxpbmcnLCBpZDogJ2JpbGluZWFyJywgZGlzYWJsZTogdHJ1ZSB9LCB7IG5hbWU6ICdDdWJpYyByZXNhbXBsaW5nJywgaWQ6ICdjdWJpYycsIGRpc2FibGU6IHRydWUgfV07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSB0aGUgcmVzYW1wbGluZyBtZXRob2RzIGJhc2VkIG9uIHRoZSBudW1iZXIgb2YgR0NQIHBvaW50cyBhdmFpbGFibGVcbiAgICAgKiBcbiAgICAgKiBAcmV0dXJucyB7YXJyYXl9XG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0UmVzYW1wbGluZ01ldGhvZHNCYXNlZE9uR0NQKCkge1xuICAgICAgaWYgKE9iamVjdC5rZXlzKHZtLmdjcCkubGVuZ3RoIDwgMykge1xuICAgICAgICB2bS5yZXNhbXBsaW5nTWV0aG9kcyA9IFt7IG5hbWU6ICdOZWFyZXN0IG5laWdoYm91ciByZXNhbXBsaW5nJywgaWQ6ICduZWFyJywgZGlzYWJsZTogZmFsc2UgfSwgeyBuYW1lOiAnQmlsaW5lYXIgcmVzYW1wbGluZycsIGlkOiAnYmlsaW5lYXInLCBkaXNhYmxlOiBmYWxzZSB9LCB7IG5hbWU6ICdDdWJpYyByZXNhbXBsaW5nJywgaWQ6ICdjdWJpYycsIGRpc2FibGU6IGZhbHNlIH1dO1xuICAgICAgfSBlbHNlIGlmIChPYmplY3Qua2V5cyh2bS5nY3ApLmxlbmd0aCA+PSAzICYmIE9iamVjdC5rZXlzKHZtLmdjcCkubGVuZ3RoIDwgNikge1xuICAgICAgICB2bS5yZXNhbXBsaW5nTWV0aG9kcyA9IFt7IG5hbWU6ICdOZWFyZXN0IG5laWdoYm91ciByZXNhbXBsaW5nJywgaWQ6ICduZWFyJywgZGlzYWJsZTogZmFsc2UgfSwgeyBuYW1lOiAnQmlsaW5lYXIgcmVzYW1wbGluZycsIGlkOiAnYmlsaW5lYXInLCBkaXNhYmxlOiB0cnVlIH0sIHsgbmFtZTogJ0N1YmljIHJlc2FtcGxpbmcnLCBpZDogJ2N1YmljJywgZGlzYWJsZTogdHJ1ZSB9XTtcbiAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LmtleXModm0uZ2NwKS5sZW5ndGggPj0gNiAmJiBPYmplY3Qua2V5cyh2bS5nY3ApLmxlbmd0aCA8IDEwKSB7XG4gICAgICAgIHZtLnJlc2FtcGxpbmdNZXRob2RzID0gW3sgbmFtZTogJ05lYXJlc3QgbmVpZ2hib3VyIHJlc2FtcGxpbmcnLCBpZDogJ25lYXInLCBkaXNhYmxlOiBmYWxzZSB9LCB7IG5hbWU6ICdCaWxpbmVhciByZXNhbXBsaW5nJywgaWQ6ICdiaWxpbmVhcicsIGRpc2FibGU6IGZhbHNlIH0sIHsgbmFtZTogJ0N1YmljIHJlc2FtcGxpbmcnLCBpZDogJ2N1YmljJywgZGlzYWJsZTogdHJ1ZSB9XTtcbiAgICAgIH0gZWxzZSBpZiAoT2JqZWN0LmtleXModm0uZ2NwKS5sZW5ndGggPj0gMTApIHtcbiAgICAgICAgdm0ucmVzYW1wbGluZ01ldGhvZHMgPSBbeyBuYW1lOiAnTmVhcmVzdCBuZWlnaGJvdXIgcmVzYW1wbGluZycsIGlkOiAnbmVhcicsIGRpc2FibGU6IGZhbHNlIH0sIHsgbmFtZTogJ0JpbGluZWFyIHJlc2FtcGxpbmcnLCBpZDogJ2JpbGluZWFyJywgZGlzYWJsZTogZmFsc2UgfSwgeyBuYW1lOiAnQ3ViaWMgcmVzYW1wbGluZycsIGlkOiAnY3ViaWMnLCBkaXNhYmxlOiBmYWxzZSB9XTtcbiAgICAgIH1cbiAgICAgIC8vIGlmIHVzZXIgaGF2ZSBhbHJlYWR5IHNlbGVjdGVkIGFuIG9wdGlvbiBmcm9tIGRyb3Bkb3duIHRoYW4gcmVzZWxlY3RlZCBpdFxuICAgICAgaWYgKHR5cGVvZiB2bS5yZXNhbXBsaW5nTWV0aG9kICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIGxvZGFzaC5mb3JFYWNoKHZtLnJlc2FtcGxpbmdNZXRob2RzLCBmdW5jdGlvbiAobWV0aG9kKSB7XG4gICAgICAgICAgaWYgKG1ldGhvZC5pZCA9PT0gdm0ucmVzYW1wbGluZ01ldGhvZC5pZCkge1xuICAgICAgICAgICAgdm0ucmVzYW1wbGluZ01ldGhvZCA9IG1ldGhvZDtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgY2FsbGVkIG9uIHJlc2FtcGxlIERyb3Bkb3duIHNlbGVjdGlvbiBjaGFuZ2UsIHRvIGdldCBnZW5lcmF0ZSB0aGUgXG4gICAgICogJ2ZpbGVuYW1lJyBhbmQgZXh0ZW50ICd2YWx1ZSdcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZW5lcmF0ZUZpbGVuYW1lYW5kRXh0ZW50KCkge1xuICAgICAgLy8gZ2V0IHRoZSBsYXllciB0aGF0IGNvbnRhaW5zIHRoZSByZXNvdXJjZS9tYXAgdG8gYmUgZ2VvcmVmZXJlbmNlZFxuICAgICAgdmFyIGxheWVyID0gTWFwTGF5ZXJTZXJ2aWNlLmdldFZpZXdlck92ZXJsYXlzKFwibGVmdE1hcFZpZXdlclwiKTtcblxuICAgICAgLy8gZ2V0IHRoZSByZXNvdXJjZS9tYXAgaWQgZnJvbSB0aGUgbG9hZGVkIGxheWVyXG4gICAgICAvLyBhcyBpbiB0aGUgY2FzZSBvZiBnZW9yZWZlcmVuY2UgbW9kdWxlIG9ubHkgb25lIHJlc291cmNlL21hcCB3aWxsXG4gICAgICAvLyBiZSBsb2FkZWQsIHdlIGdldCB0aGUgcHJvcGVydGllcyBmcm9tIHRoZSBmaXJzdCByZXNvdXJjZSBpbiB0aGUgbGF5ZXJcbiAgICAgIHZhciBmaXJzdExheWVyS2V5ID0gT2JqZWN0LmtleXMobGF5ZXIpWzBdO1xuXG4gICAgICAvLyBHZXQgbmV3IGdlb3JlZmVuY2VkIGZpbGUgbmFtZSBmcm9tIHRoZSB1c2VyXG4gICAgICB2bS5nZW9SZWZGaWxlbmFtZSA9IGxheWVyW2ZpcnN0TGF5ZXJLZXldLnJlc291cmNlLnRpdGxlICsgXCJfZ19cIiArIHZtLnJlY3RpZnlNZXRob2QuaWQgKyBcIl9cIiArIHZtLnJlc2FtcGxpbmdNZXRob2QuaWQgKyBcIl9cIiArIChuZXcgRGF0ZSgpLmdldE1vbnRoKCkgKyAxKSArIFwiLlwiICsgbmV3IERhdGUoKS5nZXREYXRlKCkgKyBcIi5cIiArIG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKTtcblxuICAgICAgLy8gY2FsY3VsYXRlIG1pbngsIG1pbnkgdmFsdWVzXG4gICAgICBjYWxjTWluTWF4VmFsdWVzKCk7XG4gICAgICB2bS5iYm94Q3JvcEltYWdlID0gdm0ubWlueCArIFwiIFwiICsgdm0ubWlueSArIFwiIFwiICsgdm0ubWF4eCArIFwiIFwiICsgdm0ubWF4eTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGVzIHRoZSBtaW54LCBtaW55LCBtYXh4IGFuZCBtYXh5IHZhbHVlcyBiYXNlZCBvbiBHQ1AgY3JlYXRlZCBcbiAgICAgKiBvbiByaWdodCBtYXBcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjYWxjTWluTWF4VmFsdWVzKCkge1xuICAgICAgLy8gQ3JvcCBmaW5hbCBnZW9yZWZlcmVuY2VkIGltYWdlXG4gICAgICB2YXIgbGF0ID0gW107dmFyIGxuZyA9IFtdO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBPYmplY3Qua2V5cygkc2NvcGUuJHBhcmVudC52bS5yaWdodE1hcmtlcnMpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGxhdC5wdXNoKE9iamVjdC52YWx1ZXMoJHNjb3BlLiRwYXJlbnQudm0ucmlnaHRNYXJrZXJzKVtpXVtcImxhdFwiXSk7XG4gICAgICAgIGxuZy5wdXNoKE9iamVjdC52YWx1ZXMoJHNjb3BlLiRwYXJlbnQudm0ucmlnaHRNYXJrZXJzKVtpXVtcImxuZ1wiXSk7XG4gICAgICB9XG4gICAgICAvLyBhc3NpZ24gdGhlIGV4dGVudCB2YWx1ZXMgdG8gc2NvcGUgdmFyaWFibGUgdG8gZGlwbGF5IG9uIHBhZ2VcbiAgICAgIHZtLm1pbnggPSBwYXJzZUZsb2F0KE1hdGgubWluLmFwcGx5KE1hdGgsIGxuZykudG9GaXhlZCg1KSk7XG4gICAgICB2bS5taW55ID0gcGFyc2VGbG9hdChNYXRoLm1pbi5hcHBseShNYXRoLCBsYXQpLnRvRml4ZWQoNSkpO1xuICAgICAgdm0ubWF4eCA9IHBhcnNlRmxvYXQoTWF0aC5tYXguYXBwbHkoTWF0aCwgbG5nKS50b0ZpeGVkKDUpKTtcbiAgICAgIHZtLm1heHkgPSBwYXJzZUZsb2F0KE1hdGgubWF4LmFwcGx5KE1hdGgsIGxhdCkudG9GaXhlZCg1KSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW4gYSBjb21iaW5hdGlvbiBvZiBsZWFmbGV0LCB1aS1sZWFmbGV0LCBzaWRlbmF2IGFuZCBtZC1zZWxlY3RcbiAgICAgKiB3aGVuIHRoZSBtZC1zZWxlY3QgZHJvcCBkb3duIG9wdGlvbnMgYXJlIG9wZW4gYW5kIHRoZSB1c2VyIGNsaWNrc1xuICAgICAqIG91dHNpZGUgdGhlIG9wdGlvbnMgb3ZlcmxheSwgdGhlIG1kLXNlbGVjdCBpcyBub3QgYmVlbiBjbG9zZWQgYXV0b21hdGljYWxseVxuICAgICAqIFNvLCBmb3IgaW5zdGFuY2Ugd2UgaGFkIHRvIGNyZWF0ZSB0aGlzIGhhY2sgdW50aWwgd2UgZmluZCBhIG5pY2Ugc29sdXRpb24gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gbW9uaXRvckNsb3NlU2VsZWN0KCkge1xuICAgICAgdmFyICQkd2luZG93ID0gYW5ndWxhci5lbGVtZW50KCR3aW5kb3cpO1xuICAgICAgJCR3aW5kb3cub24oJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGlmIChldmVudC50YXJnZXQuY2xhc3NMaXN0WzBdID09PSAnbWQtc2lkZW5hdi1sZWZ0Jykge1xuICAgICAgICAgICRtZFNlbGVjdC5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBTYXZlLy9hcHBseSB0aGUgZ2VvcmVmZXJlbmNlIHRvIHRoZSBsYXllci9yZXNvdXJjZSBsb2FkZWQgaW4gdGhlIGxlZnRNYXBWaWV3ZXJcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzYXZlKCkge1xuICAgICAgLy8gY2hlY2sgZm9yIG51bWJlciBvZiBtYXJrZXJzIG9uIGJvdGggbWFwcyB0byBiZSBlcXVhbFxuICAgICAgaWYgKE9iamVjdC52YWx1ZXMoJHNjb3BlLiRwYXJlbnQudm0ubGVmdE1hcmtlcnMpLmxlbmd0aCA9PT0gT2JqZWN0LnZhbHVlcygkc2NvcGUuJHBhcmVudC52bS5yaWdodE1hcmtlcnMpLmxlbmd0aCkge1xuICAgICAgICAvLyBnZXQgdGhlIGxheWVyIHRoYXQgY29udGFpbnMgdGhlIHJlc291cmNlL21hcCB0byBiZSBnZW9yZWZlcmVuY2VkXG4gICAgICAgIHZhciBsYXllciA9IE1hcExheWVyU2VydmljZS5nZXRWaWV3ZXJPdmVybGF5cyhcImxlZnRNYXBWaWV3ZXJcIik7XG5cbiAgICAgICAgLy8gaW5zdGFudGlhdGUgdGhlIGdlb3JlZmVyZW5jZSBzZXJ2aWNlIHRoYXQgaXMgbGlua2VkIHdpdGggdGhlIGJhY2stZW5kIGVuZC1wb2ludFxuICAgICAgICB2YXIgZ2VvUmVmID0gbmV3IEdlb3JlZmVyZW5jZVNlcnZpY2UoKTtcblxuICAgICAgICAvLyBnZXQgdGhlIG1hcmtlcnMgZnJvbSBsZWZ0IGFuZCByaWdodCB2aWV3ZXJzIGZyb20gcGFyZW50IGNvbnRyb2xsZXJcbiAgICAgICAgZ2VvUmVmLmltYWdlQ29vcmRpbmF0ZXMgPSAkc2NvcGUuJHBhcmVudC52bS5sZWZ0TWFya2VycztcbiAgICAgICAgZ2VvUmVmLndvcmxkQ29vcmRpbmF0ZXMgPSAkc2NvcGUuJHBhcmVudC52bS5yaWdodE1hcmtlcnM7XG4gICAgICAgIGdlb1JlZi5yZWN0aWZ5TWV0aG9kID0gdm0ucmVjdGlmeU1ldGhvZC5pZDtcbiAgICAgICAgZ2VvUmVmLnJlc2FtcGxpbmdNZXRob2QgPSB2bS5yZXNhbXBsaW5nTWV0aG9kLmlkO1xuXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS4kcGFyZW50LnZtKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2codm0pO1xuXG5cbiAgICAgICAgLy8gZ2V0IHRoZSByZXNvdXJjZS9tYXAgaWQgZnJvbSB0aGUgbG9hZGVkIGxheWVyXG4gICAgICAgIC8vIGFzIGluIHRoZSBjYXNlIG9mIGdlb3JlZmVyZW5jZSBtb2R1bGUgb25seSBvbmUgcmVzb3VyY2UvbWFwIHdpbGxcbiAgICAgICAgLy8gYmUgbG9hZGVkLCB3ZSBnZXQgdGhlIHByb3BlcnRpZXMgZnJvbSB0aGUgZmlyc3QgcmVzb3VyY2UgaW4gdGhlIGxheWVyXG5cbiAgICAgICAgdmFyIGZpcnN0TGF5ZXJLZXkgPSBPYmplY3Qua2V5cyhsYXllcilbMF07XG4gICAgICAgIGdlb1JlZi5tYXBJZCA9IGxheWVyW2ZpcnN0TGF5ZXJLZXldLnJlc291cmNlLmlkO1xuXG4gICAgICAgIC8vIENvbnZlcnQgQXV0b0Jhc2VkT25HQ1AgdG8gT3JkZXIgXG4gICAgICAgIHZhciBudW1Db29yZGluYXRlcyA9IE9iamVjdC52YWx1ZXMoZ2VvUmVmLmltYWdlQ29vcmRpbmF0ZXMpLmxlbmd0aDtcbiAgICAgICAgZ2VvUmVmLnJlY3RpZnlNZXRob2QgPT0gXCJBdXRvQmFzZWRPbkdDUFwiID8gbnVtQ29vcmRpbmF0ZXMgPj0gMyAmJiBudW1Db29yZGluYXRlcyA8IDYgPyBnZW9SZWYucmVjdGlmeU1ldGhvZCA9IFwiMXN0T3JkZXJQb2x5blwiIDogbnVtQ29vcmRpbmF0ZXMgPj0gNiAmJiBudW1Db29yZGluYXRlcyA8IDEwID8gZ2VvUmVmLnJlY3RpZnlNZXRob2QgPSBcIjJuZE9yZGVyUG9seW5cIiA6IGdlb1JlZi5yZWN0aWZ5TWV0aG9kID0gXCIzcmRPcmRlclBvbHluXCIgOiBudWxsO1xuXG4gICAgICAgIC8vIEdldCBuZXcgZ2VvcmVmZW5jZWQgZmlsZSBuYW1lIGZyb20gdGhlIHVzZXJcbiAgICAgICAgLy8gZ2VvUmVmLm5ld0ZpbGVOYW1lID0gcHJvbXB0KFwiRW50ZXIgbmV3IGZpbGUgbmFtZS4gRGVmYXVsdCBpcyBmb2xsb3dzOlwiLCBsYXllcltmaXJzdExheWVyS2V5XS5yZXNvdXJjZS50aXRsZSArIFwiX2dfXCIgKyBnZW9SZWYucmVjdGlmeU1ldGhvZCArIFwiX1wiICsgZ2VvUmVmLnJlc2FtcGxpbmdNZXRob2QgKyBcIl9cIiArICgobmV3IERhdGUoKSkuZ2V0TW9udGgoKSsxKSArIFwiLlwiICsgKG5ldyBEYXRlKCkpLmdldERhdGUoKSArIFwiLlwiICsgKG5ldyBEYXRlKCkpLmdldEZ1bGxZZWFyKCkpO1xuICAgICAgICAvLyB1c2UgdGhlIGZpbGVuYW1lIGdlbmVyYXRlZCBpbiBcbiAgICAgICAgZ2VvUmVmLm5ld0ZpbGVOYW1lID0gdm0uZ2VvUmVmRmlsZW5hbWU7XG5cbiAgICAgICAgLy8gQ3JvcCBmaW5hbCBnZW9yZWZlcmVuY2VkIGltYWdlXG4gICAgICAgIC8qIHZhciBsYXQgPSBbXTsgdmFyIGxuZyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpPTA7IGk8T2JqZWN0LmtleXMoZ2VvUmVmLndvcmxkQ29vcmRpbmF0ZXMpLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICBsYXQucHVzaChPYmplY3QudmFsdWVzKGdlb1JlZi53b3JsZENvb3JkaW5hdGVzKVtpXVtcImxhdFwiXSk7XG4gICAgICAgICAgbG5nLnB1c2goT2JqZWN0LnZhbHVlcyhnZW9SZWYud29ybGRDb29yZGluYXRlcylbaV1bXCJsbmdcIl0pXG4gICAgICAgIH1cbiAgICAgICAgdmFyIGxuZ21pbiA9IE1hdGgubWluLmFwcGx5KE1hdGgsIGxuZyk7XG4gICAgICAgIHZhciBsYXRtaW4gPSBNYXRoLm1pbi5hcHBseShNYXRoLCBsYXQpO1xuICAgICAgICB2YXIgbG5nbWF4ID0gTWF0aC5tYXguYXBwbHkoTWF0aCwgbG5nKTtcbiAgICAgICAgdmFyIGxhdG1heCA9IE1hdGgubWF4LmFwcGx5KE1hdGgsIGxhdCk7ICovXG4gICAgICAgIC8vIGdlb1JlZi5iYm94Q3JvcEltYWdlID0gcHJvbXB0KFwiRW50ZXIgY29vcmRpbmF0ZXMgdG8gY3JvcCB0aGUgaW1hZ2U6IG1pbiBMbmcsIG1pbiBMYXQsIG1heCBMbmcsIG1heCBMYXQuIERlZmF1bHQgZXh0ZW50LCBhcyBzaG93biBiZWxvdywgaXMgc2VsZWN0ZWQgYmFzZWQgZnJvbSB0aGUgcHJvdmlkZWQgR0NQcy4gSWYgZG9uJ3Qgd2FudCBhbnkgY3JvcHBpbmcgdGhlbiBzaW1wbHkgZGVsZXRlIHRoZSBkZWZhdWx0IGNvb3JkaW5hdGVzLlwiLCBsbmdtaW4gKyBcIiBcIiArIGxhdG1pbiArIFwiIFwiICsgbG5nbWF4ICsgXCIgXCIgKyBsYXRtYXgpO1xuICAgICAgICBpZiAoJHNjb3BlLmV4dGVudFNlbGVjdGlvbiA9PSAnMCcpIHtcbiAgICAgICAgICBnZW9SZWYuYmJveENyb3BJbWFnZSA9IFwiXCI7XG4gICAgICAgIH1cbiAgICAgICAgLy8gaWYgZXh0ZW50IGlzIGJ5IHZhbHVlcyBwcm92aWRlZCBieSB0aGUgdXNlciB0aGVuIGp1c3Qgc2VuZCA0IHBhcmFtcyB0byAvYXBwbHkgQVBJXG4gICAgICAgIGVsc2UgaWYgKCRzY29wZS5leHRlbnRTZWxlY3Rpb24gPT0gJzEnKSB7XG4gICAgICAgICAgICBnZW9SZWYuYmJveENyb3BJbWFnZSA9IHZtLm1pbnggKyBcIiBcIiArIHZtLm1pbnkgKyBcIiBcIiArIHZtLm1heHggKyBcIiBcIiArIHZtLm1heHk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIGlmIGV4dGVudCBpcyBieSBkcmF3aW5nIGEgcmVjdGFuZ2xlIG9uIG1hcCB0aGVuIHNlbmQgOCBwYXJhbXMgdG8gL2FwcGx5IEFQSVxuICAgICAgICAgIGVsc2UgaWYgKCRzY29wZS5leHRlbnRTZWxlY3Rpb24gPT0gJzInKSB7XG4gICAgICAgICAgICAgIGdlb1JlZi5iYm94Q3JvcEltYWdlID0gdm0ubWlueCArIFwiIFwiICsgdm0ubWlueSArIFwiIFwiICsgdm0ubWF4eCArIFwiIFwiICsgdm0ubWlueSArIFwiIFwiICsgdm0ubWF4eCArIFwiIFwiICsgdm0ubWF4eSArIFwiIFwiICsgdm0ubWlueCArIFwiIFwiICsgdm0ubWF4eTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgLy8gY29uc29sZS5sb2coZ2VvUmVmLmJib3hDcm9wSW1hZ2UpXG5cbiAgICAgICAgZ2VvUmVmLmFwcGx5RW5kUG9pbnQgPSAnL2hlaW1hcC9nZW9yZWYvYXBwbHknO1xuICAgICAgICBnZW9SZWYuJHNhdmUoKVxuICAgICAgICAvLyBnZW9SZWYuc2F2ZUdlb1JlZigpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcblxuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3VsdC5pZClcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhhbmd1bGFyLmlzRGVmaW5lZChyZXN1bHQuaWQpKVxuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwienpcIik7XG5cbiAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQocmVzdWx0LmlkKSkge1xuICAgICAgICAgICAgY2xvc2UoKTtcbiAgICAgICAgICAgIEMyVG9hc3Quc3VjY2VzcygkdHJhbnNsYXRlLmluc3RhbnQoJ21lc3NhZ2VzLnNhdmVHZW9yZWZlcmVuY2VTdWNjZXNzJykpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtQ29vcmRpbmF0ZXM7IGkrKykge1xuICAgICAgICAgICAgZGVsZXRlICRzY29wZS4kcGFyZW50LnZtLmxlZnRNYXJrZXJzW09iamVjdC52YWx1ZXMoJHNjb3BlLiRwYXJlbnQudm0ubGVmdE1hcmtlcnMpWzBdW1wiaWRcIl1dO1xuICAgICAgICAgICAgZGVsZXRlICRzY29wZS4kcGFyZW50LnZtLnJpZ2h0TWFya2Vyc1tPYmplY3QudmFsdWVzKCRzY29wZS4kcGFyZW50LnZtLnJpZ2h0TWFya2VycylbMF1bXCJpZFwiXV07XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIC8vVE9ETzogXG4gICAgICAgICAgLyogdXBkYXRlIHRoZSB2aWV3ZXIgc3RhdGUgd2l0aCB0aGUgZ2VvcmVmZXJlbmNlZCByZXNvdXJjZVxuICAgICAgICAgICAgICByZXNldCB0aGUgR0NQXG4gICAgICAgICAgKi9cbiAgICAgICAgICAvKiB2YXIgd2hlcmVUb0dvID0gcHJvbXB0KFwiRW50ZXIgeW91ciBuZXh0IGFjdGlvbjogMSB0byB2aWV3IHJlY2VudGx5IGdlb3JlZmVyZW5jZWQgaW1hZ2UgYW5kL29yIGdlb3JlZmVyZW5jZSBhbm90aGVyIGltYWdlIGFuZCAyIHRvIHVwbG9hZCBuZXcgaW1hZ2VcIiwgXCIxXCIpO1xuICAgICAgICAgICBzd2l0Y2god2hlcmVUb0dvKXtcbiAgICAgICAgICAgIGNhc2UgXCIxXCI6IFxuICAgICAgICAgICAgICBNYXBMYXllclNlcnZpY2UucmVtb3ZlQWxsTWFwTGF5ZXJzKFwibGVmdE1hcFZpZXdlclwiKTsgXG4gICAgICAgICAgICAgIE1hcExheWVyU2VydmljZS5hZGRNYXBMYXllcihyZXN1bHQsIFwicmlnaHRNYXBWaWV3ZXJcIik7IFxuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCIyXCI6IFxuICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnIyEvbWFwJzsgXG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH0gKi9cblxuICAgICAgICAgIC8vIC8vIGZpcmUgZXZlbnQgdG8gR0NQIGNvbnRyb2xsZXIgZm9yIGNhbGwgcmVmcmVzaEdDUFRhYmxlXG4gICAgICAgICAgLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KFwicmVmcmVzaEdjcFRhYmxlRXZlbnRcIik7XG4gICAgICAgICAgLy8gY3JlYXRlIHBvcHVwIGJveFxuICAgICAgICAgIHZhciBjb25maXJtID0gJG1kRGlhbG9nLmNvbmZpcm0oKS50aXRsZSgnTmV4dCBBY3Rpb24/JykudGV4dENvbnRlbnQoJ1ZpZXcgcmVjZW50bHkgZ2VvcmVmZXJlbmNlZCBpbWFnZSBhbmQvb3IgZ2VvcmVmZXJlbmNlIGFub3RoZXIgaW1hZ2UgT1IgdXBsb2FkIGEgbmV3IGltYWdlJylcbiAgICAgICAgICAvLyAuYXJpYUxhYmVsKCdMdWNreSBkYXknKVxuICAgICAgICAgIC5vaygnTG9hZCBpdCBpbiBSaWdodCBNYXAnKS5jYW5jZWwoJ1VwbG9hZCBhIG5ldyBmaWxlJyk7XG5cbiAgICAgICAgICAkbWREaWFsb2cuc2hvdyhjb25maXJtKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiTG9hZCBpbiByaWdodCBtYXAgY2xpY2tlZFwiKTtcbiAgICAgICAgICAgIC8vIE1hcExheWVyU2VydmljZS5yZW1vdmVBbGxNYXBMYXllcnMoXCJsZWZ0TWFwVmlld2VyXCIpOyBcbiAgICAgICAgICAgIC8vIE1hcExheWVyU2VydmljZS5hZGRNYXBMYXllcihyZXN1bHQsIFwicmlnaHRNYXBWaWV3ZXJcIik7IFxuICAgICAgICAgICAgLy8gcmVzb2x2aW5nIERpcmsncyByZXF1ZXN0IG1lbml0b25lZCBpbiAjMTgyXG4gICAgICAgICAgICAvLyByZXNvbHZpbmcgIzIwOCB3aXRoIHVzZSBvZiBsb2NhbHN0b3JhZ2VcbiAgICAgICAgICAgIHZhciB0ZW1wTGVmdExheWVyID0gbGF5ZXJbT2JqZWN0LmtleXMobGF5ZXIpWzBdXS5yZXNvdXJjZTtcbiAgICAgICAgICAgIC8vIGRlbGV0ZSBpdCBiZWNhdXNlIGl0IGhhcyByZWZlcmVuY2UgdG8gb3RoZXIgTW9kZWxzLCB3aGljaCBjcmVhdGVzIGEgY2lyY3VsYXIgSlNPTlxuICAgICAgICAgICAgaWYgKHR5cGVvZiB0ZW1wTGVmdExheWVyLiQkYXJyYXkgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgZGVsZXRlIHRlbXBMZWZ0TGF5ZXIuJCRhcnJheTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRsb2NhbFN0b3JhZ2Uuc2V0T2JqZWN0KFwibm9uZ2VvcmVmTGF5ZXJcIiwgdGVtcExlZnRMYXllcik7XG4gICAgICAgICAgICAkbG9jYWxTdG9yYWdlLnNldE9iamVjdChcImdlb3JlZkxheWVyXCIsIHJlc3VsdCk7XG4gICAgICAgICAgICAkc3RhdGUucmVsb2FkKCk7XG4gICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJ1cGxvYWQgYSBuZXcgZmlsZVwiKTtcbiAgICAgICAgICAgIC8vIGNoYW5nZSBhcHAgc3RhdGUgdG8gbWFwLCBmaXJzdCBwYWdlIG9mIGFwcFxuICAgICAgICAgICAgJHN0YXRlLmdvKCdhcHAubWFwJyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgIC8vIHRoZSBjb2RlIGluc2lkZSB0aGlzIGJsb2NrIHdpbGwgYmUgZmlyZWQgaWYgc29tZSBlcnJvciBvY2N1clxuICAgICAgICAgIC8vIGhlcmUgeW91IGNhbiBzaG93IHNvbWUgZXJyb3IgbWVzc2FnZSBvciBkbyBub3RoaW5nLCBkZXBlbmRpbmcgb24gdGhlIGJ1c2luZXNzIHJ1bGVcblxuICAgICAgICAgIC8vVE9ETzogbm90aWZ5IHRoZSB1c2VyIGFib3V0IHRoZSBlcnJvcj9cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgIHRpdGxlOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2RpYWxvZy5pbnZhbGlkR2VvcmVmVGl0bGUnKSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJHRyYW5zbGF0ZS5pbnN0YW50KCdkaWFsb2cuaW52YWxpZEdlb3JlZlRleHQnKSxcbiAgICAgICAgICB0b29sYmFyQmdDb2xvcjogJG1kQ29sb3JzLmdldFRoZW1lQ29sb3IoJ3ByaW1hcnknKSxcbiAgICAgICAgICBva0JnQ29sb3I6ICRtZENvbG9ycy5nZXRUaGVtZUNvbG9yKCdwcmltYXJ5JyksXG4gICAgICAgICAgb2s6ICR0cmFuc2xhdGUuaW5zdGFudCgnZ2xvYmFsLm9rJylcbiAgICAgICAgfTtcbiAgICAgICAgQzJEaWFsb2cuYWxlcnQoY29uZmlnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaG93IHRoZSBHQ1AgdGFibGUgaW4gYSBwcmV2aWV3IHRhYmxlXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gcHJldmlld0djcCgpIHtcbiAgICAgIC8vIGNoZWNrIGZvciBudW1iZXIgb2YgbWFya2VycyBvbiBib3RoIG1hcHMgdG8gYmUgZXF1YWxcbiAgICAgIGlmIChPYmplY3QudmFsdWVzKCRzY29wZS4kcGFyZW50LnZtLmxlZnRNYXJrZXJzKS5sZW5ndGggPT09IE9iamVjdC52YWx1ZXMoJHNjb3BlLiRwYXJlbnQudm0ucmlnaHRNYXJrZXJzKS5sZW5ndGgpIHtcbiAgICAgICAgaWYgKHZtLnJlY3RpZnlNZXRob2QgJiYgdm0ucmVzYW1wbGluZ01ldGhvZCkge1xuICAgICAgICAgIC8vIGdldCB0aGUgbGF5ZXIgdGhhdCBjb250YWlucyB0aGUgcmVzb3VyY2UvbWFwIHRvIGJlIGdlb3JlZmVyZW5jZWRcbiAgICAgICAgICB2YXIgbGF5ZXIgPSBNYXBMYXllclNlcnZpY2UuZ2V0Vmlld2VyT3ZlcmxheXMoXCJsZWZ0TWFwVmlld2VyXCIpO1xuXG4gICAgICAgICAgLy8gaW5zdGFudGlhdGUgdGhlIGdlb3JlZmVyZW5jZSBzZXJ2aWNlIHRoYXQgaXMgbGlua2VkIHdpdGggdGhlIGJhY2stZW5kIGVuZC1wb2ludFxuICAgICAgICAgIHZhciBnZW9SZWYgPSBuZXcgR2VvcmVmZXJlbmNlU2VydmljZSgpO1xuXG4gICAgICAgICAgLy8gZ2V0IHRoZSBtYXJrZXJzIGZyb20gbGVmdCBhbmQgcmlnaHQgdmlld2VycyBmcm9tIHBhcmVudCBjb250cm9sbGVyXG4gICAgICAgICAgZ2VvUmVmLmltYWdlQ29vcmRpbmF0ZXMgPSAkc2NvcGUuJHBhcmVudC52bS5sZWZ0TWFya2VycztcbiAgICAgICAgICBnZW9SZWYud29ybGRDb29yZGluYXRlcyA9ICRzY29wZS4kcGFyZW50LnZtLnJpZ2h0TWFya2VycztcbiAgICAgICAgICBnZW9SZWYucmVjdGlmeU1ldGhvZCA9IHZtLnJlY3RpZnlNZXRob2QuaWQ7XG4gICAgICAgICAgZ2VvUmVmLnJlc2FtcGxpbmdNZXRob2QgPSB2bS5yZXNhbXBsaW5nTWV0aG9kLmlkO1xuXG4gICAgICAgICAgLy8gZ2V0IHRoZSByZXNvdXJjZS9tYXAgaWQgZnJvbSB0aGUgbG9hZGVkIGxheWVyXG4gICAgICAgICAgLy8gYXMgaW4gdGhlIGNhc2Ugb2YgZ2VvcmVmZXJlbmNlIG1vZHVsZSBvbmx5IG9uZSByZXNvdXJjZS9tYXAgd2lsbFxuICAgICAgICAgIC8vIGJlIGxvYWRlZCwgd2UgZ2V0IHRoZSBwcm9wZXJ0aWVzIGZyb20gdGhlIGZpcnN0IHJlc291cmNlIGluIHRoZSBsYXllclxuXG4gICAgICAgICAgdmFyIGZpcnN0TGF5ZXJLZXkgPSBPYmplY3Qua2V5cyhsYXllcilbMF07XG4gICAgICAgICAgZ2VvUmVmLm1hcElkID0gbGF5ZXJbZmlyc3RMYXllcktleV0ucmVzb3VyY2UuaWQ7XG5cbiAgICAgICAgICAvLyBDb252ZXJ0IEF1dG9CYXNlZE9uR0NQIHRvIE9yZGVyIFxuICAgICAgICAgIHZhciBudW1Db29yZGluYXRlcyA9IE9iamVjdC52YWx1ZXMoZ2VvUmVmLmltYWdlQ29vcmRpbmF0ZXMpLmxlbmd0aDtcbiAgICAgICAgICBnZW9SZWYucmVjdGlmeU1ldGhvZCA9PSBcIkF1dG9CYXNlZE9uR0NQXCIgPyBudW1Db29yZGluYXRlcyA+PSAzICYmIG51bUNvb3JkaW5hdGVzIDwgNiA/IGdlb1JlZi5yZWN0aWZ5TWV0aG9kID0gXCIxc3RPcmRlclBvbHluXCIgOiBudW1Db29yZGluYXRlcyA+PSA2ICYmIG51bUNvb3JkaW5hdGVzIDwgMTAgPyBnZW9SZWYucmVjdGlmeU1ldGhvZCA9IFwiMm5kT3JkZXJQb2x5blwiIDogZ2VvUmVmLnJlY3RpZnlNZXRob2QgPSBcIjNyZE9yZGVyUG9seW5cIiA6IG51bGw7XG5cbiAgICAgICAgICAvLyBHZXQgbmV3IGdlb3JlZmVuY2VkIGZpbGUgbmFtZSBmcm9tIHRoZSB1c2VyXG4gICAgICAgICAgZ2VvUmVmLm5ld0ZpbGVOYW1lID0gdm0uZ2VvUmVmRmlsZW5hbWU7XG5cbiAgICAgICAgICAvLyBDcm9wIGZpbmFsIGdlb3JlZmVyZW5jZWQgaW1hZ2VcbiAgICAgICAgICBpZiAodm0ubWFudWFsRXh0ZW50KSB7XG4gICAgICAgICAgICBnZW9SZWYuYmJveENyb3BJbWFnZSA9IHZtLm1pbnggKyBcIiBcIiArIHZtLm1pbnkgKyBcIiBcIiArIHZtLm1heHggKyBcIiBcIiArIHZtLm1heHk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhnZW9SZWYuYmJveENyb3BJbWFnZSlcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2VvUmVmLmJib3hDcm9wSW1hZ2UgPSBcIlwiO1xuICAgICAgICAgIH1cblxuICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncHJldmlld0djcCcsIGdlb1JlZik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gY2xvc2luZyBsZWZ0IHNpZGVuYXYgc2luY2UgaXQgd2FzIG92ZXJsYXBpbmcgYWxlcnQgbWVzc2FnZVxuICAgICAgICAgIGNsb3NlKCk7XG4gICAgICAgICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgICAgIHRpdGxlOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2RpYWxvZy5jYW50UHJldmlld0djcHRhYmxlVGl0bGUnKSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2RpYWxvZy5jYW50UHJldmlld0djcHRhYmxlVGV4dCcpLFxuICAgICAgICAgICAgdG9vbGJhckJnQ29sb3I6ICRtZENvbG9ycy5nZXRUaGVtZUNvbG9yKCdwcmltYXJ5JyksXG4gICAgICAgICAgICBva0JnQ29sb3I6ICRtZENvbG9ycy5nZXRUaGVtZUNvbG9yKCdwcmltYXJ5JyksXG4gICAgICAgICAgICBvazogJHRyYW5zbGF0ZS5pbnN0YW50KCdnbG9iYWwub2snKVxuICAgICAgICAgIH07XG4gICAgICAgICAgQzJEaWFsb2cuYWxlcnQoY29uZmlnKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgICB0aXRsZTogJHRyYW5zbGF0ZS5pbnN0YW50KCdkaWFsb2cuaW52YWxpZEdlb3JlZlRpdGxlJyksXG4gICAgICAgICAgZGVzY3JpcHRpb246ICR0cmFuc2xhdGUuaW5zdGFudCgnZGlhbG9nLmludmFsaWRHZW9yZWZUZXh0JyksXG4gICAgICAgICAgdG9vbGJhckJnQ29sb3I6ICRtZENvbG9ycy5nZXRUaGVtZUNvbG9yKCdwcmltYXJ5JyksXG4gICAgICAgICAgb2tCZ0NvbG9yOiAkbWRDb2xvcnMuZ2V0VGhlbWVDb2xvcigncHJpbWFyeScpLFxuICAgICAgICAgIG9rOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2dsb2JhbC5vaycpXG4gICAgICAgIH07XG4gICAgICAgIEMyRGlhbG9nLmFsZXJ0KGNvbmZpZyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVtb3ZlR2NwVGFibGUoKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBnZS5sZWZ0LnNpZGVuYXYuY29udHJvbGxlciA+Pj4gcmVtb3ZlR2NwVGFibGUgXCIpO1xuICAgICAgYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNnY3BUYWJsZScpKS5lbXB0eSgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTdGFydHMgdGhlIGRyYXdpbmcgaW50ZXJhY3Rpb24gdG8gZHJhdyBhIHJlY3RhbmdsZSBvbiBsZWZ0IG1hcCB0byBjcm9wIHRoZSBpbWFnZVxuICAgICAqIFxuICAgICAqIEFsdGVybmF0aXZlbHksIENPTU1FTlRFRCBDT0RFIGlzIGZvciBzaG93aW5nIHRoZSBleHRlbnQgcmVjdGFuZ2xlIG9uIHJpZ2h0IG1hcFxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGRyYXdSZWN0YW5nbGVGb3JFeHRlbnQoKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBnZS5sZWZ0LnNpZGVuYXYuY29udHJvbGxlciA+Pj4gZHJhd1JlY3RhbmdsZUZvckV4dGVudCBcIik7XG4gICAgICBjbG9zZSgpO1xuICAgICAgQzJUb2FzdC5zdWNjZXNzKCR0cmFuc2xhdGUuaW5zdGFudCgnbWVzc2FnZXMuZ2VvcmVmU3RhcnRSZWN0YW5nbGVFeHRlbnQnKSk7XG4gICAgICB2YXIgdmlld2VySWQgPSBcImxlZnRNYXBWaWV3ZXJcIjtcbiAgICAgIC8vIGRpc2JsZSBtYXJrZXIgY3JlYXRpb24gYnkgZmlyaW5nIGFuIGV2ZW50IHRvIEdlb3JlZmVyZW5jZSBjb250cm9sbGVyXG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3RvZ2dsZU1hcmtlckNyZWF0aW9uJywgeyAnbWFya2Vyc0tlZXBlcic6IHZpZXdlcklkIH0pO1xuXG4gICAgICBsZWFmbGV0RGF0YS5nZXRNYXAodmlld2VySWQpLnRoZW4oZnVuY3Rpb24gKG1hcCkge1xuICAgICAgICAvLyBBcHByb2FjaCAyIDogZHJhdyBleHRlbnQgcmVjdGFuZ2xlIG9uIHJpZ2h0IE1hcCBhbmQgbGV0IHRoZSB1c2VyIGJ5IGFibGUgdG8gZWRpdCBpdFxuICAgICAgICAvLyBpZihtYXAuaGFzTGF5ZXIoZHJhd25JdGVtcykpe1xuICAgICAgICAvLyAgIGNvbnNvbGUubG9nKGRyYXduSXRlbXMpO1xuICAgICAgICAvLyB9XG4gICAgICAgIC8vIHZhciBkcmF3bkl0ZW1zID0gbmV3IEwuRmVhdHVyZUdyb3VwKCk7XG5cbiAgICAgICAgLy8gLy8gZHJhd25JdGVtcy5mb3JFYWNoKGZ1bmN0aW9uKGxheWVyKSB7XG4gICAgICAgIC8vIC8vICAgY29uc29sZS5sb2cobGF5ZXIpO1xuICAgICAgICAvLyAvLyAgIG1hcC5yZW1vdmVMYXllcihsYXllcik7XG4gICAgICAgIC8vIC8vIH0pO1xuICAgICAgICAvLyAvLyBjcmVhdGUgYSByZWN0YW5nbGUgYmFzZWQgb24gZXh0ZW5kIGNhbGN1bGF0ZWRcbiAgICAgICAgLy8gdmFyIGV4dGVudFJlY3QgPSBMLnJlY3RhbmdsZShbW3ZtLm1pbnksIHZtLm1pbnhdLCBbdm0ubWF4eSwgdm0ubWF4eF1dKS5hZGRUbyhkcmF3bkl0ZW1zKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coZXh0ZW50UmVjdCk7XG4gICAgICAgIC8vIGV4dGVudFJlY3QudHlwZSA9IGV4dGVudFJlY3QudHlwZSB8fCBcIkZlYXR1cmVcIjsgLy8gSW50aWFsaXplIGZlYXR1cmUudHlwZVxuICAgICAgICAvLyB2YXIgcHJvcHMgPSBleHRlbnRSZWN0LnByb3BlcnRpZXMgPSBleHRlbnRSZWN0LnByb3BlcnRpZXMgfHwge307IC8vIEludGlhbGl6ZSBmZWF0dXJlLnByb3BlcnRpZXNcbiAgICAgICAgLy8gcHJvcHMudGl0bGUgPSBcImV4dGVudFJlY3RhbmdsZUZvckNyb3BwaW5nXCI7XG4gICAgICAgIC8vIC8vIHByb3BzLmNvbnRlbnQgPSBcIm15IGNvbnRlbnRcIjtcbiAgICAgICAgLy8gZXh0ZW50UmVjdC5lZGl0aW5nLmVuYWJsZSgpO1xuICAgICAgICAvLyBtYXAub24oJ2RyYXc6ZWRpdHJlc2l6ZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIC8vICAgY29uc29sZS5sb2coXCJkcmF3OmVkaXRyZXNpemUgXCIsIGUubGF5ZXIpO1xuICAgICAgICAvLyAgIHZtLm1pbnggPSBlLmxheWVyLmdldEJvdW5kcygpLmdldFdlc3QoKTtcbiAgICAgICAgLy8gICB2bS5taW55ID0gZS5sYXllci5nZXRCb3VuZHMoKS5nZXRTb3V0aCgpO1xuICAgICAgICAvLyAgIHZtLm1heHggPSBlLmxheWVyLmdldEJvdW5kcygpLmdldEVhc3QoKTtcbiAgICAgICAgLy8gICB2bS5tYXh5ID0gZS5sYXllci5nZXRCb3VuZHMoKS5nZXROb3J0aCgpO1xuICAgICAgICAvLyB9LmJpbmQoZHJhd25JdGVtcykpO1xuICAgICAgICAvLyBtYXAuYWRkTGF5ZXIoZHJhd25JdGVtcyk7XG5cbiAgICAgICAgLy8gQXBwcm9hY2ggMiA6IExldCB0aGUgVXNlciBkcmF3IHJlY3RhbmdsZSBvbiBMZWZ0IE1hcFxuICAgICAgICAvLyBGZWF0dXJlR3JvdXAgaXMgdG8gc3RvcmUgZWRpdGFibGUgbGF5ZXJzXG4gICAgICAgIHZhciBkcmF3bkl0ZW1zID0gbmV3IEwuRmVhdHVyZUdyb3VwKCk7XG4gICAgICAgIG1hcC5hZGRMYXllcihkcmF3bkl0ZW1zKTtcbiAgICAgICAgdmFyIHBvbHlnb25EcmF3ZXIgPSBuZXcgTC5EcmF3LlJlY3RhbmdsZShtYXApO1xuICAgICAgICBwb2x5Z29uRHJhd2VyLmVuYWJsZSgpO1xuXG4gICAgICAgIG1hcC5vbignZHJhdzpjcmVhdGVkJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICB2YXIgbGF5ZXIgPSBlLmxheWVyO1xuICAgICAgICAgIGxheWVyLnR5cGUgPSBsYXllci50eXBlIHx8IFwiRmVhdHVyZVwiOyAvLyBJbnRpYWxpemUgZmVhdHVyZS50eXBlXG4gICAgICAgICAgdmFyIHByb3BzID0gbGF5ZXIucHJvcGVydGllcyA9IGxheWVyLnByb3BlcnRpZXMgfHwge307IC8vIEludGlhbGl6ZSBmZWF0dXJlLnByb3BlcnRpZXNcbiAgICAgICAgICBwcm9wcy50aXRsZSA9IFwiZXh0ZW50UmVjdGFuZ2xlRm9yQ3JvcHBpbmdcIjtcblxuICAgICAgICAgIGRyYXduSXRlbXMuYWRkTGF5ZXIobGF5ZXIpO1xuICAgICAgICAgIC8vIHZhciBkcmF3c0dlb0pzb24gPSBsYXllci50b0dlb0pTT04oKTtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcInBveWdvbiBnZW9qc29uID0gXCIsIGRyYXdzR2VvSnNvbik7XG4gICAgICAgICAgdm0ubWlueCA9IGxheWVyLmdldEJvdW5kcygpLmdldFNvdXRoV2VzdCgpLmxuZztcbiAgICAgICAgICB2bS5taW55ID0gbGF5ZXIuZ2V0Qm91bmRzKCkuZ2V0U291dGhXZXN0KCkubGF0O1xuICAgICAgICAgIHZtLm1heHggPSBsYXllci5nZXRCb3VuZHMoKS5nZXROb3J0aEVhc3QoKS5sbmc7XG4gICAgICAgICAgdm0ubWF4eSA9IGxheWVyLmdldEJvdW5kcygpLmdldE5vcnRoRWFzdCgpLmxhdDtcbiAgICAgICAgICAvLyBvcGVuIHRoZSBzaWRlbmF2XG4gICAgICAgICAgLy8gb3BlbigpO1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwidm0ubWlueCA9IFwiLCB2bS5taW54LCB2bS5taW55LCB2bS5tYXh4LCB2bS5tYXh5KTtcbiAgICAgICAgfS5iaW5kKGRyYXduSXRlbXMpKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKiBcbiAgICAgKiBJZiBhbnkgcmVjdGFuZ2xlIGRyYXduIG9uIGxlZnQgbWFwIHRoYW4gY2xlYXJzIGl0IGFuZCBcbiAgICAgKiByZWluaXRpYWxpemVzIG1pbiwgbWF4IHZhbHVlcyB0byBudWxsXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2xlYW5VcCgpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IGdlLmxlZnQuc2lkZW5hdi5jb250cm9sbGVyID4+PiBjbGVhblVwXCIpO1xuICAgICAgLy8gYWx3YXkgZGlzcGxheSBleHRlbnQgcmVjdGFuZ2xlIGluIFJpZ2h0IG1hcFxuICAgICAgdmFyIHZpZXdlcklkID0gXCJsZWZ0TWFwVmlld2VyXCI7XG4gICAgICBsZWFmbGV0RGF0YS5nZXRNYXAodmlld2VySWQpLnRoZW4oZnVuY3Rpb24gKG1hcCkge1xuICAgICAgICBsb2Rhc2guZm9yRWFjaChtYXAuX2xheWVycywgZnVuY3Rpb24gKGZlYXR1cmUpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIGZlYXR1cmUudHlwZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgaWYgKGZlYXR1cmUudHlwZSA9PT0gXCJGZWF0dXJlXCIpIHtcbiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZmVhdHVyZSk7XG4gICAgICAgICAgICAgIC8vIGZlYXR1cmUucmVtb3ZlRnJvbShkcmF3bkl0ZW1zKTtcbiAgICAgICAgICAgICAgLy8gZmVhdHVyZS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgbWFwLnJlbW92ZUxheWVyKGZlYXR1cmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIHZtLm1pbnggPSB2bS5taW55ID0gdm0ubWF4eCA9IHZtLm1heHkgPSBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgRXh0ZW50IHJlY3RhbmxnIGZyb20gUmlnaHQgbWFwIGJlZm9yZSBkcmF3aW5nIGEgbmV3IG9uZVxuICAgICAqICoqKiogVW51c2VkIGNvZGUsIGdvb2QgZm9yIGNhbGxiYWNrIGV4YW1wbGVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZW1vdmVFeHRlbnRSZWN0YW5nbGUoY2FsbGJhY2spIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiPj4+IGdlLmxlZnQuc2lkZW5hdi5jb250cm9sbGVyID4+PiByZW1vdmVFeHRlbnRSZWN0YW5nbGVcIik7XG4gICAgICAvLyBhbHdheSBkaXNwbGF5IGV4dGVudCByZWN0YW5nbGUgaW4gUmlnaHQgbWFwXG4gICAgICB2YXIgdmlld2VySWQgPSBcInJpZ2h0TWFwVmlld2VyXCI7XG4gICAgICBsZWFmbGV0RGF0YS5nZXRNYXAodmlld2VySWQpLnRoZW4oZnVuY3Rpb24gKG1hcCkge1xuICAgICAgICAvLyBjaGVjayBpZiByZWN0YW5nbGUgYWxyZWFkeSBkcmF3biwgaWYgeWVzIHRoYW4gcmVtb3ZlIGl0XG4gICAgICAgIGxvZGFzaC5mb3JFYWNoKG1hcC5fbGF5ZXJzLCBmdW5jdGlvbiAoZmVhdHVyZSkge1xuICAgICAgICAgIGlmICh0eXBlb2YgZmVhdHVyZS50eXBlICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICBpZiAoZmVhdHVyZS50eXBlID09PSBcIkZlYXR1cmVcIikge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhmZWF0dXJlKTtcbiAgICAgICAgICAgICAgLy8gZmVhdHVyZS5yZW1vdmVGcm9tKGRyYXduSXRlbXMpO1xuICAgICAgICAgICAgICAvLyBmZWF0dXJlLnJlbW92ZSgpO1xuICAgICAgICAgICAgICBtYXAucmVtb3ZlTGF5ZXIoZmVhdHVyZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9XG5cbiAgICBhY3RpdmF0ZSgpO1xuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7IGlmIChrZXkgaW4gb2JqKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7IH0gZWxzZSB7IG9ialtrZXldID0gdmFsdWU7IH0gcmV0dXJuIG9iajsgfVxuXG4vKmVzbGludCBhbmd1bGFyL2ZpbGUtbmFtZTogMCwgbm8tdW5kZWY6IDAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25zdGFudCgnZW4tR0IuaTE4bi5hdHRyaWJ1dGVzJywgX2RlZmluZVByb3BlcnR5KHtcbiAgICBlbWFpbDogJ0VtYWlsJyxcbiAgICBwYXNzd29yZDogJ1Bhc3N3b3JkJyxcbiAgICBuYW1lOiAnTmFtZScsXG4gICAgaW1hZ2U6ICdJbWFnZScsXG4gICAgcm9sZXM6ICdQcm9maWxlcycsXG4gICAgZGF0ZTogJ0RhdGUnLFxuICAgIGluaXRpYWxEYXRlOiAnSW5pdGlhbCBkYXRlJyxcbiAgICBmaW5hbERhdGU6ICdFbmQgZGF0ZScsXG4gICAgdGl0bGU6ICdUaXRsZScsXG4gICAgbWFwVHlwZTogJ01hcCB0eXBlJyxcbiAgICBwcm9qZWN0aW9uOiAnUHJvamVjdGlvbicsXG4gICAgZ2VvcmVmZXJlbmNlZDogJ0dlb3JlZmVyZW5jZWQnLFxuICAgIGlzR2VvcmVmZXJlbmNlZDogJ0lzIGdlb3JlZmVyZW5jZWQnLFxuICAgIGlzTm90R2VvcmVmZXJlbmNlZDogJ0lzIG5vdCBnZW9yZWZlcmVuY2VkJyxcbiAgICBtYXBPcHRpb25zOiAnTWFwIG9wdGlvbnMnLFxuICAgIHZlcmlmaWVkOiAnVmVyaWZpZWQnLFxuICAgIHJlY3RpZnlNZXRob2Q6ICdSZWN0aWZ5IG1ldGhvZCcsXG4gICAgcmVzYW1wbGluZ01ldGhvZDogJ1Jlc2FtcGxpbmcgbWV0aG9kJyxcbiAgICBlbnRlckdlb3JlZkZpbGVOYW1lOiAnR2VvcmVmZXJlbmNlZCBmaWxlIG5hbWUnLFxuICAgIGV4dGVudEdlb1JlZjogJ0VudGVyIGNvb3JkaW5hdGVzIHRvIGNyb3AgdGhlIGltYWdlOiBtaW4gTG5nLCBtaW4gTGF0LCBtYXggTG5nLCBtYXggTGF0LiBEZWZhdWx0IGV4dGVudCwgYXMgc2hvd24gYmVsb3csIGlzIHNlbGVjdGVkIGJhc2VkIGZyb20gdGhlIHByb3ZpZGVkIEdDUHMuIElmIGRvblxcJ3Qgd2FudCBhbnkgY3JvcHBpbmcgdGhlbiBzaW1wbHkgZGVsZXRlIHRoZSBkZWZhdWx0IGNvb3JkaW5hdGVzJyxcbiAgICBtaW54OiAnV2VzdCcsXG4gICAgbWlueTogJ1NvdXRoJyxcbiAgICBtYXh4OiAnRWFzdCcsXG4gICAgbWF4eTogJ05vcnRoJyxcbiAgICBjcm9wSW1hZ2U6ICdDcm9wIEltYWdlIGJhc2VkIG9uIEV4dGVudCBWYWx1ZXM/JyxcbiAgICBjcm9wSW1hZ2VCeURyYXc6ICdDcm9wIEltYWdlIGJhc2VkIGJ5IGRyYXdpbmcgb24gbWFwPycsXG4gICAgY3JvcEltYWdlTm9uZTogJ05vbmUnLFxuICAgIHByZXZpZXdHQ1A6ICdTaG93IEdDUCBUYWJsZScsXG4gICAgc2hvd09ubHlDaGlsZE1hcDogJ1Nob3cgb25seSBNYXBzIHdoaWNoIHVzZWQgdGhlIGxvYWRlZCBOb25HZW9yZWZlcmVuY2VkIGltYWdlJyxcbiAgICBkZXNjcmlwdGlvbjogJ0Rlc2NyaXB0aW9uJyxcbiAgICBnYXp6VHlwZTogJ0NSTSBFbnRpdHkgVHlwZScsXG4gICAgYnVpbGRpbmdUeXBlOiAnQnVpZGxpbmcgVHlwZScsXG4gICAgc3RhdGU6ICdTdGF0ZScsXG4gICAgY291bnRyeTogJ0NvdW50cnknLFxuICAgIHRpbWVTcGFuOiAnVGltZSBTcGFuJyxcbiAgICBtYXRlcmlhbDogJ01hdGVyaWFsJyxcbiAgICByZWZEb2N1bWVudDogJ0RvY3VtZW50IFJlZmVyZW5jZScsXG4gICAgY3JlYXRlZERhdGU6ICdDcmVhdGVkIERhdGUnLFxuICAgIGtpbmc6ICdLaW5nJ1xuICB9LCAndGl0bGUnLCAnVGl0bGUnKSk7XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4vKmVzbGludCBhbmd1bGFyL2ZpbGUtbmFtZTogMCwgbm8tdW5kZWY6IDAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25zdGFudCgnZW4tR0IuaTE4bi5kaWFsb2cnLCB7XG4gICAgY29uZmlybVRpdGxlOiAnQ29uZmlybT8nLFxuICAgIGNvbmZpcm1EZXNjcmlwdGlvbjogJ0NvbmZpcm0gYWN0aW9uPycsXG4gICAgY29uZmlybUxvYWRVbmdlb3JlZmVyZW5jZWRUaXRsZTogJ0NvbmZpcm0gbG9hZCB1bmdlb3JlZmVyZW5jZWQgbWFwJyxcbiAgICBjb25maXJtTG9hZEdlb3JlZmVyZW5jZWRUaXRsZTogJ0NvbmZpcm0gbG9hZCBnZW9yZWZlcmVuY2VkIG1hcCcsXG4gICAgTG9hZFVuZ2VvcmVmZXJlbmNlZERlc2NyaXB0aW9uOiAnSWYgeW91IGxvYWQgdGhpcyB1bmdlb3JlZmVyZW5jZWQgbWFwIGFsbCBiYXNlIGxheWVycyBhbmQgb3RoZXIgbWFwcyB3aWxsIGJlIHJlbW92ZWQgZnJvbSB0aGUgdmlld2VyLiBEbyB5b3Ugd2FudCB0byBwcm9jZWVkPycsXG4gICAgTG9hZEdlb3JlZmVyZW5jZWREZXNjcmlwdGlvbjogJ0lmIHlvdSBsb2FkIHRoaXMgZ2VvcmVmZXJlbmNlZCBtYXAgY3VycmVudCB1bmdlb3JlZmVyZW5jZWQgbGF5ZXJzIHdpbGwgYmUgcmVtb3ZlZCBmcm9tIHRoZSB2aWV3ZXIuIERvIHlvdSB3YW50IHRvIHByb2NlZWQ/JyxcbiAgICByZW1vdmVEZXNjcmlwdGlvbjogJ0RvIHlvdSB3YW50IHRvIHJlbW92ZSBwZXJtYW5lbnRseSB7e25hbWV9fT8nLFxuICAgIGludmFsaWRHZW9yZWZUaXRsZTogJ0ludmFsaWQgbnVtYmVyIG9mIEdyb3VuZCBDb250cm9sIFBvaW50cycsXG4gICAgaW52YWxpZEdlb3JlZlRleHQ6ICdTYW1lIG51bWJlciBvZiBHcm91bmQgQ29udHJvbCBQb2ludHMgYW5kIGEgbWluaW11bSBvZiAzIEdyb3VuZCBDb250cm9sIFBvaW50cyBpcyByZXF1aXJlZCBpbiBlYWNoIHZpZXdlciB0byBnZW9yZWZlcmVuY2UgYSBtYXAnLFxuICAgIGxvZ2luOiB7XG4gICAgICByZXNldFBhc3N3b3JkOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVHlwZSB5b3VyIHJlZ2lzdGVyZWQgZS1tYWlsIGluIHRoZSBzeXN0ZW0uJ1xuICAgICAgfVxuICAgIH0sXG4gICAgY2FudExvYWRUaXRsZTogJ0NhblxcJ3QgbGluayBCb3RoIHRoZSBtYXBzJyxcbiAgICBjYW50TG9hZERlc2NyaXB0aW9uOiAnQ2FuXFwndCBsaW5rIG1hcHMgc2luY2Ugb25lIG9mIG1hcHMgaGFzIFVuZ2VvcmVmZXJlbmNlZCBpbWFnZScsXG4gICAgY2FudFByZXZpZXdHY3B0YWJsZVRpdGxlOiAnU2VsZWN0IFJlY3RpZnkgTWV0aG9kIGFuZCBSZXNhbXBsaW5nIE1ldGhvZCcsXG4gICAgY2FudFByZXZpZXdHY3B0YWJsZVRleHQ6ICdQbGVhc2Ugc2VsZWN0IFJlY3RpZnkgTWV0aG9kIGFuZCBSZXNhbXBsaW5nIE1ldGhvZCB0byBQcmV2aWV3IEdDUCdcbiAgfSk7XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4vKmVzbGludCBhbmd1bGFyL2ZpbGUtbmFtZTogMCwgbm8tdW5kZWY6IDAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25zdGFudCgnZW4tR0IuaTE4bi5nbG9iYWwnLCB7XG4gICAgbG9hZGluZzogJ0xvYWRpbmcuLi4nLFxuICAgIHByb2Nlc3Npbmc6ICdQcm9jZXNzaW5nLi4uJyxcbiAgICB5ZXM6ICdZZXMnLFxuICAgIG5vOiAnTm8nLFxuICAgIGFsbDogJ0FsbCcsXG4gICAgb2s6ICdPSydcbiAgfSk7XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4vKmVzbGludCBhbmd1bGFyL2ZpbGUtbmFtZTogMCwgbm8tdW5kZWY6IDAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25zdGFudCgnZW4tR0IuaTE4bi5tZXNzYWdlcycsIHtcbiAgICBpbnRlcm5hbEVycm9yOiAnSW50ZXJuYWwgZXJyb3IuIGNvbnRhY3QgdGhlIHN5c3RlbSBhZG1pbicsXG4gICAgbWFwRmlsZUlzTWFuZGF0b3J5OiAnU2VsZWN0IGEgbWFwIGZpbGUgaXMgbWFuZGF0b3J5JyxcbiAgICBpbnZhbGlkSW1hZ2VGaWxlOiAnRmlsZSBzZWxlY3RlZCBpcyBub3QgYSB2YWxpZCBpbWFnZSBmaWxlJyxcbiAgICBmaWxlVG9vQmlnOiAnRmlsZSBzZWxlY3RlZCBpcyB0b28gYmlnJyxcbiAgICBub3RGb3VuZDogJ05vdCBmb3VuZCcsXG4gICAgbm90QXV0aG9yaXplZDogJ1lvdSBkbyBub3QgaGF2ZSBhY2Nlc3MgdG8gdGhpcyBmdW5jdGlvbmFsaXR5LicsXG4gICAgc2VhcmNoRXJyb3I6ICdTZWFyY2ggZXJyb3IuJyxcbiAgICBzYXZlU3VjY2VzczogJ0l0ZW0gc2F2ZWQgc3VjY2Vzc2Z1bGx5LicsXG4gICAgc2F2ZUdlb3JlZmVyZW5jZVN1Y2Nlc3M6ICdJbWFnZSBoYXMgYmVlbiByZWN0aWZpZWQuJyxcbiAgICBvcGVyYXRpb25TdWNjZXNzOiAnT3BlcmF0aW9uIGRvbmUgd2l0aCBzdWNjZXNzLicsXG4gICAgb3BlcmF0aW9uRXJyb3I6ICdFcnJvciB3aGlsZSBkb2luZyB0aGUgb3BlcmF0aW9uJyxcbiAgICBzYXZlRXJyb3I6ICdFcnJvciB3aGlsZSB0cnlpbmcgdG8gc2F2ZSB0aGUgaXRlbS4nLFxuICAgIHJlbW92ZVN1Y2Nlc3M6ICdSZW1vdmFsIGRvbmUgd2l0aCBzdWNjZXNzLicsXG4gICAgcmVtb3ZlRXJyb3I6ICdFcnJvciB3aGlsZSB0cnlpbmcgdG8gcmVtb3ZlIHRoZSBpdGVtLicsXG4gICAgcmVzb3VyY2VOb3RGb3VuZEVycm9yOiAnSXRlbSBub3QgZm91bmQnLFxuICAgIG5vdE51bGxFcnJvcjogJ0FsbCB0aGUgbWFuZGF0b3J5IGZpZWxkcyBtdXN0IGJlIGZpbGxlZC4nLFxuICAgIGR1cGxpY2F0ZWRSZXNvdXJjZUVycm9yOiAnQWxyZWFkeSBleGlzdHMgYW4gaXRlbSB3aXRoIHRoZXNlIGRhdGEuJyxcbiAgICBkZWxldGVMYXllclRpdGxlOiAnRGVsZXRlIExheWVyPycsXG4gICAgZGVsZXRlTGF5ZXJNZXNzYWdlOiAnV291bGQgeW91IGxpa2UgdG8gRGVsZXRlIGxheWVyPycsXG4gICAgeWVzOiAnWWVzJyxcbiAgICBubzogJ05vJyxcbiAgICB2YWxpZGF0ZToge1xuICAgICAgZmllbGRSZXF1aXJlZDogJ1RoZSBmaWVsZCB7e2ZpZWxkfX0gaXMgbWFuZGF0b3J5LidcbiAgICB9LFxuICAgIGxheW91dDoge1xuICAgICAgZXJyb3I0MDQ6ICdQYWdlIG5vIGZvdW5kJ1xuICAgIH0sXG4gICAgbG9naW46IHtcbiAgICAgIGxvZ291dEluYWN0aXZlOiAnWW91IGhhdmUgYmVlbiBsb2dnZWQgb3V0LiBMb2dpbiBhZ2Fpbi4nLFxuICAgICAgaW52YWxpZENyZWRlbnRpYWxzOiAnSW52YWxpZCBjcmVkZW50aWFscycsXG4gICAgICB1bmtub3duRXJyb3I6ICdJdCB3YXMgbm90IHBvc3NpYmxlIHRvIGxvZyB5b3UgaW4uICcgKyAnVHJ5IGFnYWluLiBJZiB0aGUgZXJyb3IgcGVyc2lzdHMsIGNvbnRhY3QgdGhlIHN5c3RlbSBhZG1pbmlzdHJhdG9yLicsXG4gICAgICB1c2VyTm90Rm91bmQ6ICdVc2VyIG5vdCBmb3VuZCdcbiAgICB9LFxuICAgIGRhc2hib2FyZDoge1xuICAgICAgd2VsY29tZTogJ1dlbGNvbWUge3t1c2VyTmFtZX19JyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnVXNlIHRoZSBmb3IgbmF2aWdhdGlvbi4nXG4gICAgfSxcbiAgICBtYWlsOiB7XG4gICAgICBtYWlsRXJyb3JzOiAnQW4gZXJyb3IgaGFzIG9jY3VycmVkIGluIHRoZSBmb2xsb3dpbmcgZS1tYWlsczpcXG4nLFxuICAgICAgc2VuZE1haWxTdWNjZXNzOiAnRW1haWwgc2VudCB3aXRoIHN1Y2Nlc3MhJyxcbiAgICAgIHNlbmRNYWlsRXJyb3I6ICdJdCB3YXMgbm90IHBvc3NpYmxlIHRvIHNlbmQgdGhlIGUtbWFpbC4nLFxuICAgICAgcGFzc3dvcmRTZW5kaW5nU3VjY2VzczogJ1RoZSBwYXNzd29yZCByZWNvdmVyIHByb2Nlc3Mgd2FzIGluaXRpYXRlZC4gSWYgdGhlIGUtbWFpbCBkb2VzIG5vdCBhcnJpdmUgaW4gMTAgbWludXRlcywgdHJ5IGFnYWluLidcbiAgICB9LFxuICAgIHVzZXI6IHtcbiAgICAgIHJlbW92ZVlvdXJTZWxmRXJyb3I6ICdZb3UgY2FuIG5vdCByZW1vdmUgeW91ciBvd24gdXNlci4nLFxuICAgICAgdXNlckV4aXN0czogJ1VzZXIgYWxyZWFkeSBleGlzdHMhJyxcbiAgICAgIHByb2ZpbGU6IHtcbiAgICAgICAgdXBkYXRlRXJyb3I6ICdJdCB3YXMgbm90IHBvc3NpYmxlIHRvIHVwZGF0ZSB5b3VyIHByb2ZpbGUuJ1xuICAgICAgfVxuICAgIH0sXG4gICAgbWFwOiB7XG4gICAgICBkcm9wTWFwOiAnRHJvcCBtYXAgaGVyZScsXG4gICAgICBzZWxlY3RBTWFwOiAnU2VsZWN0IGEgbWFwIGltYWdlJyxcbiAgICAgIHNlbGVjdEFHZW9GaWxlOiAnU2VsZWN0IGEgZ2VvIGZpbGUnLFxuICAgICAgY2xpY2tUb0FkZDogJ0NsaWNrIHRvIGFkZCBhIG5ldyBtYXAnXG4gICAgfSxcbiAgICBnZW9yZWZTdGFydFJlY3RhbmdsZUV4dGVudDogJ0RyYXcgYSBSZWN0YW5nbGUgb24gTGVmdCBNYXAnXG4gIH0pO1xufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuLyplc2xpbnQgYW5ndWxhci9maWxlLW5hbWU6IDAsIG5vLXVuZGVmOiAwKi9cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uc3RhbnQoJ2VuLUdCLmkxOG4ubW9kZWxzJywge1xuICAgIHVzZXI6ICdVc2VyJ1xuICB9KTtcbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbi8qZXNsaW50IGFuZ3VsYXIvZmlsZS1uYW1lOiAwLCBuby11bmRlZjogMCovXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnN0YW50KCdlbi1HQi5pMThuLnZpZXdzJywge1xuICAgIGJyZWFkY3J1bWJzOiB7XG4gICAgICB1c2VyOiAnVXNlIGFkbWluJyxcbiAgICAgICd1c2VyLXByb2ZpbGUnOiAnVXNlciBwcm9maWxlJyxcbiAgICAgIGRhc2hib2FyZDogJ0Rhc2hib2FyZCcsXG4gICAgICBhdWRpdDogJ0F1ZGl0JyxcbiAgICAgIG1haWw6ICdNYWlsIHNlbmQnLFxuICAgICAgcHJvamVjdDogJ1Byb2plY3RzJyxcbiAgICAgICdub3QtYXV0aG9yaXplZCc6ICdOb3QgYXV0aG9yaXplZCdcbiAgICB9LFxuICAgIHRpdGxlczoge1xuICAgICAgZGFzaGJvYXJkOiAnSG9tZSBwYWdlJyxcbiAgICAgIG1haWxTZW5kOiAnU2VuZCBtYWlsJyxcbiAgICAgIHRhc2tMaXN0OiAnVGFzayBsaXN0JyxcbiAgICAgIHVzZXJMaXN0OiAnVXNlciBsaXN0JyxcbiAgICAgIGF1ZGl0TGlzdDogJ0F1ZGl0IExpc3QnLFxuICAgICAgcmVnaXN0ZXI6ICdSZWdpc3RlcicsXG4gICAgICByZXNldFBhc3N3b3JkOiAnUmVzZXQgcGFzc3dvcmQnLFxuICAgICAgdXBkYXRlOiAnVXBkYXRlJyxcbiAgICAgIGFkZE1hcDogJ0FkZCBtYXAnLFxuICAgICAgZWRpdE1hcDogJ0VkaXQgbWFwJyxcbiAgICAgIG1hcExpc3Q6ICdNYXAgbGlzdCcsXG4gICAgICBtYXBWaWV3OiAnTWFwIHZpZXcnLFxuICAgICAgbWFwRWxlbWVudHM6ICdNYXAgZWxlbWVudHMnLFxuICAgICAgbWFwTGF5ZXJzOiAnTWFwIGxheWVycycsXG4gICAgICBuZXdNYXA6ICdOZXcgbWFwJyxcbiAgICAgIG1hcEdlb3JlZmVyZW5jaW5nOiAnTWFwIGdlb3JlZmVyZW5jaW5nJyxcbiAgICAgIHNhdmVDb250cm9sUG9pbnRzOiAnU2F2ZSBDb250cm9sIFBvaW50cycsXG4gICAgICB2ZWN0b3JUaXRsZTogJ1ZlY3RvcicsXG4gICAgICBmZWF0dXJlQXR0cjogJ0ZlYXR1cmUgQXR0cmlidXRlJyxcbiAgICAgIGxheWVyTGlzdDogJ0xheWVyIGxpc3QnLFxuICAgICAgYWRkTGF5ZXI6ICdBZGQgbGF5ZXInLFxuICAgICAgZWRpdExheWVyOiAnRWRpdCBsYXllcidcbiAgICB9LFxuICAgIGFjdGlvbnM6IHtcbiAgICAgIHNlbmQ6ICdTZW5kJyxcbiAgICAgIHNhdmU6ICdTYXZlJyxcbiAgICAgIGNsZWFyOiAnQ2xlYXInLFxuICAgICAgY2xlYXJBbGw6ICdDbGVhciBhbGwnLFxuICAgICAgcmVzdGFydDogJ1Jlc3RhcnQnLFxuICAgICAgZmlsdGVyOiAnRmlsdGVyJyxcbiAgICAgIHNlYXJjaDogJ1NlYXJjaCcsXG4gICAgICBsaXN0OiAnTGlzdCcsXG4gICAgICBlZGl0OiAnRWRpdCcsXG4gICAgICBjYW5jZWw6ICdDYW5jZWwnLFxuICAgICAgdXBkYXRlOiAnVXBkYXRlJyxcbiAgICAgIHJlbW92ZTogJ1JlbW92ZScsXG4gICAgICBnZXRPdXQ6ICdFeGl0JyxcbiAgICAgIGFkZDogJ0FkZCcsXG4gICAgICBpbjogJ2VudGVyJyxcbiAgICAgIGxvYWRJbWFnZTogJ0xvYWQgaW1hZ2UnLFxuICAgICAgb3BlbjogJ09wZW4nLFxuICAgICAgY2xvc2U6ICdDbG9zZScsXG4gICAgICB2aWV3OiAnVmlldycsXG4gICAgICBmaWx0ZXJNYXBzOiAnRmlsdGVyIG1hcHMnLFxuICAgICAgc2hvdzogJ1Nob3cnLFxuICAgICAgaGlkZTogJ0hpZGUnLFxuICAgICAgbG9hZE1hcEluTGVmdDogJ0xvYWQgaW4gdGhlIGxlZnQgdmlld2VyJyxcbiAgICAgIGxvYWRNYXBJblJpZ2h0OiAnTG9hZCBpbiB0aGUgcmlnaHQgdmlld2VyJyxcbiAgICAgIGhpZGVNYXBMYXllcjogJ0hpZGUgbWFwIGxheWVyJyxcbiAgICAgIHNob3dNYXBMYXllcjogJ1Nob3cgbWFwIGxheWVyJyxcbiAgICAgIHJlbW92ZU1hcExheWVyOiAnUmVtb3ZlIG1hcCBsYXllcicsXG4gICAgICB6b29tVG9NYXBMYXllcjogJ1pvb20gdG8gbWFwIGxheWVyJyxcbiAgICAgIGxvYWRlZEluTGVmdFZpZXdlcjogJ0xvYWRlZCBpbiB0aGUgbGVmdCB2aWV3ZXInLFxuICAgICAgbG9hZGVkSW5SaWdodFZpZXdlcjogJ0xvYWRlZCBpbiB0aGUgcmlnaHQgdmlld2VyJyxcbiAgICAgIHJlc2V0OiAnUmVzZXQnLFxuICAgICAgdW5saW5rTGluazogJ1VubGluay9saW5rIHZpZXdlcnMnLFxuICAgICAgc3BsaXQ6ICdTcGxpdCB2aWV3ZXJzJyxcbiAgICAgIHRvZ2dsZVZlcmlmaWVkOiAnSXMgb3Igbm90IGEgdmVyaWZpZWQgbWFwPycsXG4gICAgICB0b2dnbGVGYXZvcml0ZTogJ1RvZ2dsZSBmYXZvcml0ZScsXG4gICAgICB0b2dnbGVXaGVlbFpvb206ICdUb2dnbGUgd2hlZWwgem9vbScsXG4gICAgICB0b2dnbGVNYXJrZXJDcmVhdGlvbjogJ0VuYWJsZS9kaXNhYmxlIG1hcmtlciBjcmVhdGlvbicsXG4gICAgICB0b2dnbGVNYXJrZXJSZW1vdmFsOiAnRW5hYmxlL2Rpc2FibGUgbWFya2VyIHJlbW92YWwnLFxuICAgICAgc2F2ZUdlb3JlZjogJ1NhdmUgZ2VvcmVmJyxcbiAgICAgIGxvYWRHY3BPbk1hcDogJ0xvYWQgR0NQIG9uIE1hcCcsXG4gICAgICBjcmVhdGVsYXllcjogJ05ldyBMYXllcicsXG4gICAgICBwdWJsaXNoOiAnUHVibGlzaCcsXG4gICAgICBzaG93RmVhdHVyZVZlcnNpb246ICdTaG93IEZlYXR1cmVzIFZlcnNpb24gc2RmZ2FzZGdhc2QgYXNkZ2Zhc2RnYXNkZmdhIGFzZGdhc2RnZmFzZGZhc2QgYXNkZmFzZGZhc2RmYXNkIGFzZGZhc2RmYXNkZidcbiAgICB9LFxuICAgIGZpZWxkczoge1xuICAgICAgZGF0ZTogJ0RhdGUnLFxuICAgICAgYWN0aW9uOiAnQWN0aW9uJyxcbiAgICAgIGFjdGlvbnM6ICdBY3Rpb25zJyxcbiAgICAgIG9wYWNpdHk6ICdPcGFjaXR5JyxcbiAgICAgIGxvZ2luOiB7XG4gICAgICAgIHJlc2V0UGFzc3dvcmQ6ICdSZXNldCBwYXNzd29yZCcsXG4gICAgICAgIGNvbmZpcm1QYXNzd29yZDogJ0NvbmZpcm0gcGFzc3dvcmQnXG4gICAgICB9LFxuICAgICAgbWFpbDoge1xuICAgICAgICB0bzogJ1RvJyxcbiAgICAgICAgc3ViamVjdDogJ1N1YmplY3QnLFxuICAgICAgICBtZXNzYWdlOiAnTWVzc2FnZSdcbiAgICAgIH0sXG4gICAgICB1c2VyOiB7XG4gICAgICAgIHByb2ZpbGU6ICdQcm9maWxlcycsXG4gICAgICAgIG5hbWVPckVtYWlsOiAnTmFtZSBvciBlLW1haWwnXG4gICAgICB9XG4gICAgfSxcbiAgICBsYXlvdXQ6IHtcbiAgICAgIG1lbnU6IHtcbiAgICAgICAgbWFwOiAnTWFwJyxcbiAgICAgICAgZXhwb3J0OiAnRXhwb3J0JyxcbiAgICAgICAgaW1wb3J0OiAnSW1wb3J0JyxcbiAgICAgICAgdmVjdG9yOiAnVmVjdG9yJyxcbiAgICAgICAgZ2VvcmVmZXJlbmNlOiAnR2VvcmVmZXJlbmNlJyxcbiAgICAgICAgcHJlZmVyZW5jZXM6ICdwcmVmZXJlbmNlcydcbiAgICAgIH0sXG4gICAgICBpbnB1dDoge1xuICAgICAgICBzZWxlY3Q6ICdTZWxlY3QnXG4gICAgICB9XG4gICAgfSxcbiAgICB0b29sdGlwczoge1xuICAgICAgdXNlcjoge1xuICAgICAgICBwcm9maWxlOiAnUHJvZmlsZScsXG4gICAgICAgIHRyYW5zZmVyOiAnVHJhbnNmZXInXG4gICAgICB9XG4gICAgfSxcbiAgICBwYWdpbmF0aW9uOiB7XG4gICAgICB0b3RhbDogJ1RvdGFsJyxcbiAgICAgIGl0ZW1zOiAnSXRlbShzKSdcbiAgICB9XG4gIH0pO1xufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuLyplc2xpbnQgYW5ndWxhci9maWxlLW5hbWU6IDAsIG5vLXVuZGVmOiAwKi9cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uc3RhbnQoJ2RlLURFLmkxOG4uYXR0cmlidXRlcycsIHtcbiAgICBlbWFpbDogJ0VtYWlsJyxcbiAgICBwYXNzd29yZDogJ1Bhc3N3b3JkJyxcbiAgICBuYW1lOiAnTmFtZScsXG4gICAgaW1hZ2U6ICdJbWFnZScsXG4gICAgcm9sZXM6ICdQcm9maWxlcycsXG4gICAgZGF0ZTogJ0RhdGUnLFxuICAgIGluaXRpYWxEYXRlOiAnSW5pdGlhbCBkYXRlJyxcbiAgICBmaW5hbERhdGU6ICdFbmQgZGF0ZScsXG4gICAgdGFzazoge1xuICAgICAgZGVzY3JpcHRpb246ICdEZXNjcmlwdGlvbicsXG4gICAgICBkb25lOiAnRG9uZT8nLFxuICAgICAgcHJpb3JpdHk6ICdQcmlvcml0eScsXG4gICAgICBzY2hlZHVsZWRfdG86ICdTY2hlZHVsZWQgdG8/JyxcbiAgICAgIHByb2plY3Q6ICdQcm9qZWN0J1xuICAgIH0sXG4gICAgcHJvamVjdDoge1xuICAgICAgY29zdDogJ2Nvc3QnXG4gICAgfSxcbiAgICBhdWRpdE1vZGVsOiB7fVxuICB9KTtcbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbi8qZXNsaW50IGFuZ3VsYXIvZmlsZS1uYW1lOiAwLCBuby11bmRlZjogMCovXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnN0YW50KCdkZS1ERS5pMThuLmRpYWxvZycsIHtcbiAgICBjb25maXJtVGl0bGU6ICdDb25maXJtPycsXG4gICAgY29uZmlybURlc2NyaXB0aW9uOiAnQ29uZmlybSBhY3Rpb24/JyxcbiAgICByZW1vdmVEZXNjcmlwdGlvbjogJ0RvIHlvdSB3YW50IHRvIHJlbW92ZSBwZXJtYW5lbnRseSB7e25hbWV9fT8nLFxuICAgIGF1ZGl0OiB7XG4gICAgICBjcmVhdGVkOiAnQ3JlYXRlZCcsXG4gICAgICB1cGRhdGVkQmVmb3JlOiAnVXBkYXRlZCBiZWZvcmUnLFxuICAgICAgdXBkYXRlZEFmdGVyOiAnVXBkYXRlZCBhZnRlcicsXG4gICAgICBkZWxldGVkOiAnRGVsZXRlZCdcbiAgICB9LFxuICAgIGxvZ2luOiB7XG4gICAgICByZXNldFBhc3N3b3JkOiB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVHlwZSB5b3VyIHJlZ2lzdGVyZWQgZS1tYWlsIGluIHRoZSBzeXN0ZW0uJ1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4vKmVzbGludCBhbmd1bGFyL2ZpbGUtbmFtZTogMCwgbm8tdW5kZWY6IDAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25zdGFudCgnZGUtREUuaTE4bi5nbG9iYWwnLCB7XG4gICAgbG9hZGluZzogJ0xvYWRpbmcuLi4nLFxuICAgIHByb2Nlc3Npbmc6ICdQcm9jZXNzaW5nLi4uJyxcbiAgICB5ZXM6ICdZZXMnLFxuICAgIG5vOiAnTm8nLFxuICAgIGFsbDogJ0FsbCdcbiAgfSk7XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4vKmVzbGludCBhbmd1bGFyL2ZpbGUtbmFtZTogMCwgbm8tdW5kZWY6IDAqL1xuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb25zdGFudCgnZGUtREUuaTE4bi5tZXNzYWdlcycsIHtcbiAgICBpbnRlcm5hbEVycm9yOiAnSW50ZXJuYWwgZXJyb3IuIGNvbnRhY3QgdGhlIHN5c3RlbSBhZG1pbicsXG4gICAgbWFwRmlsZUlzTWFuZGF0b3J5OiAnU2VsZWN0IGEgbWFwIGZpbGUgaXMgbWFuZGF0b3J5JyxcbiAgICBpbnZhbGlkSW1hZ2VGaWxlOiAnRmlsZSBzZWxlY3RlZCBpcyBub3QgYSB2YWxpZCBpbWFnZSBmaWxlJyxcbiAgICBmaWxlVG9vQmlnOiAnRmlsZSBzZWxlY3RlZCBpcyB0b28gYmlnJyxcbiAgICBub3RGb3VuZDogJ05vdCBmb3VuZCcsXG4gICAgbm90QXV0aG9yaXplZDogJ1lvdSBkbyBub3QgaGF2ZSBhY2Nlc3MgdG8gdGhpcyBmdW5jdGlvbmFsaXR5LicsXG4gICAgc2VhcmNoRXJyb3I6ICdTZWFyY2ggZXJyb3IuJyxcbiAgICBzYXZlU3VjY2VzczogJ0l0ZW0gc2F2ZWQgc3VjY2Vzc2Z1bGx5LicsXG4gICAgb3BlcmF0aW9uU3VjY2VzczogJ09wZXJhdGlvbiBkb25lIHdpdGggc3VjY2Vzcy4nLFxuICAgIG9wZXJhdGlvbkVycm9yOiAnRXJyb3Igd2hpbGUgZG9pbmcgdGhlIG9wZXJhdGlvbicsXG4gICAgc2F2ZUVycm9yOiAnRXJyb3Igd2hpbGUgdHJ5aW5nIHRvIHNhdmUgdGhlIGl0ZW0uJyxcbiAgICByZW1vdmVTdWNjZXNzOiAnUmVtb3ZhbCBkb25lIHdpdGggc3VjY2Vzcy4nLFxuICAgIHJlbW92ZUVycm9yOiAnRXJyb3Igd2hpbGUgdHJ5aW5nIHRvIHJlbW92ZSB0aGUgaXRlbS4nLFxuICAgIHJlc291cmNlTm90Rm91bmRFcnJvcjogJ0l0ZW0gbm90IGZvdW5kJyxcbiAgICBub3ROdWxsRXJyb3I6ICdBbGwgdGhlIG1hbmRhdG9yeSBmaWVsZHMgbXVzdCBiZSBmaWxsZWQuJyxcbiAgICBkdXBsaWNhdGVkUmVzb3VyY2VFcnJvcjogJ0FscmVhZHkgZXhpc3RzIGFuIGl0ZW0gd2l0aCB0aGVzZSBkYXRhLicsXG4gICAgdmFsaWRhdGU6IHtcbiAgICAgIGZpZWxkUmVxdWlyZWQ6ICdUaGUgZmllbGQge3tmaWVsZH19IGlzIG1hbmRhdG9yeS4nXG4gICAgfSxcbiAgICBsYXlvdXQ6IHtcbiAgICAgIGVycm9yNDA0OiAnUGFnZSBubyBmb3VuZCdcbiAgICB9LFxuICAgIGxvZ2luOiB7XG4gICAgICBsb2dvdXRJbmFjdGl2ZTogJ1lvdSBoYXZlIGJlZW4gbG9nZ2VkIG91dC4gTG9naW4gYWdhaW4uJyxcbiAgICAgIGludmFsaWRDcmVkZW50aWFsczogJ0ludmFsaWQgY3JlZGVudGlhbHMnLFxuICAgICAgdW5rbm93bkVycm9yOiAnSXQgd2FzIG5vdCBwb3NzaWJsZSB0byBsb2cgeW91IGluLiAnICsgJ1RyeSBhZ2Fpbi4gSWYgdGhlIGVycm9yIHBlcnNpc3RzLCBjb250YWN0IHRoZSBzeXN0ZW0gYWRtaW5pc3RyYXRvci4nLFxuICAgICAgdXNlck5vdEZvdW5kOiAnVXNlciBub3QgZm91bmQnXG4gICAgfSxcbiAgICBkYXNoYm9hcmQ6IHtcbiAgICAgIHdlbGNvbWU6ICdXZWxjb21lIHt7dXNlck5hbWV9fScsXG4gICAgICBkZXNjcmlwdGlvbjogJ1VzZSB0aGUgZm9yIG5hdmlnYXRpb24uJ1xuICAgIH0sXG4gICAgbWFpbDoge1xuICAgICAgbWFpbEVycm9yczogJ0FuIGVycm9yIGhhcyBvY2N1cnJlZCBpbiB0aGUgZm9sbG93aW5nIGUtbWFpbHM6XFxuJyxcbiAgICAgIHNlbmRNYWlsU3VjY2VzczogJ0VtYWlsIHNlbnQgd2l0aCBzdWNjZXNzIScsXG4gICAgICBzZW5kTWFpbEVycm9yOiAnSXQgd2FzIG5vdCBwb3NzaWJsZSB0byBzZW5kIHRoZSBlLW1haWwuJyxcbiAgICAgIHBhc3N3b3JkU2VuZGluZ1N1Y2Nlc3M6ICdUaGUgcGFzc3dvcmQgcmVjb3ZlciBwcm9jZXNzIHdhcyBpbml0aWF0ZWQuIElmIHRoZSBlLW1haWwgZG9lcyBub3QgYXJyaXZlIGluIDEwIG1pbnV0ZXMsIHRyeSBhZ2Fpbi4nXG4gICAgfSxcbiAgICB1c2VyOiB7XG4gICAgICByZW1vdmVZb3VyU2VsZkVycm9yOiAnWW91IGNhbiBub3QgcmVtb3ZlIHlvdXIgb3duIHVzZXIuJyxcbiAgICAgIHVzZXJFeGlzdHM6ICdVc2VyIGFscmVhZHkgZXhpc3RzIScsXG4gICAgICBwcm9maWxlOiB7XG4gICAgICAgIHVwZGF0ZUVycm9yOiAnSXQgd2FzIG5vdCBwb3NzaWJsZSB0byB1cGRhdGUgeW91ciBwcm9maWxlLidcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuLyplc2xpbnQgYW5ndWxhci9maWxlLW5hbWU6IDAsIG5vLXVuZGVmOiAwKi9cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29uc3RhbnQoJ2RlLURFLmkxOG4ubW9kZWxzJywge1xuICAgIHVzZXI6ICdVc2VyJ1xuICB9KTtcbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbi8qZXNsaW50IGFuZ3VsYXIvZmlsZS1uYW1lOiAwLCBuby11bmRlZjogMCovXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnN0YW50KCdkZS1ERS5pMThuLnZpZXdzJywge1xuICAgIGJyZWFkY3J1bWJzOiB7XG4gICAgICB1c2VyOiAnVXNlIGFkbWluJyxcbiAgICAgICd1c2VyLXByb2ZpbGUnOiAnVXNlciBwcm9maWxlJyxcbiAgICAgIGRhc2hib2FyZDogJ0Rhc2hib2FyZCcsXG4gICAgICBhdWRpdDogJ0F1ZGl0JyxcbiAgICAgIG1haWw6ICdNYWlsIHNlbmQnLFxuICAgICAgcHJvamVjdDogJ1Byb2plY3RzJyxcbiAgICAgICdub3QtYXV0aG9yaXplZCc6ICdOb3QgYXV0aG9yaXplZCdcbiAgICB9LFxuICAgIHRpdGxlczoge1xuICAgICAgZGFzaGJvYXJkOiAnSG9tZSBwYWdlJyxcbiAgICAgIG1haWxTZW5kOiAnU2VuZCBtYWlsJyxcbiAgICAgIHRhc2tMaXN0OiAnVGFzayBsaXN0JyxcbiAgICAgIHVzZXJMaXN0OiAnVXNlciBsaXN0JyxcbiAgICAgIGF1ZGl0TGlzdDogJ0F1ZGl0IExpc3QnLFxuICAgICAgcmVnaXN0ZXI6ICdSZWdpc3RlcicsXG4gICAgICByZXNldFBhc3N3b3JkOiAnUmVzZXQgcGFzc3dvcmQnLFxuICAgICAgdXBkYXRlOiAnVXBkYXRlJ1xuICAgIH0sXG4gICAgYWN0aW9uczoge1xuICAgICAgc2VuZDogJ1NlbmQnLFxuICAgICAgc2F2ZTogJ1NhdmUnLFxuICAgICAgY2xlYXI6ICdDbGVhcicsXG4gICAgICBjbGVhckFsbDogJ0NsZWFyIGFsbCcsXG4gICAgICByZXN0YXJ0OiAnUmVzdGFydCcsXG4gICAgICBmaWx0ZXI6ICdGaWx0ZXInLFxuICAgICAgc2VhcmNoOiAnU2VhcmNoJyxcbiAgICAgIGxpc3Q6ICdMaXN0JyxcbiAgICAgIGVkaXQ6ICdFZGl0JyxcbiAgICAgIGNhbmNlbDogJ0NhbmNlbCcsXG4gICAgICB1cGRhdGU6ICdVcGRhdGUnLFxuICAgICAgcmVtb3ZlOiAnUmVtb3ZlJyxcbiAgICAgIGdldE91dDogJ0V4aXQnLFxuICAgICAgYWRkOiAnQWRkJyxcbiAgICAgIGluOiAnZW50ZXInLFxuICAgICAgbG9hZEltYWdlOiAnTG9hZCBpbWFnZSdcbiAgICB9LFxuICAgIGZpZWxkczoge1xuICAgICAgZGF0ZTogJ0RhdGUnLFxuICAgICAgYWN0aW9uOiAnQWN0aW9uJyxcbiAgICAgIGFjdGlvbnM6ICdBY3Rpb25zJyxcbiAgICAgIGxvZ2luOiB7XG4gICAgICAgIHJlc2V0UGFzc3dvcmQ6ICdSZXNldCBwYXNzd29yZCcsXG4gICAgICAgIGNvbmZpcm1QYXNzd29yZDogJ0NvbmZpcm0gcGFzc3dvcmQnXG4gICAgICB9LFxuICAgICAgbWFpbDoge1xuICAgICAgICB0bzogJ1RvJyxcbiAgICAgICAgc3ViamVjdDogJ1N1YmplY3QnLFxuICAgICAgICBtZXNzYWdlOiAnTWVzc2FnZSdcbiAgICAgIH0sXG4gICAgICB1c2VyOiB7XG4gICAgICAgIHByb2ZpbGU6ICdQcm9maWxlcycsXG4gICAgICAgIG5hbWVPckVtYWlsOiAnTmFtZSBvciBlLW1haWwnXG4gICAgICB9XG4gICAgfSxcbiAgICBsYXlvdXQ6IHtcbiAgICAgIG1lbnU6IHtcbiAgICAgICAgZGFzaGJvYXJkOiAnRGFzaGJvYXJkJyxcbiAgICAgICAgYWRtaW46ICdBZG1pbmlzdHJhdGlvbicsXG4gICAgICAgIGV4YW1wbGVzOiAnRXhhbXBsZXMnLFxuICAgICAgICB1c2VyOiAnVXNlcicsXG4gICAgICAgIG1haWw6ICdTZW5kIGVtYWlsJyxcbiAgICAgICAgYXVkaXQ6ICdBdWRpdCdcbiAgICAgIH1cbiAgICB9LFxuICAgIHRvb2x0aXBzOiB7XG4gICAgICB1c2VyOiB7XG4gICAgICAgIHByb2ZpbGU6ICdQcm9maWxlJyxcbiAgICAgICAgdHJhbnNmZXI6ICdUcmFuc2ZlcidcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcblxuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdNYXBEaWFsb2dDb250cm9sbGVyJywgTWFwRGlhbG9nQ29udHJvbGxlcik7XG5cbiAgICAvKiogQG5nSW5qZWN0ICovXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgICBmdW5jdGlvbiBNYXBEaWFsb2dDb250cm9sbGVyKCRjb250cm9sbGVyLCBNYXBTZXJ2aWNlLCBDMkRpYWxvZywgbWFwRGlhbG9nSW5wdXQsIEZpbGVTZXJ2aWNlLCBDMlRvYXN0LCAkdHJhbnNsYXRlLCBNYXBUeXBlU2VydmljZSwgTWFwUHJvamVjdGlvblNlcnZpY2UsIE1hcFByb2plY3RTZXJ2aWNlLCBsb2Rhc2gsIE1hcExheWVyU2VydmljZSkge1xuXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0ub25BY3RpdmF0ZSA9IG9uQWN0aXZhdGU7XG4gICAgICAgIHZtLmJlZm9yZVNhdmUgPSBiZWZvcmVTYXZlO1xuICAgICAgICB2bS5hZnRlclNhdmUgPSBhZnRlclNhdmU7XG4gICAgICAgIHZtLm9uRmlsZVJlbW92ZSA9IG9uRmlsZVJlbW92ZTtcbiAgICAgICAgdm0ucmVtb3ZlRmlsZSA9IHJlbW92ZUZpbGU7XG4gICAgICAgIHZtLm9uQWN0aXZhdGUgPSBvbkFjdGl2YXRlO1xuICAgICAgICB2bS5jbG9zZSA9IGNsb3NlO1xuICAgICAgICB2bS5nZW9GaWxlTmVlZGVkID0gZmFsc2U7XG4gICAgICAgIHZtLm9uSW1hZ2VGaWxlQ2hhbmdlID0gb25JbWFnZUZpbGVDaGFuZ2U7XG4gICAgICAgIHZtLm9uR2VvRmlsZUNoYW5nZSA9IG9uR2VvRmlsZUNoYW5nZTtcbiAgICAgICAgdm0uc2hvd0dlb0ZpbGVJbnB1dCA9IHNob3dHZW9GaWxlSW5wdXQ7XG4gICAgICAgIHZtLnNob3dQcm9qZWN0aW9uSW5wdXQgPSBzaG93UHJvamVjdGlvbklucHV0O1xuICAgICAgICB2bS5zaG93R2VvcmVmQmFkZ2UgPSBzaG93R2VvcmVmQmFkZ2U7XG5cbiAgICAgICAgLy8gaW5zdGFudGlhdGUgYmFzZSBjb250cm9sbGVyXG4gICAgICAgICRjb250cm9sbGVyKCdDUlVEQ29udHJvbGxlcicsIHtcbiAgICAgICAgICAgIHZtOiB2bSxcbiAgICAgICAgICAgIG1vZGVsU2VydmljZTogTWFwU2VydmljZSxcbiAgICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICBzZWFyY2hPbkluaXQ6IGZhbHNlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSdW4gaW5pdGlhbCBmdW5jdGlvbnMgb24gZGlhbG9nIG9wZW5JbmdcbiAgICAgICAgICogQHJldHVybiB2b2lkXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBvbkFjdGl2YXRlKCkge1xuICAgICAgICAgICAgdm0uc2F2aW5nID0gZmFsc2U7XG4gICAgICAgICAgICBkZWZpbmVWaWV3U3RhdGUoKTtcbiAgICAgICAgICAgIHZtLnJlbW92ZU1hcCA9IG1hcERpYWxvZ0lucHV0LnJlbW92ZUZuO1xuICAgICAgICAgICAgTWFwVHlwZVNlcnZpY2UucGFnaW5hdGUoKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZtLm1hcFR5cGVzID0gcmVzcG9uc2UuaXRlbXM7XG4gICAgICAgICAgICAgICAgYWRqdXN0UmVzb3VyY2UoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgTWFwUHJvamVjdGlvblNlcnZpY2UucGFnaW5hdGUoKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZtLnByb2plY3Rpb25zID0gcmVzcG9uc2UuaXRlbXM7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgTWFwUHJvamVjdFNlcnZpY2UucGFnaW5hdGUoKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZtLnByb2plY3RzID0gcmVzcG9uc2UuaXRlbXM7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDaGVjayBpZiBhIHZhbGlkIHByb2plY3Rpb24gaXMgc2VsZWN0ZWQgYW5kIHRodXMgaWYgd2Ugc2hhbGwgc2hvdyB0aGUgZ2VvIGZpbGUgaW5wdXRcbiAgICAgICAgICogXG4gICAgICAgICAqIEByZXR1cm5zIGJvb2xlYW5cbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIHNob3dHZW9GaWxlSW5wdXQoKSB7XG4gICAgICAgICAgICByZXR1cm4gYW5ndWxhci5pc0RlZmluZWQodm0ucmVzb3VyY2UucHJvamVjdGlvbikgJiYgdm0ucmVzb3VyY2UucHJvamVjdGlvbiAhPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIERlZmluZSB0aGUgZGlhbG9nIHZpZXcgc3RhdGUgYXMgYWRkIG9yIGVkaXQgXG4gICAgICAgICAqIGFuZCBwYXJzZSB0aGUgdmlldyB0aXRsZVxuICAgICAgICAgKiBAcmV0dXJuIHZvaWRcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIGRlZmluZVZpZXdTdGF0ZSgpIHtcbiAgICAgICAgICAgIHZtLm1vZGUgPSBhbmd1bGFyLmlzRGVmaW5lZChtYXBEaWFsb2dJbnB1dC5tb2RlbCkgPyAnZWRpdCcgOiAnYWRkJztcbiAgICAgICAgICAgIGlmICh2bS5tb2RlID09ICdhZGQnKSB7XG4gICAgICAgICAgICAgICAgdm0udmlld1RpdGxlID0gJHRyYW5zbGF0ZS5pbnN0YW50KCd2aWV3cy50aXRsZXMuYWRkTWFwJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZtLnZpZXdUaXRsZSA9ICR0cmFuc2xhdGUuaW5zdGFudCgndmlld3MudGl0bGVzLmVkaXRNYXAnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNob3dQcm9qZWN0aW9uSW5wdXQoKSB7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gdm0uZ2VvRmlsZU5lZWRlZCAmJiB2bS5tb2RlID09PSAnYWRkJztcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogQWRqdXN0IHJlc291cmNlIG1hcHBpbmcgdGhlIGZpZWxkIG5hbWVzIGFuZCBzZXQgdGhlIHJlc291cmNlIG1vZGVsXG4gICAgICAgICAqIEByZXR1cm4gdm9pZFxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gYWRqdXN0UmVzb3VyY2UoKSB7XG4gICAgICAgICAgICBpZiAodm0ubW9kZSA9PT0gJ2VkaXQnKSB7XG4gICAgICAgICAgICAgICAgdm0ucmVzb3VyY2UgPSBtYXBEaWFsb2dJbnB1dC5tb2RlbDtcbiAgICAgICAgICAgICAgICB2YXIgbWFwVHlwZSA9IGxvZGFzaC5maW5kKHZtLm1hcFR5cGVzLCBmdW5jdGlvbiAobSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbS5pZCA9PT0gdm0ucmVzb3VyY2UuZmllbGRfbWFwX3R5cGU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdm0ucmVzb3VyY2UubWFwVHlwZSA9IG1hcFR5cGU7XG4gICAgICAgICAgICAgICAgdm0uZ2VvRmlsZU5lZWRlZCA9ICF2bS5yZXNvdXJjZS5tYXBJbWFnZUZpbGUuZ2VvcmVmZXJlbmNlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDbG9zZSB0aGUgZGlhbG9nXG4gICAgICAgICAqIFxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gY2xvc2UoKSB7XG4gICAgICAgICAgICBDMkRpYWxvZy5jbG9zZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhhbmRsZSB0aGUgYWZ0ZXIgc2F2ZSBldmVudCwgcmVmcmVzaGluZyB0aGUgbWFwcyBmcm9tIHNlcnZlciBhbmQgY2xvc2luZyB0aGUgZGlhbG9nXG4gICAgICAgICAqIFxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gYWZ0ZXJTYXZlKCkge1xuICAgICAgICAgICAgdm0uc2F2aW5nID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQobWFwRGlhbG9nSW5wdXQub25TYXZlKSkge1xuICAgICAgICAgICAgICAgIG1hcERpYWxvZ0lucHV0Lm9uU2F2ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xvc2UoKTtcbiAgICAgICAgICAgIE1hcExheWVyU2VydmljZS5yZWZyZXNoTWFwUmVzb3VyY2Uodm0ucmVzb3VyY2VVcGRhdGVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDaGVjayB0aGUgY29uc3RyYWludHMgYW5kIGFkanVzdCByZXNvdXJjZSBtYXBwaW5nIHRoZSBmaWVsZCBuYW1lcyBhbmQgc2V0IHRoZSByZXNvdXJjZSBtb2RlbFxuICAgICAgICAgKiBcbiAgICAgICAgICogQHJldHVybnMgdm9pZFxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gYmVmb3JlU2F2ZSgpIHtcbiAgICAgICAgICAgIHZtLnNhdmluZyA9IHRydWU7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5yZXNvdXJjZS5tYXBJbWFnZUZpbGUpKSB7XG4gICAgICAgICAgICAgICAgdm0uc2F2aW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgQzJUb2FzdC5lcnJvcigkdHJhbnNsYXRlLmluc3RhbnQoJ21lc3NhZ2VzLm1hcEZpbGVJc01hbmRhdG9yeScpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZtLnJlc291cmNlLmltYWdlX2ZpbGVfaWQgPSB2bS5yZXNvdXJjZS5tYXBJbWFnZUZpbGUuaWQ7XG4gICAgICAgICAgICAgICAgdm0ucmVzb3VyY2UubWFwX3R5cGVfaWQgPSB2bS5yZXNvdXJjZS5tYXBUeXBlLmlkO1xuXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLnJlc291cmNlLm1hcEdlb0ZpbGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnJlc291cmNlLmZpZWxkX21hcF9nZW9faWQgPSB2bS5yZXNvdXJjZS5tYXBHZW9GaWxlLmlkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFdoaWxlIHdlIGRvbid0IGhhdmUgcHJvamVjdHMgbWFuYWdlbWVudCwgYXNzaWduIHRoZSBmaXJzdFxuICAgICAgICAgICAgdm0ucmVzb3VyY2UubWFwX3Byb2plY3RfaWQgPSB2bS5wcm9qZWN0c1swXS5pZDtcbiAgICAgICAgICAgIHZtLnJlc291cmNlVXBkYXRlZCA9IGFuZ3VsYXIuY29weSh2bS5yZXNvdXJjZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogSGFuZGxlcyB0aGUgZmlsZSByZW1vdmUgZXZlbnQsIGRlbGV0aW5nIHRoZSBmaWxlIGZyb20gdGhlIGJhY2stZW5kIFxuICAgICAgICAgKiBhbmQgcmVtb3ZpbmcgaXQgZnJvbSB0aGUgcmVzb3VyY2UuZmlsZXMgY29sbGVjdGlvbiAgXG4gICAgICAgICAqIEBwYXJhbSB7YW55fSBmaWxlRGF0YSBcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIG9uRmlsZVJlbW92ZSgpIHt9XG4gICAgICAgIC8vdm0ucmVtb3ZlTWFwKCk7XG5cblxuICAgICAgICAvKipcbiAgICAgICAgICogSGFuZGxlcyB0aGUgZmlsZSByZW1vdmUgZXZlbnQsIGRlbGV0aW5nIHRoZSBmaWxlIGZyb20gdGhlIGJhY2stZW5kIFxuICAgICAgICAgKiBhbmQgcmVtb3ZpbmcgaXQgZnJvbSB0aGUgcmVzb3VyY2UuZmlsZXMgY29sbGVjdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlRmlsZShmaWxlKSB7XG4gICAgICAgICAgICB2YXIgZmlsZVNlcnZpY2UgPSBuZXcgRmlsZVNlcnZpY2UoKTtcbiAgICAgICAgICAgIGZpbGVTZXJ2aWNlLmlkID0gZmlsZS5pZDtcblxuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKGZpbGVTZXJ2aWNlKSkge1xuICAgICAgICAgICAgICAgIGZpbGVTZXJ2aWNlLiRkZXN0cm95KCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFN0YXRlQWZ0ZXJGaWxlUmVtb3ZhbChmaWxlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXQgdGhlIHRoZSB2YXJpYWJsZXMgc3RhdGUgYWZ0ZXIgYSBmaWxlIChpbWFnZSBvciBnZW8pIGlzIHJlbW92ZWRcbiAgICAgICAgICogXG4gICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBzYXZlZEZpbGVEYXRhIFxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gc2V0U3RhdGVBZnRlckZpbGVSZW1vdmFsKHJlbW92ZWRGaWxlKSB7XG4gICAgICAgICAgICBzZXRJc0dlb3JlZmVyZW5jZWQoKTtcbiAgICAgICAgICAgIHZhciBpc0ltYWdlID0gYW5ndWxhci5pc0RlZmluZWQocmVtb3ZlZEZpbGUudGh1bWIpID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgICAgaWYgKGlzSW1hZ2UpIHtcbiAgICAgICAgICAgICAgICB2bS5yZXNvdXJjZS5tYXBJbWFnZUZpbGUgPSB7fTtcbiAgICAgICAgICAgICAgICB2bS5yZXNvdXJjZS5tYXBHZW9GaWxlID0ge307XG4gICAgICAgICAgICAgICAgdm0uZ2VvRmlsZU5lZWRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB2bS5yZXNvdXJjZS5tYXBHZW9GaWxlID0ge307XG4gICAgICAgICAgICAgICAgdm0uZ2VvRmlsZU5lZWRlZCA9ICF2bS5yZXNvdXJjZS5nZW9yZWZlcmVuY2VkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhhbmRsZXMgdGhlIGltYWdlIGZpbGUgY2hhbmdlICh3aGVuIGEgZmlsZSBpcyBhZGRlZCksIHByZXBhcmluZywgYW5kIHVwbG9hZGluZyBpdCBcbiAgICAgICAgICogdG8gdGhlIGJhY2stZW5kIGFuZCBhZGRpbmcgaXQgdG8gdGhlIGNsaWVudCByZXNvdXJjZS5maWxlcyBjb2xsZWN0aW9uIFxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gb25JbWFnZUZpbGVDaGFuZ2UoKSB7XG4gICAgICAgICAgICAvLyBJbiBzZXF1ZW5jZSB3ZSB1cGxvYWQgdGhlIG5ldyBmaWxlICh3ZSBkb250IGhhdmUgdG8gd2FpdCB0aGUgcmVtb3ZhbClcbiAgICAgICAgICAgIHZhciBmaWxlT2JqID0gdm0uaW1hZ2VGaWxlWzBdO1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKGZpbGVPYmopICYmICFmaWxlT2JqLmlzUmVtb3RlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZpbGVPYmoubGZUYWdUeXBlID09PSBcImltYWdlXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgd2hldGhlciB0aGUgZmlsZSBzaXplIGlzIGxlc3MgdGhhbiAyMDAgTUJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVPYmoubGZGaWxlLnNpemUgLyAxMDI0IC8gMTAyNCA8PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlU2VydmljZSA9IG5ldyBGaWxlU2VydmljZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVNlcnZpY2UuZmlsZSA9IGZpbGVPYmoubGZGaWxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkRmlsZShmaWxlU2VydmljZSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBDMlRvYXN0LmVycm9yKCR0cmFuc2xhdGUuaW5zdGFudCgnbWVzc2FnZXMuZmlsZVRvb0JpZycpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIEMyVG9hc3QuZXJyb3IoJHRyYW5zbGF0ZS5pbnN0YW50KCdtZXNzYWdlcy5pbnZhbGlkSW1hZ2VGaWxlJykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYW5kbGVzIHRoZSBnZW8gZmlsZSBjaGFuZ2UgKHdoZW4gYSBmaWxlIGlzIGFkZGVkKSwgcHJlcGFyaW5nLCBhbmQgdXBsb2FkaW5nIGl0IFxuICAgICAgICAgKiB0byB0aGUgYmFjay1lbmQgYW5kIGFkZGluZyBpdCB0byB0aGUgY2xpZW50IHJlc291cmNlLmZpbGVzIGNvbGxlY3Rpb24gXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBvbkdlb0ZpbGVDaGFuZ2UoKSB7XG4gICAgICAgICAgICAvLyBXZSB0aGUgaGFzIGEgaW1hZ2UsIHdlIGFzayB0aGUgc2VydmVyIHRvIHJlbXZvZSB0aGlzIGZpbGVcbiAgICAgICAgICAgIC8vIHRvIGF2b2lkIGdhcmJhZ2UgaW4gdGhlIGJhY2stZW5kXG4gICAgICAgICAgICB2YXIgaW1hZ2VJZCA9IG51bGw7XG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQodm0ucmVzb3VyY2UubWFwSW1hZ2VGaWxlKSAmJiBhbmd1bGFyLmlzRGVmaW5lZCh2bS5yZXNvdXJjZS5tYXBJbWFnZUZpbGUuaWQpKSB7XG4gICAgICAgICAgICAgICAgaW1hZ2VJZCA9IHZtLnJlc291cmNlLm1hcEltYWdlRmlsZS5pZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEluIHNlcXVlbmNlIHdlIHVwbG9hZCB0aGUgbmV3IGZpbGUgKHdlIGRvbnQgaGF2ZSB0byB3YWl0IHRoZSByZW1vdmFsKVxuICAgICAgICAgICAgdmFyIGZpbGVPYmogPSB2bS5nZW9GaWxlWzBdO1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKGZpbGVPYmopICYmICFmaWxlT2JqLmlzUmVtb3RlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVTZXJ2aWNlID0gbmV3IEZpbGVTZXJ2aWNlKCk7XG4gICAgICAgICAgICAgICAgZmlsZVNlcnZpY2UuZmlsZSA9IGZpbGVPYmoubGZGaWxlO1xuICAgICAgICAgICAgICAgIGZpbGVTZXJ2aWNlLm1hcF9pbWFnZV9maWxlX2lkID0gaW1hZ2VJZDtcbiAgICAgICAgICAgICAgICBmaWxlU2VydmljZS5tYXBfZ2VvX2ZpbGVfcHJvamVjdGlvbiA9IHZtLnJlc291cmNlLnByb2plY3Rpb24udmFsdWU7XG4gICAgICAgICAgICAgICAgdXBsb2FkRmlsZShmaWxlU2VydmljZSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFByb2Nlc3MgYSBmaWxlIHVwbG9hZCAoaW1hZ2Ugb3IgZ2VvIGZpbGUpXG4gICAgICAgICAqIFxuICAgICAgICAgKiBAcGFyYW0ge0ZpbGVTZXJ2aWNlfSBmaWxlU2VydmljZSBcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIHVwbG9hZEZpbGUoZmlsZVNlcnZpY2UpIHtcbiAgICAgICAgICAgIGZpbGVTZXJ2aWNlLnVwbG9hZCgpLnRoZW4oZnVuY3Rpb24gKHNhdmVkRmlsZURhdGEpIHtcbiAgICAgICAgICAgICAgICBzZXRTdGF0ZUFmdGVyRmlsZVVwbG9hZChzYXZlZEZpbGVEYXRhKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldCB0aGUgdGhlIHZhcmlhYmxlcyBzdGF0ZSBhZnRlciBhIGZpbGUgKGltYWdlIG9yIGdlbykgaXMgdXBsb2FkZWRcbiAgICAgICAgICogXG4gICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBzYXZlZEZpbGVEYXRhIFxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gc2V0U3RhdGVBZnRlckZpbGVVcGxvYWQoc2F2ZWRGaWxlRGF0YSkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHNhdmVkRmlsZURhdGEuaWQpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHNhdmVkRmlsZURhdGEudGh1bWIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnJlc291cmNlLm1hcEltYWdlRmlsZSA9IHNhdmVkRmlsZURhdGE7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlmKCF2bS5yZXNvdXJjZS5tYXBJbWFnZUZpbGUuZ2VvcmVmZXJlbmNlZCl7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdm0ucmVzb3VyY2UubWFwSW1hZ2VGaWxlLmlzZ2VvcmVmKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5nZW9GaWxlTmVlZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnJlc291cmNlLm1hcEdlb0ZpbGUgPSBzYXZlZEZpbGVEYXRhO1xuICAgICAgICAgICAgICAgICAgICB2bS5nZW9GaWxlTmVlZGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNldElzR2VvcmVmZXJlbmNlZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIERlZmluZSBhIHNob3J0aGFuZCBwcm9wZXJ0eSBpZiB0aGUgbWFwIGlzIGdlb3JlZmVyZW5jZWQgb3Igbm90XG4gICAgICAgICAqIFxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gc2V0SXNHZW9yZWZlcmVuY2VkKCkge1xuICAgICAgICAgICAgLy8gdm0ucmVzb3VyY2UuZ2VvcmVmZXJlbmNlZCA9IHZtLnJlc291cmNlLm1hcEltYWdlRmlsZS5nZW9yZWZlcmVuY2VkID09PSB0cnVlIHx8IGFuZ3VsYXIuaXNEZWZpbmVkKHZtLnJlc291cmNlLm1hcEdlb0ZpbGUuaWQpO1xuICAgICAgICAgICAgdm0ucmVzb3VyY2UuZ2VvcmVmZXJlbmNlZCA9IHZtLnJlc291cmNlLm1hcEltYWdlRmlsZS5pc2dlb3JlZjtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNob3dHZW9yZWZCYWRnZSgpIHtcbiAgICAgICAgICAgIGlmICh2bS5yZXNvdXJjZS5nZW9yZWZlcmVuY2VkICE9PSB1bmRlZmluZWQgJiYgdm0ubW9kZSAhPT0gJ2VkaXQnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdNYXBMZWZ0U2lkZW5hdkNvbnRyb2xsZXInLCBNYXBMZWZ0U2lkZW5hdkNvbnRyb2xsZXIpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgZnVuY3Rpb24gTWFwTGVmdFNpZGVuYXZDb250cm9sbGVyKCRzY29wZSwgJHRpbWVvdXQsICRtZFNpZGVuYXYsICRsb2csICRyb290U2NvcGUpIHtcbiAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgdm0uY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAvLyBDb21wb25lbnQgbG9va3VwIHNob3VsZCBhbHdheXMgYmUgYXZhaWxhYmxlIHNpbmNlIHdlIGFyZSBub3QgdXNpbmcgYG5nLWlmYFxuICAgICAgJG1kU2lkZW5hdignbGVmdCcpLmNsb3NlKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICRsb2cuZGVidWcoXCJjbG9zZSBMRUZUIGlzIGRvbmVcIik7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHJvb3RTY29wZS4kb24oJ2FkZFRvV29ya2luZ0xpc3QnLCBmdW5jdGlvbiAoZXZlbnQsIGRhdGEpIHtcbiAgICAgIGNvbnNvbGUubG9nKGRhdGEpOyAvLyAnU29tZSBkYXRhJ1xuICAgIH0pO1xuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0dmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcblxuXHRhcHAuZmFjdG9yeSgnJGxvY2FsU3RvcmFnZScsIFsnJHdpbmRvdycsIGZ1bmN0aW9uICgkd2luZG93KSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdHNldDogZnVuY3Rpb24gc2V0KGtleSwgdmFsdWUpIHtcblx0XHRcdFx0JHdpbmRvdy5sb2NhbFN0b3JhZ2Vba2V5XSA9IHZhbHVlO1xuXHRcdFx0fSxcblx0XHRcdGdldDogZnVuY3Rpb24gZ2V0KGtleSwgZGVmYXVsdFZhbHVlKSB7XG5cdFx0XHRcdHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZVtrZXldIHx8IGRlZmF1bHRWYWx1ZTtcblx0XHRcdH0sXG5cdFx0XHRzZXRPYmplY3Q6IGZ1bmN0aW9uIHNldE9iamVjdChrZXksIHZhbHVlKSB7XG5cdFx0XHRcdCR3aW5kb3cubG9jYWxTdG9yYWdlW2tleV0gPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG5cdFx0XHR9LFxuXHRcdFx0Z2V0T2JqZWN0OiBmdW5jdGlvbiBnZXRPYmplY3Qoa2V5KSB7XG5cdFx0XHRcdHJldHVybiBKU09OLnBhcnNlKCR3aW5kb3cubG9jYWxTdG9yYWdlW2tleV0gfHwgJ3t9Jyk7XG5cdFx0XHR9LFxuXHRcdFx0cmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUoa2V5KSB7XG5cdFx0XHRcdGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZVtrZXldO1xuXHRcdFx0fVxuXHRcdH07XG5cdH1dKTtcbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHR2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xuXG5cdGFwcC5mYWN0b3J5KCckc2Vzc2lvblN0b3JhZ2UnLCBbJyR3aW5kb3cnLCBmdW5jdGlvbiAoJHdpbmRvdykge1xuXHRcdHJldHVybiB7XG5cdFx0XHRzZXQ6IGZ1bmN0aW9uIHNldChrZXksIHZhbHVlKSB7XG5cdFx0XHRcdCR3aW5kb3cuc2Vzc2lvblN0b3JhZ2Vba2V5XSA9IHZhbHVlO1xuXHRcdFx0fSxcblx0XHRcdGdldDogZnVuY3Rpb24gZ2V0KGtleSwgZGVmYXVsdFZhbHVlKSB7XG5cdFx0XHRcdHJldHVybiAkd2luZG93LnNlc3Npb25TdG9yYWdlW2tleV0gfHwgZGVmYXVsdFZhbHVlO1xuXHRcdFx0fSxcblx0XHRcdHNldE9iamVjdDogZnVuY3Rpb24gc2V0T2JqZWN0KGtleSwgdmFsdWUpIHtcblx0XHRcdFx0JHdpbmRvdy5zZXNzaW9uU3RvcmFnZVtrZXldID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuXHRcdFx0fSxcblx0XHRcdGdldE9iamVjdDogZnVuY3Rpb24gZ2V0T2JqZWN0KGtleSkge1xuXHRcdFx0XHRyZXR1cm4gSlNPTi5wYXJzZSgkd2luZG93LnNlc3Npb25TdG9yYWdlW2tleV0gfHwgJ3t9Jyk7XG5cdFx0XHR9LFxuXHRcdFx0cmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUoa2V5KSB7XG5cdFx0XHRcdGRlbGV0ZSAkd2luZG93LnNlc3Npb25TdG9yYWdlW2tleV07XG5cdFx0XHR9XG5cdFx0fTtcblx0fV0pO1xufSkoKTtcbid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29tcG9uZW50KCdib3gnLCB7XG4gICAgcmVwbGFjZTogdHJ1ZSxcbiAgICB0ZW1wbGF0ZVVybDogWydHbG9iYWwnLCBmdW5jdGlvbiAoR2xvYmFsKSB7XG4gICAgICByZXR1cm4gR2xvYmFsLmNsaWVudFBhdGggKyAnL3NoYXJlZC9jb21wb25lbnRzL2JveC5odG1sJztcbiAgICB9XSxcbiAgICB0cmFuc2NsdWRlOiB7XG4gICAgICB0b29sYmFyQnV0dG9uczogJz9ib3hUb29sYmFyQnV0dG9ucycsXG4gICAgICBmb290ZXJCdXR0b25zOiAnP2JveEZvb3RlckJ1dHRvbnMnXG4gICAgfSxcbiAgICBiaW5kaW5nczoge1xuICAgICAgYm94VGl0bGU6ICdAJyxcbiAgICAgIHRvb2xiYXJDbGFzczogJ0AnLFxuICAgICAgdG9vbGJhckJnQ29sb3I6ICdAJ1xuICAgIH0sXG4gICAgY29udHJvbGxlcjogWyckdHJhbnNjbHVkZScsIGZ1bmN0aW9uICgkdHJhbnNjbHVkZSkge1xuICAgICAgdmFyIGN0cmwgPSB0aGlzO1xuXG4gICAgICBjdHJsLnRyYW5zY2x1ZGUgPSAkdHJhbnNjbHVkZTtcblxuICAgICAgY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChjdHJsLnRvb2xiYXJCZ0NvbG9yKSkgY3RybC50b29sYmFyQmdDb2xvciA9ICdkZWZhdWx0LXByaW1hcnknO1xuICAgICAgfTtcbiAgICB9XVxuICB9KTtcbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICAvKiogQG5nSW5qZWN0ICovXG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbXBvbmVudCgnY29udGVudEJvZHknLCB7XG4gICAgcmVwbGFjZTogdHJ1ZSxcbiAgICB0cmFuc2NsdWRlOiB0cnVlLFxuICAgIHRlbXBsYXRlVXJsOiBbJ0dsb2JhbCcsIGZ1bmN0aW9uIChHbG9iYWwpIHtcbiAgICAgIHJldHVybiBHbG9iYWwuY2xpZW50UGF0aCArICcvc2hhcmVkL2NvbXBvbmVudHMvY29udGVudC1ib2R5Lmh0bWwnO1xuICAgIH1dLFxuICAgIGJpbmRpbmdzOiB7XG4gICAgICBsYXlvdXRBbGlnbjogJ0AnXG4gICAgfSxcbiAgICBjb250cm9sbGVyOiBbZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGN0cmwgPSB0aGlzO1xuXG4gICAgICBjdHJsLiRvbkluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIE1ha2UgYSBjb3B5IG9mIHRoZSBpbml0aWFsIHZhbHVlIHRvIGJlIGFibGUgdG8gcmVzZXQgaXQgbGF0ZXJcbiAgICAgICAgY3RybC5sYXlvdXRBbGlnbiA9IGFuZ3VsYXIuaXNEZWZpbmVkKGN0cmwubGF5b3V0QWxpZ24pID8gY3RybC5sYXlvdXRBbGlnbiA6ICdjZW50ZXIgc3RhcnQnO1xuICAgICAgfTtcbiAgICB9XVxuICB9KTtcbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICAvKiogQG5nSW5qZWN0ICovXG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbXBvbmVudCgnY29udGVudEhlYWRlcicsIHtcbiAgICB0ZW1wbGF0ZVVybDogWydHbG9iYWwnLCBmdW5jdGlvbiAoR2xvYmFsKSB7XG4gICAgICByZXR1cm4gR2xvYmFsLmNsaWVudFBhdGggKyAnL3NoYXJlZC9jb21wb25lbnRzL2NvbnRlbnQtaGVhZGVyLmh0bWwnO1xuICAgIH1dLFxuICAgIHJlcGxhY2U6IHRydWUsXG4gICAgYmluZGluZ3M6IHtcbiAgICAgIHRpdGxlOiAnQCcsXG4gICAgICBkZXNjcmlwdGlvbjogJ0AnXG4gICAgfVxuICB9KTtcbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdNYXBWaWV3ZXJDb250cm9sbGVyJywgTWFwVmlld2VyQ29udHJvbGxlcik7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICBmdW5jdGlvbiBNYXBWaWV3ZXJDb250cm9sbGVyKHZtLCAkc2NvcGUsIG9wdGlvbnMsICRjb250cm9sbGVyLCBNYXBTZXJ2aWNlLCBsb2Rhc2gsIEdsb2JhbCwgQzJEaWFsb2csIE1hcFR5cGVTZXJ2aWNlLCBsZWFmbGV0RGF0YSwgbGVhZmxldCwgJG1kU2lkZW5hdiwgU3VwcG9ydFNlcnZpY2UsICRyb290U2NvcGUsIE1hcExheWVyU2VydmljZSwgJHRpbWVvdXQsICR3aW5kb3csICRzdGF0ZSwgJHRyYW5zbGF0ZSwgJG1kQ29sb3JzLCBDMlRvYXN0KSB7XG5cbiAgICAvLyBGdW5jdGlvbnMgQmxvY2sgICAgXG4gICAgdm0uYWZ0ZXJTZWFyY2ggPSBhZnRlclNlYXJjaDtcbiAgICB2bS5vbkFjdGl2YXRlID0gb25BY3RpdmF0ZTtcbiAgICB2bS5hcHBseUZpbHRlcnMgPSBhcHBseUZpbHRlcnM7XG4gICAgdm0udG9nZ2xlTGVmdCA9IHRvZ2dsZUxlZnQ7XG4gICAgdm0udG9nZ2xlUmlnaHQgPSB0b2dnbGVSaWdodDtcbiAgICB2bS5zd2l0Y2hUb1ZpZXcgPSBzd2l0Y2hUb1ZpZXc7XG4gICAgdm0ucmVzZXQgPSByZXNldDtcbiAgICB2bS50b2dnbGVWaWV3ZXJzQ2VudGVyTGluayA9IHRvZ2dsZVZpZXdlcnNDZW50ZXJMaW5rO1xuICAgIHZtLmhpZGVWaWV3ZXIgPSBoaWRlVmlld2VyO1xuICAgIHZtLnNob3dCb3RoVmlld2VycyA9IHNob3dCb3RoVmlld2VycztcbiAgICB2bS50b2dnbGVXaGVlbFpvb20gPSB0b2dnbGVXaGVlbFpvb207XG4gICAgdm0udG9nZ2xlQWRkR0NQID0gdG9nZ2xlQWRkR0NQO1xuXG4gICAgLy8gU2V0IG9wdGlvbnMgYXMgY29udGV4dCB2YXJpYWJsZXNcbiAgICB2bS5zdXBwb3J0TGlzdGluZ1ZpZXcgPSBvcHRpb25zLnN1cHBvcnRMaXN0aW5nVmlldztcbiAgICB2bS5zdXBwb3J0RHJhd2luZyA9IG9wdGlvbnMuc3VwcG9ydERyYXdpbmc7XG4gICAgdm0udGl0bGVUcmFuc2xLZXkgPSBvcHRpb25zLnRpdGxlVHJhbnNsS2V5O1xuICAgIHZtLnNob3dHZW9SZWZUb29scyA9IG9wdGlvbnMuc2hvd0dlb1JlZlRvb2xzO1xuICAgIHZtLmxlZnRTaWRlQmFyID0gb3B0aW9ucy5sZWZ0U2lkZUJhcjtcbiAgICAvLyB2bS5yaWdodFNpZGVCYXIgPSBvcHRpb25zLnJpZ2h0U2lkZUJhcjtcbiAgICB2bS5zaG93R2NwVGFibGUgPSBvcHRpb25zLnNob3dHY3BUYWJsZTtcbiAgICB2bS5nY3BUYWJsZSA9IG9wdGlvbnMuZ2NwVGFibGU7XG4gICAgdm0uZGlzcGxheUJvdHRvbU5hdiA9IGZhbHNlO1xuXG4gICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQob3B0aW9ucy5yaWdodFNpZGVCYXIpKSB7XG4gICAgICB2bS5yaWdodFNpZGVCYXIgPSBHbG9iYWwuY2xpZW50UGF0aCArIFwiL3NoYXJlZC9tYXAtdmlld2VyL25hdnMvbWFwLXJpZ2h0LXNpZGVuYXYuaHRtbFwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB2bS5yaWdodFNpZGVCYXIgPSBvcHRpb25zLnJpZ2h0U2lkZUJhcjtcbiAgICB9XG5cbiAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChvcHRpb25zLmJvdHRvbU5hdikpIHtcbiAgICAgIHZtLmRpc3BsYXlCb3R0b21OYXYgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB2bS5kaXNwbGF5Qm90dG9tTmF2ID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gaW5zdGFudGlhdGUgYmFzZSBjb250cm9sbGVyXG4gICAgJGNvbnRyb2xsZXIoJ0NSVURDb250cm9sbGVyJywge1xuICAgICAgdm06IHZtLFxuICAgICAgbW9kZWxTZXJ2aWNlOiBNYXBTZXJ2aWNlLFxuICAgICAgb3B0aW9uczoge1xuICAgICAgICBzZWFyY2hPbkluaXQ6IHRydWUsXG4gICAgICAgIHBlclBhZ2U6IDdcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEV4ZWN1dGUgdGhlIGFjdGlvbiB3aGVuIHRoaXMgY29udHJvbGxlciBpcyBhY3RpdmF0ZWRcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvbkFjdGl2YXRlKCkge1xuICAgICAgLy8gY2FsbCBjaGlsZCBvbkFjdGl2YXRlIGZ1bmN0aW9uLCBpZiBpdCBleGlzdHNcbiAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24odm0uYmVmb3JlVmlld2VyQWN0aXZhdGUpKSB7XG4gICAgICAgIHZtLmJlZm9yZVZpZXdlckFjdGl2YXRlKCk7XG4gICAgICB9XG5cbiAgICAgIC8vIEluaXRpYWxseSB0aGUgYm90dG9tIG5hdiBzdGFydCByZXRyYWN0ZWRcbiAgICAgIHZtLnNob3dCb3R0b21OYXYgPSBmYWxzZTtcblxuICAgICAgLy8gR2V0IHRoZSBtYXAgdHlwZXMgZnJvbSB0aGUgc2VydmljZVxuICAgICAgTWFwVHlwZVNlcnZpY2UucGFnaW5hdGUoKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICB2bS5tYXBUeXBlcyA9IHJlc3BvbnNlLml0ZW1zO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEJ1aWxkIHRoZSBvcHRpb25zIGZvciB0aGUgZGVmYXVsdCBsYXllcnMgYnVpbGRpbmcgdGFzayAgICAgIFxuICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgIHN1cHBvcnREcmF3aW5nOiB2bS5zdXBwb3J0RHJhd2luZ1xuICAgICAgfTtcblxuICAgICAgLy8gQnVpbGQgdGhlIGJhc2UgbGF5ZXJzIGZvciBib3RoIHZpZXdlcnMgKGxlZnRNYXBWaWV3ZXIgYW5kIHJpZ2h0TWFwVmlld2VyKSAgICBcbiAgICAgIE1hcExheWVyU2VydmljZS5idWlsZERlZmF1bHRMYXllcnMob3B0aW9ucyk7XG5cbiAgICAgIC8vIGNoZWNrIGlmIGF0IHRoZSBiZWdpbm5pbmcsIGJvdGggdmlld2VycyBcbiAgICAgIC8vIHNob3VsZCBoYXZlIGRyYXcgY2FwYWJpbGl0aWVzIGFuZCAoaWYgeWVzKSBhZGRcbiAgICAgIGlmICh2bS5zdXBwb3J0RHJhd2luZyA9PT0gdHJ1ZSkge1xuICAgICAgICB2bS5yaWdodENvbnRyb2xzID0ge1xuICAgICAgICAgIGRyYXc6IHt9XG4gICAgICAgIH07XG4gICAgICAgIHZtLmxlZnRDb250cm9scyA9IHtcbiAgICAgICAgICBkcmF3OiB7fVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBJbml0aWFsIGNlbnRlciBpbiBIZWlkZWxiZXJnLCBHZXJtYW55XG4gICAgICB2bS5sZWZ0Q2VudGVyID0gTWFwTGF5ZXJTZXJ2aWNlLmdldERlZmF1bHRDZW50ZXIoKTtcblxuICAgICAgLy8gR2V0IGVhY2ggdmlld2VyIGRhdGFcbiAgICAgIHZtLmxlZnRNYXBWaWV3ZXIgPSBNYXBMYXllclNlcnZpY2UuZ2V0Vmlld2VyRGF0YSgnbGVmdE1hcFZpZXdlcicpO1xuICAgICAgdm0ucmlnaHRNYXBWaWV3ZXIgPSBNYXBMYXllclNlcnZpY2UuZ2V0Vmlld2VyRGF0YSgncmlnaHRNYXBWaWV3ZXInKTtcblxuICAgICAgLy8gQXQgdGhlIGJlZ2lubmluZywgYm90aCB2aWV3ZXJzIGFyZSB2aXNpYmxlICAgICBcbiAgICAgIHZtLnNob3dSaWdodE1hcFZpZXdlciA9IHRydWU7XG4gICAgICB2bS5zaG93TGVmdE1hcFZpZXdlciA9IHRydWU7XG5cbiAgICAgIC8vIEluaXRpYWxseSwgYm90aCBtYXBzIHNob3VsZCBoYXZlIHRoZSBzYW1lIGNlbnRlciwgbW92aW5nIHRvZ2V0aGVyICAgICAgXG4gICAgICB2bS5yaWdodENlbnRlciA9IHZtLmxlZnRDZW50ZXI7XG5cbiAgICAgIC8vIFJlZnJlc2ggdGhlIHZpZXdlcnMsIHNvIHRoZSB0aWxlcyBhcmUgbG9hZGVkL2FkanVzdGVkXG4gICAgICAvLyBhY2NvcmRpbmcgdGhlIHZpZXcgc2l6ZVxuICAgICAgcmVmcmVzaE1hcFZpZXdlcigpO1xuXG4gICAgICAvLyBJbml0aWFsbHkgdGhlIG1vdXNlIHdoZWVsIHNjcm9sbCBhcyBhIHpvb20gY29udHJvbCBzdGFydHMgZGlzYWJsZWRcbiAgICAgIC8vIHNvIHRoZSB1c2VyIGNhbiBzY3JvbGwgdGhlIHBhZ2UgZWFzaWx5XG4gICAgICB2bS5yaWdodFdoZWVsWm9vbUVuYWJsZWQgPSBmYWxzZTtcbiAgICAgIHZtLmxlZnRXaGVlbFpvb21FbmFibGVkID0gZmFsc2U7XG4gICAgICBNYXBMYXllclNlcnZpY2Uuc2V0V2hlZWxab29tU3RhdHVzKCdsZWZ0TWFwVmlld2VyJywgZmFsc2UpO1xuICAgICAgTWFwTGF5ZXJTZXJ2aWNlLnNldFdoZWVsWm9vbVN0YXR1cygncmlnaHRNYXBWaWV3ZXInLCBmYWxzZSk7XG5cbiAgICAgIC8vIGNhbGwgY2hpbGQgb25BY3RpdmF0ZSBmdW5jdGlvbiwgaWYgaXQgZXhpc3RzXG4gICAgICBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKHZtLm9uVmlld2VyQWN0aXZhdGUpKSB7XG4gICAgICAgIHZtLm9uVmlld2VyQWN0aXZhdGUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTd2l0Y2hlZCB0aGUgdmlldyBhbmQgYnJvYWRjYXN0IGFuZCBldmVudCB3aGVuIHRoZSB2aWV3IGlzIHN3aXRjaGVkXG4gICAgICovXG4gICAgZnVuY3Rpb24gc3dpdGNoVG9WaWV3KHZpZXcpIHtcbiAgICAgIHZtLmdvVG8odmlldyk7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3N3aXRjaGVkVmlldycsIHZpZXcpO1xuICAgICAgaWYgKHZpZXcgPT09ICdmb3JtJykge1xuICAgICAgICAvLyBSZWZyZXNoIHRoZSB2aWV3ZXJzLCBzbyB0aGUgdGlsZXMgYXJlIGxvYWRlZC9hZGp1c3RlZFxuICAgICAgICAvLyBhY2NvcmRpbmcgdGhlIHZpZXcgc2l6ZVxuICAgICAgICByZWZyZXNoTWFwVmlld2VyKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGlhc2JsZSBBZGQgR0NQIFBvaW50cyBidXR0b24uIFRoZSBmaXJzdCB0aW1lIHRoYXQgdGhlIHZpZXdlcnMgbG9hZCwgdGhlIGJ1dHRvbnMgc2hvdWxkIGJlIGRpc2FibGVkIGFyZSB0aGVyZSBpcyBubyBvdmVybGF5cyBvdGhlciB0aGFuIGJhc2VsYXllcnMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9nZ2xlQWRkR0NQKCkge1xuICAgICAgcmV0dXJuIE1hcExheWVyU2VydmljZS5nZXRPdmVybGF5c0NvdW50Qm9vbCgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRvZ2dsZSB0aGUgbW91c2Ugd2hlZWwgc2Nyb2xsIGFzIGEgem9vbSBjb250cm9sIGZvciBhIHZpZXdlclxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7YW55fSB2aWV3ZXJJZCBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0b2dnbGVXaGVlbFpvb20odmlld2VySWQpIHtcbiAgICAgIGlmICh2aWV3ZXJJZCA9PT0gJ3JpZ2h0TWFwVmlld2VyJykge1xuICAgICAgICB2bS5yaWdodFdoZWVsWm9vbUVuYWJsZWQgPSAhdm0ucmlnaHRXaGVlbFpvb21FbmFibGVkO1xuICAgICAgICBNYXBMYXllclNlcnZpY2Uuc2V0V2hlZWxab29tU3RhdHVzKHZpZXdlcklkLCB2bS5yaWdodFdoZWVsWm9vbUVuYWJsZWQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdm0ubGVmdFdoZWVsWm9vbUVuYWJsZWQgPSAhdm0ubGVmdFdoZWVsWm9vbUVuYWJsZWQ7XG4gICAgICAgIE1hcExheWVyU2VydmljZS5zZXRXaGVlbFpvb21TdGF0dXModmlld2VySWQsIHZtLmxlZnRXaGVlbFpvb21FbmFibGVkKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWZyZXNoIHRoZSBtYXAgb24gdGhlIHZpZXdlci4gXG4gICAgICogVXNlZnVsIHdoZW4gdGhlIHZpZXdlciBpcyByZXNpemVkIG9yIHN3aXRjaGVkIGZyb20gb25lL3R3byB2aWV3ZXJzXG4gICAgICogXG4gICAgICogQHJldHVybiB2b2lkIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlZnJlc2hNYXBWaWV3ZXIoKSB7XG4gICAgICAvLyBUaGlzIGlzIGEgaGFjayB0byBmb3JjZSBsZWFmbGV0IHJlZHJhdy9yZXNpemUgY29ycmVjdGx5IHRoZSBtYXBzXG4gICAgICAvLyBpbiB0aGUgY2FzZSB3aGVuIHRoZXJlIGFyZSB0d28gbWFwIHZpZXdlcnMgYW5kIHRoZSBjb250YWluZXIgb2Ygb25lIG9mIHRoZW0gXG4gICAgICAvLyBpcyByZXNpemVkLiBcbiAgICAgIC8vIFRoZSBjYW5kaWRhdGVzIG1hcC5pbnZhbGlkYXRlU2l6ZSgpIGFuZCBtYXAuZWFjaExheWVyKGZ1bmN0aW9uKGxheWVyKXtsYXllci5yZWRyYXcoKTt9KTtcbiAgICAgIC8vIGhhdmUgbm90IHdvcmtlZCBhdCBhbGwgb24gdGhpcyBjYXNlXG4gICAgICAvLyBAc2VlICBodHRwczovL2dpdGh1Yi5jb20vTGVhZmxldC9MZWFmbGV0L2lzc3Vlcy82OTRcbiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gV2UgbWFudWFsbHkgZmlyZSB0aGUgYnJvd3NlciByZXNpemUgZXZlbnQgaW5zaWRlIGFcbiAgICAgICAgLy8gdGltZW91dCBmdW5jdGlvbiB3aXRoIGEgZGVsYXkgb2YgMSB0ZW50aCBvZiBzZWNvbmRcbiAgICAgICAgLy8gRm9yIHNvbWUgcmVhc29uLCB3aGVuIHRoaXMgZXZlbnQgb2NjdXJzLCBsZWFmbGV0XG4gICAgICAgIC8vIGlzIGFibGUgdG8gcmVzaXplL3JlZHJhdyB0aGUgdGlsZXMgY29ycmVjdGx5XG4gICAgICAgICR3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ3Jlc2l6ZScpKTtcbiAgICAgIH0sIDEwMCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGlkZSBhIHZpZXdlclxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7YW55fSB2aWV3ZXJJZCBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBoaWRlVmlld2VyKHZpZXdlcklkKSB7XG4gICAgICBpZiAodmlld2VySWQgPT09ICdsZWZ0TWFwVmlld2VyJykge1xuICAgICAgICB2bS5zaG93TGVmdE1hcFZpZXdlciA9IGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdm0uc2hvd1JpZ2h0TWFwVmlld2VyID0gZmFsc2U7XG4gICAgICB9XG4gICAgICAvLyBUZWxscyB0aGUgc2VydmljZSB0aGF0IGEgdmlld2VyIGlzIG5vdyBoaWRkZW5cbiAgICAgIC8vIEludGVybmFsbHkgdGhlIHNlcnZpY2UgcHJvcGFnYXRlIHRoaXMgc28gb3RoZXIgY29udHJvbGxlcnMvc2VydmljZXNcbiAgICAgIC8vIGNhbiBsaXN0ZW4gdG8gdGhpcyBldmVudCBhbmQgYXBwbHkgY2hhbmdlc1xuICAgICAgTWFwTGF5ZXJTZXJ2aWNlLmhpZGVWaWV3ZXIodmlld2VySWQpO1xuXG4gICAgICAvLyBBcyB0aGVyZSBpcyBvbmx5IG9uZSB2aWV3ZXIsIGl0IG11c3QgaGF2ZSB1c2VkIHRoZSBmdWxsIHNwYWNlXG4gICAgICB2bS52aWV3ZXJXaWR0aCA9IDEwMDtcblxuICAgICAgLy8gVGhpcyBhdHRyaWJ1dGUgaXMgdXNlZCB0byBkZXRlcm1pbmUgaWYgdGhlIHZpZXdlciBzcGxpdCBidXR0b24gbXVzdCBiZSBzaG93blxuICAgICAgdm0uYm90aFZpZXdlcnNWaXNpYmxlID0gZmFsc2U7XG5cbiAgICAgIC8vIFJlZnJlc2ggdGhlIHZpZXdlcnMsIHNvIHRoZSB0aWxlcyBhcmUgbG9hZGVkL2FkanVzdGVkXG4gICAgICAvLyBhY2NvcmRpbmcgdG8gdGhlIHZpZXcgc2l6ZVxuICAgICAgcmVmcmVzaE1hcFZpZXdlcigpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNob3cgYm90aCB0aGUgdmlld2VycywgcmVzaXplIGJvdGggdG8gNTAlXG4gICAgICogYW5kIHJlZnJlc2ggdGhlIHZpZXdlcnMgKHJlbG9hZCB0aGUgdGlsZXMpXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2hvd0JvdGhWaWV3ZXJzKCkge1xuICAgICAgLy8gQXMgdGhlcmUgYXJlIHR3byB2aWV3ZXJzLCBlYWNoIG9uZSBtdXN0IGhhdmUgaGFsZiBzcGFjZVxuICAgICAgdm0udmlld2VyV2lkdGggPSA1MDtcblxuICAgICAgLy8gaWYgdGhlIHJpZ2h0IHZpZXdlciBpcyBoaWRkZW4sIHNob3cgaXRcbiAgICAgIGlmICh2bS5zaG93UmlnaHRNYXBWaWV3ZXIgPT09IGZhbHNlKSB7XG4gICAgICAgIHZtLnNob3dSaWdodE1hcFZpZXdlciA9IHRydWU7XG5cbiAgICAgICAgLy8gVGVsbHMgdGhlIHRoZSBzZXJ2aWNlIHRoYXQgYSB2aWV3ZXIgaXMgbm93IHNob3duXG4gICAgICAgIC8vIEludGVybmFsbHkgdGhlIHNlcnZpY2UgcHJvcGFnYXRlIHRoaXMgc28gb3RoZXIgY29udHJvbGxlcnMvc2VydmljZXNcbiAgICAgICAgLy8gY2FuIGxpc3RlbiB0byB0aGlzIGV2ZW50IGFuZCBhcHBseSBjaGFuZ2VzXG4gICAgICAgIE1hcExheWVyU2VydmljZS5zaG93Vmlld2VyKCdyaWdodE1hcFZpZXdlcicpO1xuICAgICAgfVxuXG4gICAgICAvLyBpZiB0aGUgbGVmdCB2aWV3ZXIgaXMgaGlkZGVuLCBzaG93IGl0XG4gICAgICBpZiAodm0uc2hvd0xlZnRNYXBWaWV3ZXIgPT09IGZhbHNlKSB7XG4gICAgICAgIHZtLnNob3dMZWZ0TWFwVmlld2VyID0gdHJ1ZTtcblxuICAgICAgICAvLyBUZWxscyB0aGUgdGhlIHNlcnZpY2UgdGhhdCBhIHZpZXdlciBpcyBub3cgc2hvd25cbiAgICAgICAgLy8gSW50ZXJuYWxseSB0aGUgc2VydmljZSBwcm9wYWdhdGUgdGhpcyBhbmQgb3RoZXIgY29udHJvbGxlcnMvc2VydmljZXNcbiAgICAgICAgLy8gY2FuIGxpc3RlbiB0byB0aGlzIGV2ZW50IGFuZCBhcHBseSBjaGFuZ2VzXG4gICAgICAgIE1hcExheWVyU2VydmljZS5zaG93Vmlld2VyKCdsZWZ0TWFwVmlld2VyJyk7XG4gICAgICB9XG4gICAgICAvLyBUaGlzIGF0dHJpYnV0ZSBpcyB1c2VkIHRvIGRldGVybWluZSBpZiB0aGUgdmlld2VyIHNwbGl0IGJ1dHRvbiBtdXN0IGJlIHNob3duXG4gICAgICB2bS5ib3RoVmlld2Vyc1Zpc2libGUgPSB0cnVlO1xuXG4gICAgICAvLyBBZnRlciB0aGUgY2hhbmdlcyB3ZSByZWZyZXNoIHRoZSB2aWV3ZXJzLCB0byB0aGUgdGlsZXMgYXJlIGFkanVzdGVkXG4gICAgICByZWZyZXNoTWFwVmlld2VyKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTGluayBvciB1bmxpbmsgdGhlIGNlbnRlciBvZiBib3RoIHZpZXdlcnNcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbWFzdGVyVmlld2VyIC0gdGhlIHZpZXdlciBmcm9tIHdoaWNoIHRoZSBjZW50ZXIgd2lsbCBiZSB1c2VkIHRvIGNlbnRyYWxpemVkIGl0c2VsZlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHRvZ2dsZVZpZXdlcnNDZW50ZXJMaW5rKG1hc3RlclZpZXdlcikge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gbWFwLXZpZXdlci5jb250cm9sbGVyID4+PiB0b2dnbGVWaWV3ZXJzQ2VudGVyTGluayA+Pj4gXCIsIG1hc3RlclZpZXdlcik7XG4gICAgICAvLyBpZiBsb2FkZWQgdW5nZW9yZWZlcmVuY2VkIGZpbGUgdGhlbiBjYW4ndCBsaW5rIHRoZSBtYXBzXG4gICAgICAvLyBpZiB0aGUgdmlld2VycycgY2VudGVyIGFyZSBsaW5rZWQsIHVubGluayB0aGVuXG4gICAgICAvLyBidXQga2VlcCB0aGVtIHdpdGggdGhlIHNhbWUgY2VudGVyXG4gICAgICBpZiAodm0ucmlnaHRDZW50ZXIgPT0gdm0ubGVmdENlbnRlcikge1xuICAgICAgICB2bS5yaWdodENlbnRlciA9IGFuZ3VsYXIuY29weSh2bS5sZWZ0Q2VudGVyKTtcbiAgICAgIH1cbiAgICAgIC8vIGlmIHRoZSB2aWV3ZXJzJyBjZW50ZXIgYXJlIG5vdCBsaW5rZWQsIGxpbmtcbiAgICAgIC8vIHRoZW0sIG1vdmluZyB0aGUgc2xhdmUgdmlld2VyJ3MgY2VudGVyIHRvIHRoZSBjZW50ZXIgb2ZcbiAgICAgIC8vIHRoZSAnbWFzdGVyIHZpZXdlcicgY2VudGVyIHBhc3NlZCBhcyBwYXJhbWV0ZXJcbiAgICAgIGVsc2Uge1xuICAgICAgICAgIGlmICghTWFwTGF5ZXJTZXJ2aWNlLmhhc05vbkdlb3JlZmVyZW5jZWRMYXllcignbGVmdE1hcFZpZXdlcicpKSB7XG4gICAgICAgICAgICBpZiAobWFzdGVyVmlld2VyID09PSAnbGVmdE1hcFZpZXdlcicpIHtcbiAgICAgICAgICAgICAgdm0ucmlnaHRDZW50ZXIgPSB2bS5sZWZ0Q2VudGVyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdm0ubGVmdENlbnRlciA9IHZtLnJpZ2h0Q2VudGVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcImNhbid0IGxvYWQgcmlnaHQgbWFwIHNpbmNlIHJpZ2h0IHNpZGUgaXMgdW5nZW9yZWZlcm5jZWRcIilcbiAgICAgICAgICAgIEMyVG9hc3QuaW5mbygkdHJhbnNsYXRlLmluc3RhbnQoJ2RpYWxvZy5jYW50TG9hZERlc2NyaXB0aW9uJykpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExpc3RlbiB0byB0aGUgZXZlbnQgdGhhdCB0ZWxscyB1cyB0aGF0IGFuIHVuZ2VvcmVmZXJlbmNlZCBtYXAgd2lsbCBiZSBsb2FkZWRcbiAgICAgKiBhbmQgdW5saW5rIHRoZSB2aWV3ZXJzJyBjZW50ZXIuIFRoaXMgZXZlbnQgb2NjdXJzIGJlZm9yZSB0aGUgbWFwIGlzIGxvYWRlZFxuICAgICAqIGFuZCByZWNlaXZlIHRoZSB2aWV3ZXIgaWQgd2hlcmUgdGhlIHVuZ2VvcmVmZXJlbmNlZCBtYW8gd2lsbCBiZSBsb2FkZWRcbiAgICAgKi9cbiAgICAkcm9vdFNjb3BlLiRvbigndW5nZW9yZWZlcmVuY2VkTGF5ZXJUb0JlTG9hZGVkJywgZnVuY3Rpb24gKGV2ZW50LCB2aWV3ZXJJZCkge1xuICAgICAgLy8gdGhlIHRvZ2dsZSBmdW5jdGlvbiB1bmxpbmsgb24gdmlld2VyJ3MgY2VudGVyICAgICAgIFxuICAgICAgaWYgKHZtLnJpZ2h0Q2VudGVyID09IHZtLmxlZnRDZW50ZXIpIHtcbiAgICAgICAgdG9nZ2xlVmlld2Vyc0NlbnRlckxpbmsodmlld2VySWQpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogTGlzdGVuIHRvIHRoZSBldmVudCB0aGF0IHRlbGxzIHVzIHRoYXQgYW4gZ2VvcmVmZXJlbmNlZCBtYXAgd2lsbCBiZSBsb2FkZWRcbiAgICAgKiBhbmQgbGluayB0aGUgdmlld2VycycgY2VudGVyLiBUaGlzIGV2ZW50IG9jY3VycyBiZWZvcmUgdGhlIG1hcCBpcyBsb2FkZWRcbiAgICAgKiBhbmQgcmVjZWl2ZSB0aGUgdmlld2VyIGlkIHdoZXJlIHRoZSBnZW9yZWZlcmVuY2VkIG1hbyB3aWxsIGJlIGxvYWRlZFxuICAgICAqL1xuICAgICRyb290U2NvcGUuJG9uKCdnZW9yZWZlcmVuY2VkTGF5ZXJUb0JlTG9hZGVkJywgZnVuY3Rpb24gKGV2ZW50LCB2aWV3ZXJJZCkge1xuICAgICAgLy8gdGhlIHRvZ2dsZSBmdW5jdGlvbiB1bmxpbmsgb24gdmlld2VyJ3MgY2VudGVyICAgICAgIFxuICAgICAgaWYgKHZtLnJpZ2h0Q2VudGVyICE9IHZtLmxlZnRDZW50ZXIpIHtcbiAgICAgICAgdG9nZ2xlVmlld2Vyc0NlbnRlckxpbmsodmlld2VySWQpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogTWFrZSBzb21lIGFkanVzdG1lbnRzIGluIHRoZSByZXNvdXJjZXMgbGlzdCBhZnRlciBsb2FkaW5nIHRoZW1cbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gcmVzcG9uc2UgXG4gICAgICovXG4gICAgZnVuY3Rpb24gYWZ0ZXJTZWFyY2gocmVzcG9uc2UpIHtcbiAgICAgIGxvZGFzaC5tYXAodm0ucmVzb3VyY2VzLCBmdW5jdGlvbiAobWFwKSB7XG4gICAgICAgIG1hcC5tYXBJbWFnZUZpbGUgPSBtYXAubWFwX2ltYWdlX2ZpbGU7XG4gICAgICAgIG1hcC5tYXBUeXBlTmFtZSA9IG1hcC5tYXBfdHlwZV9uYW1lO1xuICAgICAgICBtYXAubWFwR2VvRmlsZSA9IG1hcC5maWVsZF9tYXBfZ2VvZmlsZTtcbiAgICAgICAgcmV0dXJuIG1hcDtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhlcmUgd2UgbGlzdGVuIHRvIHRoZSBhcHBseUZpbHRlcnMgY2FsbGJhY2sgdG8gYWRkIGN1c3RvbSBmaWx0ZXJzXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IGRlZmF1bHRRdWVyeUZpbHRlcnMgXG4gICAgICogQHJldHVybnMge31cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhcHBseUZpbHRlcnMoZGVmYXVsdFF1ZXJ5RmlsdGVycykge1xuICAgICAgdmFyIGZpbHRlcnMgPSB7fTtcbiAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZCh2bS5xdWVyeUZpbHRlcnMpKSB7XG4gICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZCh2bS5xdWVyeUZpbHRlcnMubWFwVHlwZSkpIHtcbiAgICAgICAgICBmaWx0ZXJzLmZpZWxkX21hcF90eXBlID0gYW5ndWxhci5jb3B5KHZtLnF1ZXJ5RmlsdGVycy5tYXBUeXBlLmlkKTtcbiAgICAgICAgfVxuICAgICAgICBmaWx0ZXJzLnRpdGxlID0gdm0ucXVlcnlGaWx0ZXJzLnRpdGxlO1xuICAgICAgICBpZiAodm0ucXVlcnlGaWx0ZXJzLmdlb3JlZmVyZW5jZWQgIT09ICdBbGwnKSB7XG4gICAgICAgICAgZmlsdGVycy5nZW9yZWZlcmVuY2VkID0gdm0ucXVlcnlGaWx0ZXJzLmdlb3JlZmVyZW5jZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZtLnF1ZXJ5RmlsdGVycy52ZXJpZmllZCAhPT0gJ0FsbCcpIHtcbiAgICAgICAgICBmaWx0ZXJzLnZlcmlmaWVkID0gdm0ucXVlcnlGaWx0ZXJzLnZlcmlmaWVkO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBhbmd1bGFyLmV4dGVuZChkZWZhdWx0UXVlcnlGaWx0ZXJzLCBmaWx0ZXJzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXNldCB0aGUgc2VhcmNoIHN0YXRlIGFuZCByZWxvYWQgaXRlbXNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZXNldCgpIHtcbiAgICAgIHZtLnF1ZXJ5RmlsdGVycyA9IHt9O1xuICAgICAgdm0uc2VhcmNoKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT3Blbi9jbG9zZSB0aGUgbGVmdCBzaWRlIG5hdlxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHRvZ2dsZUxlZnQoKSB7XG4gICAgICAkbWRTaWRlbmF2KCdsZWZ0JykudG9nZ2xlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT3Blbi9jbG9zZSB0aGUgcmlnaHQgc2lkZSBuYXZcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0b2dnbGVSaWdodCgpIHtcbiAgICAgICRtZFNpZGVuYXYoJ3JpZ2h0JykudG9nZ2xlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gZGVsZXRlR0NQKGdjcElkKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIj4+PiBtYS12aWV3ZXIuY29udHJvbGxlciA+Pj4gZGVsZXRlR0NQIFwiLCBnY3BJZCk7XG4gICAgfVxuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4vKmVzbGludC1lbnYgZXM2Ki9cblxuKGZ1bmN0aW9uICgpIHtcblxuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmNvbnRyb2xsZXIoJ01lbnVDb250cm9sbGVyJywgTWVudUNvbnRyb2xsZXIpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgZnVuY3Rpb24gTWVudUNvbnRyb2xsZXIoJG1kU2lkZW5hdiwgJHN0YXRlLCAkbWRDb2xvcnMsICRyb290U2NvcGUpIHtcbiAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgLy9CbG9jbyBkZSBkZWNsYXJhY29lcyBkZSBmdW5jb2VzXG4gICAgdm0ub3BlbiA9IG9wZW47XG4gICAgdm0ub3Blbk1lbnVPclJlZGlyZWN0VG9TdGF0ZSA9IG9wZW5NZW51T3JSZWRpcmVjdFRvU3RhdGU7XG5cbiAgICAvLyBhZGRlZCB0byBtYWtlIHRoZSBtZW51IGhpZ2hsaWdodGVkXG4gICAgdm0uY3VycmVudE5hdkl0ZW0gPSAkc3RhdGUuY3VycmVudC5uYW1lO1xuICAgIC8vIHJvb3Qgc3RhdGUgY2hhbmdlIHdhdGNoZXIgdG8gaGlnaGxpZ2h0IHRoZSB0YWIgb24gZWFjaCBzdGF0ZSBjaGFuZ2VcbiAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwic3RhdGUgY2hhbmdlZCBmcm9tIC0gXCIsIGZyb21TdGF0ZSwgXCIgdG8gLSBcIiwgdG9TdGF0ZSk7XG4gICAgICB2bS5jdXJyZW50TmF2SXRlbSA9IHRvU3RhdGUubmFtZTtcbiAgICB9KTtcbiAgICBhY3RpdmF0ZSgpO1xuXG4gICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG4gICAgICAvLyBBcnJheSBjb250ZW5kbyBvcyBpdGVucyBxdWUgc8OjbyBtb3N0cmFkb3Mgbm8gbWVudSBsYXRlcmFsXG4gICAgICB2bS5pdGVuc01lbnUgPSBbXTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvcGVuKCkge31cblxuICAgIC8qKlxyXG4gICAgICogTcOpdG9kbyBxdWUgZXhpYmUgbyBzdWIgbWVudSBkb3MgaXRlbnMgZG8gbWVudSBsYXRlcmFsIGNhc28gdGVuaGEgc3ViIGl0ZW5zXHJcbiAgICAgKiBjYXNvIGNvbnRyw6FyaW8gcmVkaXJlY2lvbmEgcGFyYSBvIHN0YXRlIHBhc3NhZG8gY29tbyBwYXLDom1ldHJvXHJcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvcGVuTWVudU9yUmVkaXJlY3RUb1N0YXRlKCRtZE1lbnUsIGV2LCBpdGVtKSB7XG4gICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQoaXRlbS5zdWJJdGVucykgJiYgaXRlbS5zdWJJdGVucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICRtZE1lbnUub3Blbihldik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkc3RhdGUuZ28oaXRlbS5zdGF0ZSk7XG4gICAgICAgICRtZFNpZGVuYXYoJ2xlZnQnKS5jbG9zZSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldENvbG9yKGNvbG9yUGFsZXR0ZXMpIHtcbiAgICAgIHJldHVybiAkbWRDb2xvcnMuZ2V0VGhlbWVDb2xvcihjb2xvclBhbGV0dGVzKTtcbiAgICB9XG4gIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdWZWN0b3JMYXllckNvbnRyb2xsZXInLCBWZWN0b3JMYXllckNvbnRyb2xsZXIpO1xuXG4gIGZ1bmN0aW9uIFZlY3RvckxheWVyQ29udHJvbGxlcigkc3RhdGUsIFZlY3RvclNlcnZpY2UsIGxvZGFzaCwgQzJEaWFsb2csIEMyVG9hc3QsICR0cmFuc2xhdGUsIG1hcERpYWxvZ0lucHV0KSB7XG5cbiAgICB2YXIgdm0gPSB0aGlzO1xuICAgIHZtLnNhdmUgPSBzYXZlO1xuICAgIHZtLmNsb3NlID0gY2xvc2U7XG4gICAgdm0ubW9kZSA9IG51bGw7XG5cbiAgICB2bS52aWV3VGl0bGUgPSBcIkFkZCBMYXllclwiO1xuICAgIHZtLnJlc291cmNlID0ge1xuICAgICAgdGl0bGU6IG51bGwsXG4gICAgICBkZXNjcmlwdGlvbjogbnVsbCxcbiAgICAgIC8vIGxheWVyTmFtZTogXCJ2ZXJ0ZXhfcHJval9pZF9wcm9qZWN0SWQxX2xheWVyX2lkX2xheWVySWRfbGF0ZXN0XCIsXG4gICAgICBwcm9qX2lkOiBudWxsLFxuICAgICAgdXNlcl9pZDogbnVsbCxcbiAgICAgIGxheWVyTmFtZTogbnVsbCxcbiAgICAgIGxheWVySWQ6IG51bGxcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IFZlY3RvckxheWVyQ29udHJvbGxlciA+Pj4gaW5pdCBcIik7XG4gICAgICBkZWZpbmVWaWV3U3RhdGUoKTtcbiAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZChtYXBEaWFsb2dJbnB1dC5tb2RlbCkpIHtcbiAgICAgICAgdm0ucmVzb3VyY2UudGl0bGUgPSBtYXBEaWFsb2dJbnB1dC5tb2RlbC50aXRsZTtcbiAgICAgICAgdm0ucmVzb3VyY2UuZGVzY3JpcHRpb24gPSBtYXBEaWFsb2dJbnB1dC5tb2RlbC5kZXNjO1xuICAgICAgICB2bS5yZXNvdXJjZS5sYXllck5hbWUgPSBtYXBEaWFsb2dJbnB1dC5tb2RlbC5sYXllck5hbWU7XG4gICAgICAgIHZtLnJlc291cmNlLmxheWVySWQgPSBtYXBEaWFsb2dJbnB1dC5tb2RlbC5sYXllcklkO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcImluaXQgLi4uLi4uIFwiLCB2bS5yZXNvdXJjZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2F2ZSgpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IFZlY3RvckxheWVyQ29udHJvbGxlciA+Pj4gc2F2ZSBcIiwgdm0ucmVzb3VyY2UpO1xuICAgICAgdmFyIHZlY3RvclNlcnZpY2UgPSBuZXcgVmVjdG9yU2VydmljZSgpO1xuICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKHZtLm1vZGUsIFwiYWRkXCIpKSB7XG4gICAgICAgIGlmICghbG9kYXNoLmlzRW1wdHkoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInByb2pJZFwiKSkpIHtcbiAgICAgICAgICB2bS5yZXNvdXJjZS5wcm9qX2lkID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInByb2pJZFwiKTtcbiAgICAgICAgICB2bS5yZXNvdXJjZS51c2VyX2lkID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInVzZXJJZFwiKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcmVxUGFyYW0gPSB7XG4gICAgICAgICAgXCJhY3Rpb25cIjogXCJjcmVhdGVMYXllcnNcIixcbiAgICAgICAgICBcImRhdGFcIjogW11cbiAgICAgICAgfTtcbiAgICAgICAgcmVxUGFyYW0uZGF0YS5wdXNoKHZtLnJlc291cmNlKTtcbiAgICAgICAgdmVjdG9yU2VydmljZS5jcmVhdGVWZWN0b3JMYXllcnMocmVxUGFyYW0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coXCJyZXNwb25zZSBcIiwgcmVzcG9uc2UpO1xuICAgICAgICAgIGlmIChyZXNwb25zZSA9PT0gXCJzdWNjZXNzXCIpIHtcbiAgICAgICAgICAgIEMyVG9hc3Quc3VjY2VzcygkdHJhbnNsYXRlLmluc3RhbnQoJ21lc3NhZ2VzLnNhdmVTdWNjZXNzJykpO1xuICAgICAgICAgICAgY2xvc2UoKTtcbiAgICAgICAgICAgIC8vICRzdGF0ZS5yZWxvYWQoKTtcbiAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBDMlRvYXN0LmVycm9yKCR0cmFuc2xhdGUuaW5zdGFudCgnbWVzc2FnZXMuc2F2ZUVycm9yJykpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmIChhbmd1bGFyLmVxdWFscyh2bS5tb2RlLCBcImVkaXRcIikpIHtcbiAgICAgICAgaWYgKCFsb2Rhc2guaXNFbXB0eShzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicHJvaklkXCIpKSkge1xuICAgICAgICAgIHZtLnJlc291cmNlLnByb2pfaWQgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicHJvaklkXCIpO1xuICAgICAgICAgIHZtLnJlc291cmNlLnVzZXJfaWQgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwidXNlcklkXCIpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZWRpdCBzYXZpbmcuLi4uLi4gXCIsIHZtLnJlc291cmNlKTtcbiAgICAgICAgdmFyIHJlcVBhcmFtID0ge1xuICAgICAgICAgIFwiYWN0aW9uXCI6IFwiZWRpdExheWVyc1wiLFxuICAgICAgICAgIFwiZGF0YVwiOiBbe1xuICAgICAgICAgICAgXCJ0aXRsZVwiOiB2bS5yZXNvdXJjZS50aXRsZSxcbiAgICAgICAgICAgIFwiZGVzY3JpcHRpb25cIjogdm0ucmVzb3VyY2UuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICBcImxheWVyX2lkXCI6IHZtLnJlc291cmNlLmxheWVySWQsXG4gICAgICAgICAgICBcInVzZXJfaWRcIjogdm0ucmVzb3VyY2UudXNlcl9pZCxcbiAgICAgICAgICAgIFwicHJval9pZFwiOiB2bS5yZXNvdXJjZS5wcm9qX2lkXG4gICAgICAgICAgfV1cbiAgICAgICAgfTtcbiAgICAgICAgLy8gcmVxUGFyYW0uZGF0YS5wdXNoKHZtLnJlc291cmNlKTtcbiAgICAgICAgdmVjdG9yU2VydmljZS5lZGl0VmVjdG9yTGF5ZXJzKHJlcVBhcmFtKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwicmVzcG9uc2UgXCIsIHJlc3BvbnNlKTtcbiAgICAgICAgICBpZiAocmVzcG9uc2UgPT09IFwic3VjY2Vzc1wiKSB7XG4gICAgICAgICAgICBDMlRvYXN0LnN1Y2Nlc3MoJHRyYW5zbGF0ZS5pbnN0YW50KCdtZXNzYWdlcy5zYXZlU3VjY2VzcycpKTtcbiAgICAgICAgICAgIGNsb3NlKCk7XG4gICAgICAgICAgICAkc3RhdGUucmVsb2FkKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIEMyVG9hc3QuZXJyb3IoJHRyYW5zbGF0ZS5pbnN0YW50KCdtZXNzYWdlcy5zYXZlRXJyb3InKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVmaW5lIHRoZSBkaWFsb2cgdmlldyBzdGF0ZSBhcyBhZGQgb3IgZWRpdCBcbiAgICAgKiBhbmQgcGFyc2UgdGhlIHZpZXcgdGl0bGVcbiAgICAgKiBcbiAgICAgKiBAcmV0dXJuIHZvaWRcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkZWZpbmVWaWV3U3RhdGUoKSB7XG4gICAgICB2bS5tb2RlID0gYW5ndWxhci5pc0RlZmluZWQobWFwRGlhbG9nSW5wdXQubW9kZWwpID8gJ2VkaXQnIDogJ2FkZCc7XG4gICAgICBpZiAodm0ubW9kZSA9PSAnYWRkJykge1xuICAgICAgICB2bS52aWV3VGl0bGUgPSAkdHJhbnNsYXRlLmluc3RhbnQoJ3ZpZXdzLnRpdGxlcy5hZGRMYXllcicpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdm0udmlld1RpdGxlID0gJHRyYW5zbGF0ZS5pbnN0YW50KCd2aWV3cy50aXRsZXMuZWRpdExheWVyJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xvc2UgdGhlIGRpYWxvZ1xuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNsb3NlKCkge1xuICAgICAgQzJEaWFsb2cuY2xvc2UoKTtcbiAgICB9XG5cbiAgICBpbml0KCk7XG4gIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdWZWN0b3JMZWZ0U2lkZW5hdkNvbnRyb2xsZXInLCBWZWN0b3JMZWZ0U2lkZW5hdkNvbnRyb2xsZXIpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgZnVuY3Rpb24gVmVjdG9yTGVmdFNpZGVuYXZDb250cm9sbGVyKEdsb2JhbCwgJG1kU2lkZW5hdiwgJG1kRGlhbG9nLCAkd2luZG93LCBsb2Rhc2gsICRyb290U2NvcGUsIEMyRGlhbG9nLCBDMlRvYXN0LCAkdHJhbnNsYXRlLCAkc3RhdGUsIGxlYWZsZXQsIGxlYWZsZXREYXRhLCAkc2Vzc2lvblN0b3JhZ2UsIFZlY3RvclNlcnZpY2UpIHtcbiAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgdm0ubGF5ZXJDbGlja2VkID0gbGF5ZXJDbGlja2VkO1xuICAgIHZtLmFjdGl2YXRlRmVhdHVyZUVkaXQgPSBhY3RpdmF0ZUZlYXR1cmVFZGl0O1xuICAgIHZtLmRlbGV0ZUxheWVyID0gZGVsZXRlTGF5ZXI7XG4gICAgdm0ub3BlbkF0dHJpYnV0ZVBvcFVwID0gb3BlbkF0dHJpYnV0ZVBvcFVwO1xuICAgIHZtLmxheWVyVmlzaWJpbGl0eSA9IGxheWVyVmlzaWJpbGl0eTtcbiAgICB2bS5jcmVhdGVMYXllciA9IGNyZWF0ZUxheWVyO1xuICAgIHZtLnNhdmUgPSBzYXZlO1xuICAgIHZtLnRvZ2dsZUxlZnQgPSB0b2dnbGVMZWZ0O1xuICAgIHZtLmV4cG9ydExheWVyID0gZXhwb3J0TGF5ZXI7XG4gICAgdm0udXNlckFsbG93ID0gdXNlckFsbG93O1xuICAgIHZtLmRyYXdDb250cm9sID0gbnVsbDsgLy8gdG9vbGJhciBjb250cm9sXG4gICAgdm0uZHJhd25JdGVtcyA9IG51bGw7XG4gICAgdm0ubGF5ZXJzID0gW107XG4gICAgdm0ubGVhZmxldExheWVycyA9IFtdO1xuICAgIHZtLmN1cnJlbnRseUVkaXRpbmdMYXllciA9IG51bGw7XG4gICAgdm0uZWRpdE1vZGUgPSBudWxsO1xuXG4gICAgLy8gQ2FsbGVkIGZyb20gcmlnaHQgc2lkZSBuYXYgZm9yIGFkZGluZyBuZXdseSBjcmVhdGVkIGZlYXR1cmUgdG8gbGVhZmxldCBsYXllclxuICAgICRyb290U2NvcGUuJG9uKCdhZGRGZWF0dXJlVG9MYXllcicsIGZ1bmN0aW9uIChldmVudCwgYXJncykge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gVmVjdG9yTGVmdFNpZGVuYXZDb250cm9sbGVyID4+PiBhZGRGZWF0dXJlVG9MYXllciBcIiwgYXJncyk7XG4gICAgICAvLyBsZWFmbGV0Lmdlb0pTT04oYXJncywge30pLmFkZFRvKHZtLmRyYXduSXRlbXMpO1xuICAgICAgdm0uZHJhd25JdGVtcy5hZGRMYXllcihhcmdzKTtcbiAgICAgIGxlYWZsZXREYXRhLmdldE1hcCgnbGVmdE1hcFZpZXdlcicpLnRoZW4oZnVuY3Rpb24gKG1hcCkge1xuICAgICAgICB2bS5kcmF3bkl0ZW1zLmFkZFRvKG1hcCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEZpcnN0IGZ1bmN0aW9uIGNhbGxlZCBhZnRlciB0aGUgY29udHJvbGxlciBpcyByYW5cbiAgICAgKiBoZXJlIHRoZSBzdHVmZiBhcmUgaW5pdGlhbGl6ZWRcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IGdlLmxlZnQuc2lkZW5hdi5jb250cm9sbGVyID4+PiBhY3RpdmF0ZSBcIik7XG4gICAgICBpZiAoIWxvZGFzaC5pc0VtcHR5KCRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJwcm9qSWRcIikudG9TdHJpbmcoKSkpIHtcbiAgICAgICAgdmFyIHByb2pJZCA9ICRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJwcm9qSWRcIikudG9TdHJpbmcoKTtcbiAgICAgICAgdmFyIGxheWVyU2VydmljZSA9IG5ldyBWZWN0b3JTZXJ2aWNlKCk7XG4gICAgICAgIHZhciByZXFQYXJhbURhdGEgPSB7XG4gICAgICAgICAgcHJval9pZDogcHJvaklkLFxuICAgICAgICAgIHVzZXJfaWQ6ICRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJ1c2VySWRcIikudG9TdHJpbmcoKSxcbiAgICAgICAgICBmZXRjaDogJ2FsbExheWVycydcbiAgICAgICAgfTtcbiAgICAgICAgbGF5ZXJTZXJ2aWNlLmdldFZlY3RvckxheWVycyhyZXFQYXJhbURhdGEpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgIGxvZGFzaC5mb3JFYWNoKHJlc3VsdCwgZnVuY3Rpb24gKGxheWVyKSB7XG4gICAgICAgICAgICBsYXllci5sYXllck5hbWUgPSBcInZlcnRleF9wcm9qX2lkX1wiICsgcHJvaklkICsgXCJfbGF5ZXJfaWRfXCIgKyBsYXllci5sYXllcl9pZCArIFwiX2xhdGVzdFwiO1xuICAgICAgICAgICAgLy8gbG9hZCBXRlMgbGF5ZXJzIGZyb20gR2Vvc2VydmVyXG4gICAgICAgICAgICBsb2FkV0ZTTGF5ZXJzKGxheWVyKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBoYW5kbGUgZmVhdHVyZSBjcmVhdGlvbiBvbiBtYXBcbiAgICAgIGxlYWZsZXREYXRhLmdldE1hcCgnbGVmdE1hcFZpZXdlcicpLnRoZW4oZnVuY3Rpb24gKG1hcCkge1xuICAgICAgICBpZiAodHlwZW9mIHZtLmRyYXduSXRlbXMgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAvLyBhZGRlZCB0aGlzIGJsb2Mgb2YgY29kZSBmb3IgbGV0dGluZyB1c2VyIGdldCBmZWF0dXJlLWluZm8gd2l0aG91dCBlbnRlcmluZyBlZGl0LW1vZGVcbiAgICAgICAgICBpZiAodm0uZHJhd25JdGVtcyA9PT0gbnVsbCkge1xuICAgICAgICAgICAgdm0uZHJhd25JdGVtcyA9IG5ldyBsZWFmbGV0LkZlYXR1cmVHcm91cCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2bS5kcmF3bkl0ZW1zLm9uKCdjbGljaycsIG9uRmVhdHVyZUNsaWNrZWQpO1xuICAgICAgICAgIC8vIHZtLmRyYXduSXRlbXMuYWRkVG8obWFwKTtcbiAgICAgICAgICAvLyBtYXAuYWRkTGF5ZXIodm0uZHJhd25JdGVtcyk7XG4gICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgIGlmICgkc3RhdGUuY3VycmVudC5uYW1lID09PSBcImFwcC52ZWN0b3JcIikge1xuICAgICAgICAgICAgbWFwLm9uKCdkcmF3OmNyZWF0ZWQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICB2YXIgbGVhZkxheWVyID0gZS5sYXllcjtcbiAgICAgICAgICAgICAgLy8gdm0uZHJhd25JdGVtcy5hZGRMYXllcihsZWFmTGF5ZXIpO1xuICAgICAgICAgICAgICB2YXIgZHJhd3NHZW9Kc29uID0gbGVhZkxheWVyLnRvR2VvSlNPTigpO1xuICAgICAgICAgICAgICB2bS5lZGl0TW9kZSA9IFwiYWRkXCI7XG4gICAgICAgICAgICAgIC8vIG9wZW5BdHRyaWJ1dGVQb3BVcChkcmF3c0dlb0pzb24sIHZtLmN1cnJlbnRseUVkaXRpbmdMYXllciwgdm0uZWRpdE1vZGUsIGUpO1xuICAgICAgICAgICAgICBvcGVuQXR0cmlidXRlUG9wVXAobGVhZkxheWVyLCB2bS5jdXJyZW50bHlFZGl0aW5nTGF5ZXIsIHZtLmVkaXRNb2RlLCBlKTtcbiAgICAgICAgICAgIH0uYmluZCh2bS5kcmF3bkl0ZW1zKSk7XG4gICAgICAgICAgICBtYXAub24oJ2RyYXc6ZWRpdHN0YXJ0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgLy8gIGNvbnNvbGUubG9nKFwiPj4+IGRyYXc6ZWRpdHN0YXJ0IFwiKTtcbiAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSBcImVkaXQtR2VvbVwiO1xuICAgICAgICAgICAgICAvLyAgdm0uZHJhd25JdGVtcy5vZmYoJ2NsaWNrJywgb25GZWF0dXJlQ2xpY2tlZCk7XG4gICAgICAgICAgICB9LmJpbmQodm0uZHJhd25JdGVtcykpO1xuICAgICAgICAgICAgbWFwLm9uKCdkcmF3OmVkaXRzdG9wJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gZHJhdzplZGl0c3RvcCBcIik7XG4gICAgICAgICAgICAgIHZtLmVkaXRNb2RlID0gbnVsbDtcbiAgICAgICAgICAgIH0uYmluZCh2bS5kcmF3bkl0ZW1zKSk7XG4gICAgICAgICAgICBtYXAub24oJ2RyYXc6ZWRpdGVkJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gZHJhdzplZGl0ZWQgXCIpO1xuICAgICAgICAgICAgICB2YXIgbGF5ZXJzID0gZS5sYXllcnM7XG4gICAgICAgICAgICAgIC8qIGxheWVycy5lYWNoTGF5ZXIoZnVuY3Rpb24gKGxheWVyKSB7XG4gICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhsYXllcik7XG4gICAgICAgICAgICAgICAgICAvLyByZXBsYWNlIGZlYXR1cmUgZ2VvbSB3aXRoIHRoZSBuZXcgZWRpdHRlZCBnZW9tIHZhbHVlXG4gICAgICAgICAgICAgICAgICBsYXllci5mZWF0dXJlLmdlb21ldHJ5LmNvb3JkaW5hdGVzID0gT2JqZWN0LnZhbHVlcyhsYXllci5nZXRMYXRMbmcoKSk7XG4gICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoXCJhZGRGZWF0dXJlVG9VcGRhdGVcIiwgbGF5ZXIuZmVhdHVyZSk7XG4gICAgICAgICAgICAgIH0pOyAqL1xuICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoXCJnZW9tVXBkYXRlZFwiLCBsYXllcnMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBtYXAub24oJ2RyYXc6ZGVsZXRlc3RhcnQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBkcmF3OmRlbGV0ZXN0YXJ0IFwiKTtcbiAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSBcImRlbGV0ZVwiO1xuICAgICAgICAgICAgfS5iaW5kKHZtLmRyYXduSXRlbXMpKTtcbiAgICAgICAgICAgIG1hcC5vbignZHJhdzpkZWxldGVzdG9wJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gZHJhdzpkZWxldGVzdG9wIFwiKTtcbiAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSBudWxsO1xuICAgICAgICAgICAgfS5iaW5kKHZtLmRyYXduSXRlbXMpKTtcbiAgICAgICAgICAgIG1hcC5vbignZHJhdzpkZWxldGVkJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gZHJhdzpkZWxldGVkIFwiKTtcbiAgICAgICAgICAgICAgdmFyIGxheWVycyA9IGUubGF5ZXJzO1xuICAgICAgICAgICAgICBwcmVwYXJlRGVsZXRlUGFyYW1zKGxheWVycyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG9uRmVhdHVyZUNsaWNrZWQoZSkge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gb25GZWF0dXJlQ2xpY2tlZCA+Pj4gXCIsIGUpO1xuICAgICAgaWYgKCEodm0uZWRpdE1vZGUgPT09IFwiZWRpdC1HZW9tXCIgfHwgdm0uZWRpdE1vZGUgPT09IFwiZGVsZXRlXCIpKSB7XG4gICAgICAgIC8vIGV4cGVjdHMgb25seSBhIHNpbmdsZSBmZWF0dXJlXG4gICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdChcInNob3dGZWF0dXJlQXR0clwiLCBlLmxheWVyLmZlYXR1cmUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZUxheWVyKCkge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gZ2UubGVmdC5zaWRlbmF2LmNvbnRyb2xsZXIgPj4+IGNyZWF0ZUxheWVyXCIpO1xuICAgICAgY2xvc2UoKTtcbiAgICAgIHZhciBjb25maWcgPSB7XG4gICAgICAgIGxvY2Fsczoge1xuICAgICAgICAgIG1hcERpYWxvZ0lucHV0OiB7XG4gICAgICAgICAgICAvLyBtb2RlbDogcmVzb3VyY2UsXG4gICAgICAgICAgICByZW1vdmVGbjogdm0ucmVtb3ZlXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBjb250cm9sbGVyOiAnVmVjdG9yTGF5ZXJDb250cm9sbGVyJyxcbiAgICAgICAgY29udHJvbGxlckFzOiAnY3RybCcsXG4gICAgICAgIHRlbXBsYXRlVXJsOiBHbG9iYWwuY2xpZW50UGF0aCArICcvdmVjdG9yL2RpYWxvZy92ZWN0b3JMYXllci5odG1sJyxcbiAgICAgICAgaGFzQmFja2Ryb3A6IGZhbHNlXG4gICAgICB9O1xuXG4gICAgICBDMkRpYWxvZy5jdXN0b20oY29uZmlnKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gcmVsb2FkIHRoZSBpdGVtcyBmcm9tIGJhY2stZW5kXG4gICAgICAgIC8vIHZtLnNlYXJjaCgpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInNhdmUgZG9uZVwiKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxheWVyQ2xpY2tlZChsYXllcikge1xuICAgICAgY29uc29sZS5sb2coXCI+Pj4gdmVjdG9yLmxlZnQuc2lkZW5hdi5jb250cm9sbGVyID4+PiBsYXllckNsaWNrZWQgXCIsIGxheWVyKTtcbiAgICAgIGNsb3NlKCk7XG4gICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICBsb2NhbHM6IHtcbiAgICAgICAgICBtYXBEaWFsb2dJbnB1dDoge1xuICAgICAgICAgICAgbW9kZWw6IGxheWVyXG4gICAgICAgICAgICAvLyByZW1vdmVGbjogdm0ucmVtb3ZlXG4gICAgICAgICAgICAvLyBtb2RlOiAnZWRpdCdcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGNvbnRyb2xsZXI6ICdWZWN0b3JMYXllckNvbnRyb2xsZXInLFxuICAgICAgICBjb250cm9sbGVyQXM6ICdjdHJsJyxcbiAgICAgICAgdGVtcGxhdGVVcmw6IEdsb2JhbC5jbGllbnRQYXRoICsgJy92ZWN0b3IvZGlhbG9nL3ZlY3RvckxheWVyLmh0bWwnLFxuICAgICAgICBoYXNCYWNrZHJvcDogZmFsc2VcbiAgICAgIH07XG5cbiAgICAgIEMyRGlhbG9nLmN1c3RvbShjb25maWcpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyByZWxvYWQgdGhlIGl0ZW1zIGZyb20gYmFjay1lbmRcbiAgICAgICAgLy8gdm0uc2VhcmNoKCk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwic2F2ZSBkb25lXCIpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWN0aXZhdGUgRWRpdCB0b29sYmFyIGZvciBwYXJ0aWN1bGFyIGxheWVyXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IGxheWVyIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFjdGl2YXRlRmVhdHVyZUVkaXQobGF5ZXIpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IHZlY3Rvci5sZWZ0LnNpZGVuYXYuY29udHJvbGxlciA+Pj4gYWN0aXZhdGVGZWF0dXJlRWRpdCBcIiwgbGF5ZXIpO1xuXG4gICAgICBsZWFmbGV0RGF0YS5nZXRNYXAoJ2xlZnRNYXBWaWV3ZXInKS50aGVuKGZ1bmN0aW9uIChtYXApIHtcbiAgICAgICAgaWYgKHZtLmRyYXdDb250cm9sICE9PSBudWxsKSB7XG4gICAgICAgICAgdm0uZHJhd0NvbnRyb2wucmVtb3ZlKCk7XG4gICAgICAgICAgdm0uZHJhd0NvbnRyb2wgPSBudWxsO1xuICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZCh2bS5kcmF3bkl0ZW1zKSkge1xuICAgICAgICAgICAgdm0uZHJhd25JdGVtcyA9IG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh2bS5kcmF3Q29udHJvbCA9PT0gbnVsbCkge1xuICAgICAgICAgIC8vIHZtLmRyYXduSXRlbXMgPSBuZXcgbGVhZmxldC5GZWF0dXJlR3JvdXAoKTtcbiAgICAgICAgICAvLyB2bS5kcmF3bkl0ZW1zLm9uKHtcbiAgICAgICAgICAvLyAgICdjbGljayc6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgLy8gICAgIC8vIGV4cGVjdHMgb25seSBhIHNpbmdsZSBmZWF0dXJlXG4gICAgICAgICAgLy8gICAgICRyb290U2NvcGUuJGJyb2FkY2FzdChcInNob3dGZWF0dXJlQXR0clwiLCBlLmxheWVyLmZlYXR1cmUpO1xuICAgICAgICAgIC8vICAgfVxuICAgICAgICAgIC8vIH0pXG4gICAgICAgICAgLy8gYWRkaW5nIGN1cnJlbnQgbGF5ZXJzIGZlYXR1cmVzIHRvIGRyYXduSXRlbXNcbiAgICAgICAgICAvLyBsb2Rhc2guZm9yRWFjaChsYXllci5nZXRMYXllcnMoKSwgZnVuY3Rpb24oZWFjaEZlYXR1cmUpIHtcbiAgICAgICAgICAvLyAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IGVhY2hGZWF0dXJlIFwiLCBlYWNoRmVhdHVyZSk7XG4gICAgICAgICAgLy8gICAvLyBlYWNoRmVhdHVyZS5lZGl0aW5nLmVuYWJsZSgpO1xuICAgICAgICAgIC8vICAgZWFjaEZlYXR1cmUuYWRkVG8odm0uZHJhd25JdGVtcyk7XG4gICAgICAgICAgLy8gfSk7XG4gICAgICAgICAgLy8gdm0uZHJhd25JdGVtcy5hZGRUbyhtYXApO1xuICAgICAgICAgIC8vIG1hcC5hZGRMYXllcih2bS5kcmF3bkl0ZW1zKTtcbiAgICAgICAgICAvLyBcbiAgICAgICAgICB2bS5kcmF3bkl0ZW1zID0gbmV3IGxlYWZsZXQuRmVhdHVyZUdyb3VwKCk7XG4gICAgICAgICAgLy8gYWRkaW5nIGN1cnJlbnQgbGF5ZXJzIGZlYXR1cmVzIHRvIGRyYXduSXRlbXNcbiAgICAgICAgICBsb2Rhc2guZm9yRWFjaChsYXllci5nZXRMYXllcnMoKSwgZnVuY3Rpb24gKGVhY2hGZWF0dXJlKSB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBlYWNoRmVhdHVyZSBcIiwgZWFjaEZlYXR1cmUpO1xuICAgICAgICAgICAgLy8gZWFjaEZlYXR1cmUuZWRpdGluZy5lbmFibGUoKTtcbiAgICAgICAgICAgIC8vIGNoZWNrIGlzIHJvbGUgaXMgMywgaWYgc28gdGhhbiBjaGVjayBpZiB0aGUgZmVhdHVyZSdzIHVzZXIgaXMgdGhlIHNhbWUgYXMgbG9nZ2VkIGluIHVzZXJcbiAgICAgICAgICAgIGlmIChlYWNoRmVhdHVyZS5mZWF0dXJlLnByb3BlcnRpZXMubGF5ZXJOYW1lID09PSBsYXllci5sYXllcklkKSB7XG4gICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiYmVmb3JlIGFkZGluZyB0byBkcmF3bml0ZW1zIFwiLCBlYWNoRmVhdHVyZS5mZWF0dXJlKTtcbiAgICAgICAgICAgICAgaWYgKCRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiM1wiKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVhY2hGZWF0dXJlLmZlYXR1cmUucHJvcGVydGllcy51c2VyX2lkID09PSAkc2Vzc2lvblN0b3JhZ2UuZ2V0T2JqZWN0KFwidXNlcklkXCIpKSB7XG4gICAgICAgICAgICAgICAgICBlYWNoRmVhdHVyZS5hZGRUbyh2bS5kcmF3bkl0ZW1zKTtcbiAgICAgICAgICAgICAgICAgIHZtLmRyYXduSXRlbXMuYWRkVG8obWFwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZWFjaEZlYXR1cmUuYWRkVG8odm0uZHJhd25JdGVtcyk7XG4gICAgICAgICAgICAgICAgdm0uZHJhd25JdGVtcy5hZGRUbyhtYXApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdm0uZHJhd0NvbnRyb2wgPSBuZXcgbGVhZmxldC5Db250cm9sLkRyYXcoe1xuICAgICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgICBwb2x5Z29uOiB0cnVlLFxuICAgICAgICAgICAgICBwb2x5bGluZTogdHJ1ZSxcbiAgICAgICAgICAgICAgcmVjdGFuZ2xlOiBmYWxzZSxcbiAgICAgICAgICAgICAgY2lyY2xlOiBmYWxzZSxcbiAgICAgICAgICAgICAgbWFya2VyOiB0cnVlLFxuICAgICAgICAgICAgICBjaXJjbGVtYXJrZXI6IGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZWRpdDoge1xuICAgICAgICAgICAgICBmZWF0dXJlR3JvdXA6IHZtLmRyYXduSXRlbXNcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwb3NpdGlvbjogJ3RvcHJpZ2h0J1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIG1hcC5hZGRDb250cm9sKHZtLmRyYXdDb250cm9sKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBzZXQgdGhlIGN1cnJlbnRseSBlZGl0aW5nIGxheWVyXG4gICAgICAgIHZtLmN1cnJlbnRseUVkaXRpbmdMYXllciA9IGxheWVyO1xuICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoXCJzZXRDdXJyZW50RWRpdExheWVyXCIsIHsgZGF0YTogeyBsYXllcjogdm0uY3VycmVudGx5RWRpdGluZ0xheWVyIH0gfSk7XG4gICAgICAgIGNsb3NlKCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBhZGROb25Hcm91cExheWVycyhzb3VyY2VMYXllciwgdGFyZ2V0R3JvdXApIHtcbiAgICAgIGlmIChzb3VyY2VMYXllciBpbnN0YW5jZW9mIEwuTGF5ZXJHcm91cCkge1xuICAgICAgICBzb3VyY2VMYXllci5lYWNoTGF5ZXIoZnVuY3Rpb24gKGxheWVyKSB7XG4gICAgICAgICAgYWRkTm9uR3JvdXBMYXllcnMobGF5ZXIsIHRhcmdldEdyb3VwKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0YXJnZXRHcm91cC5hZGRMYXllcihzb3VyY2VMYXllcik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyB0aGUgbGF5ZXIgZnJvbSBtYXAgYW5kIGRlbGV0ZXMgaXQgZnJvbSBvdXIgY29sbGVjdGlvblxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7YW55fSBsYXllciBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkZWxldGVMYXllcihsYXllcikge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gdmVjdG9yLmxlZnQuc2lkZW5hdi5jb250cm9sbGVyID4+PiBkZWxldGVMYXllciBcIiwgbGF5ZXIpO1xuICAgICAgLy8gY2hlY2sgZm9yIGRyYXcgY29udHJvbFxuICAgICAgLy8gaWYodm0uZHJhd0NvbnRyb2wgIT09IG51bGwpIHtcbiAgICAgIC8vICAgdm0uZHJhd0NvbnRyb2wucmVtb3ZlKCk7XG4gICAgICAvLyAgIHZtLmRyYXdDb250cm9sID0gbnVsbDtcbiAgICAgIC8vICAgaWYoYW5ndWxhci5pc0RlZmluZWQodm0uZHJhd25JdGVtcykpIHtcbiAgICAgIC8vICAgICBjb25zb2xlLmxvZyhcInZtLmRyYXduSXRlbXMgPSBcIiwgdm0uZHJhd25JdGVtcyk7XG4gICAgICAvLyAgICAgdm0uZHJhd25JdGVtcyA9IG51bGw7XG4gICAgICAvLyAgIH1cbiAgICAgIC8vIH1cblxuICAgICAgLy8gLy8gY2xlYW4gZmVhdHVyZXMgZnJvbSBtYXAgaS5lIHJlbW92ZSBsYXllciBmcm9tIG1hcFxuICAgICAgLy8gbGVhZmxldERhdGEuZ2V0TWFwKCdsZWZ0TWFwVmlld2VyJykudGhlbihmdW5jdGlvbiAobWFwKSB7XG4gICAgICAvLyAgIG1hcC5yZW1vdmVMYXllcihsYXllcik7XG4gICAgICAvLyB9KTtcblxuICAgICAgLy8gdm0ubGVhZmxldExheWVycyA9IGxvZGFzaC5yZWplY3Qodm0ubGVhZmxldExheWVycywgZnVuY3Rpb24obGF5ZXJUb0RlbGV0ZSkgeyBcbiAgICAgIC8vICAgaWYobGVhZmxldC5zdGFtcChsYXllclRvRGVsZXRlKSA9PT0gbGVhZmxldC5zdGFtcChsYXllcikpIHtcbiAgICAgIC8vICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIC8vICAgfVxuICAgICAgLy8gfSk7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIkFmdGVyIGRlbGV0ZWluZyBcIiwgdm0ubGVhZmxldExheWVycyk7XG5cbiAgICAgIHZhciBjb25maXJtID0gJG1kRGlhbG9nLmNvbmZpcm0oKS50aXRsZSgkdHJhbnNsYXRlLmluc3RhbnQoJ21lc3NhZ2VzLmRlbGV0ZUxheWVyVGl0bGUnKSkudGV4dENvbnRlbnQoJHRyYW5zbGF0ZS5pbnN0YW50KCdtZXNzYWdlcy5kZWxldGVMYXllck1lc3NhZ2UnKSkuYXJpYUxhYmVsKCdMdWNreSBkYXknKVxuICAgICAgLy8gLnRhcmdldEV2ZW50KGV2KVxuICAgICAgLm9rKCR0cmFuc2xhdGUuaW5zdGFudCgnbWVzc2FnZXMueWVzJykpLmNhbmNlbCgkdHJhbnNsYXRlLmluc3RhbnQoJ21lc3NhZ2VzLm5vJykpO1xuXG4gICAgICAkbWREaWFsb2cuc2hvdyhjb25maXJtKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gJHNjb3BlLnN0YXR1cyA9ICdZb3UgZGVjaWRlZCB0byBnZXQgcmlkIG9mIHlvdXIgZGVidC4nO1xuICAgICAgICB2YXIgcmVxUGFyYW0gPSB7XG4gICAgICAgICAgXCJhY3Rpb25cIjogXCJkZWxldGVMYXllcnNcIixcbiAgICAgICAgICBcImRhdGFcIjogW3tcbiAgICAgICAgICAgIFwibGF5ZXJfaWRcIjogbGF5ZXIubGF5ZXJJZCxcbiAgICAgICAgICAgIFwidXNlcl9pZFwiOiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwidXNlcklkXCIpLFxuICAgICAgICAgICAgXCJwcm9qX2lkXCI6IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJwcm9qSWRcIilcbiAgICAgICAgICB9XVxuICAgICAgICB9O1xuICAgICAgICAvLyBjYWxsIGRlbGV0ZSBBUEkgYW5kIHN0YXRlLnJlbG9hZFxuICAgICAgICB2YXIgdmVjdG9yU2VydmljZSA9IG5ldyBWZWN0b3JTZXJ2aWNlKCk7XG4gICAgICAgIHZlY3RvclNlcnZpY2UuZGVsZXRlVmVjdG9yTGF5ZXIocmVxUGFyYW0pLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgIGlmIChyZXMgPT09IFwic3VjY2Vzc1wiKSB7XG4gICAgICAgICAgICAkc3RhdGUucmVsb2FkKCk7XG4gICAgICAgICAgICBDMlRvYXN0LnN1Y2Nlc3MoJHRyYW5zbGF0ZS5pbnN0YW50KCdtZXNzYWdlcy5vcGVyYXRpb25TdWNjZXNzJykpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBDMlRvYXN0LnN1Y2Nlc3MoJHRyYW5zbGF0ZS5pbnN0YW50KCdtZXNzYWdlcy5vcGVyYXRpb25FcnJvcicpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yIHdoaWxlIGRlbGV0aW5nIFwiLCBlcnIpO1xuICAgICAgICB9KTtcbiAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJEZWxldGluZyBMYXllciBDYW5jZWxsZWRcIik7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBY2NlcHRzIGFycmF5IG9mIGxheWVyIG5hbWVzIGFuZCBmaXJlcyBXRlMgY2FsbHMgdG8gbG9hZCB0aGVtIGFzIFdGUyBsYXllclxuICAgICAqIEdlbmVyYXRlcyBhbiBhcnJheSBvZiBsYXllciBsaXN0IFwibGVhZmxldExheWVyc1wiIHdoaWNoIG1haW50YWlucyBhIGxpc3Qgb2YgbGF5ZXJzIGFkZGVkIHRvIG1hcFxuICAgICAqIFxuICAgICAqIEBwYXJhbSBbe2FueX1dIGxheWVycyBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBsb2FkV0ZTTGF5ZXJzKGxheWVyKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiB2ZWN0b3IubGVmdC5zaWRlbmF2LmNvbnRyb2xsZXIgPj4+IGxvYWRXRlNMYXllcnMgXCIsIGxheWVyKTtcbiAgICAgIC8vIGxvZGFzaC5mb3JFYWNoKGxheWVycywgZnVuY3Rpb24obGF5ZXIpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiY2FsbGluZyBnZW9zZXJ2ZXIgZm9yIGxheWVyID0gXCIsIGxheWVyKTtcbiAgICAgIGxlYWZsZXREYXRhLmdldE1hcCgnbGVmdE1hcFZpZXdlcicpLnRoZW4oZnVuY3Rpb24gKG1hcCkge1xuICAgICAgICAvLyBNYXBMYXllclNlcnZpY2UuYWRkV0ZTTGF5ZXIobGF5ZXIubGF5ZXJOYW1lLCAnbGVmdE1hcFZpZXdlcicpO1xuICAgICAgICAvLyBjcmVhdGUgbGF5ZXIgb2JqZWN0cyBhbmQga2VlcCBpdCBpbiB2bS5sYXllcnMgbGlzdCBcbiAgICAgICAgdmFyIHRlbXBMYXllciA9IG5ldyBsZWFmbGV0LldGU1Qoe1xuICAgICAgICAgIC8vIHVybDogJ2h0dHBzOi8vZGVtby5nZW8tc29sdXRpb25zLml0OjQ0My9nZW9zZXJ2ZXIvb3dzJyxcbiAgICAgICAgICAvLyB0eXBlTlM6ICd0aWdlcicsXG4gICAgICAgICAgLy8gdHlwZU5hbWU6ICd0aWdlcl9yb2FkcycsXG4gICAgICAgICAgdXJsOiAnaHR0cDovLzAuMC4wLjA6ODA4MS9nZW9zZXJ2ZXIvb3dzJyxcbiAgICAgICAgICB0eXBlTlM6ICd2ZWN0b3InLFxuICAgICAgICAgIHR5cGVOYW1lOiBsYXllci5sYXllck5hbWUsXG4gICAgICAgICAgLy8gY3JzOiBsZWFmbGV0LkNSUy5FUFNHNDMyNixcbiAgICAgICAgICBnZW9tZXRyeUZpZWxkOiAndGhlX2dlb20nLFxuICAgICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgICBjb2xvcjogXCIjXCIgKyAoKDEgPDwgMjQpICogTWF0aC5yYW5kb20oKSB8IDApLnRvU3RyaW5nKDE2KVxuICAgICAgICAgICAgLy8gd2VpZ2h0OiAxLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZmlsbE9wYWNpdHk6IDAuMlxuICAgICAgICB9LCBuZXcgbGVhZmxldC5Gb3JtYXQuR2VvSlNPTih7XG4gICAgICAgICAgY3JzOiBsZWFmbGV0LkNSUy5FUFNHNDMyNiAvKiAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2ludFRvTGF5ZXIoZ2VvSnNvblBvaW50LCBsYXRsbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyID0gbmV3IEwuQ2lyY2xlTWFya2VyKGxhdGxuZywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmFkaXVzOiAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxheWVyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgKi9cbiAgICAgICAgfSkpLmFkZFRvKG1hcCkub24oJ2xvYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgLy8gbWFwLmZpdEJvdW5kcyh0ZW1wTGF5ZXIuZ2V0TGF5ZXJzKClbMF0uZ2V0Qm91bmRzKCkpO1xuICAgICAgICAgIGlmICh0ZW1wTGF5ZXIuZ2V0Qm91bmRzKCkuaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICBtYXAuZml0Qm91bmRzKHRlbXBMYXllci5nZXRCb3VuZHMoKSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRlbXBMYXllci52aXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgICB0ZW1wTGF5ZXIubGF5ZXJOYW1lID0gXCJ2ZXJ0ZXhfcHJval9pZF9cIiArIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJwcm9qSWRcIikgKyBcIl9sYXllcl9pZF9cIiArIGxheWVyLmxheWVyX2lkICsgXCJfbGF0ZXN0XCI7XG4gICAgICAgICAgdGVtcExheWVyLnRpdGxlID0gbGF5ZXIudGl0bGU7XG4gICAgICAgICAgdGVtcExheWVyLmxheWVySWQgPSBsYXllci5sYXllcl9pZDtcbiAgICAgICAgICB0ZW1wTGF5ZXIuZGVzYyA9IGxheWVyLmRlc2NyaXB0aW9uO1xuICAgICAgICAgIC8vIHN0b3JlIGluIG15IGNvbGxlY3Rpb24gdG8gYmUgdXNlZCBcbiAgICAgICAgICB2bS5sZWFmbGV0TGF5ZXJzLnB1c2godGVtcExheWVyKTtcblxuICAgICAgICAgIGxvZGFzaC5mb3JFYWNoKHRlbXBMYXllci5nZXRMYXllcnMoKSwgZnVuY3Rpb24gKGVhY2hGZWF0dXJlKSB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBlYWNoRmVhdHVyZSBcIiwgZWFjaEZlYXR1cmUsIGxheWVyLmxheWVyX2lkKTtcbiAgICAgICAgICAgIGVhY2hGZWF0dXJlLmZlYXR1cmUucHJvcGVydGllcy5sYXllck5hbWUgPSBsYXllci5sYXllcl9pZDtcbiAgICAgICAgICAgIGVhY2hGZWF0dXJlLmFkZFRvKHZtLmRyYXduSXRlbXMpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgICAgLy8gfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gb3BlbkF0dHJpYnV0ZVBvcFVwKGZlYXR1cmVHZW9qc29uLCBsYXllciwgbW9kZSwgZXYpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IHZlY3Rvci5sZWZ0LnNpZGVuYXYuY29udHJvbGxlciA+Pj4gb3BlbkF0dHJpYnV0ZVBvcFVwIFwiLCBmZWF0dXJlR2VvanNvbiwgbGF5ZXIpO1xuICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KFwib3BlblJpZ2h0TmF2XCIsIC8qIEZlYXR1cmVTZXJ2aWNlLmNyZWF0ZU9iamVjdEZyb21HZW9Kc29uKGxheWVyLmZlYXR1cmUpICovXG4gICAgICB7IGRhdGE6IHtcbiAgICAgICAgICBsYXllcjogbGF5ZXIsXG4gICAgICAgICAgbGF5ZXJJZDogbGF5ZXIubGF5ZXJJZCxcbiAgICAgICAgICBmZWF0dXJlOiBmZWF0dXJlR2VvanNvbixcbiAgICAgICAgICBvcGVyYXRpb246IFwiY3JlYXRlXCJcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hhbmdlcyB0aGUgdmlzaWJpbHR5IG9mIGEgbGF5ZXJcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gbGF5ZXIgXG4gICAgICovXG4gICAgZnVuY3Rpb24gbGF5ZXJWaXNpYmlsaXR5KGxheWVyKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBsYXllclZpc2liaWxpdHkgXCIsIGxheWVyLCBsYXllci52aXNpYmxlKTtcbiAgICAgIGxlYWZsZXREYXRhLmdldE1hcCgnbGVmdE1hcFZpZXdlcicpLnRoZW4oZnVuY3Rpb24gKG1hcCkge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBsYXllclZpc2liaWxpdHkgPj4+IFwiLCBtYXApO1xuICAgICAgICBpZiAobGF5ZXIudmlzaWJsZSkge1xuICAgICAgICAgIG1hcC5hZGRMYXllcihsYXllcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbWFwLnJlbW92ZUxheWVyKGxheWVyKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcHJlcGFyZURlbGV0ZVBhcmFtcyhmZWF0dXJlcykge1xuXG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoXCJmZWF0dXJlRGVsZXRlZFwiLCB7IGRhdGE6IHtcbiAgICAgICAgICBmZWF0dXJlczogZmVhdHVyZXMsXG4gICAgICAgICAgb3BlcmF0aW9uOiBcImRlbGV0ZVwiXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldExheWVyQnlOYW1lKGxheWVyTmFtZSkge1xuICAgICAgY29uc29sZS5sb2coXCI+Pj4gZ2V0TGF5ZXJCeU5hbWUgPj4+IFwiLCBsYXllck5hbWUpO1xuICAgICAgbGVhZmxldERhdGEuZ2V0TWFwKCdsZWZ0TWFwVmlld2VyJykudGhlbihmdW5jdGlvbiAobWFwKSB7XG4gICAgICAgIG1hcC5lYWNoTGF5ZXIoZnVuY3Rpb24gKGxheWVyKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJlYWNoIGxheWVyID0gXCIsIGxheWVyKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbG9zZSB0aGlzIHNpZGVuYXZcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjbG9zZSgpIHtcbiAgICAgICRtZFNpZGVuYXYoJ2xlZnQnKS5jbG9zZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9wZW4gdGhpcyBzaWRlbmF2XG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gb3BlbigpIHtcbiAgICAgICRtZFNpZGVuYXYoJ2xlZnQnKS5vcGVuKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTWFpbiBmdW5jdGlvbiB3aGljaCBzZW5kIHRoZSBNb2RpZmljYXRpb25zIHRvIHNlcnZlclxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNhdmUoKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBWZWN0b3JMZWZ0U2lkZW5hdkNvbnRyb2xsZXIgPj4+IHNhdmUgXCIpO1xuICAgICAgdmFyIHJlcVBhcmFtID0ge1xuICAgICAgICBcImFjdGlvblwiOiBcImNyZWF0ZUZlYXR1cmVzXCIsXG4gICAgICAgIFwidXNlcl9pZFwiOiAkc2Vzc2lvblN0b3JhZ2UuZ2V0T2JqZWN0KFwidXNlcklkXCIpLFxuICAgICAgICBcInByb2pfaWRcIjogJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcInByb2pJZFwiKSxcbiAgICAgICAgXCJyb2xlXCI6ICRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJyb2xlXCIpLFxuICAgICAgICBcImRhdGFcIjogW11cbiAgICAgIH07XG4gICAgICB2YXIgY3JlYXRlUGFyYW0gPSB7XG4gICAgICAgIFwiYWN0aW9uXCI6IFwiY3JlYXRlXCIsXG4gICAgICAgIFwiZGF0YVwiOiBbXVxuICAgICAgfTtcbiAgICAgIHZhciBlZGl0UGFyYW0gPSB7XG4gICAgICAgIFwiYWN0aW9uXCI6IFwiZWRpdFwiLFxuICAgICAgICBcImRhdGFcIjogW11cbiAgICAgIH07XG4gICAgICB2YXIgZGVsZXRlUGFyYW0gPSB7XG4gICAgICAgIFwiYWN0aW9uXCI6IFwiZGVsZXRlXCIsXG4gICAgICAgIFwiZGF0YVwiOiBbXVxuICAgICAgfTtcbiAgICAgIGlmIChhbmd1bGFyLmVxdWFscygkc2Vzc2lvblN0b3JhZ2UuZ2V0T2JqZWN0KFwiY3JlYXRlUGFyYW1cIiksIHt9KSkge1xuICAgICAgICByZXFQYXJhbS5kYXRhLnB1c2goY3JlYXRlUGFyYW0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVxUGFyYW0uZGF0YS5wdXNoKCRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJjcmVhdGVQYXJhbVwiKSk7XG4gICAgICB9XG4gICAgICBpZiAoYW5ndWxhci5lcXVhbHMoJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcImVkaXRQYXJhbVwiKSwge30pKSB7XG4gICAgICAgIHJlcVBhcmFtLmRhdGEucHVzaChlZGl0UGFyYW0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVxUGFyYW0uZGF0YS5wdXNoKCRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJlZGl0UGFyYW1cIikpO1xuICAgICAgfVxuICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKCRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJkZWxldGVQYXJhbVwiKSwge30pKSB7XG4gICAgICAgIHJlcVBhcmFtLmRhdGEucHVzaChkZWxldGVQYXJhbSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXFQYXJhbS5kYXRhLnB1c2goJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcImRlbGV0ZVBhcmFtXCIpKTtcbiAgICAgIH1cbiAgICAgIC8vIGNvbnNvbGUubG9nKFwicmVxUGFyYW0gPSBcIiwgcmVxUGFyYW0pO1xuXG4gICAgICB2YXIgbGF5ZXJTZXJ2aWNlID0gbmV3IFZlY3RvclNlcnZpY2UoKTtcbiAgICAgIGxheWVyU2VydmljZS5jcmVhdGVGZWF0dXJlcyhyZXFQYXJhbSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwic2F2ZWQgaW4gQVBJIFwiLCByZXN1bHQpO1xuICAgICAgICBpZiAocmVzdWx0ID09PSBcInN1Y2Nlc3NcIikge1xuICAgICAgICAgIEMyVG9hc3Quc3VjY2VzcygkdHJhbnNsYXRlLmluc3RhbnQoJ21lc3NhZ2VzLnNhdmVTdWNjZXNzJykpO1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwic2F2ZWQgaW4gQVBJIFwiLCByZXN1bHQpO1xuICAgICAgICAgICRzZXNzaW9uU3RvcmFnZS5yZW1vdmUoXCJjcmVhdGVQYXJhbVwiKTtcbiAgICAgICAgICAkc2Vzc2lvblN0b3JhZ2UucmVtb3ZlKFwiZWRpdFBhcmFtXCIpO1xuICAgICAgICAgICRzZXNzaW9uU3RvcmFnZS5yZW1vdmUoXCJkZWxldGVQYXJhbVwiKTtcbiAgICAgICAgICAkc3RhdGUucmVsb2FkKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgQzJUb2FzdC5lcnJvcigkdHJhbnNsYXRlLmluc3RhbnQoJ21lc3NhZ2VzLnNhdmVFcnJvcicpKTtcbiAgICAgICAgfVxuICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkVycm9yIHdoaWxlIHNhdmluZyBcIiwgZXJyKTtcbiAgICAgICAgJHNlc3Npb25TdG9yYWdlLnJlbW92ZShcImNyZWF0ZVBhcmFtXCIpO1xuICAgICAgICAkc2Vzc2lvblN0b3JhZ2UucmVtb3ZlKFwiZWRpdFBhcmFtXCIpO1xuICAgICAgICAkc2Vzc2lvblN0b3JhZ2UucmVtb3ZlKFwiZGVsZXRlUGFyYW1cIik7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVuL2Nsb3NlIHRoZSBsZWZ0IHNpZGUgbmF2XG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9nZ2xlTGVmdCgpIHtcbiAgICAgICRtZFNpZGVuYXYoJ2xlZnQnKS50b2dnbGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFeHBvcnQgbGF5ZXIgZGF0YSBhcyBHZW9KU09OIGluIGEgZmlsZVxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGV4cG9ydExheWVyKGxheWVyKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBsZWZ0U2lkZU5hdiA+Pj4gZXhwb3J0TGF5ZXIgXCIsIGxheWVyKTtcbiAgICAgIC8vICR3aW5kb3cub3BlbihcIi9oZWltYXAvdmVjdG9yP3Byb2pfaWQ9XCIrXG4gICAgICAvLyAgICRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJwcm9qSWRcIikgK1xuICAgICAgLy8gICBcIiZsYXllcl9pZD1cIisgbGF5ZXIubGF5ZXJJZCArXCImZmV0Y2g9bGF0ZXN0VmVyc2lvblwiLFxuICAgICAgLy8gICBcIl9ibGFua1wiKTtcblxuICAgICAgdmFyIHJlcVBhcmFtID0ge1xuICAgICAgICAvLyBcInVzZXJfaWRcIjogJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcInVzZXJJZFwiKSxcbiAgICAgICAgXCJsYXllcl9pZFwiOiBsYXllci5sYXllcklkLFxuICAgICAgICBcInByb2pfaWRcIjogJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcInByb2pJZFwiKSxcbiAgICAgICAgXCJmZXRjaFwiOiBcImxhdGVzdFZlcnNpb25cIlxuICAgICAgfTtcblxuICAgICAgdmFyIGxheWVyU2VydmljZSA9IG5ldyBWZWN0b3JTZXJ2aWNlKCk7XG4gICAgICBsYXllclNlcnZpY2UuZXhwb3J0TGF5ZXJHZW9Kc29uKHJlcVBhcmFtKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJleHBvcnRMYXllckdlb0pzb24gXCIsIHJlc3VsdCk7XG4gICAgICAgIHZhciBsYXllckRhdGEgPSBcImRhdGE6YXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtO2NoYXJzZXQ9dXRmLTgsXCIgKyBlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkocmVzdWx0KSk7XG4gICAgICAgIHZhciBkb3dubG9hZEFuY2hvck5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgICAgIGRvd25sb2FkQW5jaG9yTm9kZS5zZXRBdHRyaWJ1dGUoXCJocmVmXCIsIGxheWVyRGF0YSk7XG4gICAgICAgIGRvd25sb2FkQW5jaG9yTm9kZS5zZXRBdHRyaWJ1dGUoXCJkb3dubG9hZFwiLCBcImxheWVyLmpzb25cIik7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZG93bmxvYWRBbmNob3JOb2RlKTsgLy8gcmVxdWlyZWQgZm9yIGZpcmVmb3hcbiAgICAgICAgZG93bmxvYWRBbmNob3JOb2RlLmNsaWNrKCk7XG4gICAgICAgIGRvd25sb2FkQW5jaG9yTm9kZS5yZW1vdmUoKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJFcnJvciB3aGlsZSBzYXZpbmcgXCIsIGVycik7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBmdW5jdGlvbmFsaXR5IGlzIGFsbG93ZWQgZm9yIGEgdXNlciBiYXNlZCBvbiBoaXMgcm9sZVxuICAgICAqIFxuICAgICAqIEByZXR1cm5zIGJvb2xlYW5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiB1c2VyQWxsb3coZnVuY3Rpb25hbGl0eSkge1xuICAgICAgaWYgKGZ1bmN0aW9uYWxpdHkgPT09IFwiZmVhdHVyZUVkaXRcIikge1xuICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCIxXCIpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjJcIikge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiM1wiKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCI0XCIpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChmdW5jdGlvbmFsaXR5ID09PSBcImxheWVyQ3JlYXRlXCIpIHtcbiAgICAgICAgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiMVwiKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCIyXCIpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjNcIikge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiNFwiKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoZnVuY3Rpb25hbGl0eSA9PT0gXCJsYXllckVkaXRcIikge1xuICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCIxXCIpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjJcIikge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiM1wiKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCI0XCIpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChmdW5jdGlvbmFsaXR5ID09PSBcImxheWVyRGVsZXRlXCIpIHtcbiAgICAgICAgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiMVwiKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCIyXCIpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjNcIikge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiNFwiKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoZnVuY3Rpb25hbGl0eSA9PT0gXCJsYXllckV4cG9ydFwiKSB7XG4gICAgICAgIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjFcIikge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiMlwiKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCIzXCIpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjRcIikge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGZ1bmN0aW9uYWxpdHkgPT09IFwicHVibGlzaERhdGFcIikge1xuICAgICAgICBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCIxXCIpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjJcIikge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiM1wiKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCI0XCIpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBhY3RpdmF0ZSgpO1xuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG52YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSBcInN5bWJvbFwiID8gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfSA6IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gXCJzeW1ib2xcIiA6IHR5cGVvZiBvYmo7IH07XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdWZWN0b3JSaWdodFNpZGVuYXZDb250cm9sbGVyJywgVmVjdG9yUmlnaHRTaWRlbmF2Q29udHJvbGxlcik7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICBmdW5jdGlvbiBWZWN0b3JSaWdodFNpZGVuYXZDb250cm9sbGVyKCRtZFNpZGVuYXYsIGxvZGFzaCwgJHJvb3RTY29wZSwgbGVhZmxldCwgbGVhZmxldERhdGEsIEZlYXR1cmVTZXJ2aWNlLCAkc2Vzc2lvblN0b3JhZ2UsIFZlY3RvclNlcnZpY2UsIE1hcExheWVyU2VydmljZSkge1xuICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICB2bS5zaG93QXR0cmlidXRlcyA9IHNob3dBdHRyaWJ1dGVzO1xuICAgIHZtLnVwZGF0ZSA9IHVwZGF0ZTtcbiAgICB2bS5jbG9zZSA9IGNsb3NlO1xuICAgIHZtLm9wZW4gPSBvcGVuO1xuICAgIHZtLnNob3dBbGxGZWF0dXJlVmVyc2lvbnMgPSBzaG93QWxsRmVhdHVyZVZlcnNpb25zO1xuICAgIHZtLnRvZ2dsZVJpZ2h0ID0gdG9nZ2xlUmlnaHQ7XG4gICAgdm0uY2hlY2tEZXBlbmRlbnRWYWx1ZSA9IGNoZWNrRGVwZW5kZW50VmFsdWU7XG4gICAgdm0uZ2V0Rm9ybUF0dHJpYnV0ZSA9IGdldEZvcm1BdHRyaWJ1dGU7XG4gICAgdm0uZmVhdHVyZUF0dHIgPSBudWxsO1xuICAgIHZtLmdhenpUeXBlcyA9IFtcIlBoeXNpY2FsIFRoaW5nXCIsIFwiRXZlbnRcIiwgXCJQbGFjZVwiXTtcbiAgICB2bS5lZGl0TW9kZSA9IG51bGw7IC8vIFwiZWRpdFwiLCBcImNyZWF0ZVwiLCBcImRlbGV0ZVwiXG4gICAgdm0uY3VycmVudExheWVyID0gbnVsbDtcbiAgICB2bS5jcmVhdGVQYXJhbSA9IHtcbiAgICAgIFwiYWN0aW9uXCI6IFwiY3JlYXRlXCIsXG4gICAgICBcImRhdGFcIjogW11cbiAgICB9O1xuICAgIHZtLmVkaXRQYXJhbSA9IHtcbiAgICAgIFwiYWN0aW9uXCI6IFwiZWRpdFwiLFxuICAgICAgXCJkYXRhXCI6IFtdXG4gICAgfTtcbiAgICB2bS5kZWxldGVQYXJhbSA9IHtcbiAgICAgIFwiYWN0aW9uXCI6IFwiZGVsZXRlXCIsXG4gICAgICBcImRhdGFcIjogW11cbiAgICB9O1xuICAgIHZtLmRpc2FibGVTYXZlID0gZmFsc2U7XG4gICAgdm0uc2hvd0FsbFZlcnNpb25zID0gdHJ1ZTtcbiAgICB2bS5mb3JtUGFyYW1zID0gbnVsbDtcblxuICAgIC8vIHVzZWQgZm9yIEVkaXQgZmVhdHVyZSBjYWxsIChhdHRyaWJ1dGUgdXBkYXRlKVxuICAgICRyb290U2NvcGUuJG9uKCdzaG93RmVhdHVyZUF0dHInLCBmdW5jdGlvbiAoZXZlbnQsIGFyZ3MpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IFZlY3RvclJpZ2h0U2lkZW5hdkNvbnRyb2xsZXIgPj4+IHNob3dGZWF0dXJlQXR0ciBcIiwgYXJncyk7XG4gICAgICB2bS5mZWF0dXJlQXR0ciA9IG51bGw7XG4gICAgICAvLyBjbG9zZSBhbmQgb3BlbiB0byBsZXQgdGhlIGRpdnMgcmVmcmVzaFxuICAgICAgY2xvc2UoKTtcbiAgICAgIHZtLmVkaXRNb2RlID0gXCJlZGl0XCI7XG4gICAgICB2bS5jdXJyZW50RmVhdHVyZSA9IGFyZ3M7XG4gICAgICBhcmdzID0gRmVhdHVyZVNlcnZpY2UuY3JlYXRlT2JqZWN0RnJvbUdlb0pzb24oYXJncyk7XG4gICAgICAvLyBjaGVjayB3aGV0aGVyIGZlYXR1cmUgYWxyZWFkeSBleGlzdCBpbiB2bS5lZGl0UGFyYW1cbiAgICAgIGlmICh2bS5lZGl0UGFyYW0uZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHZhciB0ZW1wT2JqID0gc2VhcmNoRnJvbUNvbGxlY3Rpb25Ub0ZlYXR1cmUoYXJncywgdm0uZWRpdFBhcmFtKTtcbiAgICAgICAgaWYgKHRlbXBPYmogIT09IG51bGwpIHtcbiAgICAgICAgICB0ZW1wT2JqLnR5cGVfY3JtID0gdm0uY3VycmVudEZlYXR1cmUucHJvcGVydGllcy50eXBlX2NybTtcbiAgICAgICAgICBhcmdzID0gdGVtcE9iajtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgc2hvd0F0dHJpYnV0ZXMoYXJncyk7XG4gICAgICBvcGVuKCk7XG4gICAgICBpZiAodm0uY3VycmVudExheWVyICE9PSBudWxsKSB7XG4gICAgICAgIGlmICh2bS5jdXJyZW50TGF5ZXIubGF5ZXJJZCA9PT0gdm0uY3VycmVudEZlYXR1cmUucHJvcGVydGllcy5sYXllck5hbWUpIHtcbiAgICAgICAgICAvLyBjaGVjayBmb3IgdXNlcidzIGFjY2VzcyBvbiB0aGlzIGZlYXR1cmVcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhjaGVja1VzZXJBY2Nlc3NPbkZlYXR1cmUodm0uY3VycmVudEZlYXR1cmUsICRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJ1c2VySWRcIikudG9TdHJpbmcoKSkpO1xuICAgICAgICAgIGlmIChjaGVja1VzZXJBY2Nlc3NPbkZlYXR1cmUodm0uY3VycmVudEZlYXR1cmUsICRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJ1c2VySWRcIikudG9TdHJpbmcoKSkpIHtcbiAgICAgICAgICAgIHZtLmRpc2FibGVTYXZlID0gZmFsc2U7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZtLmRpc2FibGVTYXZlID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdm0uZGlzYWJsZVNhdmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2bS5kaXNhYmxlU2F2ZSA9IHRydWU7XG4gICAgICB9XG4gICAgICB2bS5zaG93QWxsVmVyc2lvbnMgPSB0cnVlO1xuICAgIH0pO1xuXG4gICAgLy8gZ2VvbSB1cGRhdGVcbiAgICAkcm9vdFNjb3BlLiRvbignZ2VvbVVwZGF0ZWQnLCBmdW5jdGlvbiAoZXZlbnQsIGFyZ3MpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IFZlY3RvclJpZ2h0U2lkZW5hdkNvbnRyb2xsZXIgPj4+IGFkZEZlYXR1cmVUb1VwZGF0ZSBcIiwgYXJncyk7XG4gICAgICBhcmdzLmVhY2hMYXllcihmdW5jdGlvbiAobGF5ZXIpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2cobGF5ZXIpO1xuICAgICAgICAvLyByZXBsYWNlIGZlYXR1cmUgZ2VvbSB3aXRoIHRoZSBuZXcgZWRpdHRlZCBnZW9tIHZhbHVlXG4gICAgICAgIC8vIGxheWVyLmZlYXR1cmUuZ2VvbWV0cnkuY29vcmRpbmF0ZXMgPSBPYmplY3QudmFsdWVzKGxheWVyLmdldExhdExuZygpKTtcbiAgICAgICAgbGF5ZXIuZmVhdHVyZS5nZW9tZXRyeSA9IGxheWVyLnRvR2VvSlNPTigpLmdlb21ldHJ5O1xuICAgICAgICB2bS5jdXJyZW50RmVhdHVyZSA9IGxheWVyLmZlYXR1cmU7XG4gICAgICAgIC8vIGFkZEZlYXR1cmVUb1VwZGF0ZUxpc3QobGF5ZXIuZmVhdHVyZSk7XG4gICAgICAgIC8vIC0tLS0tLVxuICAgICAgICBpZiAodm0uY3JlYXRlUGFyYW0uZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgLy8gZmluZCBlZGl0dGVkIGZlYXR1cmUgaW4gZWRpdFBhcmFtIFxuICAgICAgICAgIHZhciBmb3VuZE9iamVjdEluQ3JlYXRlUGFyYW0gPSBsb2Rhc2guZmluZCh2bS5jcmVhdGVQYXJhbS5kYXRhLCBmdW5jdGlvbiAoZWFjaEZlYXR1cmUpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJzZUludChsYXllci5mZWF0dXJlLnByb3BlcnRpZXMudHlwZV9jcm0pID09PSBlYWNoRmVhdHVyZS50eXBlX2NybSB8fCBsYXllci5mZWF0dXJlLnByb3BlcnRpZXMudHlwZV9jcm0gPT09IGVhY2hGZWF0dXJlLnR5cGVfY3JtO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGlmICh0eXBlb2YgZm91bmRPYmplY3RJbkNyZWF0ZVBhcmFtICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcImZvdW5kIGluIGNyZWF0ZVBhcmFtIFwiLCBmb3VuZE9iamVjdEluQ3JlYXRlUGFyYW0pO1xuICAgICAgICAgICAgc2VhcmNoQW5kUmVwbGFjZU9ubHlHZW9tKGxheWVyLmZlYXR1cmUsIHZtLmNyZWF0ZVBhcmFtKTtcbiAgICAgICAgICAgIC8vIGFkZEZlYXR1cmVUb1VwZGF0ZUxpc3QobGF5ZXIuZmVhdHVyZSk7XG4gICAgICAgICAgICAvLyBmaXJlIGJhY2sgdG8gbGVmdCBzaWRlbmF2IHRvIGFkZCBuZXdseSBhZGRlZCBmZWF0dXJlIHRvIGl0cyBsYXllclxuICAgICAgICAgICAgLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KFwiYWRkRmVhdHVyZVRvTGF5ZXJcIiwgdm0uY3VycmVudEZlYXR1cmUpO1xuICAgICAgICAgICAgJHNlc3Npb25TdG9yYWdlLnNldE9iamVjdChcImNyZWF0ZVBhcmFtXCIsIHZtLmNyZWF0ZVBhcmFtKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gaGFuZGxlRWRpdFBhcmFtKHZtLmZlYXR1cmVBdHRyLCB2bS5lZGl0UGFyYW0sIHZtLmN1cnJlbnRGZWF0dXJlKTtcbiAgICAgICAgICAgIGFkZEZlYXR1cmVUb1VwZGF0ZUxpc3QobGF5ZXIuZmVhdHVyZSk7XG4gICAgICAgICAgICAkc2Vzc2lvblN0b3JhZ2Uuc2V0T2JqZWN0KFwiZWRpdFBhcmFtXCIsIHZtLmVkaXRQYXJhbSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGhhbmRsZUVkaXRQYXJhbSh2bS5mZWF0dXJlQXR0ciwgdm0uZWRpdFBhcmFtLCB2bS5jdXJyZW50RmVhdHVyZSk7XG4gICAgICAgICAgYWRkRmVhdHVyZVRvVXBkYXRlTGlzdChsYXllci5mZWF0dXJlKTtcbiAgICAgICAgICAkc2Vzc2lvblN0b3JhZ2Uuc2V0T2JqZWN0KFwiZWRpdFBhcmFtXCIsIHZtLmVkaXRQYXJhbSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgLy8gdXNlZCBmb3IgY3JlYXRlIGZlYXR1cmUgY2FsbFxuICAgICRyb290U2NvcGUuJG9uKCdvcGVuUmlnaHROYXYnLCBmdW5jdGlvbiAoZXZlbnQsIGFyZ3MpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IFZlY3RvclJpZ2h0U2lkZW5hdkNvbnRyb2xsZXIgPj4+IG9wZW5SaWdodE5hdiBcIiwgYXJncyk7XG4gICAgICB2bS5mZWF0dXJlQXR0ciA9IG51bGw7XG4gICAgICBjbG9zZSgpO1xuICAgICAgdm0uZWRpdE1vZGUgPSBhcmdzLmRhdGEub3BlcmF0aW9uO1xuICAgICAgdm0uY3VycmVudExheWVyID0gYXJncy5kYXRhLmxheWVyO1xuICAgICAgdm0uY3VycmVudExlYWZGZWF0dXJlID0gYXJncy5kYXRhLmZlYXR1cmU7XG4gICAgICB2bS5jdXJyZW50RmVhdHVyZSA9IGFyZ3MuZGF0YS5mZWF0dXJlLnRvR2VvSlNPTigpO1xuICAgICAgdm0uZGlzYWJsZVNhdmUgPSBmYWxzZTtcbiAgICAgIG9wZW4oKTtcbiAgICB9KTtcblxuICAgIC8vIHVzZWQgZm9yIGRlbGV0ZSBmZWF0dXJlIGNhbGxcbiAgICAkcm9vdFNjb3BlLiRvbignZmVhdHVyZURlbGV0ZWQnLCBmdW5jdGlvbiAoZXZlbnQsIGFyZ3MpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IFZlY3RvclJpZ2h0U2lkZW5hdkNvbnRyb2xsZXIgPj4+IGZlYXR1cmVEZWxldGVkIFwiLCBhcmdzKTtcbiAgICAgIHZhciBsYXllcnMgPSBhcmdzLmRhdGEuZmVhdHVyZXM7XG4gICAgICBsYXllcnMuZWFjaExheWVyKGZ1bmN0aW9uIChsYXllcikge1xuICAgICAgICAvLyBjaGVjayBmb3IgaXQgZXhpc3QgaW4gY3JlYXRlIG9yIGVkaXQgY29sbGVjdGlvblxuICAgICAgICBpZiAoc2VhcmNoSW5Db2xsZWN0aW9uKHZtLmNyZWF0ZVBhcmFtLCBsYXllcikgPT09IGZhbHNlICYmIHNlYXJjaEluQ29sbGVjdGlvbih2bS5lZGl0UGFyYW0sIGxheWVyKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICB2YXIgdGVtcERlbGV0ZURhdGEgPSB7XG4gICAgICAgICAgICBcImxheWVyX2lkXCI6IHZtLmN1cnJlbnRMYXllci5sYXllcklkLFxuICAgICAgICAgICAgXCJ0eXBlX2NybVwiOiBsYXllci5mZWF0dXJlLnByb3BlcnRpZXMudHlwZV9jcm1cbiAgICAgICAgICB9O1xuICAgICAgICAgIHZtLmRlbGV0ZVBhcmFtLmRhdGEucHVzaCh0ZW1wRGVsZXRlRGF0YSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKHNlYXJjaEluQ29sbGVjdGlvbih2bS5jcmVhdGVQYXJhbSwgbGF5ZXIpKSB7XG4gICAgICAgICAgICAvLyBkZWxldGUgaXQgZnJvbSB0aGF0IGNvbGxlY3Rpb25cbiAgICAgICAgICAgIGRlbGV0ZUZlYXR1cmVGcm9tQ29sbGVjdGlvbihsYXllciwgdm0uY3JlYXRlUGFyYW0pO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJ2bS5jcmVhdGVQYXJhbSA9IFwiLCB2bS5jcmVhdGVQYXJhbSk7XG4gICAgICAgICAgICAkc2Vzc2lvblN0b3JhZ2Uuc2V0T2JqZWN0KFwiY3JlYXRlUGFyYW1cIiwgdm0uY3JlYXRlUGFyYW0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc2VhcmNoSW5Db2xsZWN0aW9uKHZtLmVkaXRQYXJhbSwgbGF5ZXIpKSB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBnb3QgYSBmZWF0dXJlIGluIGNvbGxlY3Rpb25cIik7XG4gICAgICAgICAgICAvLyBkZWxldGUgaXQgZnJvbSB0aGF0IGNvbGxlY3Rpb25cbiAgICAgICAgICAgIGRlbGV0ZUZlYXR1cmVGcm9tQ29sbGVjdGlvbihsYXllciwgdm0uZWRpdFBhcmFtKTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwidm0uZWRpdFBhcmFtID0gXCIsIHZtLmVkaXRQYXJhbSk7XG4gICAgICAgICAgICAkc2Vzc2lvblN0b3JhZ2Uuc2V0T2JqZWN0KFwiZWRpdFBhcmFtXCIsIHZtLmVkaXRQYXJhbSk7XG4gICAgICAgICAgICAvLyBzaW5jZSBhIGVkaXRlZCBmZWF0dXJlIGlzIGRlbGV0ZWQgdGhhdCBtZWFucyBpdHMgYSBzaW1wbGUgZGVsZXRlXG4gICAgICAgICAgICB2YXIgdGVtcERlbGV0ZURhdGEgPSB7XG4gICAgICAgICAgICAgIFwibGF5ZXJfaWRcIjogdm0uY3VycmVudExheWVyLmxheWVySWQsXG4gICAgICAgICAgICAgIFwidHlwZV9jcm1cIjogbGF5ZXIuZmVhdHVyZS5wcm9wZXJ0aWVzLnR5cGVfY3JtXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdm0uZGVsZXRlUGFyYW0uZGF0YS5wdXNoKHRlbXBEZWxldGVEYXRhKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgLy8gY29uc29sZS5sb2coXCJ2bS5kZWxldGVQYXJhbSA9IFwiLCB2bS5kZWxldGVQYXJhbSk7XG4gICAgICAkc2Vzc2lvblN0b3JhZ2Uuc2V0T2JqZWN0KFwiZGVsZXRlUGFyYW1cIiwgdm0uZGVsZXRlUGFyYW0pO1xuICAgIH0pO1xuXG4gICAgLy8gQXNzaWduIGN1cnJlbnQgRWRpdGluZyBsYXllclxuICAgICRyb290U2NvcGUuJG9uKCdzZXRDdXJyZW50RWRpdExheWVyJywgZnVuY3Rpb24gKGV2ZW50LCBhcmdzKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBWZWN0b3JSaWdodFNpZGVuYXZDb250cm9sbGVyID4+PiBzZXRDdXJyZW50RWRpdExheWVyIFwiLCBhcmdzKTtcbiAgICAgIHZtLmN1cnJlbnRMYXllciA9IGFyZ3MuZGF0YS5sYXllcjtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEZpcnN0IGZ1bmN0aW9uIGNhbGxlZCBhZnRlciB0aGUgY29udHJvbGxlciBpcyByYW5cbiAgICAgKiBoZXJlIHRoZSBzdHVmZiBhcmUgaW5pdGlhbGl6ZWRcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHt9XG4gICAgLy8gY29uc29sZS5sb2coXCI+Pj4gdmVjdG9yLnJpZ2h0LnNpZGVuYXYuY29udHJvbGxlciA+Pj4gYWN0aXZhdGUgXCIsIHZtKTtcblxuXG4gICAgLyoqXG4gICAgICogQ2xvc2UgdGhpcyBzaWRlbmF2XG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2xvc2UoKSB7XG4gICAgICAkbWRTaWRlbmF2KCdyaWdodCcpLmNsb3NlKCk7XG4gICAgICB2bS5lZGl0TW9kZSA9IG51bGw7XG4gICAgICB2bS5jdXJyZW50RmVhdHVyZSA9IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT3BlbiB0aGlzIHNpZGVuYXZcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvcGVuKCkge1xuICAgICAgJG1kU2lkZW5hdigncmlnaHQnKS5vcGVuKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGlzcGxheXMgZmVhdHVyZSdzIGF0dHJpYnV0ZSBpbiByaWdodC1zaWRlLW5hdi4gQ2FsbGVkIGZyb20gZXZlbnQgYnJvYWRjYXN0IGZyb20gXG4gICAgICogdmVjdG9yLmxlZnQuc2lkZW5hdi5jb250cm9sbGVyXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2hvd0F0dHJpYnV0ZXMoZmVhdHVyZU9iamVjdCkge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gVmVjdG9yUmlnaHRTaWRlbmF2Q29udHJvbGxlciA+Pj4gc2hvd0ZlYXR1cmVBdHRyKCkgXCIsIGZlYXR1cmVPYmplY3QpO1xuICAgICAgLy8gY2hlY2sgaWYgYW55IHZhbHVlIGNvbnRhaW5zIFtdIGZvciBhdHRyaWJ1dGUgdHlwZXMgbGlrZSBcIkxhbmd1YWdlXCIgd2hlcmUgdmFsdWVzIHdpbGwgYmUgYW4gYXJyYXlcbiAgICAgIHZhciB0ZW1wRlZhbE9iaiA9IE9iamVjdC52YWx1ZXMoZmVhdHVyZU9iamVjdCk7XG4gICAgICB2YXIgdGVtcEZLZXlPYmogPSBPYmplY3Qua2V5cyhmZWF0dXJlT2JqZWN0KTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGVtcEZWYWxPYmoubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKHR5cGVvZiB0ZW1wRlZhbE9ialtpXSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgIGlmICh0ZW1wRlZhbE9ialtpXS5pbmRleE9mKFwiW1wiKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIGZlYXR1cmVPYmplY3RbdGVtcEZLZXlPYmpbaV1dID0gSlNPTi5wYXJzZSh0ZW1wRlZhbE9ialtpXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHZtLmZlYXR1cmVBdHRyID0gZmVhdHVyZU9iamVjdDtcbiAgICAgIGdldEZvcm1BdHRyaWJ1dGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxsZWQgd2hlbiBnZW9tIHVwZGF0ZSBpcyBwZXJmb3JtZWQgb24gZmVhdHVyZS4gRXhwZWN0cyAxIGZlYXR1cmUgYXQgYSB0aW1lLiBcbiAgICAgKiBIZW5jZSBjYWxsZWQgaW4gbG9vcCBmcm9tIHRoZSBjYWxsZXIuIFxuICAgICAqIENoZWNrcyBmb3IgRWRpdCArIEVkaXQgc2NlbmFyaW9zLCBtZW50aW9uZWQgaW4gVGVzdCBjYXNlcyBvZiAjMjI1LlxuICAgICAqIERvZXNuJ3QgcmV0dXJucyBhbnl0aGluZyBidXQgdXBkYXRlcyB0aGUgdm0uZWRpdFBhcmFtXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IGZlYXR1cmVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhZGRGZWF0dXJlVG9VcGRhdGVMaXN0KGZlYXR1cmUpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IFZlY3RvclJpZ2h0U2lkZW5hdkNvbnRyb2xsZXIgPj4+IGFkZEZlYXR1cmVUb1VwZGF0ZUxpc3QgXCIsIGZlYXR1cmUpO1xuICAgICAgaWYgKHZtLmVkaXRQYXJhbS5kYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gZmluZCBlZGl0dGVkIGZlYXR1cmUgaW4gZWRpdFBhcmFtIFxuICAgICAgICB2YXIgZm91bmRPYmplY3RJbkVkaXRQYXJhbSA9IGxvZGFzaC5maW5kKHZtLmVkaXRQYXJhbS5kYXRhLCBmdW5jdGlvbiAoZWFjaEZlYXR1cmUpIHtcbiAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoZmVhdHVyZS5wcm9wZXJ0aWVzLnR5cGVfY3JtKSA9PT0gZWFjaEZlYXR1cmUudHlwZV9jcm0gfHwgZmVhdHVyZS5wcm9wZXJ0aWVzLnR5cGVfY3JtID09PSBlYWNoRmVhdHVyZS50eXBlX2NybTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIGlmIGZvdW5kIHRoYW4gcmVwbGFjZSBpdCBpbiBlZGlQYXJhbSBlbHNlIGl0cyBhIG5ldyBmZWF0dXJlIHB1c2ggdG8gZWRpdFBhcmFtXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZm91bmRPYmplY3RJbkVkaXRQYXJhbSA9IFwiLCBmb3VuZE9iamVjdEluRWRpdFBhcmFtKTtcbiAgICAgICAgaWYgKHR5cGVvZiBmb3VuZE9iamVjdEluRWRpdFBhcmFtICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgLy8gc2VhcmNoQW5kUmVwbGFjZShmZWF0dXJlLCB2bS5lZGl0UGFyYW0pO1xuICAgICAgICAgIC8vIGxvZGFzaC5yZW1vdmUodm0uZWRpdFBhcmFtLmRhdGEsIGZ1bmN0aW9uKGVhY2hGZWF0dXJlKXtcbiAgICAgICAgICAvLyAgIHJldHVybiAocGFyc2VJbnQoZmVhdHVyZS50eXBlX2NybSkgPT09IGVhY2hGZWF0dXJlLnR5cGVfY3JtIHx8IFxuICAgICAgICAgIC8vICAgZmVhdHVyZS50eXBlX2NybSA9PT0gZWFjaEZlYXR1cmUudHlwZV9jcm0pIFxuICAgICAgICAgIC8vIH0pO1xuICAgICAgICAgIHNlYXJjaEFuZFJlcGxhY2VPbmx5R2VvbShmZWF0dXJlLCB2bS5lZGl0UGFyYW0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciB0ZW1wRmVhdHVyZSA9IHtcbiAgICAgICAgICAgIFwibGF5ZXJfaWRcIjogdm0uY3VycmVudExheWVyLmxheWVySWQsXG4gICAgICAgICAgICBcImtleV9jaWRvY19hcnJheVwiOiBmZWF0dXJlLnByb3BlcnRpZXMua2V5X2NpZG9jX2FycmF5LnNwbGl0KFwifFwiKSxcbiAgICAgICAgICAgIFwidmFsdWVfZ2F6ZXR0ZWVyX2FycmF5XCI6IGZlYXR1cmUucHJvcGVydGllcy52YWx1ZV9nYXpldHRlZXJfYXJyYXkuc3BsaXQoXCJ8XCIpLFxuICAgICAgICAgICAgXCJ0eXBlX2NybVwiOiBmZWF0dXJlLnByb3BlcnRpZXMudHlwZV9jcm1cbiAgICAgICAgICB9O1xuICAgICAgICAgIHRlbXBGZWF0dXJlLmtleV9jaWRvY19hcnJheS5wdXNoKFwiZ2VvbVwiKTtcbiAgICAgICAgICB0ZW1wRmVhdHVyZS52YWx1ZV9nYXpldHRlZXJfYXJyYXkucHVzaChmZWF0dXJlLmdlb21ldHJ5KTtcbiAgICAgICAgICB2bS5lZGl0UGFyYW0uZGF0YS5wdXNoKHRlbXBGZWF0dXJlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHRlbXBGZWF0dXJlID0ge1xuICAgICAgICAgIFwibGF5ZXJfaWRcIjogdm0uY3VycmVudExheWVyLmxheWVySWQsXG4gICAgICAgICAgXCJrZXlfY2lkb2NfYXJyYXlcIjogZmVhdHVyZS5wcm9wZXJ0aWVzLmtleV9jaWRvY19hcnJheS5zcGxpdChcInxcIiksXG4gICAgICAgICAgXCJ2YWx1ZV9nYXpldHRlZXJfYXJyYXlcIjogZmVhdHVyZS5wcm9wZXJ0aWVzLnZhbHVlX2dhemV0dGVlcl9hcnJheS5zcGxpdChcInxcIiksXG4gICAgICAgICAgXCJ0eXBlX2NybVwiOiBmZWF0dXJlLnByb3BlcnRpZXMudHlwZV9jcm1cbiAgICAgICAgfTtcbiAgICAgICAgdGVtcEZlYXR1cmUua2V5X2NpZG9jX2FycmF5LnB1c2goXCJnZW9tXCIpO1xuICAgICAgICB0ZW1wRmVhdHVyZS52YWx1ZV9nYXpldHRlZXJfYXJyYXkucHVzaChmZWF0dXJlLmdlb21ldHJ5KTtcbiAgICAgICAgdm0uZWRpdFBhcmFtLmRhdGEucHVzaCh0ZW1wRmVhdHVyZSk7XG4gICAgICB9XG4gICAgICAvLyBjb25zb2xlLmxvZyhcInZtLmVkaXRQYXJhbSA9IFwiLCB2bS5lZGl0UGFyYW0pO1xuICAgICAgJHNlc3Npb25TdG9yYWdlLnNldE9iamVjdChcImVkaXRQYXJhbVwiLCB2bS5lZGl0UGFyYW0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNhdmUgZnVuY3Rpb24uIENhbGxlZCB3aGVuIFNhdmUgYnV0dG9uIGluIHJpZ2h0LXNhaWRlLW5hdiBpcyBjbGlja2VkLCB1cGRhdGVkIHZtLmNyZWF0ZVBhcmFtXG4gICAgICogYW5kIHZtLmVkaXRQYXJhbS5cbiAgICAgKiBOb3QgZm9yIERlbGV0ZSBmZWF0dXJlcywgc2luY2UgdGhpcyBoYW5kbGVzIG1ham9ybHkgb25seSBmb3IgQXR0cmlidXRlIFNhdmUvVXBkYXRlXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gdXBkYXRlKCkge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gVmVjdG9yUmlnaHRTaWRlbmF2Q29udHJvbGxlciA+Pj4gdXBkYXRlID4+PiBcIiwgdm0uZWRpdE1vZGUsIHZtLmN1cnJlbnRMYXllciwgdm0uZmVhdHVyZUF0dHIsIHZtLmN1cnJlbnRGZWF0dXJlKTtcbiAgICAgIGlmICh2bS5lZGl0TW9kZSA9PT0gXCJjcmVhdGVcIikge1xuICAgICAgICAvLyB2bS5mZWF0dXJlQXR0ci50eXBlX2NybSA9IFwiY3JtX1wiICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDk5OTkgLSAxICsgMSkpICsgMTtcbiAgICAgICAgdmFyIHRlbXBDcm0gPSBcImNybV9cIiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg5OTk5IC0gMSArIDEpKSArIDE7XG4gICAgICAgIHZhciBhcGlQYXJhbUZvcm1hdCA9IGNvbnZlcnRKc29uVG9BcGlSZXFPYmoodm0uZmVhdHVyZUF0dHIsIHZtLmN1cnJlbnRGZWF0dXJlKTtcbiAgICAgICAgdmFyIHRlbXBGZWF0dXJlID0ge1xuICAgICAgICAgIFwibGF5ZXJfaWRcIjogdm0uY3VycmVudExheWVyLmxheWVySWQsXG4gICAgICAgICAgXCJrZXlfY2lkb2NfYXJyYXlcIjogYXBpUGFyYW1Gb3JtYXQua2V5cyxcbiAgICAgICAgICBcInZhbHVlX2dhemV0dGVlcl9hcnJheVwiOiBhcGlQYXJhbUZvcm1hdC52YWx1ZXMsXG4gICAgICAgICAgXCJ0eXBlX2NybVwiOiB0ZW1wQ3JtXG4gICAgICAgIH07XG4gICAgICAgIHZtLmNyZWF0ZVBhcmFtLmRhdGEucHVzaCh0ZW1wRmVhdHVyZSk7XG4gICAgICAgIC8vIGNyZWF0ZSB0aGUgdm0uY3VycmVudEZlYXR1cmUgaW4gc2FtZSBzdHlsZSBhcyB3ZSByZWNlaXZlIGl0IGZyb20gd2ZzIGxheWVyIGNhbGxcbiAgICAgICAgLy8gdm0uY3VycmVudEZlYXR1cmUucHJvcGVydGllcyA9IHZtLmZlYXR1cmVBdHRyO1xuICAgICAgICB2bS5jdXJyZW50RmVhdHVyZS5wcm9wZXJ0aWVzID0ge1xuICAgICAgICAgIFwia2V5X2NpZG9jX2FycmF5XCI6IGNvbnZlcnRUb1NTVihhcGlQYXJhbUZvcm1hdC5rZXlzKSxcbiAgICAgICAgICBcInZhbHVlX2dhemV0dGVlcl9hcnJheVwiOiBjb252ZXJ0VG9TU1YoYXBpUGFyYW1Gb3JtYXQudmFsdWVzKSxcbiAgICAgICAgICBcInR5cGVfY3JtXCI6IHRlbXBDcm1cbiAgICAgICAgfTtcbiAgICAgICAgdm0uY3VycmVudExlYWZGZWF0dXJlLmZlYXR1cmUgPSB2bS5jdXJyZW50RmVhdHVyZTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJ2bS5jdXJyZW50TGVhZkZlYXR1cmUgPSBcIiwgdm0uY3VycmVudExlYWZGZWF0dXJlKTtcbiAgICAgICAgLy8gZmlyZSBiYWNrIHRvIGxlZnQgc2lkZW5hdiB0byBhZGQgbmV3bHkgYWRkZWQgZmVhdHVyZSB0byBpdHMgbGF5ZXJcbiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KFwiYWRkRmVhdHVyZVRvTGF5ZXJcIiwgdm0uY3VycmVudExlYWZGZWF0dXJlKTtcbiAgICAgICAgJHNlc3Npb25TdG9yYWdlLnNldE9iamVjdChcImNyZWF0ZVBhcmFtXCIsIHZtLmNyZWF0ZVBhcmFtKTtcbiAgICAgIH0gZWxzZSBpZiAodm0uZWRpdE1vZGUgPT09IFwiZWRpdFwiKSB7XG4gICAgICAgIC8vIGNoZWNrIGlmIGN1cnJlbnQgZmVhdHVyZSBhbHJlYWR5IGV4aXN0IGluIHZtLmNyZWF0ZVBhcmFtXG4gICAgICAgIGlmICh2bS5jcmVhdGVQYXJhbS5kYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAvLyBmaW5kIGVkaXR0ZWQgZmVhdHVyZSBpbiBlZGl0UGFyYW0gXG4gICAgICAgICAgdmFyIGZvdW5kT2JqZWN0SW5DcmVhdGVQYXJhbSA9IGxvZGFzaC5maW5kKHZtLmNyZWF0ZVBhcmFtLmRhdGEsIGZ1bmN0aW9uIChlYWNoRmVhdHVyZSkge1xuICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KHZtLmZlYXR1cmVBdHRyLnR5cGVfY3JtKSA9PT0gZWFjaEZlYXR1cmUudHlwZV9jcm0gfHwgdm0uZmVhdHVyZUF0dHIudHlwZV9jcm0gPT09IGVhY2hGZWF0dXJlLnR5cGVfY3JtO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGlmICh0eXBlb2YgZm91bmRPYmplY3RJbkNyZWF0ZVBhcmFtICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcImZvdW5kIGluIGNyZWF0ZVBhcmFtIFwiLCBmb3VuZE9iamVjdEluQ3JlYXRlUGFyYW0pO1xuICAgICAgICAgICAgc2VhcmNoQW5kUmVwbGFjZSh2bS5mZWF0dXJlQXR0ciwgdm0uY3JlYXRlUGFyYW0pO1xuICAgICAgICAgICAgdmFyIGFwaVBhcmFtRm9ybWF0ID0gY29udmVydEpzb25Ub0FwaVJlcU9iaih2bS5mZWF0dXJlQXR0ciwgdm0uY3VycmVudEZlYXR1cmUpO1xuICAgICAgICAgICAgdm0uY3VycmVudEZlYXR1cmUucHJvcGVydGllcyA9IHtcbiAgICAgICAgICAgICAgXCJrZXlfY2lkb2NfYXJyYXlcIjogY29udmVydFRvU1NWKGFwaVBhcmFtRm9ybWF0LmtleXMpLFxuICAgICAgICAgICAgICBcInZhbHVlX2dhemV0dGVlcl9hcnJheVwiOiBjb252ZXJ0VG9TU1YoYXBpUGFyYW1Gb3JtYXQudmFsdWVzKSxcbiAgICAgICAgICAgICAgXCJ0eXBlX2NybVwiOiB2bS5mZWF0dXJlQXR0ci50eXBlX2NybVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHZtLmN1cnJlbnRMZWFmRmVhdHVyZS5mZWF0dXJlID0gdm0uY3VycmVudEZlYXR1cmU7XG4gICAgICAgICAgICAvLyBmaXJlIGJhY2sgdG8gbGVmdCBzaWRlbmF2IHRvIGFkZCBuZXdseSBhZGRlZCBmZWF0dXJlIHRvIGl0cyBsYXllclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KFwiYWRkRmVhdHVyZVRvTGF5ZXJcIiwgdm0uY3VycmVudExlYWZGZWF0dXJlKTtcbiAgICAgICAgICAgICRzZXNzaW9uU3RvcmFnZS5zZXRPYmplY3QoXCJjcmVhdGVQYXJhbVwiLCB2bS5jcmVhdGVQYXJhbSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGhhbmRsZUVkaXRQYXJhbSh2bS5mZWF0dXJlQXR0ciwgdm0uZWRpdFBhcmFtLCB2bS5jdXJyZW50RmVhdHVyZSk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcInZtLmVkaXRQYXJhbSA9IFwiLCB2bS5lZGl0UGFyYW0pO1xuICAgICAgICAgICAgJHNlc3Npb25TdG9yYWdlLnNldE9iamVjdChcImVkaXRQYXJhbVwiLCB2bS5lZGl0UGFyYW0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBoYW5kbGVFZGl0UGFyYW0odm0uZmVhdHVyZUF0dHIsIHZtLmVkaXRQYXJhbSwgdm0uY3VycmVudEZlYXR1cmUpO1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwidm0uZWRpdFBhcmFtID0gXCIsIHZtLmVkaXRQYXJhbSk7XG4gICAgICAgICAgJHNlc3Npb25TdG9yYWdlLnNldE9iamVjdChcImVkaXRQYXJhbVwiLCB2bS5lZGl0UGFyYW0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRvZ2dsZVNhdmVCdXR0b24oKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGVzIEVkaXQgKyBFZGl0IG9wZXJhdGlvbnMgb24gUmlnaHQgU2F2ZSBjbGlja1xuICAgICAqIFxuICAgICAqIEBwYXJhbSB7YW55fSBmZWF0dXJlQXR0ciBmZWF0dXJlJ3MgYXR0cmlidXRlcyB3aGljaCBhcmUgZGlzcGxheWVkIGluIHJpZ2h0IHNpZGVuYXZcbiAgICAgKiBAcGFyYW0ge2FueX0gZWRpdFBhcmFtQ29sbGVjdGlvbiBFZGl0IGNvbGxlY3Rpb24gIFxuICAgICAqIEBwYXJhbSB7YW55fSBjdXJyZW50RmVhdHVyZSBcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBoYW5kbGVFZGl0UGFyYW0oZmVhdHVyZUF0dHIsIGVkaXRQYXJhbUNvbGxlY3Rpb24sIGN1cnJlbnRGZWF0dXJlKSB7XG4gICAgICAvLyBjaGVjayBpcyBjdXJyZW50IGZlYXR1cmUgYWxyZWFkeSBleGlzdCBpbiBlZGl0UGFyYW1Db2xsZWN0aW9uIGR1ZSB0byBnZW9tIGVkaXRcbiAgICAgIGlmIChlZGl0UGFyYW1Db2xsZWN0aW9uLmRhdGEubGVuZ3RoID4gMCkge1xuICAgICAgICAvLyBmaW5kIGVkaXR0ZWQgZmVhdHVyZSBpbiBlZGl0UGFyYW0gXG4gICAgICAgIHZhciBmb3VuZE9iamVjdEluRWRpdFBhcmFtID0gbG9kYXNoLmZpbmQoZWRpdFBhcmFtQ29sbGVjdGlvbi5kYXRhLCBmdW5jdGlvbiAoZWFjaEZlYXR1cmUpIHtcbiAgICAgICAgICByZXR1cm4gcGFyc2VJbnQoZmVhdHVyZUF0dHIudHlwZV9jcm0pID09PSBlYWNoRmVhdHVyZS50eXBlX2NybSB8fCBmZWF0dXJlQXR0ci50eXBlX2NybSA9PT0gZWFjaEZlYXR1cmUudHlwZV9jcm07XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBpZiBmb3VuZCB0aGFuIHJlcGxhY2UgaXQgaW4gZWRpUGFyYW0gZWxzZSBpdHMgYSBuZXcgZmVhdHVyZSBwdXNoIHRvIGVkaXRQYXJhbVxuICAgICAgICBpZiAodHlwZW9mIGZvdW5kT2JqZWN0SW5FZGl0UGFyYW0gIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICBzZWFyY2hBbmRSZXBsYWNlKGZlYXR1cmVBdHRyLCBlZGl0UGFyYW1Db2xsZWN0aW9uKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgdGVtcEZlYXR1cmUgPSB7XG4gICAgICAgICAgICBcImxheWVyX2lkXCI6IHZtLmN1cnJlbnRMYXllci5sYXllcklkLFxuICAgICAgICAgICAgXCJ0eXBlX2NybVwiOiBwYXJzZUludChmZWF0dXJlQXR0ci50eXBlX2NybSksXG4gICAgICAgICAgICBcImtleV9jaWRvY19hcnJheVwiOiBPYmplY3Qua2V5cyhmZWF0dXJlQXR0ciksXG4gICAgICAgICAgICBcInZhbHVlX2dhemV0dGVlcl9hcnJheVwiOiBPYmplY3QudmFsdWVzKGZlYXR1cmVBdHRyKVxuICAgICAgICAgIH07XG4gICAgICAgICAgZWRpdFBhcmFtQ29sbGVjdGlvbi5kYXRhLnB1c2godGVtcEZlYXR1cmUpO1xuICAgICAgICAgIGN1cnJlbnRGZWF0dXJlLnByb3BlcnRpZXMua2V5X2NpZG9jX2FycmF5ID0gT2JqZWN0LmtleXMoZmVhdHVyZUF0dHIpLnRvU3RyaW5nKCk7XG4gICAgICAgICAgY3VycmVudEZlYXR1cmUucHJvcGVydGllcy52YWx1ZV9nYXpldHRlZXJfYXJyYXkgPSBPYmplY3QudmFsdWVzKGZlYXR1cmVBdHRyKS50b1N0cmluZygpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgdGVtcEZlYXR1cmVBdHRyID0gRmVhdHVyZVNlcnZpY2UudGVhck9iamVjdChmZWF0dXJlQXR0cik7XG4gICAgICAgIHZhciB0ZW1wRmVhdHVyZSA9IHtcbiAgICAgICAgICBcImxheWVyX2lkXCI6IHZtLmN1cnJlbnRMYXllci5sYXllcklkLFxuICAgICAgICAgIFwidHlwZV9jcm1cIjogcGFyc2VJbnQoZmVhdHVyZUF0dHIudHlwZV9jcm0pLFxuICAgICAgICAgIFwia2V5X2NpZG9jX2FycmF5XCI6IHRlbXBGZWF0dXJlQXR0ci5rZXlzLFxuICAgICAgICAgIFwidmFsdWVfZ2F6ZXR0ZWVyX2FycmF5XCI6IHRlbXBGZWF0dXJlQXR0ci52YWx1ZXNcbiAgICAgICAgfTtcbiAgICAgICAgZWRpdFBhcmFtQ29sbGVjdGlvbi5kYXRhLnB1c2godGVtcEZlYXR1cmUpO1xuICAgICAgICBjdXJyZW50RmVhdHVyZS5wcm9wZXJ0aWVzLmtleV9jaWRvY19hcnJheSA9IE9iamVjdC5rZXlzKGZlYXR1cmVBdHRyKS50b1N0cmluZygpO1xuICAgICAgICBjdXJyZW50RmVhdHVyZS5wcm9wZXJ0aWVzLnZhbHVlX2dhemV0dGVlcl9hcnJheSA9IE9iamVjdC52YWx1ZXMoZmVhdHVyZUF0dHIpLnRvU3RyaW5nKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2luY2Ugb3VyIEFQSSByZXF1aXJlcyB0aGUgZGF0YSBpbiBhIHBhcnRpY3VsYXIgZm9ybWF0LiBUaGlzIGZ1bmNpb24gY29udmVydHMga2V5OiB2YWx1ZSBcbiAgICAgKiBjb21iaW5hdGlvbiB0byBhbGwga2V5cyB0b2dldGhlciBhbmQgYWxsIHZhbHVlcyB0b2dldGhlci4gQWxzbyBhZGRzIGdlb21ldHJ5IHRvIFxuICAgICAqIHRoYXQga2V5IGFuZCB2YWx1ZSBzdHlsZSBvYmplY3RcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gYXR0cmlidXRlcyBmZWF0dXJlJ3MgYXR0cmlidXRlcyB3aGljaCBhcmUgZGlzcGxheWVkIGluIHJpZ2h0IHNpZGVuYXZcbiAgICAgKiBAcGFyYW0ge2FueX0gZmVhdHVyZSBcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjb252ZXJ0SnNvblRvQXBpUmVxT2JqKGF0dHJpYnV0ZXMsIGZlYXR1cmUpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IGNvbnZlcnRKc29uVG9BcGlSZXFPYmogPj4+IFwiLCBhdHRyaWJ1dGVzLCBmZWF0dXJlKTtcbiAgICAgIGZvciAodmFyIGVhY2hBdHRyIGluIGF0dHJpYnV0ZXMpIHtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYXR0cmlidXRlc1tlYWNoQXR0cl0pKSB7XG4gICAgICAgICAgLy8gZWFjaEF0dHIgPSBlYWNoQXR0ci50b1N0cmluZygpO1xuICAgICAgICAgIGF0dHJpYnV0ZXNbZWFjaEF0dHJdID0gSlNPTi5zdHJpbmdpZnkoYXR0cmlidXRlc1tlYWNoQXR0cl0pO1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiYXR0cmlidXRlc1tlYWNoQXR0cl0gPSBcIiwgYXR0cmlidXRlc1tlYWNoQXR0cl0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpO1xuICAgICAgdmFyIHZhbHVlcyA9IE9iamVjdC52YWx1ZXMoYXR0cmlidXRlcyk7XG5cbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IGNvbnZlcnRKc29uVG9BcGlSZXFPYmogPj4+IFwiLCB2YWx1ZXMpO1xuICAgICAga2V5cy5wdXNoKFwiZ2VvbVwiKTtcbiAgICAgIHZhbHVlcy5wdXNoKGZlYXR1cmUuZ2VvbWV0cnkpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgXCJrZXlzXCI6IGtleXMsXG4gICAgICAgIFwidmFsdWVzXCI6IHZhbHVlc1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZWFyY2ggZm9yIHRoZSBmZWF0dXJlIGluIGNvbGxlY3Rpb24gdXNpbmcgJ3R5cGVfY3JtJyBpbiBmZWF0dXJlIHRvIG1hdGNoIHdpdGggJ3R5cGVfY3JtJyBcbiAgICAgKiBpbiBjb2xsZWN0aW9uLiBIYW5kbGVzIEVkaXQgKyBFZGl0IG9wZXJhdGlvblxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7YW55fSBmZWF0dXJlIFxuICAgICAqIEBwYXJhbSB7Y29sbGVjdGlvbn0gY29sbGVjdGlvblxuICAgICAqIFxuICAgICAqIEByZXR1cm5zIGNvbGxlY3Rpb24gbW9kaWZpZWQgY29sbGVjdGlvblxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNlYXJjaEFuZFJlcGxhY2UoZmVhdHVyZSwgY29sbGVjdGlvbikge1xuICAgICAgdmFyIHJldHVybkRhdGEgPSBbXTtcbiAgICAgIHZhciB0ZW1wQ29sbGVjdGlvbiA9IGNvbGxlY3Rpb24uZGF0YTtcbiAgICAgIGxvZGFzaC5mb3JFYWNoKHRlbXBDb2xsZWN0aW9uLCBmdW5jdGlvbiAoZWFjaEZlYXR1cmUpIHtcbiAgICAgICAgaWYgKHBhcnNlSW50KGZlYXR1cmUudHlwZV9jcm0pID09PSBlYWNoRmVhdHVyZS50eXBlX2NybSB8fCBmZWF0dXJlLnR5cGVfY3JtID09PSBlYWNoRmVhdHVyZS50eXBlX2NybSkge1xuICAgICAgICAgIGZlYXR1cmUgPSBGZWF0dXJlU2VydmljZS50ZWFyT2JqZWN0KGZlYXR1cmUpO1xuICAgICAgICAgIGVhY2hGZWF0dXJlLmtleV9jaWRvY19hcnJheSA9IGZlYXR1cmUua2V5cztcbiAgICAgICAgICBlYWNoRmVhdHVyZS52YWx1ZV9nYXpldHRlZXJfYXJyYXkgPSBmZWF0dXJlLnZhbHVlcztcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gcmV0dXJuRGF0YTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZWFyY2ggZm9yIHRoZSBmZWF0dXJlIGluIGNvbGxlY3Rpb24gdXNpbmcgJ3R5cGVfY3JtJyBpbiBmZWF0dXJlIHRvIG1hdGNoIHdpdGggJ3R5cGVfY3JtJyBcbiAgICAgKiBpbiBjb2xsZWN0aW9uLiBIYW5kbGVzIEVkaXQgKyBFZGl0IG9wZXJhdGlvblxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7YW55fSBmZWF0dXJlIFxuICAgICAqIEBwYXJhbSB7Y29sbGVjdGlvbn0gY29sbGVjdGlvblxuICAgICAqIFxuICAgICAqIEByZXR1cm5zIGNvbGxlY3Rpb24gbW9kaWZpZWQgY29sbGVjdGlvblxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNlYXJjaEZyb21Db2xsZWN0aW9uVG9GZWF0dXJlKGZlYXR1cmUsIGNvbGxlY3Rpb24pIHtcbiAgICAgIHZhciByZXR1cm5EYXRhID0gbnVsbDtcbiAgICAgIHZhciB0ZW1wQ29sbGVjdGlvbiA9IGNvbGxlY3Rpb24uZGF0YTtcbiAgICAgIGxvZGFzaC5mb3JFYWNoKHRlbXBDb2xsZWN0aW9uLCBmdW5jdGlvbiAoZWFjaEZlYXR1cmUpIHtcbiAgICAgICAgaWYgKGZlYXR1cmUudHlwZV9jcm0gPT09IGVhY2hGZWF0dXJlLnR5cGVfY3JtKSB7XG4gICAgICAgICAgZWFjaEZlYXR1cmUgPSBGZWF0dXJlU2VydmljZS5zdGl0Y2hPYmplY3QoZWFjaEZlYXR1cmUua2V5X2NpZG9jX2FycmF5LCBlYWNoRmVhdHVyZS52YWx1ZV9nYXpldHRlZXJfYXJyYXkpO1xuICAgICAgICAgIHJldHVybkRhdGEgPSBlYWNoRmVhdHVyZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcInNlYXJjaEZyb21Db2xsZWN0aW9uVG9GZWF0dXJlID4+PiByZXR1cm5EYXRhID0gXCIsIHJldHVybkRhdGEpO1xuICAgICAgcmV0dXJuIHJldHVybkRhdGE7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2VhcmNoIGZvciB0aGUgZmVhdHVyZSBpbiBjb2xsZWN0aW9uIHVzaW5nICd0eXBlX2NybScgaW4gZmVhdHVyZSB0byBtYXRjaCB3aXRoICd0eXBlX2NybScgXG4gICAgICogaW4gY29sbGVjdGlvbi4gYW5kIHJlcGxhY2UgdGhlIEZlYXR1cmUncyBnZW9tZXRyeSBpbiBDb2xsZWN0aW9uICB3aXRoIGZlYXR1cmUnIGdlb21ldHJ5XG4gICAgICogQmFzaWNhbGx5IHVzZWQgaW4gQWRkL0VkaXQgKyBFZGl0IChnZW9tKSBvcGVyYXRpb25cbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gZmVhdHVyZSBcbiAgICAgKiBAcGFyYW0ge2NvbGxlY3Rpb259IGNvbGxlY3Rpb25cbiAgICAgKiBcbiAgICAgKiBAcmV0dXJucyBjb2xsZWN0aW9uIG1vZGlmaWVkIGNvbGxlY3Rpb25cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzZWFyY2hBbmRSZXBsYWNlT25seUdlb20oZmVhdHVyZSwgY29sbGVjdGlvbikge1xuICAgICAgdmFyIHRlbXBDb2xsZWN0aW9uID0gY29sbGVjdGlvbi5kYXRhO1xuICAgICAgbG9kYXNoLmZvckVhY2godGVtcENvbGxlY3Rpb24sIGZ1bmN0aW9uIChlYWNoRmVhdHVyZSkge1xuICAgICAgICBpZiAocGFyc2VJbnQoZmVhdHVyZS5wcm9wZXJ0aWVzLnR5cGVfY3JtKSA9PT0gZWFjaEZlYXR1cmUudHlwZV9jcm0gfHwgZmVhdHVyZS5wcm9wZXJ0aWVzLnR5cGVfY3JtID09PSBlYWNoRmVhdHVyZS50eXBlX2NybSkge1xuICAgICAgICAgIGVhY2hGZWF0dXJlLnZhbHVlX2dhemV0dGVlcl9hcnJheVtlYWNoRmVhdHVyZS5rZXlfY2lkb2NfYXJyYXkuaW5kZXhPZihcImdlb21cIildID0gZmVhdHVyZS5nZW9tZXRyeTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2VhcmNoZXMgZm9yIGEgZmVhdHVyZSBpbiBhIGNvbGxlY3Rpb24gZ2l2ZW4uIFJldHVybnMgdHJ1ZSBpZiBmb3VuZCBlbHNlIGZhbHNlXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IGZlYXR1cmUgXG4gICAgICogQHBhcmFtIHtjb2xsZWN0aW9ufSBjb2xsZWN0aW9uXG4gICAgICogXG4gICAgICogQHJldHVybnMgYm9vbGVhblxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNlYXJjaEluQ29sbGVjdGlvbihjb2xsZWN0aW9uLCBsYXllcikge1xuICAgICAgLy8gY29uc29sZS5sb2coXCJzZWFyY2hJbkNvbGxlY3Rpb24gPj4+IFwiLCBjb2xsZWN0aW9uLCBsYXllcik7XG4gICAgICB2YXIgdGVtcFJldHVybiA9IGxvZGFzaC5maW5kKGNvbGxlY3Rpb24uZGF0YSwgZnVuY3Rpb24gKGVhY2hGZWF0dXJlKSB7XG4gICAgICAgIHJldHVybiBwYXJzZUludChsYXllci5mZWF0dXJlLnByb3BlcnRpZXMudHlwZV9jcm0pID09PSBlYWNoRmVhdHVyZS50eXBlX2NybSB8fCBsYXllci5mZWF0dXJlLnByb3BlcnRpZXMudHlwZV9jcm0gPT09IGVhY2hGZWF0dXJlLnR5cGVfY3JtO1xuICAgICAgfSk7XG4gICAgICBpZiAodHlwZW9mIHRlbXBSZXR1cm4gIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVsZXRlcyBhIGZlYXR1cmUgZnJvbSBhIGNvbGxlY3Rpb24gZ2l2ZW4uIFJldHVybnMgbmV3IGNvbGxlY3Rpb25cbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gZmVhdHVyZSBcbiAgICAgKiBAcGFyYW0ge2NvbGxlY3Rpb259IGNvbGxlY3Rpb25cbiAgICAgKiBcbiAgICAgKiBAcmV0dXJucyBjb2xsZWN0aW9uXG4gICAgICovXG4gICAgZnVuY3Rpb24gZGVsZXRlRmVhdHVyZUZyb21Db2xsZWN0aW9uKGxheWVyLCBjb2xsZWN0aW9uKSB7XG4gICAgICByZXR1cm4gbG9kYXNoLnJlbW92ZShjb2xsZWN0aW9uLmRhdGEsIGZ1bmN0aW9uIChlYWNoRmVhdHVyZSkge1xuICAgICAgICByZXR1cm4gcGFyc2VJbnQobGF5ZXIuZmVhdHVyZS5wcm9wZXJ0aWVzLnR5cGVfY3JtKSA9PT0gZWFjaEZlYXR1cmUudHlwZV9jcm0gfHwgbGF5ZXIuZmVhdHVyZS5wcm9wZXJ0aWVzLnR5cGVfY3JtID09PSBlYWNoRmVhdHVyZS50eXBlX2NybTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERpc2FibGVzIHRoZSBTYXZlIGJ1dHRvbiBmcm9tIGFjY2lkZW50YWwgdXBkYXRlc1xuICAgICAqIEVuYWJsZXMgYmFjayB3aGVuIGZlYXR1cmUgaXMgY2xpY2tlZCBvbiBtYXBcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0b2dnbGVTYXZlQnV0dG9uKCkge1xuICAgICAgdm0uZGlzYWJsZVNhdmUgPSB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhbGxzIHRoZSBBUEkgZm9yIGdldHRpbmcgYWxsIHZlcnNpb25zIG9mIGEgcGFydGljdWxhciBmZWF0dXJlXG4gICAgICogdXNlcyB2bS5jdXJyZW50RmVhdHVyZSwgdm0uY3VycmVudExheWVyXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2hvd0FsbEZlYXR1cmVWZXJzaW9ucygpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+ID4+PiBzaG93QWxsRmVhdHVyZVZlcnNpb25zID4+PiBcIiwgdm0uY3VycmVudEZlYXR1cmUsIHZtLmN1cnJlbnRMYXllcik7XG4gICAgICBNYXBMYXllclNlcnZpY2UucmVtb3ZlQWxsTWFwTGF5ZXJzKCdyaWdodE1hcFZpZXdlcicpO1xuICAgICAgLy8gY2FsbCBnZXRBbGxGZWF0dXJlVmVyc2lvblxuICAgICAgdmFyIHJlcVBhcmFtRGF0YSA9IHtcbiAgICAgICAgcHJval9pZDogJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcInByb2pJZFwiKS50b1N0cmluZygpLFxuICAgICAgICBsYXllcl9pZDogdm0uY3VycmVudExheWVyLmxheWVySWQsXG4gICAgICAgIHR5cGVfY3JtOiB2bS5jdXJyZW50RmVhdHVyZS5wcm9wZXJ0aWVzLnR5cGVfY3JtLFxuICAgICAgICBmZXRjaDogJ2FsbFZlcnNpb25zJ1xuICAgICAgfTtcbiAgICAgIHZhciBsYXllclNlcnZpY2UgPSBuZXcgVmVjdG9yU2VydmljZSgpO1xuICAgICAgbGF5ZXJTZXJ2aWNlLmdldEFsbEZlYXR1cmVWZXJzaW9uKHJlcVBhcmFtRGF0YSkudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgIGlmIChyZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHNob3dGZWF0dXJlT25NYXAocmVzKTtcbiAgICAgICAgfVxuICAgICAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2hvd3MgLyByZW5kZXJzIGFsbCB2ZXJzaW9ucyBvZiBhIHBhcnRpY3VsYXIgZmVhdHVyZSBvbiByaWdodCBtYXBcbiAgICAgKiBBc3NvY2lhdGVzIGNsaWNrIGV2ZW50IHRvIGVhY2ggZmVhdHVyZSB0byBzaG93IGF0dHJpYnV0ZXMgb24gY2xpY2tcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gW3thbnl9XSBmZWF0dXJlc1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNob3dGZWF0dXJlT25NYXAoZmVhdHVyZXMpIHtcblxuICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLnJpZ2h0TWFwTGF5ZXJHcm91cCkpIHtcbiAgICAgICAgdm0ucmlnaHRNYXBMYXllckdyb3VwLmNsZWFyTGF5ZXJzKCk7XG4gICAgICB9XG4gICAgICB2bS5yaWdodE1hcExheWVyR3JvdXAgPSBuZXcgbGVhZmxldC5MYXllckdyb3VwKCk7XG5cbiAgICAgIGxlYWZsZXREYXRhLmdldE1hcCgncmlnaHRNYXBWaWV3ZXInKS50aGVuKGZ1bmN0aW9uIChtYXApIHtcbiAgICAgICAgbG9kYXNoLmZvckVhY2goZmVhdHVyZXMsIGZ1bmN0aW9uIChmZWF0dXJlKSB7XG4gICAgICAgICAgZmVhdHVyZS50eXBlX2NybSA9IHZtLmN1cnJlbnRGZWF0dXJlLnByb3BlcnRpZXMudHlwZV9jcm0gKyBcIl9cIiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg5OTk5IC0gMSArIDEpKSArIDE7XG4gICAgICAgICAgdmFyIGZnZW9tID0gSlNPTi5wYXJzZShmZWF0dXJlLmdlb20pO1xuICAgICAgICAgIGRlbGV0ZSBmZWF0dXJlLmdlb207XG5cbiAgICAgICAgICB2YXIgZ2VvanNvbkZlYXR1cmUgPSB7XG4gICAgICAgICAgICBcInR5cGVcIjogXCJGZWF0dXJlXCIsXG4gICAgICAgICAgICBcInByb3BlcnRpZXNcIjogZmVhdHVyZSxcbiAgICAgICAgICAgIFwiZ2VvbWV0cnlcIjogZmdlb21cbiAgICAgICAgICB9O1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZ2VvanNvbkZlYXR1cmUgPSBcIiwgZ2VvanNvbkZlYXR1cmUpO1xuICAgICAgICAgIC8vIHZtLnJpZ2h0TWFwTGF5ZXJHcm91cCA9IGxlYWZsZXQuZ2VvSlNPTihnZW9qc29uRmVhdHVyZSwge1xuICAgICAgICAgIC8vICAgb25FYWNoRmVhdHVyZTogb25FYWNoRmVhdHVyZVxuICAgICAgICAgIC8vIH0pLmFkZFRvKG1hcCk7XG4gICAgICAgICAgbGVhZmxldC5nZW9KU09OKGdlb2pzb25GZWF0dXJlLCB7XG4gICAgICAgICAgICBvbkVhY2hGZWF0dXJlOiBvbkVhY2hGZWF0dXJlXG4gICAgICAgICAgfSkuYWRkVG8odm0ucmlnaHRNYXBMYXllckdyb3VwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHZtLnJpZ2h0TWFwTGF5ZXJHcm91cC5hZGRUbyhtYXApO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIGlubmVyIGZ1Y250aW9uIHVzZWQgZm9yIGJpbmRpbmcgY2xpY2sgZXZlbnQgdG8gZWFjaCBmZWF0dXJlXG4gICAgICBmdW5jdGlvbiBvbkVhY2hGZWF0dXJlKGZlYXR1cmUsIGxheWVyKSB7XG4gICAgICAgIGxheWVyLm9uKHtcbiAgICAgICAgICAnY2xpY2snOiBmdW5jdGlvbiBjbGljayhlKSB7XG4gICAgICAgICAgICBjbG9zZSgpO1xuICAgICAgICAgICAgc2hvd0F0dHJpYnV0ZXMoZmVhdHVyZS5wcm9wZXJ0aWVzKTtcbiAgICAgICAgICAgIHZtLmRpc2FibGVTYXZlID0gdHJ1ZTtcbiAgICAgICAgICAgIHZtLnNob3dBbGxWZXJzaW9ucyA9IGZhbHNlO1xuICAgICAgICAgICAgb3BlbigpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT3Blbi9jbG9zZSB0aGUgcmlnaHQgc2lkZSBuYXZcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0b2dnbGVSaWdodCgpIHtcbiAgICAgICRtZFNpZGVuYXYoJ3JpZ2h0JykudG9nZ2xlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2FsbGVkIHdoZW4gRmVhdHVyZSBUeXBlIERyb3Bkb3duIGlzIGNoYW5nZWQuIEdldHMgYXR0cmlidXRlcyAob25seSBrZXkpb2YgdGhlIGZlYXR1cmVcbiAgICAgKiB0byBnZW5lcmF0ZSB0aGUgQXR0cmlidXRlIGZvcm1cbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdm0uZmVhdHVyZUF0dHIuZmVhdHVyZSBkcm9wZG93biBzZWxlY3RlZCB2YWx1ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldEZvcm1BdHRyaWJ1dGUoKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcImdldEZvcm1BdHRyaWJ1dGUgXCIsIHZtLmZlYXR1cmVBdHRyLmZlYXR1cmUpO1xuICAgICAgLy8gY2FsbCBBUEkgZm9yIHZtLmZlYXR1cmVBdHRyLmZlYXR1cmVcbiAgICAgIHZhciBmZWF0dXJlVHlwZSA9IHZtLmZlYXR1cmVBdHRyLmZlYXR1cmU7XG4gICAgICBpZiAoZmVhdHVyZVR5cGUuaW5kZXhPZihcIiBcIikgIT09IC0xKSB7XG4gICAgICAgIGZlYXR1cmVUeXBlID0gZmVhdHVyZVR5cGUucmVwbGFjZSgvXFxzL2csICcnKTtcbiAgICAgIH1cbiAgICAgIHZhciByZXFQYXJhbURhdGEgPSB7IHR5cGU6IGZlYXR1cmVUeXBlIH07XG4gICAgICB2YXIgdmVjdG9yU2VydmljZSA9IG5ldyBWZWN0b3JTZXJ2aWNlKCk7XG4gICAgICB2ZWN0b3JTZXJ2aWNlLmdldEZvcm1EYXRhKHJlcVBhcmFtRGF0YSkudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwicmVzcG9uc2UgXCIsIHJlcyk7XG4gICAgICAgIHZtLmZvcm1QYXJhbXMgPSByZXM7XG4gICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3Mgd2hldGhlciBhIGZpZWxkIGlzIGRlcGVuZGVudCBvbiBvdGhlciBmaWVsZHMuIFVzZWQgZm9yIER5bmFtaWMgZm9ybSBcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZmllbGRcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjaGVja0RlcGVuZGVudFZhbHVlKGZpZWxkKSB7XG4gICAgICAvLyB2bS5mb3JtUGFyYW1zXG4gICAgICAvLyBmZWF0dXJlQXR0cltmaWVsZC5uYW1lXVxuICAgICAgaWYgKHZtLmZlYXR1cmVBdHRyICE9PSBudWxsKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGZpZWxkLm5hbWUsIFwiIC0gXCIsIGZpZWxkLmRlcGVuZGVudCk7IFxuICAgICAgICBpZiAoZmllbGQubmFtZSAhPT0gZmllbGQuZGVwZW5kZW50KSB7XG4gICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLmZlYXR1cmVBdHRyW2ZpZWxkLmRlcGVuZGVudF0pKSB7XG4gICAgICAgICAgICAvLyBpZih2bS5mZWF0dXJlQXR0cltmaWVsZC5kZXBlbmRlbnRdICE9PSBcIlwiKSB7XG4gICAgICAgICAgICBpZiAodm0uZmVhdHVyZUF0dHJbZmllbGQuZGVwZW5kZW50XS5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gPj4+IGNoZWNrRGVwZW5kZW50VmFsdWUgXCIsIGZpZWxkLCBmaWVsZC5kZXBlbmRlbnQsIHZtLmZlYXR1cmVBdHRyW2ZpZWxkLmRlcGVuZGVudF0pO1xuICAgICAgICAgICAgICAvLyBmaWVsZC5yZXF1aXJlZCA9IHRydWU7XG4gICAgICAgICAgICAgIC8vIGNsb3NlKCk7XG4gICAgICAgICAgICAgIC8vIG9wZW4oKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBjb21tYSBzcGVyYXRlZCB2YWx1ZXMgdG8gc2VtaS1jb2xvbiBzZXBlcmF0ZWQgdmFsdWVzXG4gICAgICogXG4gICAgICogQHBhcmFtIHsqfSBjc3ZTdHJpbmcgXG4gICAgICovXG4gICAgZnVuY3Rpb24gY29udmVydFRvU1NWKGNzdlN0cmluZykge1xuICAgICAgLy8gY29uc29sZS5sb2coXCJjc3ZTdHJpbmcgPSBcIiwgY3N2U3RyaW5nKTtcbiAgICAgIHZhciByZXN1bHRTdHJpbmcgPSBcIlwiO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjc3ZTdHJpbmcubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKF90eXBlb2YoY3N2U3RyaW5nW2ldKSAhPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgY3N2U3RyaW5nW2ldICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgaWYgKGNzdlN0cmluZ1tpXS5pbmRleE9mKFwiW1wiKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIGlmIChyZXN1bHRTdHJpbmcgPT0gXCJcIikge1xuICAgICAgICAgICAgICByZXN1bHRTdHJpbmcgPSBjc3ZTdHJpbmdbaV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXN1bHRTdHJpbmcgPSByZXN1bHRTdHJpbmcgKyBcIjtcIiArIGNzdlN0cmluZ1tpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKHJlc3VsdFN0cmluZyA9PSBcIlwiKSB7XG4gICAgICAgICAgICByZXN1bHRTdHJpbmcgPSBjc3ZTdHJpbmdbaV07XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdFN0cmluZyA9IHJlc3VsdFN0cmluZyArIFwiO1wiICsgY3N2U3RyaW5nW2ldO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gcmV0dXJuIGNzdlN0cmluZy5yZXBsYWNlKC8sL2csIFwiO1wiKTtcbiAgICAgIHJldHVybiByZXN1bHRTdHJpbmc7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIHRoZSB1c2VyIGJhc2VkIG9uIGhpcyByb2xlIHdoZXRoZXIgaGUvc2hlIGlzIGFsbG93ZWQgYWNjZXNzIG9uIHRoZSBmZWF0dXJlIFxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBmZWF0dXJlXG4gICAgICogQHBhcmFtIHtvYmplY3R9IHVzZXIgY3VycmVudGx5IGxvZ2dlZCBpbiB1c2VyXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2hlY2tVc2VyQWNjZXNzT25GZWF0dXJlKGZlYXR1cmUsIHVzZXIpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IGNoZWNrVXNlckFjY2Vzc09uRmVhdHVyZSA+Pj4gXCIsIGZlYXR1cmUsIHVzZXIpO1xuICAgICAgLy8gYWRtaW5cbiAgICAgIGlmICgkc2Vzc2lvblN0b3JhZ2UuZ2V0T2JqZWN0KFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjFcIikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIC8vIHNlbmlvciB1c2VyXG4gICAgICBpZiAoJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCIyXCIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICAvLyB1c2VyXG4gICAgICBpZiAoJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCIzXCIpIHtcbiAgICAgICAgaWYgKGZlYXR1cmUucHJvcGVydGllcy51c2VyX2lkID09PSB1c2VyKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBndWVzdCB1c2VyXG4gICAgICBpZiAoJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCI0XCIpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGFjdGl2YXRlKCk7XG4gIH1cbn0pKCk7XG4ndXNlIHN0cmljdCc7XG5cbihmdW5jdGlvbiAoKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKCdNYXBCb3R0b21OYXZDb250cm9sbGVyJywgTWFwQm90dG9tTmF2Q29udHJvbGxlcik7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICBmdW5jdGlvbiBNYXBCb3R0b21OYXZDb250cm9sbGVyKCRjb250cm9sbGVyLCBNYXBTZXJ2aWNlLCBsb2Rhc2gsICRtZFNpZGVuYXYsICRyb290U2NvcGUsIE1hcExheWVyU2VydmljZSwgQzJEaWFsb2csICR0cmFuc2xhdGUsIE1hcFZpZXdlclNlcnZpY2UsICRzdGF0ZSkge1xuXG4gICAgdmFyIHZtID0gdGhpcztcbiAgICB2bS5hZnRlclNlYXJjaCA9IGFmdGVyU2VhcmNoO1xuICAgIHZtLnRvZ2dsZUJvdHRvbSA9IHRvZ2dsZUJvdHRvbTtcbiAgICB2bS5hcHBseUZpbHRlcnMgPSBhcHBseUZpbHRlcnM7XG4gICAgdm0udG9nZ2xlSW5jbHVkZVRvV29ya2luZ0xpc3QgPSB0b2dnbGVJbmNsdWRlVG9Xb3JraW5nTGlzdDtcbiAgICB2bS5pc0xvYWRlZCA9IGlzTG9hZGVkO1xuICAgIHZtLm9uQWN0aXZhdGUgPSBvbkFjdGl2YXRlO1xuICAgIHZtLnNob3dMb2FkTWFwSW5MZWZ0QnV0dG9uID0gc2hvd0xvYWRNYXBJbkxlZnRCdXR0b247XG4gICAgdm0uc2hvd0xvYWRNYXBJblJpZ2h0QnV0dG9uID0gc2hvd0xvYWRNYXBJblJpZ2h0QnV0dG9uO1xuICAgIHZtLmxvYWRHY3BPbk1hcCA9IGxvYWRHY3BPbk1hcDtcbiAgICB2bS5pc05vbkdlb3JlZkxvYWRlZCA9IGlzTm9uR2VvcmVmTG9hZGVkO1xuICAgIHZtLnNob3dGaWx0ZXJDaGVja2JveCA9IGZhbHNlO1xuICAgIHZtLnNob3dPbmx5Q2hpbGRNYXAgPSBmYWxzZTtcbiAgICB2bS5zaG93T25seUNoaWxkTWFwRnVuYyA9IHNob3dPbmx5Q2hpbGRNYXBGdW5jO1xuICAgIHZtLmlzQ2hpbGRNYXAgPSBpc0NoaWxkTWFwO1xuXG4gICAgLyoqXG4gICAgICogRXhlY3V0ZSB0aGUgYWN0aW9uIHdoZW4gdGhpcyBjb250cm9sbGVyIGlzIGFjdGl2YXRlZFxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG9uQWN0aXZhdGUoKSB7XG4gICAgICB2bS5zaG93Qm90dG9tTmF2ID0gZmFsc2U7XG4gICAgICB2bS5zaG93TG9hZE1hcEluUmlnaHQgPSBNYXBWaWV3ZXJTZXJ2aWNlLmdldE9wdGlvbigncmlnaHRNYXBWaWV3ZXInLCAnc2hvd0xvYWRNYXBJblJpZ2h0JywgdHJ1ZSk7XG4gICAgICB2bS5zaG93TG9hZE1hcEluTGVmdCA9IE1hcFZpZXdlclNlcnZpY2UuZ2V0T3B0aW9uKCdsZWZ0TWFwVmlld2VyJywgJ3Nob3dMb2FkTWFwSW5MZWZ0JywgdHJ1ZSk7XG4gICAgfVxuXG4gICAgLy8gaW5zdGFudGlhdGUgYmFzZSBjb250cm9sbGVyXG4gICAgJGNvbnRyb2xsZXIoJ0NSVURDb250cm9sbGVyJywge1xuICAgICAgdm06IHZtLFxuICAgICAgbW9kZWxTZXJ2aWNlOiBNYXBTZXJ2aWNlLFxuICAgICAgb3B0aW9uczoge1xuICAgICAgICBzZWFyY2hPbkluaXQ6IGZhbHNlLFxuICAgICAgICBwZXJQYWdlOiAxMVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogTGlzdGVuIHRvIHRoZSB2aWV3IHN3aXRjaCBldmVudCBhbmQgcmVsb2FkIHRoZSBkYXRhXG4gICAgICogZnJvbSB0aGUgYmFjay1lbmQgaWYgdGhlIHRhcmdldCB2aWV3IGlzIHRoZSB0aGUgZm9ybVxuICAgICAqL1xuICAgICRyb290U2NvcGUuJG9uKCdzd2l0Y2hlZFZpZXcnLCBmdW5jdGlvbiAoZXZlbnQsIGRhdGEpIHtcbiAgICAgIGlmIChkYXRhID09PSAnZm9ybScpIHtcbiAgICAgICAgdm0uc2VhcmNoKHZtLnBhZ2luYXRvci5jdXJyZW50UGFnZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAkcm9vdFNjb3BlLiRvbigndmlld2VyU2hvd24nLCBmdW5jdGlvbiAoZXZlbnQsIHZpZXdlcklkKSB7XG4gICAgICBpZiAodmlld2VySWQgPT09ICdyaWdodE1hcFZpZXdlcicpIHtcbiAgICAgICAgdm0uc2hvd0xvYWRNYXBJblJpZ2h0ID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZtLnNob3dMb2FkTWFwSW5MZWZ0ID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgICRyb290U2NvcGUuJG9uKCd2aWV3ZXJIaWRkZW4nLCBmdW5jdGlvbiAoZXZlbnQsIHZpZXdlcklkKSB7XG4gICAgICBpZiAodmlld2VySWQgPT09ICdyaWdodE1hcFZpZXdlcicpIHtcbiAgICAgICAgdm0uc2hvd0xvYWRNYXBJblJpZ2h0ID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2bS5zaG93TG9hZE1hcEluTGVmdCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gJHNjb3BlLiRvbignc2hvd09ubHlDaGlsZE1hcCcsIGZ1bmN0aW9uKG5ld1ZhbCwgb2xkVmFsKSB7XG4gICAgLy8gICBjb25zb2xlLmxvZyhcIj4+PiBzaG93T25seUNoaWxkTWFwID4+PiBcIiwgbmV3VmFsLCBvbGRWYWwpXG4gICAgLy8gICAvLyB2bS5zZWFyY2godm0ucGFnaW5hdG9yLmN1cnJlbnRQYWdlKTtcbiAgICAvLyB9KVxuICAgIC8qKlxuICAgICAqIEhlcmUgd2UgbGlzdGVuIHRvIHRoZSBhcHBseUZpbHRlcnMgY2FsbGJhY2sgdG8gYWRkIGN1c3RvbSBmaWx0ZXJzXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IGRlZmF1bHRRdWVyeUZpbHRlcnMgXG4gICAgICogQHJldHVybnMge31cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhcHBseUZpbHRlcnMoZGVmYXVsdFF1ZXJ5RmlsdGVycykge1xuICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0ucXVlcnlGaWx0ZXJzKSkge1xuICAgICAgICB2bS5xdWVyeUZpbHRlcnMgPSB7fTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhbmd1bGFyLmV4dGVuZChkZWZhdWx0UXVlcnlGaWx0ZXJzLCB2bS5xdWVyeUZpbHRlcnMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE1ha2Ugc29tZSBhZGp1c3RtZW50cyBpbiB0aGUgcmVzb3VyY2VzIGxpc3QgYWZ0ZXIgbG9hZGluZyB0aGVtXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IHJlc3BvbnNlIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFmdGVyU2VhcmNoKHJlc3BvbnNlKSB7XG4gICAgICBsb2Rhc2gubWFwKHZtLnJlc291cmNlcywgZnVuY3Rpb24gKG1hcCkge1xuICAgICAgICBtYXAubWFwSW1hZ2VGaWxlID0gbWFwLm1hcF9pbWFnZV9maWxlO1xuICAgICAgICBtYXAubWFwVHlwZU5hbWUgPSBtYXAubWFwX3R5cGVfbmFtZTtcbiAgICAgICAgcmV0dXJuIG1hcDtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICogT3Blbi9jbG9zZSB0aGUgcmlnaHQgc2lkZSBuYXZcbiAgICAqIFxuICAgICovXG4gICAgZnVuY3Rpb24gdG9nZ2xlQm90dG9tKCkge1xuICAgICAgdm0uc2hvd0JvdHRvbU5hdiA9ICF2bS5zaG93Qm90dG9tTmF2O1xuICAgICAgaWYgKHZtLnNob3dCb3R0b21OYXYgPT09IHRydWUpIHtcbiAgICAgICAgdm0ucGFnaW5hdG9yLmN1cnJlbnRQYWdlID0gdm0ucGFnaW5hdG9yLmN1cnJlbnRQYWdlID4gMCA/IHZtLnBhZ2luYXRvci5jdXJyZW50UGFnZSA6IDE7XG4gICAgICAgIHZtLnNlYXJjaCh2bS5wYWdpbmF0b3IuY3VycmVudFBhZ2UpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFkZC9yZW1vdmUgYSBtYXAgdG8gdGhlIHdvcmtpbmcgbGlzdFxuICAgICAqIFxuICAgICAqIEBwYXJhbSBvYmplY3QgcmVzb3VyY2UgXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9nZ2xlSW5jbHVkZVRvV29ya2luZ0xpc3QocmVzb3VyY2UsIHZpZXdlcklkKSB7XG4gICAgICB2YXIgdG9nZ2xlTG9hZE1hcCA9IGZ1bmN0aW9uIHRvZ2dsZUxvYWRNYXAoKSB7XG4gICAgICAgIGlmIChpc0xvYWRlZChyZXNvdXJjZSwgdmlld2VySWQpKSB7XG4gICAgICAgICAgTWFwTGF5ZXJTZXJ2aWNlLnJlbW92ZU1hcExheWVyKHJlc291cmNlLCB2aWV3ZXJJZCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgTWFwTGF5ZXJTZXJ2aWNlLmFkZE1hcExheWVyKHJlc291cmNlLCB2aWV3ZXJJZCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICAvLyBDb25maXJtIGJlZm9yZSBsb2FkaW5nIG5vbiBnZW9yZWZlcmVuY2VkIG1hcCAgICBcbiAgICAgIGlmICghaXNMb2FkZWQocmVzb3VyY2UsIHZpZXdlcklkKSAmJiByZXNvdXJjZS5nZW9yZWZlcmVuY2VkID09PSBmYWxzZSkge1xuICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgIHRpdGxlOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2RpYWxvZy5jb25maXJtTG9hZFVuZ2VvcmVmZXJlbmNlZFRpdGxlJyksXG4gICAgICAgICAgZGVzY3JpcHRpb246ICR0cmFuc2xhdGUuaW5zdGFudCgnZGlhbG9nLkxvYWRVbmdlb3JlZmVyZW5jZWREZXNjcmlwdGlvbicpLFxuICAgICAgICAgIHllczogJHRyYW5zbGF0ZS5pbnN0YW50KCdnbG9iYWwueWVzJyksXG4gICAgICAgICAgbm86ICR0cmFuc2xhdGUuaW5zdGFudCgnZ2xvYmFsLm5vJylcbiAgICAgICAgfTtcbiAgICAgICAgQzJEaWFsb2cuY29uZmlybShjb25maWcpLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHRvZ2dsZUxvYWRNYXAoKTtcbiAgICAgICAgICAvLyBsb29rIGZvciBHZW9yZWYgbWFwcyB3aGljaCBhcmUgYXNzb2NpYXRlZCB0byBjdXJyZW5jdGx5IG5vbmdlb3JlZiBpbWFnZVxuICAgICAgICAgIGNoZWNrQWxsR2VvUmVmTWFwcyhyZXNvdXJjZSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgLy8gQ29uZmlybSBiZWZvcmUgbG9hZGluZyBnZW9yZWZlcmVuY2VkIG1hcCB3aGVuIGEgbm9uIGdlb3JlZmVyZW5jZWQgbWFwIGlzIGFscmVhZHkgbG9hZGVkICAgXG4gICAgICBlbHNlIGlmIChNYXBMYXllclNlcnZpY2UuaGFzTm9uR2VvcmVmZXJlbmNlZExheWVyKHZpZXdlcklkKSkge1xuICAgICAgICAgIHZhciBjb25maWcgPSB7XG4gICAgICAgICAgICB0aXRsZTogJHRyYW5zbGF0ZS5pbnN0YW50KCdkaWFsb2cuY29uZmlybUxvYWRHZW9yZWZlcmVuY2VkVGl0bGUnKSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2RpYWxvZy5Mb2FkR2VvcmVmZXJlbmNlZERlc2NyaXB0aW9uJyksXG4gICAgICAgICAgICB5ZXM6ICR0cmFuc2xhdGUuaW5zdGFudCgnZ2xvYmFsLnllcycpLFxuICAgICAgICAgICAgbm86ICR0cmFuc2xhdGUuaW5zdGFudCgnZ2xvYmFsLm5vJylcbiAgICAgICAgICB9O1xuICAgICAgICAgIEMyRGlhbG9nLmNvbmZpcm0oY29uZmlnKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIE1hcExheWVyU2VydmljZS5yZW1vdmVBbGxNYXBMYXllcnModmlld2VySWQpO1xuICAgICAgICAgICAgdG9nZ2xlTG9hZE1hcCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGluIHRoZSBvdGhlciBjYXNlcywgcnVuIGRpcmVjdGx5IHRoZSB0b2dnbGVMb2FkTWFwIHRvIHJlbW92ZT8vYWRkIGEgbWFwXG4gICAgICAgICAgdG9nZ2xlTG9hZE1hcCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogY2hlY2sgaWYgYSBtYXAgcmVzb3VyY2UgaXMgYWxyZWFkeSBsb2FkZWRcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gb2JqZWN0IHJlc291cmNlIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGlzTG9hZGVkKHJlc291cmNlLCB2aWV3ZXJJZCkge1xuICAgICAgdmFyIGlzTG9hZGVkID0gTWFwTGF5ZXJTZXJ2aWNlLmlzQWRkZWQocmVzb3VyY2UsIHZpZXdlcklkKTtcbiAgICAgIHJldHVybiBpc0xvYWRlZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBjaGVjayBpZiBjdXJyZW50IHBhZ2UgaXMgR2VvcmVmZXJlbmNlIGFuZCBpZiB0aGUgbWFwIHJlc291cmNlIGlzIG5vbmdlb3JlZmVyZW5jZWQgXG4gICAgICogdGhhbiBvbmx5IGFsbG93IHRoZSB1c2VyIHRvIGxvYWQgaXQgaW4gbGVmdCBtYXAgYW5kIGdlb3JlZmVyZW5jZWQgcmVzb3VyY2UgaW4gcmlnaHQgbWFwXG4gICAgICogXG4gICAgICogQHBhcmFtIG9iamVjdCByZXNvdXJjZSBcbiAgICAgKiBAcmV0dXJucyBib29sZWFuXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2hvd0xvYWRNYXBJbkxlZnRCdXR0b24ocmVzb3VyY2UpIHtcbiAgICAgIGlmICgkc3RhdGUuY3VycmVudC5uYW1lID09PSBcImFwcC5nZW9yZWZlcmVuY2VcIikge1xuICAgICAgICBpZiAocmVzb3VyY2UuZ2VvcmVmZXJlbmNlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGNoZWNrIGlmIGN1cnJlbnQgcGFnZSBpcyBHZW9yZWZlcmVuY2UgYW5kIGlmIHRoZSBtYXAgcmVzb3VyY2UgaXMgbm9uZ2VvcmVmZXJlbmNlZCBcbiAgICAgKiB0aGFuIG9ubHkgYWxsb3cgdGhlIHVzZXIgdG8gbG9hZCBpdCBpbiBsZWZ0IG1hcCBhbmQgZ2VvcmVmZXJlbmNlZCByZXNvdXJjZSBpbiByaWdodCBtYXBcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gb2JqZWN0IHJlc291cmNlIFxuICAgICAqIEByZXR1cm5zIGJvb2xlYW5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzaG93TG9hZE1hcEluUmlnaHRCdXR0b24ocmVzb3VyY2UpIHtcbiAgICAgIGlmICgkc3RhdGUuY3VycmVudC5uYW1lID09PSBcImFwcC5nZW9yZWZlcmVuY2VcIikge1xuICAgICAgICBpZiAocmVzb3VyY2UuZ2VvcmVmZXJlbmNlZCA9PT0gdHJ1ZSkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2FsbGVkIHdoZW4gXCJMb2FkIEdDUCBvbiBNYXAgYnV0dG9uIGlzIGNsaWNrZWRcIlxuICAgICAqIFRyaWdnZXJzIGEgZXZlbnQgdG8gR2VvcmVmZXJlbmNlIGNvbnRyb2xsZXIgdG8gaGFuZGxlXG4gICAgICogXG4gICAgICogQHBhcmFtIG9iamVjdCByZXNvdXJjZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGxvYWRHY3BPbk1hcChyZXNvdXJjZSkge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gbWFwLmJvdHRvbS5uYXYuY29udHJvbGxlciA+Pj4gbG9hZEdjcE9uTWFwXCIpO1xuICAgICAgaWYgKHJlc291cmNlLmdlb3JlZmVyZW5jZWQpIHtcbiAgICAgICAgaWYgKHJlc291cmNlLmdjcHMpIHtcbiAgICAgICAgICAvLyBicm9hZGNhc3QgdG8gR2VvcmVmZXJlbmNlIGNvbnRyb2xsZXIgdG8gY3JlYXRlIG1hcmtlcnNcbiAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoXCJjcmVhdGVHY3BPbk1hcFwiLCBKU09OLnBhcnNlKHJlc291cmNlLmdjcHMpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGNoZWNrcyBpZiBOb25HZW9yZWZlcmVuY2VkIGltYWdlIGlzIGxvYWRlZCBpbiBsZWZ0IG1hcFxuICAgICAqIFxuICAgICAqIEBwYXJhbSBvYmplY3QgcmVzb3VyY2UgXG4gICAgICogQHJldHVybnMgYm9vbGVhbiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc05vbkdlb3JlZkxvYWRlZChyZXNvdXJjZSwgbWFwVmlld2VyKSB7XG4gICAgICBpZiAocmVzb3VyY2UuY2FuTG9hZEdjcCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPbmNlIGEgTm9uR2VvcmVmZXJlbmNlZCBpbWFnZSBpcyBsb2FkZWQsIGNoZWNrIGZvciBhbGwgR2VvcmVmZXJlbmNlZCBtYXBzIHRvIGtub3cgXG4gICAgICogd2hpY2ggYXJlIGFzc29jaWF0ZWQgdG8gaXQuIE9uY2Ugd2UgaGF2ZSB0aGUgbGlzdCBvZiBnZW9yZWYgbWFwcywgYWN0aXZhdGUgdGhlaXIgTG9hZCBHQ1AgYnV0dG9uXG4gICAgICogXG4gICAgICogQHBhcmFtIG9iamVjdCByZXNvdXJjZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNoZWNrQWxsR2VvUmVmTWFwcyhyZXNvdXJjZSkge1xuICAgICAgdmFyIGZpbGVOYW1lID0gcmVzb3VyY2UubWFwX2ltYWdlX2ZpbGUubmFtZTtcbiAgICAgIGlmIChmaWxlTmFtZS5zcGxpdCgnLicpICE9PSAtMSkge1xuICAgICAgICAvLyBsZXQgdGhlIGNoZWNrYm94IGJlIHZpc2libGUgZm9yIHRoZSB1c2VyIHRvIGZpbHRlclxuICAgICAgICB2bS5zaG93RmlsdGVyQ2hlY2tib3ggPSB0cnVlO1xuICAgICAgICBmaWxlTmFtZSA9IGZpbGVOYW1lLnNwbGl0KCcuJykuc2xpY2UoMCwgLTEpLmpvaW4oJy4nKTtcbiAgICAgICAgLy8gbG9vcCB0aHJvdWdoIGFsbCB0aGUgcmVzb3VyY2VzXG4gICAgICAgIGxvZGFzaC5mb3JFYWNoKHZtLnJlc291cmNlcywgZnVuY3Rpb24gKGVhY2hSZXNvdXJjZSkge1xuICAgICAgICAgIGlmIChlYWNoUmVzb3VyY2UuZ2VvcmVmZXJlbmNlZCkge1xuICAgICAgICAgICAgdmFyIHRlbXBJbWFnZU5hbWUgPSBlYWNoUmVzb3VyY2UubWFwX2ltYWdlX2ZpbGUubmFtZTtcbiAgICAgICAgICAgIHRlbXBJbWFnZU5hbWUgPSB0ZW1wSW1hZ2VOYW1lLnNwbGl0KCdfcmVjdCcpLnNsaWNlKDAsIC0xKS5qb2luKCdfcmVjdCcpO1xuICAgICAgICAgICAgaWYgKHRlbXBJbWFnZU5hbWUgPT09IGZpbGVOYW1lKSB7XG4gICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZWFjaFJlc291cmNlcyA9IFwiLCBlYWNoUmVzb3VyY2UpO1xuICAgICAgICAgICAgICBlYWNoUmVzb3VyY2UuY2FuTG9hZEdjcCA9IHRydWU7XG4gICAgICAgICAgICAgIGVhY2hSZXNvdXJjZS5pc0NoaWxkT2ZMb2FkZWROb25nZW9yZWYgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZWFjaFJlc291cmNlLmNhbkxvYWRHY3AgPSBmYWxzZTtcbiAgICAgICAgICAgICAgZWFjaFJlc291cmNlLmlzQ2hpbGRPZkxvYWRlZE5vbmdlb3JlZiA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlYWNoUmVzb3VyY2UuaXNDaGlsZE9mTG9hZGVkTm9uZ2VvcmVmID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiZmlsZSBkb2VzbnQgaGF2ZSBleHRlbnNpb25cIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXNDaGlsZE1hcChyZXNvdXJjZSkge1xuICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLnNob3dPbmx5Q2hpbGRNYXApKSB7XG4gICAgICAgIGlmICh2bS5zaG93T25seUNoaWxkTWFwKSB7XG4gICAgICAgICAgaWYgKHJlc291cmNlLmlzQ2hpbGRPZkxvYWRlZE5vbmdlb3JlZikge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNob3dPbmx5Q2hpbGRNYXBGdW5jKCkge1xuICAgICAgaWYgKHZtLnNob3dPbmx5Q2hpbGRNYXApIHtcbiAgICAgICAgLy8gZ2V0IGN1cnJlbnRseSBsb2FkZWQgcmVzb3VyY2VcbiAgICAgICAgdmFyIHJlc291cmNlID0gTWFwTGF5ZXJTZXJ2aWNlLmdldFZpZXdlck92ZXJsYXlzKCdsZWZ0TWFwVmlld2VyJyk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwicmVzb3VyY2UgPSBcIiwgcmVzb3VyY2UpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhPYmplY3QudmFsdWVzKHJlc291cmNlKVswXS5yZXNvdXJjZS5tYXBfc291cmNlX2lkKTtcbiAgICAgICAgdmFyIHRlbXBNYXBJZCA9IE9iamVjdC52YWx1ZXMocmVzb3VyY2UpWzBdLnJlc291cmNlLm1hcF9zb3VyY2VfaWQ7XG4gICAgICAgIC8vIGNyZWF0ZSBhIGZpbHRlclxuICAgICAgICB2bS5xdWVyeUZpbHRlcnMgPSB7IFwicGFyZW50X2lkXCI6IHRlbXBNYXBJZCB9O1xuICAgICAgICAvLyBjYWxsIGFwcGx5RmlsdGVyLCB3aGljaCB3aWxsIHRha2UgY2FyZSBvZiByZXN0XG4gICAgICAgIHZtLnNlYXJjaCh2bS5wYWdpbmF0b3IuY3VycmVudFBhZ2UpO1xuICAgICAgICBhZnRlclNlYXJjaChcInJlc3BvbnNlXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdm0ucXVlcnlGaWx0ZXJzID0gbnVsbDtcbiAgICAgICAgdm0uc2VhcmNoKHZtLnBhZ2luYXRvci5jdXJyZW50UGFnZSk7XG4gICAgICAgIGFmdGVyU2VhcmNoKFwicmVzcG9uc2VcIik7XG4gICAgICB9XG4gICAgfVxuICB9XG59KSgpO1xuJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24gKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29udHJvbGxlcignTWFwUmlnaHRTaWRlbmF2Q29udHJvbGxlcicsIE1hcFJpZ2h0U2lkZW5hdkNvbnRyb2xsZXIpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgZnVuY3Rpb24gTWFwUmlnaHRTaWRlbmF2Q29udHJvbGxlcigkc2NvcGUsICR0aW1lb3V0LCAkbWRTaWRlbmF2LCAkbG9nLCAkcm9vdFNjb3BlLCBNYXBMYXllclNlcnZpY2UsIGxvZGFzaCwgJHdpbmRvdykge1xuXG4gICAgdmFyIHZtID0gdGhpcztcbiAgICB2bS5jbG9zZSA9IGNsb3NlO1xuICAgIHZtLnNob3dNYXAgPSBzaG93TWFwO1xuICAgIHZtLmhpZGVNYXAgPSBoaWRlTWFwO1xuICAgIHZtLnJlbW92ZU1hcCA9IHJlbW92ZU1hcDtcbiAgICB2bS5hcHBseU9wYWNpdHkgPSBhcHBseU9wYWNpdHk7XG4gICAgdm0uZml0TWFwQm91bmRzID0gZml0TWFwQm91bmRzO1xuICAgIHZtLmZpbHRlck1hcExheWVycyA9IGZpbHRlck1hcExheWVycztcblxuICAgIC8qKlxuICAgICAqIFJ1biB0aGUgaW5pdGlhbCBhY3Rpb25zIHdoZW4gdGhlIGNvbnRyb2xsZXIgaXMgYWN0aXZhdGVkXG4gICAgICovXG4gICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG4gICAgICByZWZyZXNoT3ZlcmxheXMoKTtcbiAgICAgIHZtLnNvcnRhYmxlQ29uZiA9IHsgb25VcGRhdGU6IHVwZGF0ZUFmdGVyU29ydCwgaGFuZGxlOiAnLmdyYWItaGFuZGxlJyB9O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsb3NlIHRoZSBzaWRlbmF2XG4gICAgICovXG4gICAgZnVuY3Rpb24gY2xvc2UoKSB7XG4gICAgICAkbWRTaWRlbmF2KCdyaWdodCcpLmNsb3NlKCkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIHlvdSBjYW4gYWRkIHNvbWUgdGFzayBhZnRlciBjbG9zaW5nXG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2hvdyBhIG1hcCBhbHJlYWR5IGxvYWRlZCBpbiB0aGUgdmlld2VyXG4gICAgICogQHBhcmFtIHt9IGxheWVyIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNob3dNYXAobGF5ZXIpIHtcbiAgICAgIE1hcExheWVyU2VydmljZS5zaG93TWFwKGxheWVyLnJlc291cmNlLCBsYXllci52aWV3ZXJJZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGlkZSBhIG1hcCBhbHJlYWR5IGxvYWRlZCBpbiB0aGUgdmlld2VyXG4gICAgICogQHBhcmFtIHt9IGxheWVyIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGhpZGVNYXAobGF5ZXIpIHtcbiAgICAgIE1hcExheWVyU2VydmljZS5oaWRlTWFwKGxheWVyLnJlc291cmNlLCBsYXllci52aWV3ZXJJZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlICh1bmxvYWQpIGEgbWFwIGZyb20gdGhlIHZpZXdlclxuICAgICAqIEBwYXJhbSB7fSBsYXllciBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZW1vdmVNYXAobGF5ZXIpIHtcbiAgICAgIE1hcExheWVyU2VydmljZS5yZW1vdmVNYXBMYXllcihsYXllci5yZXNvdXJjZSwgbGF5ZXIudmlld2VySWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpdCB0aGUgYm91bmRzIG9mIGFuIGFscmVhZHkgbG9hZGVkIG1hcCBzbyB0aGUgdGhhdCBhbGwgdGhlIG1hcCBpcyB2aXNpYmxlXG4gICAgICogQHBhcmFtIHt9IGxheWVyIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZpdE1hcEJvdW5kcyhsYXllcikge1xuICAgICAgTWFwTGF5ZXJTZXJ2aWNlLmZpdE1hcEJvdW5kcyhsYXllci5yZXNvdXJjZSwgbGF5ZXIudmlld2VySWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFwcGx5IHRoZSBvcGFjaXR5IGRlZmluZWQgaW4gdGhlIGxheWVyLmxheWVyUGFyYW1zLm9wYWNpdHkgcHJvcGVydHlcbiAgICAgKiBAcGFyYW0ge30gbGF5ZXIgXG4gICAgICovXG4gICAgZnVuY3Rpb24gYXBwbHlPcGFjaXR5KGxheWVyKSB7XG4gICAgICBNYXBMYXllclNlcnZpY2UuYXBwbHlPcGFjaXR5KGxheWVyKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaWx0ZXIgdGhlIG1hcCBsYXllcnMgbG9hZGVkIGluIHRoZSB2aWV3ZXIgYnkgbmFtZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZpbHRlck1hcExheWVycygpIHtcbiAgICAgIHJlZnJlc2hPdmVybGF5cygpO1xuICAgICAgdm0ubG9hZGVkTWFwc0xheWVycyA9IGxvZGFzaC5maWx0ZXIodm0ubG9hZGVkTWFwc0xheWVycywgZnVuY3Rpb24gKGxheWVyKSB7XG4gICAgICAgIHJldHVybiBsYXllci5yZXNvdXJjZS50aXRsZS50b0xvd2VyQ2FzZSgpLmluZGV4T2Yodm0uZmlsdGVyTWFwTGF5ZXJzVHh0LnRvTG93ZXJDYXNlKCkpICE9IC0xO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVmcmVzaCB0aGUgbWFwcyBsYXllcnMgaW4gdGhlIHNpZGViYXIgbGlzdCB3aGVuIHRoZSBtYXBMYXllcnNDaGFuZ2VkIGV2ZW50IGlzIGJyb2FkY2FzdGVkXG4gICAgICovXG4gICAgJHJvb3RTY29wZS4kb24oJ21hcExheWVyc0NoYW5nZWQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIHJlZnJlc2hPdmVybGF5cygpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogUmVmcmVzaCB0aGUgb3ZlcmxheXMgaW4gdGhlIHByb3BlcnR5IGxvYWRlZE1hcHNMYXllcnMgZ2V0dGluZyBpdCBmcm9tIE1hcExheWVyU2VydmljZVxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlZnJlc2hPdmVybGF5cygpIHtcbiAgICAgIC8vIGluaXRpYWxseSBkZWZpbmUgdGhlIG92ZXJsYXlzIGFzIGFuIGVtcHR5IGFycmF5XG4gICAgICB2bS5sb2FkZWRNYXBzTGF5ZXJzID0gW107XG5cbiAgICAgIC8vIEFzIHdlIHdhbnQgdG8gbGlzdCBhbGwgdGhlIGxheWVycywgdGhlbiBnZXQgdGhlIGxheWVycyBmcm9tIGJvdGggdmlld2Vyc1xuICAgICAgdmFyIHJpZ2h0TGF5ZXJzID0gTWFwTGF5ZXJTZXJ2aWNlLmdldFZpZXdlck92ZXJsYXlzKCdyaWdodE1hcFZpZXdlcicpO1xuICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHJpZ2h0TGF5ZXJzKSkge1xuICAgICAgICBhbmd1bGFyLmZvckVhY2gocmlnaHRMYXllcnMsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgdmFsdWUuaWQgPSBrZXk7XG4gICAgICAgICAgdm0ubG9hZGVkTWFwc0xheWVycy5wdXNoKHZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBsZWZ0TGF5ZXJzID0gTWFwTGF5ZXJTZXJ2aWNlLmdldFZpZXdlck92ZXJsYXlzKCdsZWZ0TWFwVmlld2VyJyk7XG4gICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQobGVmdExheWVycykpIHtcbiAgICAgICAgYW5ndWxhci5mb3JFYWNoKGxlZnRMYXllcnMsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgdmFsdWUuaWQgPSBrZXk7XG4gICAgICAgICAgdm0ubG9hZGVkTWFwc0xheWVycy5wdXNoKHZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICAvLyBUaGUgbGF5ZXJzIG11c3QgYmUgc2hvdyBpbiByZXZlcnNlIG9yZGVyIChsYXN0IGFkZGVkIG9uIHRoZSB0b3ApXG4gICAgICB2bS5sb2FkZWRNYXBzTGF5ZXJzID0gdm0ubG9hZGVkTWFwc0xheWVycy5zbGljZSgpLnJldmVyc2UoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGUgdGhlIHJlb3JkZXIvc29ydCBldmVudCBhbmQgYXBwbHkgaXQgdG8gdGhlIE1hcExheWVyU2VydmljZVxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7YW55fSBldnQgXG4gICAgICovXG4gICAgZnVuY3Rpb24gdXBkYXRlQWZ0ZXJTb3J0KGV2dCkge1xuICAgICAgTWFwTGF5ZXJTZXJ2aWNlLmFwcGx5UmVvcmRlcihldnQubW9kZWxzKTtcbiAgICB9XG5cbiAgICBhY3RpdmF0ZSgpO1xuICB9XG59KSgpOyIsIi8qZXNsaW50IGFuZ3VsYXIvZmlsZS1uYW1lOiAwKi9cbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gIFxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnLCBbXG4gICAgICAnbmdBbmltYXRlJyxcbiAgICAgICduZ0FyaWEnLFxuICAgICAgJ3VpLnJvdXRlcicsXG4gICAgICAnbmdDMicsXG4gICAgICAndWkudXRpbHMubWFza3MnLFxuICAgICAgJ3RleHQtbWFzaycsXG4gICAgICAnbmdNYXRlcmlhbCcsXG4gICAgICAnbW9kZWxGYWN0b3J5JyxcbiAgICAgICdtZC5kYXRhLnRhYmxlJyxcbiAgICAgICduZ01hdGVyaWFsRGF0ZVBpY2tlcicsXG4gICAgICAncGFzY2FscHJlY2h0LnRyYW5zbGF0ZScsXG4gICAgICAnYW5ndWxhckZpbGVVcGxvYWQnLFxuICAgICAgJ25nTWF0ZXJpYWwnLCBcbiAgICAgICduZ0FuaW1hdGUnLCBcbiAgICAgICduZ01lc3NhZ2VzJywgXG4gICAgICAnbmdBcmlhJywgXG4gICAgICAndWkucm91dGVyJyxcbiAgICAgICdsZk5nTWRGaWxlSW5wdXQnLFxuICAgICAgJ25lbUxvZ2dpbmcnLFxuICAgICAgJ3VpLWxlYWZsZXQnLCBcbiAgICAgICduZy1zb3J0YWJsZScgICAgIFxuICAgIF0pO1xuICB9KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gIFxuICAgIGFuZ3VsYXJcbiAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAuY29uZmlnKGNvbmZpZyk7XG4gIFxuICAgIC8qKiBAbmdJbmplY3QgKi9cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICAgIGZ1bmN0aW9uIGNvbmZpZyhHbG9iYWwsICRtZFRoZW1pbmdQcm92aWRlciwgJG1vZGVsRmFjdG9yeVByb3ZpZGVyLFxuICAgICAgJHRyYW5zbGF0ZVByb3ZpZGVyLCBtb21lbnQsICRtZEFyaWFQcm92aWRlciwgJHdpbmRvd1Byb3ZpZGVyKSB7XG4gIFxuICAgICAgJHRyYW5zbGF0ZVByb3ZpZGVyXG4gICAgICAgIC51c2VMb2FkZXIoJ2xhbmd1YWdlTG9hZGVyJylcbiAgICAgICAgLnVzZVNhbml0aXplVmFsdWVTdHJhdGVneSgnZXNjYXBlJyk7XG4gIFxuICAgICAgLy8kdHJhbnNsYXRlUHJvdmlkZXIudXNlUG9zdENvbXBpbGluZyh0cnVlKTtcbiAgXG4gICAgICBtb21lbnQubG9jYWxlKCdlbi1HQicpO1xuICBcbiAgICAgIC8vdGhlIHByZWZpeCB0byBiZSB1c2VkIGluIGFsbCBiYWNrLWVuZCBhcGkgcmVxdWVzdHNcbiAgICAgIHZhciAkd2luZG93ID0gJHdpbmRvd1Byb3ZpZGVyLiRnZXQoKTtcbiAgICAgICRtb2RlbEZhY3RvcnlQcm92aWRlci5kZWZhdWx0T3B0aW9ucy5wcmVmaXggPSBHbG9iYWwuYXBpUGF0aDtcbiAgXG4gICAgICAvLyBDb25maWd1cmF0aW9uIHRoZW1lIC0gc2VlOiBodHRwczovL21hdGVyaWFsLmFuZ3VsYXJqcy5vcmcvbGF0ZXN0L1RoZW1pbmcvMDNfY29uZmlndXJpbmdfYV90aGVtZVxuICAgICAgJG1kVGhlbWluZ1Byb3ZpZGVyLnRoZW1lKCdkZWZhdWx0JylcbiAgICAgICAgLnByaW1hcnlQYWxldHRlKCdibHVlJywge1xuICAgICAgICAgIGRlZmF1bHQ6ICc3MDAnXG4gICAgICAgIH0pXG4gICAgICAgIC5hY2NlbnRQYWxldHRlKCdpbmRpZ28nKVxuICAgICAgICAud2FyblBhbGV0dGUoJ2RlZXAtb3JhbmdlJyk7XG4gIFxuICAgICAgLy8gRW5hYmxlIGJyb3dzZXIgY29sb3JcbiAgICAgICRtZFRoZW1pbmdQcm92aWRlci5lbmFibGVCcm93c2VyQ29sb3IoKTsgICAgIFxuICBcbiAgICAgICRtZEFyaWFQcm92aWRlci5kaXNhYmxlV2FybmluZ3MoKTtcbiAgXG4gICAgfVxuICB9KCkpO1xuICAiLCIoZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuY29udHJvbGxlcignQXBwQ29udHJvbGxlcicsIEFwcENvbnRyb2xsZXIpO1xuXG4gICAgLyoqIEBuZ0luamVjdCAqL1xuICAgIC8qKlxuICAgICAqIENvbnRyb2xsZXIgcmVzcG9uc2libGUgZm9yIGZ1bmN0aW9uYWxpdGllcyB0aGF0IGFyZSB1c2VkIGluIGFueSBzeXN0ZW0gc3RhdGUvcGFnZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIEFwcENvbnRyb2xsZXIoJHN0YXRlLCBHbG9iYWwsICRsb2NhbFN0b3JhZ2UpIHtcbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAvLyBDdXJyZW50IHllYXIgdG8gYmUgc2hvd24gaW4gdGhlIGZvb3RlclxuICAgICAgICB2bS5jdXJyZW50WWVhciA9IG51bGw7XG4gICAgICAgIGFjdGl2YXRlKCk7XG5cbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG4gICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICB2bS5jdXJyZW50WWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHNlc3Npb25TdG9yYWdlLmNsZWFyKCk7XG4gICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oXCJyb2xlXCIsIFwiYWRtaW5cIik7XG4gICAgICAgIGlmKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpID09PSBcImFkbWluXCIpIHtcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oXCJyb2xlXCIsIFwiMVwiKTtcbiAgICAgICAgfSBlbHNlIGlmKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpID09PSBcInNlbmlvclwiKSB7XG4gICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKFwicm9sZVwiLCBcIjJcIik7XG4gICAgICAgIH0gZWxzZSBpZihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKSA9PT0gXCJ1c2VyXCIpIHtcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oXCJyb2xlXCIsIFwiM1wiKTtcbiAgICAgICAgfSBlbHNlIGlmKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpID09PSBcImd1ZXN0XCIpIHtcbiAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oXCJyb2xlXCIsIFwiNFwiKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJhcHBjb250cm9sbGVyIFwiLCAkbG9jYWxTdG9yYWdlKTtcbiAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShcInByb2pJZFwiLCBcIjMxMDI0MjgzXCIpO1xuICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKFwidXNlcklkXCIsIFwiMTAwMFwiKTtcbiAgICB9XG5cbn0pKCk7IiwiLyplc2xpbnQgYW5ndWxhci9maWxlLW5hbWU6IDAsIG5vLXVuZGVmOiAwKi9cbihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gIFxuICAgIC8qKlxuICAgICAqIFRyYW5zZm9ybXMgZXh0ZXJuYWwgbGlicyBpbiBhbmd1bGFyIHNlcnZpY2VzIHNvIHdlIGNhbiB1c2UgdGhlbSB3aXRoIGRlcGVuZGVuY2UgaW5qZWN0aW9uXG4gICAgICovXG4gICAgYW5ndWxhclxuICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgIC5jb25zdGFudCgnbG9kYXNoJywgXylcbiAgICAgIC5jb25zdGFudCgnbW9tZW50JywgbW9tZW50KSBcbiAgICAgIC5jb25zdGFudCgnbGVhZmxldCcsIEwpO1xuICB9KCkpO1xuICAiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICBcbiAgICBhbmd1bGFyXG4gICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgLmNvbnN0YW50KCdHbG9iYWwnLCB7XG4gICAgICAgIGFwcE5hbWU6ICdIZWlNQVAnLFxuICAgICAgICBpbWFnZVBhdGg6ICcvaW1hZ2VzJyxcbiAgICAgICAgY2xpZW50UGF0aDogJy93ZWJhcHAvYXBwJywgICAgICAgIFxuICAgICAgICBob21lU3RhdGU6ICdhcHAubWFwJyxcbiAgICAgICAgaG9tZVVybDogJy9tYXAnLFxuICAgICAgICBhcGlQYXRoOiAnJ1xuICAgICAgfSk7XG4gIH0oKSk7XG4gICIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gIFxuICAgIGFuZ3VsYXJcbiAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAuY29uZmlnKHJvdXRlcyk7XG4gIFxuICAgIC8qKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiByb3V0ZXMoJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlciwgR2xvYmFsKSB7ICBcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgICAgLnN0YXRlKCdhcHAnLCB7ICAgICAgICAgICAgXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogR2xvYmFsLmNsaWVudFBhdGggKyAnL3NoYXJlZC9wYXJ0aWFscy9hcHAuaHRtbCcsICAgICAgICAgICBcbiAgICAgICAgICAgIGFic3RyYWN0OiB0cnVlLCAgICAgICAgICAgIFxuICAgICAgICAgICAgcmVzb2x2ZTogeyAvL2Vuc3VyZSBsYW5ncyBpcyByZWFkeSBiZWZvcmUgcmVuZGVyIHZpZXdcbiAgICAgICAgICAgICAgdHJhbnNsYXRlUmVhZHk6IFsnJHRyYW5zbGF0ZScsICckcScsIGZ1bmN0aW9uKCR0cmFuc2xhdGUsICRxKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICBcbiAgICAgICAgICAgICAgICAkdHJhbnNsYXRlLnVzZSgnZW4tR0InKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgIFxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICAgICAgICB9XVxuICAgICAgICAgICAgfSAgICAgICAgIFxuICAgICAgICB9KSAgICAgICAgICAgIFxuICAgIFxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIud2hlbignL2FwcCcsIEdsb2JhbC5ob21lVXJsKTsgICAgICAgIFxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKEdsb2JhbC5ob21lVXJsKTtcbiAgICB9XG4gIH0oKSk7XG4gICIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gIFxuICAgIGFuZ3VsYXJcbiAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAucnVuKHJ1bik7XG4gIFxuICAgIC8qKiBAbmdJbmplY3QgKi9cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICAgIGZ1bmN0aW9uIHJ1bigkcm9vdFNjb3BlLCAkc3RhdGUsICRzdGF0ZVBhcmFtcywgR2xvYmFsKSB7XG4gICAgICAvL1NldHMgdGhlIHJvb3RTY29wZSBzbyBpdCBjYW4gYmUgYWNjZXNzZWQgaW4gdGhlIHZpZXdzIHdpdGhvdXQgdGhlIGNvbnRyb2xsZXIgcHJlZml4XG4gICAgICAkcm9vdFNjb3BlLiRzdGF0ZSA9ICRzdGF0ZTtcbiAgICAgICRyb290U2NvcGUuJHN0YXRlUGFyYW1zID0gJHN0YXRlUGFyYW1zOyAgICAgIFxuICAgICAgJHJvb3RTY29wZS5nbG9iYWwgPSBHbG9iYWw7XG4gICAgfVxuICB9KCkpO1xuICAiLCIvKmVzbGludCBhbmd1bGFyL2ZpbGUtbmFtZTogMCovXHJcbihmdW5jdGlvbigpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIGFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuZmFjdG9yeSgnc2VydmljZUZhY3RvcnknLCBzZXJ2aWNlRmFjdG9yeSk7XHJcblxyXG4gIC8qKiBAbmdJbmplY3QgKi9cclxuICAvKipcclxuICAgKiBNb3JlIGluZm9ybWF0aW9uOlxyXG4gICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9zd2ltbGFuZS9hbmd1bGFyLW1vZGVsLWZhY3Rvcnkvd2lraS9BUElcclxuICAgKi9cclxuICBmdW5jdGlvbiBzZXJ2aWNlRmFjdG9yeSgkbW9kZWxGYWN0b3J5KSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24odXJsLCBvcHRpb25zKSB7XHJcbiAgICAgIHZhciBtb2RlbDtcclxuICAgICAgdmFyIGRlZmF1bHRPcHRpb25zID0ge1xyXG4gICAgICAgIGFjdGlvbnM6IHtcclxuICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICogQWN0aW9uIHRvIGRvIGEgcGFnaW5hdGVkIHNlYXJjaFxyXG4gICAgICAgICAgICogRXhwZWN0cyB0aGF0IGEganNvbiBvYmplY3Qgd2l0aCB0aGUgcHJvcGVydGllcyBpdGVtcyBhbmQgdG90YWxcclxuICAgICAgICAgICAqL1xyXG4gICAgICAgICAgcGFnaW5hdGU6IHtcclxuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgaXNBcnJheTogZmFsc2UsXHJcbiAgICAgICAgICAgIHdyYXA6IGZhbHNlLFxyXG4gICAgICAgICAgICBhZnRlclJlcXVlc3Q6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlWydpdGVtcyddKSB7XHJcbiAgICAgICAgICAgICAgICByZXNwb25zZVsnaXRlbXMnXSA9IG1vZGVsLkxpc3QocmVzcG9uc2VbJ2l0ZW1zJ10pO1xyXG4gICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9kZWwgPSAkbW9kZWxGYWN0b3J5KHVybCwgYW5ndWxhci5tZXJnZShkZWZhdWx0T3B0aW9ucywgb3B0aW9ucykpXHJcblxyXG4gICAgICByZXR1cm4gbW9kZWw7XHJcbiAgICB9XHJcbiAgfVxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xyXG5cclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIGFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29udHJvbGxlcignQ1JVRENvbnRyb2xsZXInLCBDUlVEQ29udHJvbGxlcik7XHJcblxyXG4gIC8qKiBAbmdJbmplY3QgKi9cclxuICAvKipcclxuICAgKiBCYXNlIENvbnRyb2xsZXIgdGhhdCAgaW1wbGVtZW50cyBhbCB0aGUgc3RhbmRhcmQgQ1JVRCBmdW5jdGlvbnNcclxuICAgKlxyXG4gICAqIEltcGxlbWVudGVkIGFjdGlvbnM6XHJcbiAgICogYWN0aXZhdGUoKVxyXG4gICAqIHNlYXJjaChwYWdlKVxyXG4gICAqIGVkaXQocmVzb3VyY2UpXHJcbiAgICogc2F2ZSgpXHJcbiAgICogcmVtb3ZlKHJlc291cmNlKVxyXG4gICAqIGdvVG8odmlld05hbWUpXHJcbiAgICogY2xlYW5Gb3JtKClcclxuICAgKlxyXG4gICAqIFRyaWdnZXJzOlxyXG4gICAqXHJcbiAgICogb25BY3RpdmF0ZSgpXHJcbiAgICogYXBwbHlGaWx0ZXJzKGRlZmF1bHRRdWVyeUZpbHRlcnMpXHJcbiAgICogYmVmb3JlU2VhcmNoKHBhZ2UpIC8vcmV0dXJuaW5nIGZhbHNlIGNhbmNlbCB0aGUgc3VibWlzc2lvbi9mbG93XHJcbiAgICogYWZ0ZXJTZWFyY2gocmVzcG9uc2UpXHJcbiAgICogYmVmb3JlQ2xlYW4gLy9yZXR1cm5pbmcgZmFsc2UgY2FuY2VsIHRoZSBzdWJtaXNzaW9uL2Zsb3dcclxuICAgKiBhZnRlckNsZWFuKClcclxuICAgKiBiZWZvcmVTYXZlKCkgLy9yZXR1cm5pbmcgZmFsc2UgY2FuY2VsIHRoZSBzdWJtaXNzaW9uL2Zsb3dcclxuICAgKiBhZnRlclNhdmUocmVzb3VyY2UpXHJcbiAgICogb25TYXZlRXJyb3IoZXJyb3IpXHJcbiAgICogYmVmb3JlUmVtb3ZlKHJlc291cmNlKSAvL3JldHVybmluZyBmYWxzZSBjYW5jZWwgdGhlIHN1Ym1pc3Npb24vZmxvd1xyXG4gICAqIGFmdGVyUmVtb3ZlKHJlc291cmNlKVxyXG4gICAqXHJcbiAgICogQHBhcmFtIHthbnl9IHZtIGNoaWxkIGNvbnRyb2xsZXIgaW5zdGFuY2VcclxuICAgKiBAcGFyYW0ge2FueX0gbW9kZWxTZXJ2aWNlIG1vZGVsIHNlcnZpY2UgdGhhdCB0aGUgY29udHJvbGxlciB3aWxsIHVzZSBmb3IgdGhlIHJlc3RmdWwgcmVxdWVzdHNcclxuICAgKiBAcGFyYW0ge2FueX0gb3B0aW9ucyBvcHRpb25zIHRvIG92ZXJ3cml0ZSB0aGUgZGVmYXVsdCBiZWhhdmlvcnNcclxuICAgKi9cclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xyXG4gIGZ1bmN0aW9uIENSVURDb250cm9sbGVyKHZtLCBtb2RlbFNlcnZpY2UsIG9wdGlvbnMsIEMyVG9hc3QsIEMyUGFnaW5hdGlvbiwgLy8gTk9TT05BUlxyXG4gICAgQzJEaWFsb2csICR0cmFuc2xhdGUpIHtcclxuXHJcbiAgICAvL0Z1bmN0aW9ucyBCbG9ja1xyXG4gICAgdm0uc2VhcmNoID0gc2VhcmNoO1xyXG4gICAgdm0ucGFnaW5hdGVTZWFyY2ggPSBwYWdpbmF0ZVNlYXJjaDtcclxuICAgIHZtLm5vcm1hbFNlYXJjaCA9IG5vcm1hbFNlYXJjaDtcclxuICAgIHZtLmVkaXQgPSBlZGl0O1xyXG4gICAgdm0uc2F2ZSA9IHNhdmU7XHJcbiAgICB2bS5yZW1vdmUgPSByZW1vdmU7XHJcbiAgICB2bS5nb1RvID0gZ29UbztcclxuICAgIHZtLmNsZWFuRm9ybSA9IGNsZWFuRm9ybTtcclxuXHJcbiAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUHJlcGFyZSB0aGUgY29udHJvbGxlclxyXG4gICAgICogRG8gYW4gb3B0aW9ucyBtZXJnZVxyXG4gICAgICogSW5pdGlhbGl6ZSB0aGUgcmVzb3VyY2VcclxuICAgICAqIEluaXRpYWxpemUgdGhlIHBhZ2luZyBvYmplY3QgYW5kIGRvIHRoZSBpbml0aWFsIHNlYXJjaCAoaWYgc2VhcmNoT25Jbml0IGlzIHRydWUgKVxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgdm0uZGVmYXVsdE9wdGlvbnMgPSB7XHJcbiAgICAgICAgcmVkaXJlY3RBZnRlclNhdmU6IHRydWUsXHJcbiAgICAgICAgc2VhcmNoT25Jbml0OiB0cnVlLFxyXG4gICAgICAgIHBlclBhZ2U6IDgsXHJcbiAgICAgICAgc2tpcFBhZ2luYXRpb246IGZhbHNlXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBhbmd1bGFyLm1lcmdlKHZtLmRlZmF1bHRPcHRpb25zLCBvcHRpb25zKTtcclxuXHJcbiAgICAgIHZtLnZpZXdGb3JtID0gZmFsc2U7XHJcbiAgICAgIHZtLnJlc291cmNlID0gbmV3IG1vZGVsU2VydmljZSgpOyBcclxuXHJcbiAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24odm0ub25BY3RpdmF0ZSkpIHZtLm9uQWN0aXZhdGUoKTtcclxuXHJcbiAgICAgIHZhciBsYWJlbE9wdGlvbnMgPSB7XHJcbiAgICAgICAgbGFiZWxzOiB7XHJcbiAgICAgICAgICB0b3RhbDogJHRyYW5zbGF0ZS5pbnN0YW50KCd2aWV3cy5wYWdpbmF0aW9uLnRvdGFsJyksXHJcbiAgICAgICAgICBpdGVtczogJHRyYW5zbGF0ZS5pbnN0YW50KCd2aWV3cy5wYWdpbmF0aW9uLml0ZW1zJylcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICB2bS5wYWdpbmF0b3IgPSBDMlBhZ2luYXRpb24uZ2V0SW5zdGFuY2Uodm0uc2VhcmNoLCB2bS5kZWZhdWx0T3B0aW9ucy5wZXJQYWdlLCBsYWJlbE9wdGlvbnMpO1xyXG5cclxuICAgICAgaWYgKHZtLmRlZmF1bHRPcHRpb25zLnNlYXJjaE9uSW5pdCkgdm0uc2VhcmNoKCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRG8gYSBzZWFyY2hcclxuICAgICAqIENoZWNrcyB3aGljaCBvZiB0aGUgc2VhcmNoIGZ1bmN0aW9ucyBtdXN0IGJlIHVzZWRcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ge2FueX0gcGFnZSBwYWdlIHRoYXQgbXVzdCBiZSByZXF1ZXN0ZWRcclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gc2VhcmNoKHBhZ2UpIHtcclxuICAgICAgKHZtLmRlZmF1bHRPcHRpb25zLnNraXBQYWdpbmF0aW9uKSA/IG5vcm1hbFNlYXJjaCgpOiBwYWdpbmF0ZVNlYXJjaChwYWdlKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIERvIGEgcGFnZWQgc2VhcmNoIHdpdGggdGhlIGFwcGxpZWQgZmlsdGVyc1xyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7YW55fSBwYWdlIHBhZ2UgdGhhdCBtdXN0IGJlIHJlcXVlc3RlZFxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBwYWdpbmF0ZVNlYXJjaChwYWdlKSB7XHJcbiAgICAgIHZtLnBhZ2luYXRvci5jdXJyZW50UGFnZSA9IChhbmd1bGFyLmlzRGVmaW5lZChwYWdlKSkgPyBwYWdlIDogMTtcclxuICAgICAgdm0uZGVmYXVsdFF1ZXJ5RmlsdGVycyA9IHtcclxuICAgICAgICBwYWdlOiB2bS5wYWdpbmF0b3IuY3VycmVudFBhZ2UsXHJcbiAgICAgICAgcGVyUGFnZTogdm0ucGFnaW5hdG9yLnBlclBhZ2VcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24odm0uYXBwbHlGaWx0ZXJzKSl7XHJcbiAgICAgICAgdm0uZGVmYXVsdFF1ZXJ5RmlsdGVycyA9IHZtLmFwcGx5RmlsdGVycyh2bS5kZWZhdWx0UXVlcnlGaWx0ZXJzKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKHZtLmJlZm9yZVNlYXJjaCkgJiYgdm0uYmVmb3JlU2VhcmNoKHBhZ2UpID09PSBmYWxzZSkgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgbW9kZWxTZXJ2aWNlLnBhZ2luYXRlKHZtLmRlZmF1bHRRdWVyeUZpbHRlcnMpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgdm0ucGFnaW5hdG9yLmNhbGNOdW1iZXJPZlBhZ2VzKHJlc3BvbnNlLnRvdGFsKTtcclxuICAgICAgICB2bS5yZXNvdXJjZXMgPSByZXNwb25zZS5pdGVtcztcclxuXHJcbiAgICAgICAgaWYgKGFuZ3VsYXIuaXNGdW5jdGlvbih2bS5hZnRlclNlYXJjaCkpIHZtLmFmdGVyU2VhcmNoKHJlc3BvbnNlKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBEbyBhIHNlYXJjaCB3aXRoIHRoZSBhcHBsaWVkIGZpbHRlcnNcclxuICAgICAqXHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIG5vcm1hbFNlYXJjaCgpIHtcclxuICAgICAgdm0uZGVmYXVsdFF1ZXJ5RmlsdGVycyA9IHt9O1xyXG5cclxuICAgICAgaWYgKGFuZ3VsYXIuaXNGdW5jdGlvbih2bS5hcHBseUZpbHRlcnMpKSB2bS5kZWZhdWx0UXVlcnlGaWx0ZXJzID0gdm0uYXBwbHlGaWx0ZXJzKHZtLmRlZmF1bHRRdWVyeUZpbHRlcnMpO1xyXG4gICAgICBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKHZtLmJlZm9yZVNlYXJjaCkgJiYgdm0uYmVmb3JlU2VhcmNoKCkgPT09IGZhbHNlKSByZXR1cm4gZmFsc2U7XHJcblxyXG4gICAgICBtb2RlbFNlcnZpY2UucXVlcnkodm0uZGVmYXVsdFF1ZXJ5RmlsdGVycykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICB2bS5yZXNvdXJjZXMgPSByZXNwb25zZTtcclxuXHJcbiAgICAgICAgaWYgKGFuZ3VsYXIuaXNGdW5jdGlvbih2bS5hZnRlclNlYXJjaCkpIHZtLmFmdGVyU2VhcmNoKHJlc3BvbnNlKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBDbGVhciB0aGUgZm9ybVxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBjbGVhbkZvcm0oZm9ybSkge1xyXG4gICAgICBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKHZtLmJlZm9yZUNsZWFuKSAmJiB2bS5iZWZvcmVDbGVhbigpID09PSBmYWxzZSkgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgICAgdm0ucmVzb3VyY2UgPSBuZXcgbW9kZWxTZXJ2aWNlKCk7XHJcblxyXG4gICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQoZm9ybSkpIHtcclxuICAgICAgICBmb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICAgIGZvcm0uJHNldFVudG91Y2hlZCgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKHZtLmFmdGVyQ2xlYW4pKSB2bS5hZnRlckNsZWFuKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBMb2FkIHRoZSBzZWxlY3RlZCByZXNvdXJjZSBpbiB0aGUgZm9ybVxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7YW55fSByZXNvdXJjZSBzZWxlY3RlZCByZXNvdXJjZVxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBlZGl0KHJlc291cmNlKSB7XHJcbiAgICAgIHZtLmdvVG8oJ2Zvcm0nKTtcclxuICAgICAgdm0ucmVzb3VyY2UgPSBuZXcgYW5ndWxhci5jb3B5KHJlc291cmNlKTtcclxuXHJcbiAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24odm0uYWZ0ZXJFZGl0KSkgdm0uYWZ0ZXJFZGl0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTYXZlIG9yIHVwZGF0ZSB0aGUgcmVzb3VyY2VcclxuICAgICAqIEluIHRoZSBkZWZhdWx0IGJlaGF2aW9yLCByZWRpcmVjdCB0aGUgdXNlciB0byB0aGUgbGlzdCB2aWV3IGFmdGVyIHNhdmluZ1xyXG4gICAgICpcclxuICAgICAqIEByZXR1cm5zXHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIHNhdmUoZm9ybSkge1xyXG4gICAgICBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKHZtLmJlZm9yZVNhdmUpICYmIHZtLmJlZm9yZVNhdmUoKSA9PT0gZmFsc2UpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgIC8vIGNvbnNvbGUubG9nKHZtLnJlc291cmNlKVxyXG5cclxuICAgICAgdm0ucmVzb3VyY2UuJHNhdmUoKS50aGVuKGZ1bmN0aW9uIChyZXNvdXJjZSkge1xyXG4gICAgICAgIC8vdm0ucmVzb3VyY2UgPSByZXNvdXJjZTtcclxuXHJcbiAgICAgICAgaWYgKGFuZ3VsYXIuaXNGdW5jdGlvbih2bS5hZnRlclNhdmUpKSB2bS5hZnRlclNhdmUocmVzb3VyY2UpO1xyXG5cclxuICAgICAgICBpZiAodm0uZGVmYXVsdE9wdGlvbnMucmVkaXJlY3RBZnRlclNhdmUpIHtcclxuICAgICAgICAgIHZtLmNsZWFuRm9ybShmb3JtKTtcclxuICAgICAgICAgIHZtLnNlYXJjaCh2bS5wYWdpbmF0b3IuY3VycmVudFBhZ2UpO1xyXG4gICAgICAgICAgdm0uZ29UbygnbGlzdCcpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgQzJUb2FzdC5zdWNjZXNzKCR0cmFuc2xhdGUuaW5zdGFudCgnbWVzc2FnZXMuc2F2ZVN1Y2Nlc3MnKSk7XHJcblxyXG4gICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2VEYXRhKSB7XHJcbiAgICAgICAgaWYgKGFuZ3VsYXIuaXNGdW5jdGlvbih2bS5vblNhdmVFcnJvcikpIHZtLm9uU2F2ZUVycm9yKHJlc3BvbnNlRGF0YSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIC8qKlxyXG4gICAgLy8gICogU2F2ZSB2ZWN0b3IgR2VvSlNPTiBkYXRhXHJcbiAgICAvLyAgKiBcclxuICAgIC8vICAqIEByZXR1cm5zXHJcbiAgICAvLyAgKi9cclxuICAgIC8vIGZ1bmN0aW9uIHNhdmVnZW9qc29uKGRhdGEpe1xyXG4gICAgLy8gICBkYXRhID0gXCJ7YWRzc2R9XCJcclxuICAgIC8vICAgdm0ucmVzb3VyY2UuZ2Vvc2pvbmRhdGEgPSBkYXRhXHJcbiAgICAvLyAgIGNvbnNvbGUubG9nKHZtLnJlc291cmNlKVxyXG4gICAgLy8gICAvLyB2bS5yZXNvdXJjZS4kc2F2ZSgpLnRoZW4oZnVuY3Rpb24gKHJlc291cmNlKSB7XHJcbiAgICAvLyAgIC8vICAgLy8gdm0ucmVzb3VyY2UgPSByZXNvdXJjZTtcclxuXHJcbiAgICAvLyAgIC8vICAgLy8gY29uc29sZS5sb2coXCJyZXNvdXJjZVwiKVxyXG5cclxuICAgIC8vICAgLy8gfSwgZnVuY3Rpb24gKHJlc3BvbnNlRGF0YSkge1xyXG4gICAgLy8gICAvLyAgIC8vIGNvbnNvbGUubG9nKFwicmVzcG9uc2VEYXRhXCIpO1xyXG4gICAgLy8gICAvLyB9KTtcclxuICAgIC8vIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJldHJpZXZlIHZlY3RvciBHZW9KU09OIGRhdGFcclxuICAgICAqIFxyXG4gICAgICogQHJldHVybnNcclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gcmV0cmlldmVnZW9qc29uKHBhcmFtcyl7XHJcbiAgICAgIGNvbnNvbGUubG9nKHBhcmFtcylcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFJlbW92ZSB0aGUgcmVzb3VyY2UsIGJ1dCBiZWZvcmUgc2hvdyBhIGRpYWxvZyB0byBjb25maXJtICAgICBcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ge2FueX0gcmVzb3VyY2UgcmVzb3VyY2Ugc2VsZWN0ZWRcclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gcmVtb3ZlKHJlc291cmNlKSB7XHJcbiAgICAgIHZhciBjb25maWcgPSB7XHJcbiAgICAgICAgdGl0bGU6ICR0cmFuc2xhdGUuaW5zdGFudCgnZGlhbG9nLmNvbmZpcm1UaXRsZScpLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2RpYWxvZy5jb25maXJtRGVzY3JpcHRpb24nKSxcclxuICAgICAgICB5ZXM6ICR0cmFuc2xhdGUuaW5zdGFudCgnZ2xvYmFsLnllcycpLFxyXG4gICAgICAgIG5vOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2dsb2JhbC5ubycpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIEMyRGlhbG9nLmNvbmZpcm0oY29uZmlnKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoYW5ndWxhci5pc0Z1bmN0aW9uKHZtLmJlZm9yZVJlbW92ZSkgJiYgdm0uYmVmb3JlUmVtb3ZlKHJlc291cmNlKSA9PT0gZmFsc2UpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgICAgcmVzb3VyY2UuJGRlc3Ryb3koKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24odm0uYWZ0ZXJSZW1vdmUpKSB2bS5hZnRlclJlbW92ZShyZXNvdXJjZSk7XHJcblxyXG4gICAgICAgICAgdm0uc2VhcmNoKCk7XHJcbiAgICAgICAgICBDMlRvYXN0LmluZm8oJHRyYW5zbGF0ZS5pbnN0YW50KCdtZXNzYWdlcy5yZW1vdmVTdWNjZXNzJykpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFN3aXRjaCBiZXR3ZWVuIHRoZSBsaXN0IGFuZCBmb3JtIG1vZGVcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ge2FueX0gdmlld05hbWUgdmlldyBuYW1lIHRvIHdpdGNoIHRvXHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIGdvVG8odmlld05hbWUpIHtcclxuICAgICAgdm0udmlld0Zvcm0gPSBmYWxzZTtcclxuXHJcbiAgICAgIGlmICh2aWV3TmFtZSA9PT0gJ2Zvcm0nKSB7XHJcbiAgICAgICAgdm0uY2xlYW5Gb3JtKCk7XHJcbiAgICAgICAgdm0udmlld0Zvcm0gPSB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICBcbiAgICAndXNlIHN0cmljdCc7XG4gIFxuICAgIGFuZ3VsYXJcbiAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAuY29udHJvbGxlcignR2VvcmVmZXJlbmNlQ29udHJvbGxlcicsIEdlb3JlZmVyZW5jZUNvbnRyb2xsZXIpO1xuICBcbiAgICAvKiogQG5nSW5qZWN0ICovXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgICBmdW5jdGlvbiBHZW9yZWZlcmVuY2VDb250cm9sbGVyKCRjb250cm9sbGVyLCAkc2NvcGUsIE1hcE1hcmtlclNlcnZpY2UsIGxlYWZsZXRNYXJrZXJFdmVudHMsICRyb290U2NvcGUsIE1hcFZpZXdlclNlcnZpY2UsICR0cmFuc2xhdGUsIEMyRGlhbG9nLCAkbWRDb2xvcnMsICRtZFNpZGVuYXYsIEdsb2JhbCwgJHRpbWVvdXQsIGxvZGFzaCkge1xuICAgICAgdmFyIHZtID0gdGhpcztcbiAgXG4gICAgICAvLyBGdW5jdGlvbnMgQmxvY2sgICAgIFxuICAgICAgdm0ub25WaWV3ZXJBY3RpdmF0ZSA9IG9uVmlld2VyQWN0aXZhdGU7XG4gICAgICB2bS50b2dnbGVDcmVhdGVNYXJrZXIgPSB0b2dnbGVDcmVhdGVNYXJrZXI7XG4gICAgICB2bS5iZWZvcmVWaWV3ZXJBY3RpdmF0ZSA9IGJlZm9yZVZpZXdlckFjdGl2YXRlO1xuICAgICAgdm0udG9nZ2xlUmVtb3ZlTWFya2VyID0gdG9nZ2xlUmVtb3ZlTWFya2VyO1xuICAgICAgdm0ub3BlblNhdmVHZW9SZWYgPSBvcGVuU2F2ZUdlb1JlZjtcbiAgICAgIHZtLnZhbGlkR0NQID0gdmFsaWRHQ1A7XG4gICAgICB2bS5udW1PZkdDUCA9IG51bU9mR0NQO1xuICAgICAgdm0ucmVkcmF3TWFya2VycyA9IHJlZHJhd01hcmtlcnM7XG5cbiAgICAgIC8vIFNldCB0aGUgbWFwIHZpZXdlciBvcHRpb25zXG4gICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgc3VwcG9ydExpc3RpbmdWaWV3IDogZmFsc2UsXG4gICAgICAgIHN1cHBvcnREcmF3aW5nIDogZmFsc2UsXG4gICAgICAgIHRpdGxlVHJhbnNsS2V5IDogJ3ZpZXdzLnRpdGxlcy5tYXBHZW9yZWZlcmVuY2luZycsXG4gICAgICAgIHNob3dHZW9SZWZUb29scyA6IHRydWUsXG4gICAgICAgIGxlZnRTaWRlQmFyOiBHbG9iYWwuY2xpZW50UGF0aCArICcvZ2VvcmVmZXJlbmNlL25hdnMvZ2VvLWxlZnQtc2lkZW5hdi5odG1sJyxcbiAgICAgICAgc2hvd0djcFRhYmxlOiB0cnVlLFxuICAgICAgICBnY3BUYWJsZTogR2xvYmFsLmNsaWVudFBhdGggKyAnL2dlb3JlZmVyZW5jZS9uYXZzL2djcC1UYWJsZS5odG1sJ1xuICAgICAgfTtcblxuICAgICAgLy8gaW5pdGlhbGl6ZSBlbXB0eSBtYXJrZXJzIG9iamVjdFxuICAgICAgdm0ucmlnaHRNYXJrZXJzID0ge307XG4gICAgICB2bS5sZWZ0TWFya2VycyA9IHt9O1xuICBcbiAgICAgIC8vIGluc3RhbnRpYXRlIHRoZSBiYXNlIE1hcFZpZXdlckNvbnRyb2xsZXJcbiAgICAgICRjb250cm9sbGVyKCdNYXBWaWV3ZXJDb250cm9sbGVyJywgeyB2bTogdm0sICRzY29wZTogJHNjb3BlLCBvcHRpb25zfSk7XG4gICAgICBcbiAgICAgIC8vIExpc3RlbiB0byB0aGUgcmlnaHRNYXBWaWV3ZXIgZHJhZ2VuZFxuICAgICAgJHJvb3RTY29wZS4kb24oJ2xlYWZsZXREaXJlY3RpdmVNYXJrZXIucmlnaHRNYXBWaWV3ZXIuZHJhZ2VuZCcsIGZ1bmN0aW9uKGV2ZW50LCBhcmdzKXsgICAgICAgICAgIFxuICAgICAgICBpZih2bS5yaWdodENyZWF0ZU1hcmtlckVuYWJsZSA9PT0gdHJ1ZSl7XG4gICAgICAgICAgLy8gZG9pbmcgbm90aGluZyBmb3IgYSB3aGlsZVxuICAgICAgICB9ICAgICAgIFxuICAgICAgfSk7XG5cbiAgICAgIC8vIExpc3RlbiB0byB0aGUgcmlnaHRNYXBWaWV3ZXIgY2xpY2sgYW5kIHJlbW92ZSB0aGUgbWFya2VyIGlmIHRoZSByZW1vdmFsIHRvb2wgaXMgZW5hYmxlZFxuICAgICAgJHJvb3RTY29wZS4kb24oJ2xlYWZsZXREaXJlY3RpdmVNYXJrZXIucmlnaHRNYXBWaWV3ZXIuY2xpY2snLCBmdW5jdGlvbihldmVudCwgYXJncyl7ICAgICAgICAgICBcbiAgICAgICAgaWYodm0ucmlnaHRSZW1vdmVNYXJrZXJFbmFibGUgPT09IHRydWUpe1xuICAgICAgICAgIHZhciBpZCA9IGFyZ3MubW9kZWwuaWQ7XG4gICAgICAgICAgcmVtb3ZlTWFya2VyKGlkKTtcbiAgICAgICAgICAvLyBjYWxsIGFuIGV2ZW50IHRvIGRlbGV0ZSBpdCBmcm9tIEdDUCBUYWJsZVxuICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdChcImRlbGV0ZUdjcEZyb21UYWJsZUV2ZW50XCIsIGlkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBlbnN1cmUgdGhlIGV2ZW50IGlzIGZpcmVkIGZyb20gR0NQIFRhYmxlIGRlbGV0ZSBidXR0b25cbiAgICAgICAgICBpZihhcmdzLm1vZGVsLmV2ZW50RnJvbSA9PT0gXCJnY3BUYWJsZVwiKSB7XG4gICAgICAgICAgICB2YXIgaWQgPSBhcmdzLm1vZGVsLmlkO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coaWQpXG4gICAgICAgICAgICByZW1vdmVNYXJrZXIoaWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIExpc3RlbiB0byB0aGUgbGVmdE1hcFZpZXdlciBjbGljayBhbmQgcmVtb3ZlIHRoZSBtYXJrZXIgaWYgdGhlIHJlbW92YWwgdG9vbCBpcyBlbmFibGVkXG4gICAgICAkcm9vdFNjb3BlLiRvbignbGVhZmxldERpcmVjdGl2ZU1hcmtlci5sZWZ0TWFwVmlld2VyLmNsaWNrJywgZnVuY3Rpb24oZXZlbnQsIGFyZ3MpeyAgICAgICAgICAgXG4gICAgICAgIGlmKHZtLmxlZnRSZW1vdmVNYXJrZXJFbmFibGUgPT09IHRydWUpe1xuICAgICAgICAgIHZhciBpZCA9IGFyZ3MubW9kZWwuaWQ7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coaWQpXG4gICAgICAgICAgcmVtb3ZlTWFya2VyKGlkKTsgICAgICAgICBcbiAgICAgICAgICAvLyBjYWxsIGFuIGV2ZW50IHRvIGRlbGV0ZSBpdCBmcm9tIEdDUCBUYWJsZVxuICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdChcImRlbGV0ZUdjcEZyb21UYWJsZUV2ZW50XCIsIGlkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBlbnN1cmUgdGhlIGV2ZW50IGlzIGZpcmVkIGZyb20gR0NQIFRhYmxlIGRlbGV0ZSBidXR0b25cbiAgICAgICAgICBpZihhcmdzLm1vZGVsLmV2ZW50RnJvbSA9PT0gXCJnY3BUYWJsZVwiKSB7XG4gICAgICAgICAgICB2YXIgaWQgPSBhcmdzLm1vZGVsLmlkO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coaWQpXG4gICAgICAgICAgICByZW1vdmVNYXJrZXIoaWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIExpc3RlbiB0byB0aGUgcmlnaHRNYXBWaWV3ZXIgY2xpY2sgYW5kIGFkZCBhIG1hcmtlciBvbiB0aGUgY2xpY2tlZCBwb3NpdGlvblxuICAgICAgLy8gaWYgdGhlIG1hcmtlciBjcmVhdGlvbiB0b29sIGlzIGVuYWJsZWRcbiAgICAgICRyb290U2NvcGUuJG9uKFwibGVhZmxldERpcmVjdGl2ZU1hcC5yaWdodE1hcFZpZXdlci5jbGlja1wiLCBmdW5jdGlvbihldmVudCwgYXJncyl7ICAgICAgICBcbiAgICAgICAgaWYodm0ucmlnaHRDcmVhdGVNYXJrZXJFbmFibGUgPT09IHRydWUpeyAgICAgICAgXG4gICAgICAgICAgYWRkTWFya2VyKGFyZ3MubGVhZmxldEV2ZW50LCAncmlnaHRNYXJrZXJzJyk7XG4gICAgICAgICAgLy8gZW5zdXJlIGJvdGggdGhlIG1hcHMgaGF2ZSBlcXVhbCBudW1iZXIgb2YgbWFya2Vyc1xuICAgICAgICAgIGlmKGxvZGFzaC5zaXplKHZtWydsZWZ0TWFya2VycyddKSA9PT0gXy5zaXplKHZtWydyaWdodE1hcmtlcnMnXSkpIHtcbiAgICAgICAgICAgIC8vIGZpcmUgZXZlbnQgdG8gR0NQIGNvbnRyb2xsZXIgZm9yIGNhcWxsIHJlZnJlc2hHQ1BUYWJsZVxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KFwicmVmcmVzaEdjcFRhYmxlRXZlbnRcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9IFxuICAgICAgfSk7XG5cbiAgICAgIC8vIExpc3RlbiB0byB0aGUgbGVmdE1hcFZpZXdlciBjbGljayBhbmQgYWRkIGEgbWFya2VyIG9uIHRoZSBjbGlja2VkIHBvc2l0aW9uXG4gICAgICAvLyBpZiB0aGUgbWFya2VyIGNyZWF0aW9uIHRvb2wgaXMgZW5hYmxlZFxuICAgICAgJHJvb3RTY29wZS4kb24oXCJsZWFmbGV0RGlyZWN0aXZlTWFwLmxlZnRNYXBWaWV3ZXIuY2xpY2tcIiwgZnVuY3Rpb24oZXZlbnQsIGFyZ3MpeyAgICAgICAgXG4gICAgICAgIGlmKHZtLmxlZnRDcmVhdGVNYXJrZXJFbmFibGUgPT09IHRydWUpeyAgICAgICAgIFxuICAgICAgICAgIGFkZE1hcmtlcihhcmdzLmxlYWZsZXRFdmVudCwgJ2xlZnRNYXJrZXJzJyk7XG4gICAgICAgICAgLy8gZW5zdXJlIGJvdGggdGhlIG1hcHMgaGF2ZSBlcXVhbCBudW1iZXIgb2YgbWFya2Vyc1xuICAgICAgICAgIGlmKF8uc2l6ZSh2bVsnbGVmdE1hcmtlcnMnXSkgPT09IF8uc2l6ZSh2bVsncmlnaHRNYXJrZXJzJ10pKSB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIm1hcmtlciBzaXllIGVxdWFsIG9uIGJvdGggbWFwc1wiKTtcbiAgICAgICAgICAgIC8vIGZpcmUgZXZlbnQgdG8gR0NQIGNvbnRyb2xsZXIgZm9yIGNhcWxsIHJlZnJlc2hHQ1BUYWJsZVxuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KFwicmVmcmVzaEdjcFRhYmxlRXZlbnRcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9IFxuICAgICAgfSk7XG5cbiAgICAgIC8vIExpc3RlbiB0byB0aGUgcmlnaHRNYXBWaWV3ZXIgY2xpY2sgYW5kIGFkZCBhIG1hcmtlciBvbiB0aGUgY2xpY2tlZCBwb3NpdGlvblxuICAgICAgLy8gaWYgdGhlIG1hcmtlciBjcmVhdGlvbiB0b29sIGlzIGVuYWJsZWRcbiAgICAgICRyb290U2NvcGUuJG9uKFwiY3JlYXRlTWFya2VyRm9yVGFibGVcIiwgZnVuY3Rpb24oZXZlbnQsIGFyZ3MpeyAgXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IGdlb3JlZmVyZW5jZS5jb250cm9sbGVyID4+PiBjcmVhdGVNYXJrZXJGb3JUYWJsZSBcIiwgYXJncyk7XG4gICAgICAgIGlmKGFyZ3MubWFya2Vyc0tlZXBlciA9PT0gXCJsZWZ0TWFya2Vyc1wiKSB7XG4gICAgICAgICAgYWRkTWFya2VyKGFyZ3MsICdsZWZ0TWFya2VycycpO1xuICAgICAgICB9XG4gICAgICAgIGlmKGFyZ3MubWFya2Vyc0tlZXBlciA9PT0gXCJyaWdodE1hcmtlcnNcIikge1xuICAgICAgICAgIGFkZE1hcmtlcihhcmdzLCAncmlnaHRNYXJrZXJzJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBMaXN0ZW4gdG8gdGhlIGRpc2FibGUgbWFya2VyIGNyZWF0aW9uIFxuICAgICAgJHJvb3RTY29wZS4kb24oXCJ0b2dnbGVNYXJrZXJDcmVhdGlvblwiLCBmdW5jdGlvbihldmVudCwgYXJncyl7ICBcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gZ2VvcmVmZXJlbmNlLmNvbnRyb2xsZXIgPj4+IHRvZ2dsZU1hcmtlckNyZWF0aW9uIFwiLCBhcmdzKTtcbiAgICAgICAgdmFyIG1hcmtlcnNLZWVwZXIgPSBhcmdzLm1hcmtlcnNLZWVwZXI7IC8vICdsZWZ0TWFwVmlld2VyJ1xuICAgICAgICB0b2dnbGVDcmVhdGVNYXJrZXIobWFya2Vyc0tlZXBlcik7XG4gICAgICB9KTtcblxuICAgICAgLy8gTGlzdGVuIHRvIGNyZWF0ZSBtYXJrZXJzIG9uIG1hcCBiYXNlZCBvbiBHQ1AgcG9zaXRpb25zXG4gICAgICAkcm9vdFNjb3BlLiRvbihcImNyZWF0ZUdjcE9uTWFwXCIsIGZ1bmN0aW9uKGV2ZW50LCBhcmdzKXsgIFxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBnZW9yZWZlcmVuY2UuY29udHJvbGxlciA+Pj4gY3JlYXRlR2NwT25NYXAgXCIsIGFyZ3MpO1xuICAgICAgICBcbiAgICAgICAgbG9kYXNoLmZvckVhY2goYXJncywgZnVuY3Rpb24ocG9zaXRpb24pIHtcbiAgICAgICAgICB2YXIgcHJlcGFyZWRNYXJrZXJEYXRhID0gcHJlcGFyZURhdGFGb3JBZGRNYXJrZXIocG9zaXRpb24pO1xuICAgICAgICAgIGFkZE1hcmtlcihwcmVwYXJlZE1hcmtlckRhdGEuaW1hZ2VQb3NpdGlvbiwgJ2xlZnRNYXJrZXJzJyk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gZGVsYXkgaXMgYWRkZWQgb3RoZXJ3aXNlIG9ubHkgb25lIG9mIHRoZSBtYXAgaGFzIG1hcmtlcnMgb24gaXRcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgYWRkTWFya2VyKHByZXBhcmVkTWFya2VyRGF0YS5tYXBQb3NpdGlvbiwgJ3JpZ2h0TWFya2VycycpOyAgXG4gICAgICAgICAgfSwgMTApO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICB9KTtcblxuICAgICAgLyoqXG4gICAgICAgKiBBZGQgYSBtYXJrZXIgb24gYSBnaXZlbiBtYXJrZXJzIGtlZXBlciBvYmplY3RcbiAgICAgICAqIFxuICAgICAgICogQHBhcmFtIHthbnl9IGxlYWZFdmVudCBcbiAgICAgICAqIEBwYXJhbSB7YW55fSBtYXJrZXJzS2VlcGVyIFxuICAgICAgICovXG4gICAgICBmdW5jdGlvbiBhZGRNYXJrZXIobGVhZkV2ZW50LCBtYXJrZXJzS2VlcGVyKXsgICAgICAgIFxuICAgICAgICB2YXIgbWFya2VyRGF0YSA9IHtcbiAgICAgICAgICBsYXQ6IGxlYWZFdmVudC5sYXRsbmcubGF0LFxuICAgICAgICAgIGxuZzogbGVhZkV2ZW50LmxhdGxuZy5sbmcsXG4gICAgICAgICAgZm9jdXM6IHRydWUgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIG5ld01hcmtlciA9IE1hcE1hcmtlclNlcnZpY2UuYnVpbGRNYXJrZXIodm1bbWFya2Vyc0tlZXBlcl0sIG1hcmtlckRhdGEpOyAgICAgICBcbiAgICAgICAgdm1bbWFya2Vyc0tlZXBlcl1bbmV3TWFya2VyLmlkXSA9IG5ld01hcmtlcjsgXG4gICAgICB9XG5cbiAgICAgIC8qKlxuICAgICAgICogUmVtb3ZlIGEgZ2l2ZW4gbWFya2VyIGlkIGZyb20gYm90IHZpZXdlcnNcbiAgICAgICAqIFxuICAgICAgICogQHBhcmFtIHthbnl9IG1hcmtlcklkIFxuICAgICAgICovXG4gICAgICBmdW5jdGlvbiByZW1vdmVNYXJrZXIobWFya2VySWQpeyAgICAgICAgXG4gICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLmxlZnRNYXJrZXJzW21hcmtlcklkXSkpe1xuICAgICAgICAgIC8vIHZhciB0ZW1wTWFya2VySWQgPSB2bS5sZWZ0TWFya2Vyc1ttYXJrZXJJZF0uaWNvbi5jbGFzc05hbWUuc3BsaXQoXCIgXCIpWzFdO1xuICAgICAgICAgIGRlbGV0ZSB2bS5sZWZ0TWFya2Vyc1ttYXJrZXJJZF07XG4gICAgICAgICAgLy8gcmVkcmF3TWFya2Vycyh2bS5sZWZ0TWFya2VycywgdGVtcE1hcmtlcklkKTtcbiAgICAgICAgfVxuICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5yaWdodE1hcmtlcnNbbWFya2VySWRdKSl7XG4gICAgICAgICAgdmFyIHRlbXBNYXJrZXJJZCA9IHZtLnJpZ2h0TWFya2Vyc1ttYXJrZXJJZF0uaWNvbi5jbGFzc05hbWUuc3BsaXQoXCIgXCIpWzFdO1xuICAgICAgICAgIC8vIGFkZGVkIGEgdGltZW91dCBvdGhlciB3aXNlLCBhZnRlciBkZWxldGluZyBtYXJrZXIgb24gbGVmdHNpZGUgbWFwIGFuZCB0aGVuIGNyZWF0aW5nIGEgXG4gICAgICAgICAgLy8gbWFya2VyIG9uIHJpZ2h0c2lkZSB3YXMgbm90IGluLXN5bmNcbiAgICAgICAgICAvLyBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIGRlbGV0ZSB2bS5yaWdodE1hcmtlcnNbbWFya2VySWRdO1xuICAgICAgICAgIC8vICAgcmVkcmF3TWFya2Vycyh2bS5yaWdodE1hcmtlcnMsIHRlbXBNYXJrZXJJZCk7ICAgIFxuICAgICAgICAgIC8vIH0sIDEwKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvKipcbiAgICAgICAqIFJlZHJhdy91cGRhdGVzIGEgZ2l2ZW4gbWFwIChtYXJrZXJza2VlcGVyIC0gb2JqZWN0KSBhbGwgdGhlIG1hcmtlcnMgXG4gICAgICAgKiBleGNlcHQgdGhlIGRlbGV0ZWQgb25lXG4gICAgICAgKiBcbiAgICAgICAqIEBwYXJhbSB7YW55fSBtYXJrZXJzS2VlcGVyIFxuICAgICAgICogQHBhcmFtIHthbnl9IGRlbGV0ZWRNYXJrZXJJZCBcbiAgICAgICAqL1xuICAgICAgZnVuY3Rpb24gcmVkcmF3TWFya2VycyhtYXJrZXJzS2VlcGVyLCBkZWxldGVkTWFya2VySWQpIHsgICAgICAgIFxuICAgICAgICBcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj5nZW9yZWZlcmVuY2VDb250cm9sbGxlciA+Pj4gcmVkcmF3TWFya2VycyBcIiwgbWFya2Vyc0tlZXBlciwgZGVsZXRlZE1hcmtlcklkWzFdKTtcbiAgICAgICAgXy5mb3JPd24obWFya2Vyc0tlZXBlciwgZnVuY3Rpb24gKG1hcmtlciwga2V5KSB7XG4gICAgICAgICAgdmFyIHRlbXBJZE51bSA9IG1hcmtlci5pY29uLmNsYXNzTmFtZS5zcGxpdChcIiBcIilbMV1bMV07XG4gICAgICAgICAgaWYodGVtcElkTnVtID4gZGVsZXRlZE1hcmtlcklkWzFdKSB7XG4gICAgICAgICAgICB2YXIgbmV3TWFya2VyTm8gPSB0ZW1wSWROdW0gLSAxOyAgXG4gICAgICAgICAgICAvLyB1aSBjaGFuZ2VzIG9mIG1hcmtlciBpY29uXG4gICAgICAgICAgICBtYXJrZXIuaWNvbi5odG1sID0gXCI8ZGl2IGNsYXNzPVxcXCJtay1pY29uLWNvbnRhaW5lciBtay1va1xcXCI+XCIrIG5ld01hcmtlck5vICsgXCI8L2Rpdj5cIlxuICAgICAgICAgICAgbWFya2VyLmljb24uY2xhc3NOYW1lID0gXCJtay1kaXYtaWNvbiBtXCIrIG5ld01hcmtlck5vO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBjaGFuZ2UgdGhlIG9sZCBrZXkgb2YgdGhlIG1hcmtlciB3aXRoIG5ldyBvbmUsIG90aGVyd2lzZSB0aGUgbmV3bHkgY3JlYXRlZCBtYXJrZXIncyBudW1iZXJpbmcgXG4gICAgICAgICAgICAvLyB3aWxsIG5vdCBiZSBpbiBzeW5jXG4gICAgICAgICAgICB2YXIgb2xkS2V5ID0ga2V5OyBcbiAgICAgICAgICAgIHZhciBuZXdLZXk9XCJtXCIgKyBuZXdNYXJrZXJObzsgXG4gICAgICAgICAgICBpZiAob2xkS2V5ICE9PSBuZXdLZXkpIHtcbiAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG1hcmtlcnNLZWVwZXIsIG5ld0tleSwgXG4gICAgICAgICAgICAgICAgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihtYXJrZXJzS2VlcGVyLCBvbGRLZXkpKTtcbiAgICAgICAgICAgICAgZGVsZXRlIG1hcmtlcnNLZWVwZXJbb2xkS2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwibWFya2VyID0gXCIsIG1hcmtlcik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBBY3Rpb25zIGV4ZWN1dGVkIGJlZm9yZSB0aGUgYmFzZSB2aWV3ZXIgaXMgYWN0aXZhdGVkXG4gICAgICAgKiBcbiAgICAgICAqL1xuICAgICAgZnVuY3Rpb24gYmVmb3JlVmlld2VyQWN0aXZhdGUoKXsgIFxuICAgICAgICBcbiAgICAgICAgLy8gYWN0aXZhdGUgdGhlIGV2ZW50IGxpc3RlbmluZyBmb3IgcmlnaHQgdmlld2VyIGFuZCByaWdodCBtYXJrZXIgZXZlbnRzXG4gICAgICAgIHZtLnJpZ2h0Vmlld2VyRXZlbnRzID0ge1xuICAgICAgICAgIG1hcmtlcnM6IHtcbiAgICAgICAgICAgIGVuYWJsZTogbGVhZmxldE1hcmtlckV2ZW50cy5nZXRBdmFpbGFibGVFdmVudHMoKSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG1hcDoge1xuICAgICAgICAgICAgZW5hYmxlOiBbJ2RyYWdlbmQnLCAnZHJhZycsICdjbGljaycsICdtb3VzZW1vdmUnXSxcbiAgICAgICAgICAgIC8vbG9naWM6ICdlbWl0J1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLy8gYWN0aXZhdGUgdGhlIGV2ZW50IGxpc3RlbmluZyBmb3IgbGVmdCB2aWV3ZXIgYW5kIGxlZnQgbWFya2VyIGV2ZW50c1xuICAgICAgICB2bS5sZWZ0Vmlld2VyRXZlbnRzID0ge1xuICAgICAgICAgIG1hcmtlcnM6IHtcbiAgICAgICAgICAgIGVuYWJsZTogbGVhZmxldE1hcmtlckV2ZW50cy5nZXRBdmFpbGFibGVFdmVudHMoKSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIG1hcDoge1xuICAgICAgICAgICAgZW5hYmxlOiBbJ2RyYWdlbmQnLCAnZHJhZycsICdjbGljaycsICdtb3VzZW1vdmUnXSxcbiAgICAgICAgICAgIC8vbG9naWM6ICdlbWl0J1xuICAgICAgICAgIH1cbiAgICAgICAgfSAgICAgICBcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBBY3Rpb25zIGV4ZWN1dGVkIGFmdGVyIHRoZSBiYXNlIHZpZXdlciBpcyBhY3RpdmF0ZWRcbiAgICAgICAqIFxuICAgICAgICovXG4gICAgICBmdW5jdGlvbiBvblZpZXdlckFjdGl2YXRlKCl7IFxuICAgICAgICAvLyBTZXQgZ2xvYmFsIHZpZXdlciBvcHRpb25zXG4gICAgICAgIC8vIGNoYW5nZWQgZm9yIHJlc29sdmluZyAjMTg0IFxuICAgICAgICAvLyBNYXBWaWV3ZXJTZXJ2aWNlLnNldE9wdGlvbigncmlnaHRNYXBWaWV3ZXInLCAnc2hvd0xvYWRNYXBJblJpZ2h0JywgZmFsc2UpO1xuICAgICAgICBNYXBWaWV3ZXJTZXJ2aWNlLnNldE9wdGlvbigncmlnaHRNYXBWaWV3ZXInLCAnc2hvd0xvYWRNYXBJblJpZ2h0JywgdHJ1ZSk7XG4gICAgICAgIE1hcFZpZXdlclNlcnZpY2Uuc2V0T3B0aW9uKCdsZWZ0TWFwVmlld2VyJywgJ3Nob3dMb2FkTWFwSW5SaWdodCcsIHRydWUpO1xuICAgICAgfVxuXG4gICAgICAvKipcbiAgICAgICAqIEVuYWJsZS9kaXNhYmxlIHRoZSBtYXJrZXIgY3JlYXRpb25cbiAgICAgICAqIFxuICAgICAgICogQHBhcmFtIHthbnl9IHZpZXdlcklkIFxuICAgICAgICovXG4gICAgICBmdW5jdGlvbiB0b2dnbGVDcmVhdGVNYXJrZXIodmlld2VySWQpe1xuICAgICAgICBpZih2aWV3ZXJJZCA9PT0gJ3JpZ2h0TWFwVmlld2VyJykge1xuICAgICAgICAgIHZtLnJpZ2h0Q3JlYXRlTWFya2VyRW5hYmxlID0gIXZtLnJpZ2h0Q3JlYXRlTWFya2VyRW5hYmxlO1xuXG4gICAgICAgICAgLy8gaXQgaXMgbm90IHBvc3NpYmxlIHRvIGhhdmUgcmVtb3ZhbCBhbmQgY3JlYXRlIHRvb2wgZW5hYmxlZCBhdCB0aGUgc2FtZSB0aW1lXG4gICAgICAgICAgLy8gc28sIGlmIHRoZSByZW1vdmFsIGFuZCBjcmVhdGUgdG9vbCBhcmUgZW5hYmxlZCwgdGhlIHJpZ2h0IHJlbW92YWwgdG9vbCBpcyBkaXNhYmxlZFxuICAgICAgICAgIGlmKHZtLnJpZ2h0Q3JlYXRlTWFya2VyRW5hYmxlID09PSB0cnVlICYmIHZtLnJpZ2h0UmVtb3ZlTWFya2VyRW5hYmxlID09PSB0cnVlKSB7XG4gICAgICAgICAgICB2bS5yaWdodFJlbW92ZU1hcmtlckVuYWJsZSA9IGZhbHNlO1xuICAgICAgICAgIH0gICAgICAgICAgXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdm0ubGVmdENyZWF0ZU1hcmtlckVuYWJsZSA9ICF2bS5sZWZ0Q3JlYXRlTWFya2VyRW5hYmxlO1xuXG4gICAgICAgICAgLy8gaXQgaXMgbm90IHBvc3NpYmxlIHRvIGhhdmUgcmVtb3ZhbCBhbmQgY3JlYXRlIHRvb2wgZW5hYmxlZCBhdCB0aGUgc2FtZSB0aW1lXG4gICAgICAgICAgLy8gc28sIGlmIHRoZSByZW1vdmFsIGFuZCBjcmVhdGUgdG9vbCBhcmUgZW5hYmxlZCwgdGhlIGxlZnQgcmVtb3ZhbCB0b29sIGlzIGRpc2FibGVkXG4gICAgICAgICAgaWYodm0ubGVmdENyZWF0ZU1hcmtlckVuYWJsZSA9PT0gdHJ1ZSAmJiB2bS5sZWZ0UmVtb3ZlTWFya2VyRW5hYmxlID09PSB0cnVlKXtcbiAgICAgICAgICAgIHZtLmxlZnRSZW1vdmVNYXJrZXJFbmFibGUgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gICAgICAgIFxuICAgICAgfVxuXG4gICAgICAvKipcbiAgICAgICAqIEVuYWJsZS9kaXNhYmxlIHRoZSBtYXJrZXIgcmVtb3ZhbFxuICAgICAgICogXG4gICAgICAgKiBAcGFyYW0ge2FueX0gdmlld2VySWRcbiAgICAgICAqL1xuICAgICAgZnVuY3Rpb24gdG9nZ2xlUmVtb3ZlTWFya2VyKHZpZXdlcklkKXtcbiAgICAgICAgaWYodmlld2VySWQgPT09ICdyaWdodE1hcFZpZXdlcicpIHtcbiAgICAgICAgICB2bS5yaWdodFJlbW92ZU1hcmtlckVuYWJsZSA9ICF2bS5yaWdodFJlbW92ZU1hcmtlckVuYWJsZTtcblxuICAgICAgICAgIC8vIGl0IGlzIG5vdCBwb3NzaWJsZSB0byBoYXZlIHJlbW92YWwgYW5kIGNyZWF0ZSB0b29sIGVuYWJsZWQgYXQgdGhlIHNhbWUgdGltZVxuICAgICAgICAgIC8vIHNvLCBpZiB0aGUgcmVtb3ZhbCBhbmQgY3JlYXRlIHRvb2wgYXJlIGVuYWJsZWQsIHRoZSByaWdodCBjcmVhdGUgdG9vbCBpcyBkaXNhYmxlZFxuICAgICAgICAgIGlmKHZtLnJpZ2h0UmVtb3ZlTWFya2VyRW5hYmxlID09PSB0cnVlICYmIHZtLnJpZ2h0Q3JlYXRlTWFya2VyRW5hYmxlID09PSB0cnVlKXtcbiAgICAgICAgICAgIHZtLnJpZ2h0Q3JlYXRlTWFya2VyRW5hYmxlID0gZmFsc2U7XG4gICAgICAgICAgfSAgICAgICAgICBcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2bS5sZWZ0UmVtb3ZlTWFya2VyRW5hYmxlID0gIXZtLmxlZnRSZW1vdmVNYXJrZXJFbmFibGU7XG5cbiAgICAgICAgICAvLyBpdCBpcyBub3QgcG9zc2libGUgdG8gaGF2ZSByZW1vdmFsIGFuZCBjcmVhdGUgdG9vbCBlbmFibGVkIGF0IHRoZSBzYW1lIHRpbWVcbiAgICAgICAgICAvLyBzbywgaWYgdGhlIHJlbW92YWwgYW5kIGNyZWF0ZSB0b29sIGFyZSBlbmFibGVkLCB0aGUgbGVmdCBjcmVhdGUgdG9vbCBpcyBkaXNhYmxlZFxuICAgICAgICAgIGlmKHZtLmxlZnRSZW1vdmVNYXJrZXJFbmFibGUgPT09IHRydWUgJiYgdm0ubGVmdENyZWF0ZU1hcmtlckVuYWJsZSA9PT0gdHJ1ZSl7XG4gICAgICAgICAgICB2bS5sZWZ0Q3JlYXRlTWFya2VyRW5hYmxlID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9ICAgICAgICBcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBPcGVucyB0aGUgc2lkZSBuYXYgd2l0aCBzYXZlIG9wdGlvbnMgZm9yIHRoZSBnZW9yZWZlcmVuY2VcbiAgICAgICAqIFRoaXMgZnVuY3Rpb24ganVzdCBvcGVuIHRoZSBzaWRlIG5hdi4gVGhlIGdlb3JlZmVyZW5jZSBzYXZlIGZ1bmN0aW9uIGlzIGRlZmluZWQgXG4gICAgICAgKiBpbiB0aGUgc2lkZSBuYXYgY29udHJvbGxlciBAc2VlIGFwcC9nZW9yZWZlcmVuY2UvbmF2cy5nZW8ubGVmdC5zaWRlbmF2LmNvbnRyb2xsZXIuanNcbiAgICAgICAqL1xuICAgICAgZnVuY3Rpb24gb3BlblNhdmVHZW9SZWYoKXtcbiAgICAgICAgLy8gaWYgdGhlIEdyb3VuZCBDb250cm9sIFBvaW50cyBhcmUgdmFsaWQsIHdlIGp1c3Qgb3BlbiB0aGUgc2lkZSBuYXZcbiAgICAgICAgaWYodmFsaWRHQ1AoKSl7XG4gICAgICAgICAgJHNjb3BlLnZtID0gdm07XG4gICAgICAgICAgJG1kU2lkZW5hdignbGVmdCcpLnRvZ2dsZSgpO1xuICAgICAgICAgICRyb290U2NvcGUuJGVtaXQoJ3NhdmVHZW9SZWYnLCB2bS5sZWZ0TWFya2Vycyk7XG4gICAgICAgIH0gZWxzZSB7IC8vIGlmIG5vdCwgd2Ugd2FybiB0aGUgdXNlciBhYm91dCBpdFxuICAgICAgICAgIHZhciBjb25maWcgPSB7XG4gICAgICAgICAgICB0aXRsZTogJHRyYW5zbGF0ZS5pbnN0YW50KCdkaWFsb2cuaW52YWxpZEdlb3JlZlRpdGxlJyksXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJHRyYW5zbGF0ZS5pbnN0YW50KCdkaWFsb2cuaW52YWxpZEdlb3JlZlRleHQnKSxcbiAgICAgICAgICAgIHRvb2xiYXJCZ0NvbG9yOiRtZENvbG9ycy5nZXRUaGVtZUNvbG9yKCdwcmltYXJ5JyksXG4gICAgICAgICAgICBva0JnQ29sb3I6JG1kQ29sb3JzLmdldFRoZW1lQ29sb3IoJ3ByaW1hcnknKSxcbiAgICAgICAgICAgIG9rOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2dsb2JhbC5vaycpXG4gICAgICAgICAgfTtcbiAgICAgICAgICBDMkRpYWxvZy5hbGVydChjb25maWcpO1xuICAgICAgICB9ICAgICAgICBcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBcbiAgICAgICAqL1xuICAgICAgZnVuY3Rpb24gbnVtT2ZHQ1AoKXtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHZtLmxlZnRNYXJrZXJzKS5sZW5ndGg7XG4gICAgICB9XG5cbiAgICAgIC8qKlxuICAgICAgICogVmFsaWRhdGUgdGhlIEdyb3VuZCBDb250cm9sIFBvaW50cyBhYm91dCB0byBiZSB1c2VkIGZvciB0aGUgZ2VvcmVmZXJlbmNlXG4gICAgICAgKiBcbiAgICAgICAqIEByZXR1cm5zIFxuICAgICAgICovXG4gICAgICBmdW5jdGlvbiB2YWxpZEdDUCgpeyBcbiAgICAgICAgLy8gZ2V0IHRoZSBwcm9wZXJ0aWVzIGNvdW50IG9mIGJvdGggdmlld2Vyc1xuICAgICAgICB2YXIgbGVmdENvdW50ID0gT2JqZWN0LmtleXModm0ubGVmdE1hcmtlcnMpLmxlbmd0aDtcbiAgICAgICAgdmFyIHJpZ2h0Q291bnQgPSBPYmplY3Qua2V5cyh2bS5yaWdodE1hcmtlcnMpLmxlbmd0aDtcblxuICAgICAgICAvLyB0byBiZSB2YWxpZCBhIG1pbmltdW0gb2YgMyBHQ1AgbXVzdCBiZSBzZWxlY3RlZCBcbiAgICAgICAgLy8gYW5kIGJvdGggdmlld2VycyBtdXN0IGhhdmUgdGhlIHNhbWUgYW1vdW50IG9mIEdDUCBkZWZpbmVkXG4gICAgICAgIHJldHVybiBsZWZ0Q291bnQgPj0gMyAmJiAgbGVmdENvdW50ID09PSByaWdodENvdW50O1xuICAgICAgfVxuICAgICAgXG4gICAgICAvKipcbiAgICAgICAqIENvbnZlcnQgR0NQIGRhdGEgcmVjZWl2ZWQgZnJvbSAvbWFwIHJlc3BvbnNlIHRvIG1hcmtlciBmb3JtYXQgZGF0YVxuICAgICAgICogXG4gICAgICAgKiBAcGFyYW0gcG9zaXRpb24gZ2NwIHJlc3BvbnNlIG9mIC9tYXAgcmVxdWVzdFxuICAgICAgICogQHJldHVybnMgT2JqZWN0IEluIGZvcm1hdCBob3cgYWRkTWFya2VyIGZ1bmN0aW9uIG5lZWRzIG1hcmtlciBkYXRhXG4gICAgICAgKi9cbiAgICAgIGZ1bmN0aW9uIHByZXBhcmVEYXRhRm9yQWRkTWFya2VyKHBvc2l0aW9uKSB7XG4gICAgICAgIHZhciBpbWFnZVBvc2l0aW9uSW5MYXRMbmcgPSBMLlByb2plY3Rpb24uU3BoZXJpY2FsTWVyY2F0b3IudW5wcm9qZWN0KFxuICAgICAgICAgIC8vIEwubGF0TG5nKHBvc2l0aW9uLnBpeGVsWSxwYXJzZUZsb2F0KHBvc2l0aW9uLnBpeGVsWCkpXG4gICAgICAgICAgTC5wb2ludChwYXJzZUZsb2F0KHBvc2l0aW9uLnBpeGVsWCksIHBvc2l0aW9uLnBpeGVsWSlcbiAgICAgICAgKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coaW1hZ2VQb3NpdGlvbkluTGF0TG5nKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIFwiaW1hZ2VQb3NpdGlvblwiIDoge1xuICAgICAgICAgICAgXCJsYXRsbmdcIjoge1xuICAgICAgICAgICAgICBcImxhdFwiOiBpbWFnZVBvc2l0aW9uSW5MYXRMbmcubGF0LFxuICAgICAgICAgICAgICBcImxuZ1wiOiBpbWFnZVBvc2l0aW9uSW5MYXRMbmcubG5nXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBcIm1hcFBvc2l0aW9uXCIgOiB7XG4gICAgICAgICAgICBcImxhdGxuZ1wiOiB7XG4gICAgICAgICAgICAgIFwibGF0XCI6IHBvc2l0aW9uLmxhdCxcbiAgICAgICAgICAgICAgXCJsbmdcIjogcG9zaXRpb24ubG9uXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cbiAgXG4gIH0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgLmNvbmZpZyhyb3V0ZXMpO1xuXG4gIC8qKlxuICAgKiBDb25maWd1cmF0aW9uIGZpbGUgZm9yIGdlb3JlZmVyZW5jZSByb3V0ZVxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gJHN0YXRlUHJvdmlkZXJcbiAgICogQHBhcmFtIHtvYmplY3R9IEdsb2JhbFxuICAgKi9cbiAgLyoqIEBuZ0luamVjdCAqL1xuICBmdW5jdGlvbiByb3V0ZXMoJHN0YXRlUHJvdmlkZXIsIEdsb2JhbCkge1xuICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAuc3RhdGUoJ2FwcC5nZW9yZWZlcmVuY2UnLCB7XG4gICAgICAgIHVybDogJy9nZW9yZWZlcmVuY2UnLFxuICAgICAgICB0ZW1wbGF0ZVVybDogR2xvYmFsLmNsaWVudFBhdGggKyAnL2dlb3JlZmVyZW5jZS9nZW9yZWZlcmVuY2UuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6ICdHZW9yZWZlcmVuY2VDb250cm9sbGVyIGFzIG1hcEN0cmwnLFxuICAgICAgICBkYXRhOiB7IH1cbiAgICAgIH0pO1xuICB9XG59KCkpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgLmZhY3RvcnkoJ0dlb3JlZmVyZW5jZVNlcnZpY2UnLCBHZW9yZWZlcmVuY2VTZXJ2aWNlKTtcblxuICAvKiogQG5nSW5qZWN0ICovXG4gIGZ1bmN0aW9uIEdlb3JlZmVyZW5jZVNlcnZpY2Uoc2VydmljZUZhY3RvcnksICRodHRwLCAkcSkge1xuICAgIHZhciBhcHBseUVuZFBvaW50ID0gXCIvaGVpbWFwL2dlb3JlZi9hcHBseVwiO1xuICAgIHZhciBwcmV2aWV3R2NwRW5kUG9pbnQgPSBcIi9oZWltYXAvZ2VvcmVmL3Jtc2VcIjtcblxuICAgIHZhciBtb2RlbCA9IHNlcnZpY2VGYWN0b3J5KGFwcGx5RW5kUG9pbnQsIHtcbiAgICAgIGFjdGlvbnM6IHsgfSxcbiAgICAgIGluc3RhbmNlOiB7IFxuICAgICAgICBzYXZlR2VvUmVmOiBzYXZlR2VvUmVmLFxuICAgICAgICBwcmV2aWV3R0NQOiBwcmV2aWV3R0NQXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBwcmV2aWV3R0NQKHBhcmFtRGF0YSkge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gR2VvcmVmZXJlbmNlU2VydmljZSA+Pj4gcHJldmlld0dDUCBcIiwgcHJldmlld0djcEVuZFBvaW50LCBwYXJhbURhdGEpO1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgIHZhciBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgLyogXG4gICAgICBwYXJhbURhdGEgPSB7XG4gICAgICAgICAgXCJpbWFnZUNvb3JkaW5hdGVzXCI6e1xuICAgICAgICAgICAgXCJtMVwiOntcbiAgICAgICAgICAgICAgXCJpZFwiOlwibTFcIixcbiAgICAgICAgICAgICAgXCJsYXRcIjowLjAwNjczNzcwOTAyOTg5NTU0NzYsXG4gICAgICAgICAgICAgIFwibG5nXCI6MC4wMDQyOTk4OTQ1NTU4MTQ4MSxcbiAgICAgICAgICAgICAgXCJmb2N1c1wiOnRydWUsXG4gICAgICAgICAgICAgIFwiZHJhZ2dhYmxlXCI6dHJ1ZSxcbiAgICAgICAgICAgICAgXCJpY29uXCI6e1xuICAgICAgICAgICAgICAgIFwidHlwZVwiOlwiZGl2XCIsXG4gICAgICAgICAgICAgICAgXCJjbGFzc05hbWVcIjpcIm1rLWRpdi1pY29uIG0xXCIsXG4gICAgICAgICAgICAgICAgXCJpY29uU2l6ZVwiOm51bGwsXG4gICAgICAgICAgICAgICAgXCJodG1sXCI6XCI8ZGl2IGNsYXNzPVxcXCJtay1pY29uLWNvbnRhaW5lciBtay1va1xcXCI+MTwvZGl2PlwiXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIm0yXCI6e1xuICAgICAgICAgICAgICBcImlkXCI6XCJtMlwiLFxuICAgICAgICAgICAgICBcImxhdFwiOjAuMDAwMzg2MjM4MDk4MTQyMzEwNyxcbiAgICAgICAgICAgICAgXCJsbmdcIjowLjAwMjkyNDYyMTg3OTI3NDQ0NzYsXG4gICAgICAgICAgICAgIFwiZm9jdXNcIjp0cnVlLFxuICAgICAgICAgICAgICBcImRyYWdnYWJsZVwiOnRydWUsXG4gICAgICAgICAgICAgIFwiaWNvblwiOntcbiAgICAgICAgICAgICAgICBcInR5cGVcIjpcImRpdlwiLFxuICAgICAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6XCJtay1kaXYtaWNvbiBtMlwiLFxuICAgICAgICAgICAgICAgIFwiaWNvblNpemVcIjpudWxsLFxuICAgICAgICAgICAgICAgIFwiaHRtbFwiOlwiPGRpdiBjbGFzcz1cXFwibWstaWNvbi1jb250YWluZXIgbWstb2tcXFwiPjI8L2Rpdj5cIlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJtM1wiOntcbiAgICAgICAgICAgICAgXCJpZFwiOlwibTNcIixcbiAgICAgICAgICAgICAgXCJsYXRcIjowLjAwMDcyOTU2MDg1MjAzNTI3ODIsXG4gICAgICAgICAgICAgIFwibG5nXCI6MC4wMTI4NTIzNzE1MTMwNTAxODksXG4gICAgICAgICAgICAgIFwiZm9jdXNcIjp0cnVlLFxuICAgICAgICAgICAgICBcImRyYWdnYWJsZVwiOnRydWUsXG4gICAgICAgICAgICAgIFwiaWNvblwiOntcbiAgICAgICAgICAgICAgICBcInR5cGVcIjpcImRpdlwiLFxuICAgICAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6XCJtay1kaXYtaWNvbiBtM1wiLFxuICAgICAgICAgICAgICAgIFwiaWNvblNpemVcIjpudWxsLFxuICAgICAgICAgICAgICAgIFwiaHRtbFwiOlwiPGRpdiBjbGFzcz1cXFwibWstaWNvbi1jb250YWluZXIgbWstb2tcXFwiPjM8L2Rpdj5cIlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJtNFwiOntcbiAgICAgICAgICAgICAgXCJpZFwiOlwibTRcIixcbiAgICAgICAgICAgICAgXCJsYXRcIjowLjAwNjA1MTA2MzUyNjM0NjExMSxcbiAgICAgICAgICAgICAgXCJsbmdcIjowLjAxMDk2MTM3MTU4MjgwNzE5LFxuICAgICAgICAgICAgICBcImZvY3VzXCI6dHJ1ZSxcbiAgICAgICAgICAgICAgXCJkcmFnZ2FibGVcIjp0cnVlLFxuICAgICAgICAgICAgICBcImljb25cIjp7XG4gICAgICAgICAgICAgICAgXCJ0eXBlXCI6XCJkaXZcIixcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOlwibWstZGl2LWljb24gbTRcIixcbiAgICAgICAgICAgICAgICBcImljb25TaXplXCI6bnVsbCxcbiAgICAgICAgICAgICAgICBcImh0bWxcIjpcIjxkaXYgY2xhc3M9XFxcIm1rLWljb24tY29udGFpbmVyIG1rLW9rXFxcIj40PC9kaXY+XCJcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJ3b3JsZENvb3JkaW5hdGVzXCI6e1xuICAgICAgICAgICAgXCJtMVwiOntcbiAgICAgICAgICAgICAgXCJpZFwiOlwibTFcIixcbiAgICAgICAgICAgICAgXCJsYXRcIjo0OS4zNjA5MTE1NDcxMjYxNjUsXG4gICAgICAgICAgICAgIFwibG5nXCI6OC4wMzcxNTI5NzE1NDAxNyxcbiAgICAgICAgICAgICAgXCJmb2N1c1wiOnRydWUsXG4gICAgICAgICAgICAgIFwiZHJhZ2dhYmxlXCI6dHJ1ZSxcbiAgICAgICAgICAgICAgXCJpY29uXCI6e1xuICAgICAgICAgICAgICAgIFwidHlwZVwiOlwiZGl2XCIsXG4gICAgICAgICAgICAgICAgXCJjbGFzc05hbWVcIjpcIm1rLWRpdi1pY29uIG0xXCIsXG4gICAgICAgICAgICAgICAgXCJpY29uU2l6ZVwiOm51bGwsXG4gICAgICAgICAgICAgICAgXCJodG1sXCI6XCI8ZGl2IGNsYXNzPVxcXCJtay1pY29uLWNvbnRhaW5lciBtay1va1xcXCI+MTwvZGl2PlwiXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIm0yXCI6e1xuICAgICAgICAgICAgICBcImlkXCI6XCJtMlwiLFxuICAgICAgICAgICAgICBcImxhdFwiOjQ4LjgzMjE4MTYyNTY5ODQ3NSxcbiAgICAgICAgICAgICAgXCJsbmdcIjo3Ljk5ODY0NTMzNjU5NyxcbiAgICAgICAgICAgICAgXCJmb2N1c1wiOnRydWUsXG4gICAgICAgICAgICAgIFwiZHJhZ2dhYmxlXCI6dHJ1ZSxcbiAgICAgICAgICAgICAgXCJpY29uXCI6e1xuICAgICAgICAgICAgICAgIFwidHlwZVwiOlwiZGl2XCIsXG4gICAgICAgICAgICAgICAgXCJjbGFzc05hbWVcIjpcIm1rLWRpdi1pY29uIG0yXCIsXG4gICAgICAgICAgICAgICAgXCJpY29uU2l6ZVwiOm51bGwsXG4gICAgICAgICAgICAgICAgXCJodG1sXCI6XCI8ZGl2IGNsYXNzPVxcXCJtay1pY29uLWNvbnRhaW5lciBtay1va1xcXCI+MjwvZGl2PlwiXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcIm0zXCI6e1xuICAgICAgICAgICAgICBcImlkXCI6XCJtM1wiLFxuICAgICAgICAgICAgICBcImxhdFwiOjQ4Ljg1Mzg3MjczMTY1NjU2LFxuICAgICAgICAgICAgICBcImxuZ1wiOjkuMDQ5MzUzNjYxNDc1MjM1LFxuICAgICAgICAgICAgICBcImZvY3VzXCI6dHJ1ZSxcbiAgICAgICAgICAgICAgXCJkcmFnZ2FibGVcIjp0cnVlLFxuICAgICAgICAgICAgICBcImljb25cIjp7XG4gICAgICAgICAgICAgICAgXCJ0eXBlXCI6XCJkaXZcIixcbiAgICAgICAgICAgICAgICBcImNsYXNzTmFtZVwiOlwibWstZGl2LWljb24gbTNcIixcbiAgICAgICAgICAgICAgICBcImljb25TaXplXCI6bnVsbCxcbiAgICAgICAgICAgICAgICBcImh0bWxcIjpcIjxkaXYgY2xhc3M9XFxcIm1rLWljb24tY29udGFpbmVyIG1rLW9rXFxcIj4zPC9kaXY+XCJcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwibTRcIjp7XG4gICAgICAgICAgICAgIFwiaWRcIjpcIm00XCIsXG4gICAgICAgICAgICAgIFwibGF0XCI6NDkuNDc4ODMyNDQwNzEwNDcsXG4gICAgICAgICAgICAgIFwibG5nXCI6OS4yMDMzODQyMDEyNDc5NTcsXG4gICAgICAgICAgICAgIFwiZm9jdXNcIjp0cnVlLFxuICAgICAgICAgICAgICBcImRyYWdnYWJsZVwiOnRydWUsXG4gICAgICAgICAgICAgIFwiaWNvblwiOntcbiAgICAgICAgICAgICAgICBcInR5cGVcIjpcImRpdlwiLFxuICAgICAgICAgICAgICAgIFwiY2xhc3NOYW1lXCI6XCJtay1kaXYtaWNvbiBtNFwiLFxuICAgICAgICAgICAgICAgIFwiaWNvblNpemVcIjpudWxsLFxuICAgICAgICAgICAgICAgIFwiaHRtbFwiOlwiPGRpdiBjbGFzcz1cXFwibWstaWNvbi1jb250YWluZXIgbWstb2tcXFwiPjQ8L2Rpdj5cIlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBcInJlY3RpZnlNZXRob2RcIjpcIjFzdE9yZGVyUG9seW5cIixcbiAgICAgICAgICBcInJlc2FtcGxpbmdNZXRob2RcIjpcIm5lYXJcIixcbiAgICAgICAgICBcIm1hcElkXCI6XCIyM1wiLFxuICAgICAgICAgIFwibmV3RmlsZU5hbWVcIjpcIjFfZ18xc3RPcmRlclBvbHluX25lYXJfNy4xOS4yMDE4XCIsXG4gICAgICAgICAgXCJiYm94Q3JvcEltYWdlXCI6XCI3Ljk5ODY0NTMzNjU5NyA0OC44MzIxODE2MjU2OTg0NzUgOS4yMDMzODQyMDEyNDc5NTcgNDkuNDc4ODMyNDQwNzEwNDdcIlxuICAgICAgICB9XG4gICAgICAgKi9cbiAgICAgICRodHRwLnBvc3QocHJldmlld0djcEVuZFBvaW50LCBwYXJhbURhdGEpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3VsdC5kYXRhKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIC8vIG5vdCB1c2VkXG4gICAgZnVuY3Rpb24gc2F2ZUdlb1JlZigpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiPj4+IEdlb3JlZmVyZW5jZVNlcnZpY2UgPj4+IHNhdmVHZW9SZWYgXCIsIHRoaXMuYXBwbHlFbmRQb2ludCk7XG5cbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICB2YXIgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgIFxuICAgICAgJGh0dHAucG9zdCh0aGlzLmFwcGx5RW5kUG9pbnQsIGZvcm1EYXRhLCB7XG4gICAgICAgIHRyYW5zZm9ybVJlcXVlc3Q6IGFuZ3VsYXIuaWRlbnRpdHksXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogdW5kZWZpbmVkXG4gICAgICAgIH1cbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3VsdC5kYXRhKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIHJldHVybiBtb2RlbDtcbiAgfVxuXG59KCkpO1xuIiwiKGZ1bmN0aW9uKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuY29udHJvbGxlcignRXhwb3J0Q29udHJvbGxlcicsIEV4cG9ydENvbnRyb2xsZXIpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgZnVuY3Rpb24gRXhwb3J0Q29udHJvbGxlcigkY29udHJvbGxlciwgRXhwb3J0U2VydmljZSkge1xuICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAvL0F0dHJpYnV0ZXMgQmxvY2tcblxuICAgIC8vRnVuY3Rpb25zIEJsb2NrXG5cbiAgICAvLyBpbnN0YW50aWF0ZSBiYXNlIGNvbnRyb2xsZXJcbiAgICAkY29udHJvbGxlcignQ1JVRENvbnRyb2xsZXInLCB7IHZtOiB2bSwgbW9kZWxTZXJ2aWNlOiBFeHBvcnRTZXJ2aWNlLCBvcHRpb25zOiB7IHNlYXJjaE9uSW5pdDpmYWxzZSB9IH0pO1xuXG4gIH1cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdhcHAnKVxuICAgIC5jb25maWcocm91dGVzKTtcblxuICAvKipcbiAgICogQXJxdWl2byBkZSBjb25maWd1cmHDp8OjbyBjb20gYXMgcm90YXMgZXNwZWPDrWZpY2FzIGRvIHJlY3Vyc28gZXhwb3J0XG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSAkc3RhdGVQcm92aWRlclxuICAgKiBAcGFyYW0ge29iamVjdH0gR2xvYmFsXG4gICAqL1xuICAvKiogQG5nSW5qZWN0ICovXG4gIGZ1bmN0aW9uIHJvdXRlcygkc3RhdGVQcm92aWRlciwgR2xvYmFsKSB7XG4gICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgIC5zdGF0ZSgnYXBwLmV4cG9ydCcsIHtcbiAgICAgICAgdXJsOiAnL2V4cG9ydCcsXG4gICAgICAgIHRlbXBsYXRlVXJsOiBHbG9iYWwuY2xpZW50UGF0aCArICcvZXhwb3J0L2V4cG9ydC5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogJ0V4cG9ydENvbnRyb2xsZXIgYXMgZXhwb3J0Q3RybCcsXG4gICAgICAgIGRhdGE6IHsgfVxuICAgICAgfSk7XG4gIH1cbn0oKSk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuZmFjdG9yeSgnRXhwb3J0U2VydmljZScsIEV4cG9ydFNlcnZpY2UpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgZnVuY3Rpb24gRXhwb3J0U2VydmljZShzZXJ2aWNlRmFjdG9yeSkge1xuICAgIHZhciBtb2RlbCA9IHNlcnZpY2VGYWN0b3J5KCdleHBvcnQnLCB7XG4gICAgICBhY3Rpb25zOiB7IH0sXG4gICAgICBpbnN0YW5jZTogeyB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbW9kZWw7XG4gIH1cblxufSgpKTtcbiIsIihmdW5jdGlvbiAoKSB7XHJcblxyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnYXBwJylcclxuICAgIC5maWx0ZXIoJ2lzT3JOb3RHZW9yZWZlcmVuY2VkJywgaXNPck5vdEdlb3JlZmVyZW5jZWQpO1xyXG5cclxuICAvKiogQG5nSW5qZWN0ICovXHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcclxuICBmdW5jdGlvbiBpc09yTm90R2VvcmVmZXJlbmNlZCgkZmlsdGVyKSB7XHJcbiAgICAvKipcclxuICAgICAqIEZpbHRlciB0byBjb252ZXJ0IGJvb2xlYW4gdG8geWVzIG9yIG5vdCBzdHJpbmdcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ge2FueX0gaW5wdXQgcHJvcGVydHkvdmFyaWFibGVcclxuICAgICAqIEByZXR1cm5zIHRoZSB0cmFuc2xhdGVkIHllcy9ubyBzdHJpbmdcclxuICAgICAqL1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChpbnB1dCkgeyAgICAgIFxyXG4gICAgICB2YXIgaXNUcnVlID0gKGlucHV0ID09PSB0cnVlIHx8IGlucHV0ID09PSAndHJ1ZScgfHwgaW5wdXQgPT09IDEgfHwgKGFuZ3VsYXIuaXNEZWZpbmVkKGlucHV0KSAmJiBpbnB1dCAhPT0gZmFsc2UpKTtcclxuICAgICAgdmFyIGtleSA9ICdhdHRyaWJ1dGVzLicgKyAoaXNUcnVlPyAnaXNHZW9yZWZlcmVuY2VkJzogJ2lzTm90R2VvcmVmZXJlbmNlZCcpO1xyXG4gICAgICB2YXIgdHJhbnNsYXRlZCA9ICAkZmlsdGVyKCd0cmFuc2xhdGUnKShrZXkpO1xyXG4gICAgICByZXR1cm4gdHJhbnNsYXRlZDtcclxuICAgIH1cclxuICB9XHJcblxyXG59KSgpOyIsIihmdW5jdGlvbigpIHtcclxuXHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgLmZhY3RvcnkoJ2xhbmd1YWdlTG9hZGVyJywgTGFuZ3VhZ2VMb2FkZXIpO1xyXG5cclxuICAvKiogQG5nSW5qZWN0ICovXHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcclxuICBmdW5jdGlvbiBMYW5ndWFnZUxvYWRlcigkcSwgJGxvZywgJGluamVjdG9yKSB7XHJcbiAgICB2YXIgc2VydmljZSA9IHRoaXM7XHJcblxyXG4gICAgc2VydmljZS50cmFuc2xhdGUgPSBmdW5jdGlvbihsb2NhbGUpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBnbG9iYWw6ICRpbmplY3Rvci5nZXQobG9jYWxlICsgJy5pMThuLmdsb2JhbCcpLFxyXG4gICAgICAgIHZpZXdzOiAkaW5qZWN0b3IuZ2V0KGxvY2FsZSArICcuaTE4bi52aWV3cycpLFxyXG4gICAgICAgIGF0dHJpYnV0ZXM6ICRpbmplY3Rvci5nZXQobG9jYWxlICsgJy5pMThuLmF0dHJpYnV0ZXMnKSxcclxuICAgICAgICBkaWFsb2c6ICRpbmplY3Rvci5nZXQobG9jYWxlICsgJy5pMThuLmRpYWxvZycpLFxyXG4gICAgICAgIG1lc3NhZ2VzOiAkaW5qZWN0b3IuZ2V0KGxvY2FsZSArICcuaTE4bi5tZXNzYWdlcycpLFxyXG4gICAgICAgIG1vZGVsczogJGluamVjdG9yLmdldChsb2NhbGUgKyAnLmkxOG4ubW9kZWxzJylcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvLyByZXR1cm4gbG9hZGVyRm5cclxuICAgIHJldHVybiBmdW5jdGlvbihvcHRpb25zKSB7XHJcbiAgICAgICRsb2cuaW5mbygnTG9hZGluZyB0aGUgbGFuZ3VhZ2UgY29udGVudCAnICsgb3B0aW9ucy5rZXkpO1xyXG4gICAgICB2YXIgdHJhbnNsYXRpb24gPSBzZXJ2aWNlLnRyYW5zbGF0ZShvcHRpb25zLmtleSk7XHJcbiAgICAgIHJldHVybiAkcS53aGVuKHRyYW5zbGF0aW9uKTsgICAgIFxyXG4gICAgfVxyXG4gIH1cclxuXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbigpIHtcclxuXHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgLmZpbHRlcigndEF0dHInLCB0QXR0cik7XHJcblxyXG4gIC8qKiBAbmdJbmplY3QgKi9cclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xyXG4gIGZ1bmN0aW9uIHRBdHRyKCRmaWx0ZXIpIHtcclxuICAgIC8qKlxyXG4gICAgICogRmlsdHJvIHBhcmEgdHJhZHXDp8OjbyBkZSB1bSBhdHJpYnV0byBkZSB1bSBtb2RlbFxyXG4gICAgICogXHJcbiAgICAgKiBAcGFyYW0ge2FueX0gbmFtZSBub21lIGRvIGF0cmlidXRvXHJcbiAgICAgKiBAcmV0dXJucyBvIG5vbWUgZG8gYXRyaWJ1dG8gdHJhZHV6aWRvIGNhc28gZW5jb250cmUgc2UgbsOjbyBvIG5vbWUgcGFzc2FkbyBwb3IgcGFyYW1ldHJvXHJcbiAgICAgKi8gICAgXHJcbiAgICByZXR1cm4gZnVuY3Rpb24obmFtZSkge1xyXG4gICAgICB2YXIga2V5ID0gJ2F0dHJpYnV0ZXMuJyArIG5hbWU7XHJcbiAgICAgIHZhciB0cmFuc2xhdGUgPSAkZmlsdGVyKCd0cmFuc2xhdGUnKShrZXkpO1xyXG5cclxuICAgICAgcmV0dXJuICh0cmFuc2xhdGUgPT09IGtleSkgPyBuYW1lIDogdHJhbnNsYXRlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbigpIHtcclxuXHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgLmZpbHRlcigndEJyZWFkY3J1bWInLCB0QnJlYWRjcnVtYik7XHJcblxyXG4gIC8qKiBAbmdJbmplY3QgKi9cclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xyXG4gIGZ1bmN0aW9uIHRCcmVhZGNydW1iKCRmaWx0ZXIpIHtcclxuICAgIC8qKlxyXG4gICAgICogRmlsdHJvIHBhcmEgdHJhZHXDp8OjbyBkbyBicmVhZGNydW1iICh0aXR1bG8gZGEgdGVsYSBjb20gcmFzdHJlaW8pXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHthbnl9IGlkIGNoYXZlIGNvbSBvIG5vbWUgZG8gc3RhdGUgcmVmZXJlbnRlIHRlbGFcclxuICAgICAqIEByZXR1cm5zIGEgdHJhZHXDp8OjbyBjYXNvIGVuY29udHJlIHNlIG7Do28gbyBpZCBwYXNzYWRvIHBvciBwYXJhbWV0cm9cclxuICAgICAqL1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uKGlkKSB7XHJcbiAgICAgIC8vcGVnYSBhIHNlZ3VuZGEgcGFydGUgZG8gbm9tZSBkbyBzdGF0ZSwgcmV0aXJhbmRvIGEgcGFydGUgYWJzdHJhdGEgKGFwcC4pXHJcbiAgICAgIHZhciBrZXkgPSAndmlld3MuYnJlYWRjcnVtYnMuJyArIGlkLnNwbGl0KCcuJylbMV07XHJcbiAgICAgIHZhciB0cmFuc2xhdGUgPSAkZmlsdGVyKCd0cmFuc2xhdGUnKShrZXkpO1xyXG5cclxuICAgICAgcmV0dXJuICh0cmFuc2xhdGUgPT09IGtleSkgPyBpZCA6IHRyYW5zbGF0ZTtcclxuICAgIH1cclxuICB9XHJcblxyXG59KSgpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcblxyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnYXBwJylcclxuICAgIC5maWx0ZXIoJ3RNb2RlbCcsIHRNb2RlbCk7XHJcblxyXG4gIC8qKiBAbmdJbmplY3QgKi9cclxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xyXG4gIGZ1bmN0aW9uIHRNb2RlbCgkZmlsdGVyKSB7XHJcbiAgICAvKipcclxuICAgICAqIEZpbHRybyBwYXJhIHRyYWR1w6fDo28gZGUgdW0gYXRyaWJ1dG8gZGUgdW0gbW9kZWxcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ge2FueX0gbmFtZSBub21lIGRvIGF0cmlidXRvXHJcbiAgICAgKiBAcmV0dXJucyBvIG5vbWUgZG8gYXRyaWJ1dG8gdHJhZHV6aWRvIGNhc28gZW5jb250cmUgc2UgbsOjbyBvIG5vbWUgcGFzc2FkbyBwb3IgcGFyYW1ldHJvXHJcbiAgICAgKi9cclxuICAgIHJldHVybiBmdW5jdGlvbihuYW1lKSB7XHJcbiAgICAgIHZhciBrZXkgPSAnbW9kZWxzLicgKyBuYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIHZhciB0cmFuc2xhdGUgPSAkZmlsdGVyKCd0cmFuc2xhdGUnKShrZXkpO1xyXG5cclxuICAgICAgcmV0dXJuICh0cmFuc2xhdGUgPT09IGtleSkgPyBuYW1lIDogdHJhbnNsYXRlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XHJcblxyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnYXBwJylcclxuICAgIC5maWx0ZXIoJ3llc09yTm8nLCB5ZXNPck5vKTtcclxuXHJcbiAgLyoqIEBuZ0luamVjdCAqL1xyXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXHJcbiAgZnVuY3Rpb24geWVzT3JObygkZmlsdGVyKSB7XHJcbiAgICAvKipcclxuICAgICAqIEZpbHRlciB0byBjb252ZXJ0IGJvb2xlYW4gdG8geWVzIG9yIG5vdCBzdHJpbmdcclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0ge2FueX0gaW5wdXQgcHJvcGVydHkvdmFyaWFibGVcclxuICAgICAqIEByZXR1cm5zIHRoZSB0cmFuc2xhdGVkIHllcy9ubyBzdHJpbmdcclxuICAgICAqL1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChpbnB1dCkgeyAgICAgIFxyXG4gICAgICB2YXIgaXNUcnVlID0gKGlucHV0ID09PSB0cnVlIHx8IGlucHV0ID09PSAndHJ1ZScgfHwgaW5wdXQgPT09IDEgfHwgKGFuZ3VsYXIuaXNEZWZpbmVkKGlucHV0KSAmJiBpbnB1dCAhPT0gZmFsc2UpKTtcclxuICAgICAgdmFyIGtleSA9ICdnbG9iYWwuJyArIChpc1RydWU/ICd5ZXMnOiAnbm8nKTtcclxuICAgICAgdmFyIHRyYW5zbGF0ZWQgPSAgJGZpbHRlcigndHJhbnNsYXRlJykoa2V5KTtcclxuICAgICAgcmV0dXJuIHRyYW5zbGF0ZWQ7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgXG4gICAgYW5ndWxhclxuICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgIC5jb25maWcoc3Bpbm5lckludGVyY2VwdG9yKTtcbiAgXG4gICAgZnVuY3Rpb24gc3Bpbm5lckludGVyY2VwdG9yKCRodHRwUHJvdmlkZXIsICRwcm92aWRlKSB7XG4gICAgICAvKipcbiAgICAgICAqIFRoaXMgaW50ZXJjZXB0b3IgaXMgcmVzcG9uc2libGUgZm9yIHNob3dpbmcgYW5kIGhpZGluZyB0aGUgQzJTcGlubmVyXG4gICAgICAgKiB3aGVuIGEgYXN5bmMgcmVxdWVzdCBpcyBzdGFydGVkL2VuZGVkXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHthbnl9ICRxXG4gICAgICAgKiBAcGFyYW0ge2FueX0gJGluamVjdG9yXG4gICAgICAgKiBAcmV0dXJuc1xuICAgICAgICovXG4gICAgICBmdW5jdGlvbiBzaG93SGlkZVNwaW5uZXIoJHEsICRpbmplY3RvciwgR2xvYmFsKSB7XG4gIFxuICAgICAgICAvKipcbiAgICAgICAgICogQ3VycmVudCBwZW5kaW5nIHJlcXVlc3RzXG4gICAgICAgICAqL1xuICAgICAgICBHbG9iYWwucGVuZGluZ1JlcXVlc3RzID0gMDtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgR2xvYmFsLnBlbmRpbmdSZXF1ZXN0cysrO1xuICAgICAgICAgICAgJGluamVjdG9yLmdldCgnQzJTcGlubmVyJykuc2hvdygpOyAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICAgIH0sXG4gIFxuICAgICAgICAgIHJlc3BvbnNlOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIEdsb2JhbC5wZW5kaW5nUmVxdWVzdHMtLTsgIFxuICAgICAgICAgICAgLy8gdGhlIHNwaW5uZXIgaXMgb25seSBoaWRkZW4gaWYgdGhlcmUgYXJlIG5vIG1vcmUgIHBlbmRpbmcgcmVxdWVzdHMgICAgICBcbiAgICAgICAgICAgIGlmIChHbG9iYWwucGVuZGluZ1JlcXVlc3RzID09PSAwKSB7XG4gICAgICAgICAgICAgICRpbmplY3Rvci5nZXQoJ0MyU3Bpbm5lcicpLmhpZGUoKTtcbiAgICAgICAgICAgIH0gICAgICAgXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgfSxcbiAgXG4gICAgICAgICAgcmVzcG9uc2VFcnJvcjogZnVuY3Rpb24gKHJlamVjdGlvbikge1xuICAgICAgICAgICAgR2xvYmFsLnBlbmRpbmdSZXF1ZXN0cy0tOyAgXG4gICAgICAgICAgICAvLyB0aGUgc3Bpbm5lciBpcyBvbmx5IGhpZGRlbiBpZiB0aGVyZSBhcmUgbm9tb3JlICBwZW5kaW5nIHJlcXVlc3RzICAgICAgXG4gICAgICAgICAgICBpZiAoR2xvYmFsLnBlbmRpbmdSZXF1ZXN0cyA9PT0gMCkge1xuICAgICAgICAgICAgICAkaW5qZWN0b3IuZ2V0KCdDMlNwaW5uZXInKS5oaWRlKCk7XG4gICAgICAgICAgICB9ICBcbiAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVqZWN0aW9uKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG4gIFxuICAgICAgLy8gRGVmaW5lIGEgZmFjdG9yeSB0byB0aGUgJGh0dHBJbnRlcmNlcHRvclxuICAgICAgJHByb3ZpZGUuZmFjdG9yeSgnc2hvd0hpZGVTcGlubmVyJywgc2hvd0hpZGVTcGlubmVyKTtcbiAgXG4gICAgICAvLyBQdXNoIHRoZSBuZXcgZmFjdG9yeSBvbnRvIHRoZSAkaHR0cCBpbnRlcmNlcHRvciBhcnJheVxuICAgICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnc2hvd0hpZGVTcGlubmVyJyk7XG4gICAgfVxuICB9KCkpO1xuICAiLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuZmFjdG9yeSgnRmVhdHVyZVNlcnZpY2UnLCBGZWF0dXJlU2VydmljZSk7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICBmdW5jdGlvbiBGZWF0dXJlU2VydmljZShzZXJ2aWNlRmFjdG9yeSkge1xuICAgIHZhciBtb2RlbCA9IHNlcnZpY2VGYWN0b3J5KCcvaGVpbWFwL2ZlYXR1cmUvJywge1xuICAgICAgYWN0aW9uczogeyB9LFxuICAgICAgaW5zdGFuY2U6IHsgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG1vZGVsO1xuICB9XG5cbn0oKSk7XG4iLCIoZnVuY3Rpb24gKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuY29udHJvbGxlcignTWFwQ29udHJvbGxlcicsIE1hcENvbnRyb2xsZXIpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgZnVuY3Rpb24gTWFwQ29udHJvbGxlcigkY29udHJvbGxlciwgQzJEaWFsb2csICRzY29wZSwgR2xvYmFsLCBNYXBWaWV3ZXJTZXJ2aWNlLCAkcm9vdFNjb3BlKSB7XG4gICAgdmFyIHZtID0gdGhpcztcblxuICAgIC8vIEZ1bmN0aW9ucyBCbG9ja1xuICAgIHZtLm9wZW5BZGRNYXAgPSBvcGVuQWRkTWFwO1xuICAgIHZtLm9wZW5FZGl0TWFwID0gb3BlbkVkaXRNYXA7XG4gICAgdm0ub25WaWV3ZXJBY3RpdmF0ZSA9IG9uVmlld2VyQWN0aXZhdGU7XG5cbiAgICAvLyBTZXQgdGhlIG1hcCB2aWV3ZXIgb3B0aW9uc1xuICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgc3VwcG9ydExpc3RpbmdWaWV3IDogdHJ1ZSxcbiAgICAgIHN1cHBvcnREcmF3aW5nIDogZmFsc2UsXG4gICAgICB0aXRsZVRyYW5zbEtleSA6ICd2aWV3cy50aXRsZXMubWFwVmlldycsXG4gICAgICBsZWZ0U2lkZUJhcjogR2xvYmFsLmNsaWVudFBhdGggKyAnL21hcC9uYXZzL21hcC1sZWZ0LXNpZGVuYXYuaHRtbCdcbiAgICB9ICAgICBcblxuICAgIC8vIGluc3RhbnRpYXRlIHRoZSBiYXNlIE1hcFZpZXdlckNvbnRyb2xsZXJcbiAgICAkY29udHJvbGxlcignTWFwVmlld2VyQ29udHJvbGxlcicsIHt2bTogdm0sICRzY29wZTogJHNjb3BlLCBvcHRpb25zfSk7XG5cbiAgICAvKipcbiAgICAgKiBBY3Rpb25zIGV4ZWN1dGVkIGFmdGVyIHRoZSBiYXNlIHZpZXdlciBpcyBhY3RpdmF0ZWRcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvblZpZXdlckFjdGl2YXRlKCl7IFxuICAgICAgLy8gU2V0IGdsb2JhbCB2aWV3ZXIgb3B0aW9uc1xuICAgICAgTWFwVmlld2VyU2VydmljZS5zZXRPcHRpb24oJ3JpZ2h0TWFwVmlld2VyJywgJ3Nob3dMb2FkTWFwSW5SaWdodCcsIHRydWUpO1xuICAgICAgTWFwVmlld2VyU2VydmljZS5zZXRPcHRpb24oJ2xlZnRNYXBWaWV3ZXInLCAnc2hvd0xvYWRNYXBJblJpZ2h0JywgdHJ1ZSk7XG4gICAgfSAgICBcbiAgICBcbiAgICAvKipcbiAgICAgKiBMaXN0ZW4gdG8gdGhlIGFkZGVkIG1hcCBkcmF3ICBldmVudCBhbmQgc2F2ZSB0aGUgbWFwXG4gICAgICogaW4gdGhlIGJhY2stZW5kXG4gICAgICovXG4gICAgJHJvb3RTY29wZS4kb24oJ2FkZGVkTWFwRHJhdycsIGZ1bmN0aW9uIChldmVudCwgZHJhd3NHZW9Kc29uKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIj4+Pm1hcC5jb250cm9sbGVyID4+PiBhZGRlZE1hcERyYXcgXCIsZHJhd3NHZW9Kc29uKTtcbiAgICAgIHZtLnJlc291cmNlLmRyYXdzID0gZHJhd3NHZW9Kc29uO1xuICAgICAgb3BlbkF0dHJpYnV0ZURhaWxvZyhkcmF3c0dlb0pzb24pO1xuICAgICAgLy8gaXQgaXMgbmVlZGVkIHRvIGRlZmluZSBhIHdheSB0byBpZGVudGlmeSB0aGUgdGFyZ2V0IG1hcCBvdmVyIHdoaWNoIHRoZSBwb2x5Z29uIHdhcyBkcmF3biwgc28gaXQgY2FuIGJlIHNhdmVkIGFzIGEgdmVjdG9yIGRhdGEgdG8gdGhhdCBtYXBcbiAgICAgIC8vdm0ucmVzb3VyY2UuJHNhdmUoKTtcbiAgICB9KTtcblxuXG4gICAgLyoqXG4gICAgICogT3BlbiB0aGUgZGlhbG9nIHRvIGFkZCBhIG1hcFxuICAgICAqIEByZXR1cm4gdm9pZFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG9wZW5BZGRNYXAoKSB7XG4gICAgICBvcGVuRGlhbG9nKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT3BlbiB0aGUgZGlhbG9nIHRvIGVkaXQgYSBtYXBcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gcmVzb3VyY2UgXG4gICAgICogIEByZXR1cm4gdm9pZFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG9wZW5FZGl0TWFwKHJlc291cmNlKSB7XG4gICAgICBvcGVuRGlhbG9nKHJlc291cmNlKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVuIHRoZSBkaWFsb2cgdGhhdCBhbGxvd3MgYWRkIG9yIGVkaXQgYSBtYXBcbiAgICAgKiBXaGVuIGNsb3NlZCwgdGhlIHJlc291cmNlcyAobWFwcykgd2lsbCBiZSByZWZyZXNoZWRcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gcmVzb3VyY2UgXG4gICAgICogQHJldHVybiB2b2lkXG4gICAgICovXG4gICAgZnVuY3Rpb24gb3BlbkRpYWxvZyhyZXNvdXJjZSkge1xuICAgICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgbG9jYWxzOiB7XG4gICAgICAgICAgbWFwRGlhbG9nSW5wdXQ6IHtcbiAgICAgICAgICAgIG1vZGVsOiByZXNvdXJjZSxcbiAgICAgICAgICAgIHJlbW92ZUZuOiB2bS5yZW1vdmVcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGNvbnRyb2xsZXI6ICdNYXBEaWFsb2dDb250cm9sbGVyJyxcbiAgICAgICAgY29udHJvbGxlckFzOiAnY3RybCcsXG4gICAgICAgIHRlbXBsYXRlVXJsOiBHbG9iYWwuY2xpZW50UGF0aCArICcvbWFwL2RpYWxvZy9tYXAtZGlhbG9nLmh0bWwnLFxuICAgICAgICBoYXNCYWNrZHJvcDogdHJ1ZVxuICAgICAgfTtcblxuICAgICAgQzJEaWFsb2cuY3VzdG9tKGNvbmZpZykudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIHJlbG9hZCB0aGUgaXRlbXMgZnJvbSBiYWNrLWVuZFxuICAgICAgICB2bS5zZWFyY2goKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgLmNvbmZpZyhyb3V0ZXMpO1xuXG4gIC8qKlxuICAgKiBDb25maWd1cmF0aW9uIGZpbGUgZm9yIG1hcCByb3V0ZVxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gJHN0YXRlUHJvdmlkZXJcbiAgICogQHBhcmFtIHtvYmplY3R9IEdsb2JhbFxuICAgKi9cbiAgLyoqIEBuZ0luamVjdCAqL1xuICBmdW5jdGlvbiByb3V0ZXMoJHN0YXRlUHJvdmlkZXIsIEdsb2JhbCkge1xuICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAuc3RhdGUoJ2FwcC5tYXAnLCB7XG4gICAgICAgIHVybDogJy9tYXAnLFxuICAgICAgICB0ZW1wbGF0ZVVybDogR2xvYmFsLmNsaWVudFBhdGggKyAnL21hcC9tYXAuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6ICdNYXBDb250cm9sbGVyIGFzIG1hcEN0cmwnLFxuICAgICAgICBkYXRhOiB7IH1cbiAgICAgIH0pO1xuICB9XG59KCkpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgLmZhY3RvcnkoJ01hcFNlcnZpY2UnLCBNYXBTZXJ2aWNlKTtcblxuICAvKiogQG5nSW5qZWN0ICovXG4gIGZ1bmN0aW9uIE1hcFNlcnZpY2Uoc2VydmljZUZhY3RvcnkpIHtcbiAgICB2YXIgbW9kZWwgPSBzZXJ2aWNlRmFjdG9yeSgnL2hlaW1hcC9tYXAvJywge1xuICAgICAgYWN0aW9uczogeyB9LFxuICAgICAgaW5zdGFuY2U6IHsgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG1vZGVsO1xuICB9XG5cbn0oKSk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgLmZhY3RvcnkoJ0ZpbGVTZXJ2aWNlJywgRmlsZVNlcnZpY2UpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgZnVuY3Rpb24gRmlsZVNlcnZpY2Uoc2VydmljZUZhY3RvcnksICRodHRwLCAkcSkge1xuICAgIHZhciBlbmRQb2ludCA9ICcvaGVpbWFwL2ZpbGUnO1xuICAgIHZhciBtb2RlbCA9IHNlcnZpY2VGYWN0b3J5KGVuZFBvaW50LCB7XG4gICAgICBhY3Rpb25zOiB7fSxcbiAgICAgIGluc3RhbmNlOiB7XG4gICAgICAgIHVwbG9hZDogdXBsb2FkXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiB1cGxvYWQoKSB7XG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCB0aGlzLmZpbGUpO1xuICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQodGhpcy5tYXBfaW1hZ2VfZmlsZV9pZCkgJiYgdGhpcy5tYXBfaW1hZ2VfZmlsZV9pZCAhPT0gbnVsbCkge1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ21hcF9pbWFnZV9maWxlX2lkJywgdGhpcy5tYXBfaW1hZ2VfZmlsZV9pZCk7XG4gICAgICB9IFxuICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQodGhpcy5tYXBfZ2VvX2ZpbGVfcHJvamVjdGlvbikgJiYgdGhpcy5tYXBfZ2VvX2ZpbGVfcHJvamVjdGlvbiAhPT0gbnVsbCkge1xuICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ21hcF9nZW9fZmlsZV9wcm9qZWN0aW9uJywgdGhpcy5tYXBfZ2VvX2ZpbGVfcHJvamVjdGlvbik7XG4gICAgICB9XG5cbiAgICAgICRodHRwLnBvc3QoZW5kUG9pbnQsIGZvcm1EYXRhLCB7XG4gICAgICAgIHRyYW5zZm9ybVJlcXVlc3Q6IGFuZ3VsYXIuaWRlbnRpdHksXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAnQ29udGVudC1UeXBlJzogdW5kZWZpbmVkXG4gICAgICAgIH1cbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3VsdC5kYXRhKTtcbiAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgZGVmZXJyZWQucmVqZWN0KGVycik7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cbiAgICByZXR1cm4gbW9kZWw7XG4gIH1cblxufSgpKTsiLCIvKipcbiAqIE1hcCBMYXllciBTZXJ2aWNlIHJlc3BvbnNpYmxlIGZvciBidWlsZGluZyBiYXNpYyBsYXllcnMsIG1hbmFnaW5nIHRoZSBzdGF0ZSBvZiB0aGUgcmlnaHQgYW5kIGxlZnQgdmlld2VycyBcbiAqIGFuZCBpdHMgbGF5ZXJzLCBhcyB3ZWxsIGFzIGJhc2ljIGludGVyYWN0aW9ucyBzdXBwb3J0ZWQgYnkgbGVhZmxldCwgbGlrZSBjaGFuZ2Ugb3BhY2l0eSwgcmVvcmRlciBldGMuXG4gKiBcbiAqIEFzIGEgY2VudHJhbGl6ZWQgc2VydmljZSB0aGlzIHNlcnZpY2UgZXhlY3V0ZSBhY3Rpb25zIGFuZCBicm9hZGNhc3QgZXZlbnRzIHdoZW4gdGhlIHN0YXRlIGNoYW5nZXNcbiAqIFRoZSBmb2xsb3dpbmcgZXZlbnRzIGFyZSBicm9hZGNhc3RlZDpcbiAqIFxuICogdW5nZW9yZWZlcmVuY2VkTGF5ZXJUb0JlTG9hZGVkXG4gKiBnZW9yZWZlcmVuY2VkTGF5ZXJUb0JlTG9hZGVkXG4gKiBtYXBMYXllcnNDaGFuZ2VkXG4gKiBhZGRlZE1hcExheWVyXG4gKiByZW1vdmVkTWFwTGF5ZXJcbiAqIHJlbW92ZWRBbGxNYXBMYXllcnNcbiAqIG1hcEhpZGRlblxuICogbWFwU2hvd25cbiAqIHZpZXdlckhpZGRlblxuICogdmlld2VyU2hvd25cbiAqIG1hcExheWVyc1Jlb3JkZXJlZFxuICogYWRkZWRNYXBEcmF3XG4gKi9cblxuKGZ1bmN0aW9uICgpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdhcHAnKVxuICAgIC5mYWN0b3J5KCdNYXBMYXllclNlcnZpY2UnLCBNYXBMYXllclNlcnZpY2UpO1xuXG5cbiAgZnVuY3Rpb24gTWFwTGF5ZXJTZXJ2aWNlKGxlYWZsZXREYXRhLCBsZWFmbGV0LCBsb2Rhc2gsIFN1cHBvcnRTZXJ2aWNlLCAkcm9vdFNjb3BlLCAkcSwgJHRpbWVvdXQpIHtcbiAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgIGJ1aWxkRGVmYXVsdExheWVyczogYnVpbGREZWZhdWx0TGF5ZXJzLFxuICAgICAgYWRkTWFwTGF5ZXI6IGFkZE1hcExheWVyLFxuICAgICAgcmVtb3ZlTWFwTGF5ZXI6IHJlbW92ZU1hcExheWVyLFxuICAgICAgaGlkZU1hcDogaGlkZU1hcCxcbiAgICAgIHNob3dNYXA6IHNob3dNYXAsXG4gICAgICAvLyBhZGRNYXBMYXllcjogYWRkTWFwTGF5ZXIsXG4gICAgICBzZXJ2ZXJDb25maWc6IG51bGwsXG4gICAgICBpc0FkZGVkOiBpc0FkZGVkLFxuICAgICAgZml0TWFwQm91bmRzOiBmaXRNYXBCb3VuZHMsXG4gICAgICBhcHBseU9wYWNpdHk6IGFwcGx5T3BhY2l0eSxcbiAgICAgIGhhc05vbkdlb3JlZmVyZW5jZWRMYXllcjogaGFzTm9uR2VvcmVmZXJlbmNlZExheWVyLFxuICAgICAgcmVtb3ZlQWxsTWFwTGF5ZXJzOiByZW1vdmVBbGxNYXBMYXllcnMsXG4gICAgICBnZXRWaWV3ZXJPdmVybGF5czogZ2V0Vmlld2VyT3ZlcmxheXMsXG4gICAgICBnZXRWaWV3ZXJEYXRhOiBnZXRWaWV3ZXJEYXRhLFxuICAgICAgZ2V0RGVmYXVsdENlbnRlcjogZ2V0RGVmYXVsdENlbnRlcixcbiAgICAgIHJlZnJlc2hNYXBSZXNvdXJjZTogcmVmcmVzaE1hcFJlc291cmNlLFxuICAgICAgaGlkZVZpZXdlcjogaGlkZVZpZXdlcixcbiAgICAgIHNob3dWaWV3ZXI6IHNob3dWaWV3ZXIsXG4gICAgICBhcHBseVJlb3JkZXI6IGFwcGx5UmVvcmRlcixcbiAgICAgIHNldFdoZWVsWm9vbVN0YXR1czogc2V0V2hlZWxab29tU3RhdHVzLFxuICAgICAgZ2V0Vmlld2VyRHJhd3M6IGdldFZpZXdlckRyYXdzLFxuICAgICAgZ2V0T3ZlcmxheXNDb3VudEJvb2w6IGdldE92ZXJsYXlzQ291bnRCb29sLFxuICAgICAgYWRkV0ZTTGF5ZXI6IGFkZFdGU0xheWVyXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIFByaXZhdGUgcHJvcGVydHkgdGhhdCBzdG9yZXMgdGhlIGJhc2UgbGF5ZXJzIC8gb3ZlcmxheXMgXG4gICAgICogIFxuICAgICAqL1xuICAgIHZhciBzZXJ2aWNlRGF0YSA9IHt9O1xuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSB2aWV3ZXIgb3ZlcmxheXNcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gdmlld2VySWQgXG4gICAgICogQHJldHVybnMge31cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRWaWV3ZXJPdmVybGF5cyh2aWV3ZXJJZCkge1xuICAgICAgdmFyIHZpZXdlckRhdGEgPSBnZXRWaWV3ZXJEYXRhKHZpZXdlcklkKTsgICAgICBcbiAgICAgIHZhciBvdmVybGF5cyA9IGFuZ3VsYXIuY29weSh2aWV3ZXJEYXRhLm92ZXJsYXlzKTsgICAgXG4gICAgICBpZiAob3ZlcmxheXMgJiYgYW5ndWxhci5pc0RlZmluZWQob3ZlcmxheXMuZHJhdykpIHtcbiAgICAgICAgZGVsZXRlIG92ZXJsYXlzLmRyYXc7XG4gICAgICB9XG4gICAgICByZXR1cm4gb3ZlcmxheXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSB2aWV3ZXIgZHJhd3NcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gdmlld2VySWQgXG4gICAgICogQHJldHVybnMge31cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRWaWV3ZXJEcmF3cyh2aWV3ZXJJZCkge1xuICAgICAgdmFyIHZpZXdlckRhdGEgPSBnZXRWaWV3ZXJEYXRhKHZpZXdlcklkKTsgICAgICBcbiAgICAgIHZhciBvdmVybGF5cyA9IGFuZ3VsYXIuY29weSh2aWV3ZXJEYXRhLm92ZXJsYXlzKTsgICAgXG4gICAgICBpZiAob3ZlcmxheXMgJiYgYW5ndWxhci5pc0RlZmluZWQob3ZlcmxheXMuZHJhdykpIHtcbiAgICAgICAgcmV0dXJuIG92ZXJsYXlzLmRyYXc7XG4gICAgICB9ICAgICBcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIG1vdXNlIHdoZWVsIHNjcm9sbCB6b29tIGNvbnRyb2wgYXMgZW5hYmxlZC9kaXNhYmxlZCBmb3IgYSBjZXJ0YWluIHZpZXdlclxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2aWV3ZXJJZCBcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IGVuYWJsZWRcbiAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2V0V2hlZWxab29tU3RhdHVzKHZpZXdlcklkLCBlbmFibGVkKXtcbiAgICAgIGxlYWZsZXREYXRhLmdldE1hcCh2aWV3ZXJJZCkudGhlbihmdW5jdGlvbiAobWFwKSB7XG4gICAgICAgIGlmKGVuYWJsZWQgPT09IHRydWUpe1xuICAgICAgICAgIG1hcC5zY3JvbGxXaGVlbFpvb20uZW5hYmxlKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbWFwLnNjcm9sbFdoZWVsWm9vbS5kaXNhYmxlKCk7XG4gICAgICAgIH0gICAgICAgIFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGJvb2xlYW4uIFRydWUgaWYgdGhlcmUgYXJlIG5vIG92ZXJsYXlzIGFkZGVkLlxuICAgICAqIFxuICAgICAqIFxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldE92ZXJsYXlzQ291bnRCb29sKCl7XG4gICAgICBpZiAoT2JqZWN0LnZhbHVlcyhzZXJ2aWNlRGF0YSlbMF1bXCJvdmVybGF5c1wiXSA9PSB1bmRlZmluZWQgJiYgXG4gICAgICAgICAgT2JqZWN0LnZhbHVlcyhzZXJ2aWNlRGF0YSlbMV1bXCJvdmVybGF5c1wiXSA9PSB1bmRlZmluZWQpe1xuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfSBlbHNlIHsgcmV0dXJuIGZhbHNlIH1cbiAgICB9XG5cblxuICAgIC8qKlxuICAgICAqIEdldCB2aWV3IGRhdGEgYnkgdmlld2VyIElEXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IHZpZXdlcklkIFxuICAgICAqIEByZXR1cm5zIHt9XG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0Vmlld2VyRGF0YSh2aWV3ZXJJZCkge1xuICAgICAgdmlld2VySWQgPSBwYXJzZU1hcFZpZXdlcklkKHZpZXdlcklkKTtcbiAgICAgIGlmICh2aWV3ZXJJZCBpbiBzZXJ2aWNlRGF0YSkge1xuICAgICAgICByZXR1cm4gc2VydmljZURhdGFbdmlld2VySWRdO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHt9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQnVpbGQgdGhlIGRlZmF1bHQgYmFzZSBsYXllcnNcbiAgICAgKiBAcGFyYW0ge30gb3B0aW9uc1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJ1aWxkRGVmYXVsdExheWVycyhvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gYW5ndWxhci5pc1VuZGVmaW5lZChvcHRpb25zKT8ge30gOiBvcHRpb25zO1xuXG4gICAgICBTdXBwb3J0U2VydmljZS5jb25maWcoKS50aGVuKFxuICAgICAgICBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICBzZXJ2aWNlLnNlcnZlckNvbmZpZyA9IHJlc3BvbnNlO1xuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBzZXJ2aWNlRGF0YS5sZWZ0TWFwVmlld2VyID0ge1xuICAgICAgICBiYXNlbGF5ZXJzOiBnZXRCYXNlTGF5ZXJzKCkgICAgICAgIFxuICAgICAgfVxuXG4gICAgICBpZihvcHRpb25zLnN1cHBvcnREcmF3aW5nKXtcbiAgICAgICAgc2VydmljZURhdGEubGVmdE1hcFZpZXdlci5vdmVybGF5cyA9IFxuICAgICAgICB7XG4gICAgICAgICAgZHJhdzoge1xuICAgICAgICAgICAgbmFtZTogJ2RyYXcnLFxuICAgICAgICAgICAgdHlwZTogJ2dyb3VwJyxcbiAgICAgICAgICAgIHZpc2libGU6IHRydWUsXG4gICAgICAgICAgICBsYXllclBhcmFtczoge1xuICAgICAgICAgICAgICBzaG93T25TZWxlY3RvcjogZmFsc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIEF0IHRoZSBiZWdpbm5pbmcgYm90aCBtYXAgbGF5ZXJzIGFyZSBlcXVhbFxuICAgICAgc2VydmljZURhdGEucmlnaHRNYXBWaWV3ZXIgPSBhbmd1bGFyLmNvcHkoc2VydmljZURhdGEubGVmdE1hcFZpZXdlcik7XG4gICAgICBsaXN0ZW5BbmRBcHBseURyYXcoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBcHBseSBkcmF3IGFzIG5ldyBsYXllciBvbiBkcmF3XG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gbGlzdGVuQW5kQXBwbHlEcmF3KCkge1xuICAgICAgZnVuY3Rpb24ga2VlcERyYXcodmlld2VySWQpe1xuICAgICAgICBsZWFmbGV0RGF0YS5nZXRNYXAodmlld2VySWQpLnRoZW4oZnVuY3Rpb24gKG1hcCkge1xuICAgICAgICAgIGxlYWZsZXREYXRhLmdldExheWVycyh2aWV3ZXJJZCkudGhlbihmdW5jdGlvbiAoYmFzZWxheWVycykge1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJiYXNlbHllciA9IFwiLCBiYXNlbGF5ZXJzKTtcbiAgICAgICAgICAgIHZhciBkcmF3bkl0ZW1zID0gYmFzZWxheWVycy5vdmVybGF5cy5kcmF3O1xuICAgICAgICAgICAgLy8gYWRkZWQgY29uZGl0aW9uIHRvIGhhbmRsZSByZWN0YW5nbGUgc2VsZWN0aW9uIGZvciBHZW9yZWZcbiAgICAgICAgICAgIGlmKHR5cGVvZiBkcmF3bkl0ZW1zICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgIG1hcC5vbignZHJhdzpjcmVhdGVkJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgbGF5ZXIgPSBlLmxheWVyO1xuICAgICAgICAgICAgICAgIGRyYXduSXRlbXMuYWRkTGF5ZXIobGF5ZXIpO1xuICAgICAgICAgICAgICAgIHZhciBkcmF3c0dlb0pzb24gPSBsYXllci50b0dlb0pTT04oKTtcbiAgICAgICAgICAgICAgICAvLyBicm9hZGNhc3QgdGhlIGV2ZW50c1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbWFwTGF5ZXJzQ2hhbmdlZCcpO1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnYWRkZWRNYXBEcmF3JywgZHJhd3NHZW9Kc29uKTsgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICB9LmJpbmQoZHJhd25JdGVtcykpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBrZWVwRHJhdygnbGVmdE1hcFZpZXdlcicpO1xuICAgICAga2VlcERyYXcoJ3JpZ2h0TWFwVmlld2VyJyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSBkZWZhdWx0IGNlbnRlciBmb3IgYSBsYXllclxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldERlZmF1bHRDZW50ZXIoKSB7XG4gICAgICAvLyBIZWlkZWxiZXJnLCBHZXJtYW55XG4gICAgICByZXR1cm4ge1xuICAgICAgICBsYXQ6IDQ5LjM5OTIyOCxcbiAgICAgICAgbG5nOiA4LjY4MDUyMixcbiAgICAgICAgem9vbTogOFxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgYmFzZSBsYXllcnNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRCYXNlTGF5ZXJzKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgeHl6OiB7XG4gICAgICAgICAgbmFtZTogJ09wZW5TdHJlZXRNYXAnLFxuICAgICAgICAgIHVybDogJ2h0dHA6Ly97c30udGlsZS5vcGVuc3RyZWV0bWFwLm9yZy97en0ve3h9L3t5fS5wbmcnLFxuICAgICAgICAgIHR5cGU6ICd4eXonLFxuICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgbGF5ZXJPcHRpb25zOiB7XG4gICAgICAgICAgICB6SW5kZXg6IDBcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGJpbmdBZXJpYWw6IHtcbiAgICAgICAgICBuYW1lOiAnQWVyaWFsJyxcbiAgICAgICAgICB0eXBlOiAnYmluZycsXG4gICAgICAgICAga2V5OiAnQWo2WHRFMVExckl2ZWhtam4yUmgxTFIycXZNR1otOHZQUzlIbjNqQ2VVaVRvTTc3SkZuZi1rRlJ6eU1FTERvbCcsXG4gICAgICAgICAgbGF5ZXJPcHRpb25zOiB7XG4gICAgICAgICAgICB0eXBlOiAnQWVyaWFsJyxcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICB6SW5kZXg6IDBcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGJpbmdSb2FkOiB7XG4gICAgICAgICAgbmFtZTogJ1JvYWQnLFxuICAgICAgICAgIHR5cGU6ICdiaW5nJyxcbiAgICAgICAgICBrZXk6ICdBajZYdEUxUTFySXZlaG1qbjJSaDFMUjJxdk1HWi04dlBTOUhuM2pDZVVpVG9NNzdKRm5mLWtGUnp5TUVMRG9sJyxcbiAgICAgICAgICBsYXllck9wdGlvbnM6IHtcbiAgICAgICAgICAgIHR5cGU6ICdSb2FkJyxcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICB6SW5kZXg6IDBcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGJpbmdBZXJpYWxXaXRoTGFiZWxzOiB7XG4gICAgICAgICAgbmFtZTogJ0FlcmlhbCBXaXRoIExhYmVscycsXG4gICAgICAgICAgdHlwZTogJ2JpbmcnLFxuICAgICAgICAgIGtleTogJ0FqNlh0RTFRMXJJdmVobWpuMlJoMUxSMnF2TUdaLTh2UFM5SG4zakNlVWlUb003N0pGbmYta0ZSenlNRUxEb2wnLFxuICAgICAgICAgIGxheWVyT3B0aW9uczoge1xuICAgICAgICAgICAgdHlwZTogJ0FlcmlhbFdpdGhMYWJlbHMnLFxuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIHpJbmRleDogMFxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBCdWlsZCBhbiBhZGRpdGlvbmFsIG92ZXJsYXlzXG4gICAgICogQHBhcmFtIHt9IHJlc291cmNlIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGJ1aWxkTWFwT3ZlcmxheShyZXNvdXJjZSkge1xuICAgICAgdmFyIGxheWVyID0ge1xuICAgICAgICBuYW1lOiByZXNvdXJjZS50aXRsZSxcbiAgICAgICAgdHlwZTogJ3dtcycsXG4gICAgICAgIHZpc2libGU6IHRydWUsXG4gICAgICAgIHVybDogc2VydmljZS5zZXJ2ZXJDb25maWcuYmFzZV9vd3NfdXJsLFxuICAgICAgICBsYXllclBhcmFtczoge1xuICAgICAgICAgIGxheWVyczogcmVzb3VyY2UuZ2Vvc2VydmVyX2xheWVyX2lkLFxuICAgICAgICAgIGZvcm1hdDogJ2ltYWdlL3BuZycsXG4gICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWUsXG4gICAgICAgICAgb3BhY2l0eTogMC43XG4gICAgICAgIH0sXG4gICAgICAgIGxheWVyT3B0aW9uczoge1xuICAgICAgICAgIG9wYWNpdHk6IDAuNyxcbiAgICAgICAgICB0aWxlZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICByZXNvdXJjZTogcmVzb3VyY2VcbiAgICAgIH1cbiAgICAgIHJldHVybiBsYXllcjtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaXQgdGhlIG1hcCB2aWV3IHRvIHRoZSBib3VuZHMgb2YgYSBsYXllclxuICAgICAqIEBwYXJhbSBvYmplY3QgcmVzb3VyY2UgXG4gICAgICogQHBhcmFtIHN0cmluZyBtYXBDb21wb25lbnRJZCBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBmaXRNYXBCb3VuZHMocmVzb3VyY2UsIHZpZXdlcklkKSB7XG4gICAgICB2aWV3ZXJJZCA9IHBhcnNlTWFwVmlld2VySWQodmlld2VySWQpO1xuICAgICAgbGVhZmxldERhdGEuZ2V0TWFwKHZpZXdlcklkKS50aGVuKGZ1bmN0aW9uIChtYXApIHtcbiAgICAgICAgdmFyIGJvdW5kcyA9IFtcbiAgICAgICAgICBbcmVzb3VyY2UubWFwX3RvcF9sZWZ0X2xvbmcsIHJlc291cmNlLm1hcF90b3BfbGVmdF9sYXRdLFxuICAgICAgICAgIFtyZXNvdXJjZS5tYXBfcmlnaHRfYm90dG9tX2xvbmcsIHJlc291cmNlLm1hcF9yaWdodF9ib3R0b21fbGF0XVxuICAgICAgICBdO1xuICAgICAgICBtYXAuZml0Qm91bmRzKGJvdW5kcyk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBBcHBseSB0aGUgbGF5ZXIgZGVmaW5lZCBvcGFjaXR5IG9yIHRoZSB2YWx1ZSBkZWZpbmVkIGluIHRoZSBsYXllciB0cmFuc3BhcmVuY3kgcHJvcGVydHlcbiAgICAgKiBAcGFyYW0ge30gbGF5ZXIgXG4gICAgICogQHBhcmFtIHN0cmluZyB2aWV3ZXJJZCBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhcHBseU9wYWNpdHkobGF5ZXIpIHtcbiAgICAgIGxlYWZsZXREYXRhLmdldExheWVycyhsYXllci52aWV3ZXJJZCkudGhlbihmdW5jdGlvbiAobGF5ZXJzKSB7XG4gICAgICAgIHZhciBvdmVybGF5SWQgPSBwYXJzZU1hcE92ZXJsYXlJZChsYXllci52aWV3ZXJJZCwgbGF5ZXIucmVzb3VyY2UpO1xuICAgICAgICBsYXllcnMub3ZlcmxheXNbb3ZlcmxheUlkXS5zZXRPcGFjaXR5KGxheWVyLmxheWVyUGFyYW1zLm9wYWNpdHkpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWRkIGEgbWFwIGFzIGEgbGF5ZXIgdG8gdGhlIG1hcHMgKGxlZnQgYW5kIHJpZ2h0KVxuICAgICAqIFxuICAgICAqIEBwYXJhbSBvYmplY3QgcmVzb3VyY2UgcmVwcmVzZW50aW5nIG1hcFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFkZE1hcExheWVyKHJlc291cmNlLCB2aWV3ZXJJZCkge1xuXG4gICAgICAvLyBjb25zb2xlLmxvZyhyZXNvdXJjZSlcblxuICAgICAgaWYgKGlzQWRkZWQocmVzb3VyY2UsIHZpZXdlcklkKSA9PT0gZmFsc2UpIHtcblxuICAgICAgICBwcmVwYXJlVmlld2VyKHJlc291cmNlLHZpZXdlcklkKS50aGVuKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgLy8gcGFyc2UgdGhlIHZpZXdlciBpZCBhbmQgbWFrZSBzdXJlIHRoYXRcbiAgICAgICAgICAvLyB0aGUgb3ZlcmxheXMgcHJvcGVydHkgaXMgaW5pdGlhbGl6ZWRcbiAgICAgICAgICB2aWV3ZXJJZCA9IHBhcnNlTWFwVmlld2VySWQodmlld2VySWQpO1xuICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKHNlcnZpY2VEYXRhW3ZpZXdlcklkXS5vdmVybGF5cykpIHtcbiAgICAgICAgICAgIHNlcnZpY2VEYXRhW3ZpZXdlcklkXS5vdmVybGF5cyA9IHt9O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIGJ1aWxkIGEgbmV3IG92ZXJsYXlcbiAgICAgICAgICB2YXIgbmV3TGF5ZXIgPSBidWlsZE1hcE92ZXJsYXkocmVzb3VyY2UpO1xuICAgICAgICAgIC8vIHNldCB0aGUgdmlld2VySWQgaW4gYXMgYSBwcm9wZXJ0eSAoaW4gc29tZSBsb29wIGl0IGNhbiBiZSB1c2VmdWwpXG4gICAgICAgICAgbmV3TGF5ZXIudmlld2VySWQgPSB2aWV3ZXJJZDtcbiAgICAgICAgICB2YXIgb3ZlcmxheUlkID0gcGFyc2VNYXBPdmVybGF5SWQodmlld2VySWQsIHJlc291cmNlKTtcblxuICAgICAgICAgIC8vIGFkZCB0aGUgbmV3IGxheWVyIGFzIGEgcHJvcGVydHkgb2YgdGhlIGxheWVyXG4gICAgICAgICAgc2VydmljZURhdGFbdmlld2VySWRdLm92ZXJsYXlzW292ZXJsYXlJZF0gPSBuZXdMYXllcjtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBmaXQgdGhlIGJvdW5kcyBvZiB0aGUgbmV3IGxvYWRlZCBtYXAgbGF5ZXIsIHNvIGl0IGlzIHZpc2libGVcbiAgICAgICAgICBmaXRNYXBCb3VuZHMocmVzb3VyY2UsIHZpZXdlcklkKTtcbiAgICAgICAgICBsaXN0ZW5BbmRBcHBseURyYXcoKTtcblxuICAgICAgICAgIC8vIGJyb2FkY2FzdCB0aGUgZXZlbnRzXG4gICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdtYXBMYXllcnNDaGFuZ2VkJyk7XG4gICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdhZGRlZE1hcExheWVyJywgcmVzb3VyY2UpO1xuICAgICAgICAgIHNob3dNYXAocmVzb3VyY2UsIHZpZXdlcklkKTtcbiAgICAgICAgfSk7ICAgIFxuICAgICAgfSAgICAgXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUHJlcGFyZSBzYSB2aWV3ZXIgZm9yIGxvYWRpbmcgbWFwIGxheWVyIGFjY29yZGluZyBpdHMgZ2VvcmVmZXJlbmNpbmcgc3RhdHVzXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IHJlc291cmNlIFxuICAgICAqIEBwYXJhbSB7YW55fSB2aWV3ZXJJZCBcbiAgICAgKiBAcmV0dXJucyBwcm9taXNlIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHByZXBhcmVWaWV3ZXIocmVzb3VyY2UsIHZpZXdlcklkKXtcbiAgICAgIGlmIChyZXNvdXJjZS5nZW9yZWZlcmVuY2VkID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gcHJlcGFyZUZvclVuZ2VvcmVmZXJlbmNlZCh2aWV3ZXJJZClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBwcmVwYXJlRm9yR2VvcmVmZXJlbmNlZCh2aWV3ZXJJZClcbiAgICAgIH0gXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUHJlcGFyZSB0aGUgdmlld2VyIHRvIGxvYWQgYW4gdW5nZW9yZWZlcmVuY2VkIGxheWVyLCByZW1vdmluZyBhbGwgdGhlIGJhc2UgbGF5ZXJzIGFuZCBvdmVybGF5c1xuICAgICAqIEBwYXJhbSB7fSB2aWV3ZXJJZCBcbiAgICAgKiBAcmV0dXJucyBwcm9taXNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gcHJlcGFyZUZvclVuZ2VvcmVmZXJlbmNlZCh2aWV3ZXJJZCkge1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgndW5nZW9yZWZlcmVuY2VkTGF5ZXJUb0JlTG9hZGVkJywgdmlld2VySWQpO1xuXG4gICAgICAvLyB0byBnaXZlIHRoZSBvcHBvcnR1bml0eSB0byB0aGUgdW5nZW9yZWZlcmVuY2VkTGF5ZXJUb0JlTG9hZGVkIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgLy8gdG8gZG8gc29tZSBhY3Rpb24gYmVmb3JlIHRoZSB2aWV3ZXIgaXMgcHJlcGFyZWQsIGl0IGlzIG5lY2Vzc2FyeSB0byB3YWl0IGEgbGl0dGxlXG4gICAgICAvLyBzbyB3ZSB1c2UgdGhlIHRpbWVvdXQgZm9yIHRoYXQuIDIwMCBtaWxsaXNlY29uZHMgYXBwZWFycyB0byBiZSBlbm91Z2hcbiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgIHNlcnZpY2VEYXRhW3ZpZXdlcklkXS5vdmVybGF5cyA9IHt9O1xuICAgICAgICBzZXJ2aWNlRGF0YVt2aWV3ZXJJZF0uYmFzZWxheWVycyA9IHt9O1xuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7ICAgICAgICAgICAgICAgXG4gICAgICB9LCAyMDApO1xuXG4gICAgICAvLyByZXR1cm4gdGhlIHByb21pc2VcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlOyAgICAgIFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFByZXBhcmUgdGhlIHZpZXdlciB0byBsb2FkIGFuIHVuZ2VvcmVmZXJlbmNlZCBsYXllciwgcmVtb3ZpbmcgYWxsIHRoZSBiYXNlIGxheWVycyBhbmQgb3ZlcmxheXNcbiAgICAgKiBAcGFyYW0ge30gdmlld2VySWQgXG4gICAgICogQHJldHVybnMgcHJvbWlzZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHByZXBhcmVGb3JHZW9yZWZlcmVuY2VkKHZpZXdlcklkKSB7XG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdnZW9yZWZlcmVuY2VkTGF5ZXJUb0JlTG9hZGVkJywgdmlld2VySWQpOyAgICAgIFxuICAgICAgXG4gICAgICAvLyB0byBnaXZlIHRoZSBvcHBvcnR1bml0eSB0byB0aGUgdW5nZW9yZWZlcmVuY2VkTGF5ZXJUb0JlTG9hZGVkIGV2ZW50IGxpc3RlbmVyc1xuICAgICAgLy8gdG8gZG8gc29tZSBhY3Rpb24gYmVmb3JlIHRoZSB2aWV3ZXIgaXMgcHJlcGFyZWQsIGl0IGlzIG5lY2Vzc2FyeSB0byB3YWl0IGEgbGl0dGxlXG4gICAgICAvLyBzbyB3ZSB1c2UgdGhlIHRpbWVvdXQgZm9yIHRoYXQuIDIwMCBtaWxsaXNlY29uZHMgYXBwZWFycyB0byBiZSBlbm91Z2hcbiAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgIHNlcnZpY2VEYXRhW3ZpZXdlcklkXS5iYXNlbGF5ZXJzID0gZ2V0QmFzZUxheWVycygpO1xuICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7ICAgICAgICAgICAgICAgXG4gICAgICB9LCAyMDApO1xuXG4gICAgICAvLyByZXR1cm4gdGhlIHByb21pc2VcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhIG1hcCByZXNvdXJjZSBmcm9tIHRoZSBvdmVybGF5c1xuICAgICAqIEBwYXJhbSB7fSByZXNvdXJjZSBtYXBcbiAgICAgKiBAcGFyYW0gc3RyaW5nIHZpZXdlcklkIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlbW92ZU1hcExheWVyKHJlc291cmNlLCB2aWV3ZXJJZCkge1xuICAgICAgdmlld2VySWQgPSBwYXJzZU1hcFZpZXdlcklkKHZpZXdlcklkKTtcbiAgICAgIHZhciBvdmVybGF5SWQgPSBwYXJzZU1hcE92ZXJsYXlJZCh2aWV3ZXJJZCwgcmVzb3VyY2UpO1xuICAgICAgZGVsZXRlIHNlcnZpY2VEYXRhW3ZpZXdlcklkXS5vdmVybGF5c1tvdmVybGF5SWRdO1xuICAgICAgbGlzdGVuQW5kQXBwbHlEcmF3KCk7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ21hcExheWVyc0NoYW5nZWQnKTtcbiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgncmVtb3ZlZE1hcExheWVyJywgcmVzb3VyY2UpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlbW92ZSBhIG1hcCByZXNvdXJjZSBmcm9tIHRoZSBvdmVybGF5c1xuICAgICAqIEBwYXJhbSB7fSByZXNvdXJjZSBtYXBcbiAgICAgKiBAcGFyYW0gc3RyaW5nIHZpZXdlcklkIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlbW92ZUFsbE1hcExheWVycyh2aWV3ZXJJZCkge1xuICAgICAgdmlld2VySWQgPSBwYXJzZU1hcFZpZXdlcklkKHZpZXdlcklkKTtcbiAgICAgIHNlcnZpY2VEYXRhW3ZpZXdlcklkXS5vdmVybGF5cyA9IHt9O1xuICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdtYXBMYXllcnNDaGFuZ2VkJyk7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3JlbW92ZWRBbGxNYXBMYXllcnMnKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIaWRlIGEgbWFwIGJ1dCBrZWVwIGl0IGluIHRoZSBsb2FkZWQgbGlzdFxuICAgICAqIEBwYXJhbSB7fSByZXNvdXJjZSBtYXBcbiAgICAgKiBAcGFyYW0gc3RyaW5nIHZpZXdlcklkIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGhpZGVNYXAocmVzb3VyY2UsIHZpZXdlcklkKSB7XG4gICAgICB2aWV3ZXJJZCA9IHBhcnNlTWFwVmlld2VySWQodmlld2VySWQpO1xuICAgICAgdmFyIG92ZXJsYXlJZCA9IHBhcnNlTWFwT3ZlcmxheUlkKHZpZXdlcklkLCByZXNvdXJjZSk7XG4gICAgICBzZXJ2aWNlRGF0YVt2aWV3ZXJJZF0ub3ZlcmxheXNbb3ZlcmxheUlkXS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ21hcExheWVyc0NoYW5nZWQnKTtcbiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbWFwSGlkZGVuJywgcmVzb3VyY2UpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNob3cgYSBtYXAgcHJldmlvdXNseSBsb2FkZWRcbiAgICAgKiBAcGFyYW0ge30gcmVzb3VyY2UgbWFwXG4gICAgICogQHBhcmFtIHN0cmluZyB2aWV3ZXJJZCBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzaG93TWFwKHJlc291cmNlLCB2aWV3ZXJJZCkge1xuICAgICAgdmlld2VySWQgPSBwYXJzZU1hcFZpZXdlcklkKHZpZXdlcklkKTtcbiAgICAgIHZhciBvdmVybGF5SWQgPSBwYXJzZU1hcE92ZXJsYXlJZCh2aWV3ZXJJZCwgcmVzb3VyY2UpO1xuICAgICAgc2VydmljZURhdGFbdmlld2VySWRdLm92ZXJsYXlzW292ZXJsYXlJZF0udmlzaWJsZSA9IHRydWU7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ21hcExheWVyc0NoYW5nZWQnKTtcbiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbWFwU2hvd24nLCByZXNvdXJjZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGlkZSBhIHZpZXdlclxuICAgICAqIEBwYXJhbSBzdHJpbmcgdmlld2VySWQgXG4gICAgICovXG4gICAgZnVuY3Rpb24gaGlkZVZpZXdlcih2aWV3ZXJJZCkge1xuICAgICAgdmlld2VySWQgPSBwYXJzZU1hcFZpZXdlcklkKHZpZXdlcklkKTtcbiAgICAgIHNlcnZpY2VEYXRhW3ZpZXdlcklkXS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ21hcFZpZXdlcnNDaGFuZ2VkJyk7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3ZpZXdlckhpZGRlbicsIHZpZXdlcklkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaG93IGEgdmlld2VyICAgICBcbiAgICAgKiBAcGFyYW0gc3RyaW5nIHZpZXdlcklkIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNob3dWaWV3ZXIodmlld2VySWQpIHtcbiAgICAgIHZpZXdlcklkID0gcGFyc2VNYXBWaWV3ZXJJZCh2aWV3ZXJJZCk7XG4gICAgICBzZXJ2aWNlRGF0YVt2aWV3ZXJJZF0udmlzaWJsZSA9IHRydWU7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ21hcFZpZXdlcnNDaGFuZ2VkJyk7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3ZpZXdlclNob3duJywgdmlld2VySWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFBhcnNlIGEgZGVmYXVsdCBsYXllciBpZFxuICAgICAqIEBwYXJhbSBzdHJpbmcgdmlld2VySWQgXG4gICAgICovXG4gICAgZnVuY3Rpb24gcGFyc2VNYXBWaWV3ZXJJZCh2aWV3ZXJJZCkge1xuICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQodmlld2VySWQpIHx8IHZpZXdlcklkID09PSBudWxsKSB7XG4gICAgICAgIHZpZXdlcklkID0gJ3JpZ2h0TWFwVmlld2VyJztcbiAgICAgIH1cbiAgICAgIHJldHVybiB2aWV3ZXJJZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBQYXJzZSBhIGRlZmF1bHQgbGF5ZXIgaWRcbiAgICAgKiBAcGFyYW0gc3RyaW5nIHZpZXdlcklkIFxuICAgICAqIEBwYXJhbSB7fSByZXNvdXJjZSBtYXAgXG4gICAgICovXG4gICAgZnVuY3Rpb24gcGFyc2VNYXBPdmVybGF5SWQodmlld2VySWQsIHJlc291cmNlKSB7XG4gICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZCh2aWV3ZXJJZCkgfHwgdmlld2VySWQgPT09IG51bGwpIHtcbiAgICAgICAgdmlld2VySWQgPSAncmlnaHRNYXBWaWV3ZXInO1xuICAgICAgfVxuICAgICAgdmFyIG92ZXJsYXlJZCA9IHZpZXdlcklkICsgcmVzb3VyY2UuaWQ7XG4gICAgICByZXR1cm4gb3ZlcmxheUlkO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGNoZWNrIGlmIGEgbWFwIHJlc291cmNlIGlzIGFscmVhZHkgbG9hZGVkXG4gICAgICogXG4gICAgICogQHBhcmFtIG9iamVjdCByZXNvdXJjZSBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc0FkZGVkKHJlc291cmNlLCB2aWV3ZXJJZCkge1xuICAgICAgdmlld2VySWQgPSBwYXJzZU1hcFZpZXdlcklkKHZpZXdlcklkKTtcbiAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKHNlcnZpY2VEYXRhW3ZpZXdlcklkXS5vdmVybGF5cykpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdmFyIG92ZXJsYXlJZCA9IHBhcnNlTWFwT3ZlcmxheUlkKHZpZXdlcklkLCByZXNvdXJjZSk7XG4gICAgICByZXR1cm4gYW5ndWxhci5pc0RlZmluZWQoc2VydmljZURhdGFbdmlld2VySWRdLm92ZXJsYXlzW292ZXJsYXlJZF0pO1xuICAgICAgLy9yZXR1cm4gKHJlc291cmNlLmlkIGluIHNlcnZpY2VEYXRhW3ZpZXdlcklkXS5vdmVybGF5cyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgIHRoZXJlIGFyZSBub24gZ2VvcmVmZXJlbmNlZCBsYXllcnMgbG9hZGVkIGluIHRoZSB2aWV3ZXJcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gc3RyaW5nIHZpZXdlcklkIFxuICAgICAqIEByZXR1cm5zIGJvb2xlYW5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBoYXNOb25HZW9yZWZlcmVuY2VkTGF5ZXIodmlld2VySWQpIHtcbiAgICAgIHZpZXdlcklkID0gcGFyc2VNYXBWaWV3ZXJJZCh2aWV3ZXJJZCk7XG4gICAgICB2YXIgbm9uR2VvTGF5ZXJzID0gbG9kYXNoLmZpbHRlcihnZXRWaWV3ZXJPdmVybGF5cyh2aWV3ZXJJZCksIGZ1bmN0aW9uIChsYXllcikge1xuICAgICAgICByZXR1cm4gbGF5ZXIucmVzb3VyY2UuZ2VvcmVmZXJlbmNlZCA9PT0gZmFsc2U7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBhbmd1bGFyLmlzQXJyYXkobm9uR2VvTGF5ZXJzKSAmJiBub25HZW9MYXllcnMubGVuZ3RoID4gMDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZWZyZXNoIHRoZSByZXNvdXJjZSBvZiBhIGxheWVyXG4gICAgICogQHBhcmFtIHtyZXNvdXJjZX0gcmVzb3VyY2UgXG4gICAgICogQHBhcmFtIHN0cmluZyB2aWV3ZXJJZCBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZWZyZXNoTGF5ZXJSZXNvdXJjZShyZXNvdXJjZSwgdmlld2VySWQpIHtcbiAgICAgIHZpZXdlcklkID0gcGFyc2VNYXBWaWV3ZXJJZCh2aWV3ZXJJZCk7XG4gICAgICB2YXIgb3ZlcmxheUlkID0gcGFyc2VNYXBPdmVybGF5SWQodmlld2VySWQsIHJlc291cmNlKTtcbiAgICAgIGRlbGV0ZSBzZXJ2aWNlRGF0YVt2aWV3ZXJJZF0ub3ZlcmxheXNbb3ZlcmxheUlkXTtcbiAgICAgIGFkZE1hcExheWVyKHJlc291cmNlLCB2aWV3ZXJJZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogV2hlbiBhIG1hcCBpcyBlZGl0ZWQsIHJlZnJlc2ggdGhlIG1hcCB0aGUgbWFwIGxheWVyXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmVmcmVzaE1hcFJlc291cmNlKHJlc291cmNlKSB7XG4gICAgICBpZiAoaXNBZGRlZChyZXNvdXJjZSwgJ3JpZ2h0TWFwVmlld2VyJykpIHtcbiAgICAgICAgcmVmcmVzaExheWVyUmVzb3VyY2UocmVzb3VyY2UsICdyaWdodE1hcFZpZXdlcicpO1xuICAgICAgfVxuICAgICAgaWYgKGlzQWRkZWQocmVzb3VyY2UsICdsZWZ0TWFwVmlld2VyJykpIHtcbiAgICAgICAgcmVmcmVzaExheWVyUmVzb3VyY2UocmVzb3VyY2UsICdsZWZ0TWFwVmlld2VyJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXBwbHkgdGhlIG5ldyBvcmRlciBhbmQgYnJvYWRjYXN0IHRoZSBtYXBMYXllcnNSZW9yZGVyZWQgZXZlbnRcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gbGF5ZXJzSW5PcmRlciBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhcHBseVJlb3JkZXIobGF5ZXJzSW5PcmRlcikge1xuICAgICAgdmFyIGNvdW50ZXIgPSAxO1xuICAgICAgLy8gaXRlcmF0ZSBvdmVyIHRoZSBsYXllcnNJbk9yZGVyIGFuZCBhcHBseSB0aGUgbmV3IHotaW5kZXggb2YgZWFjaCBvbmVcbiAgICAgIGxheWVyc0luT3JkZXIuc2xpY2UoKS5yZXZlcnNlKCkuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgLy8gZm9yIGVhY2ggbGF5ZXIgaWRlbnRpZmljYXRpb24sIHdlIGdldCB0aGUgbGVhZmxldCBsYXllcnMgb2JqZWN0XG4gICAgICAgIGxlYWZsZXREYXRhLmdldExheWVycyh2YWx1ZS52aWV3ZXJJZCkudGhlbihmdW5jdGlvbiAobGF5ZXJzKSB7XG4gICAgICAgICAgLy8gd2UgcGFyc2UgdGhlIG1hcE92ZXJsYXlJZFxuICAgICAgICAgIHZhciBvdmVybGF5SWQgPSBwYXJzZU1hcE92ZXJsYXlJZCh0aGlzLnZhbHVlLnZpZXdlcklkLCB0aGlzLnZhbHVlLnJlc291cmNlKTtcbiAgICAgICAgICAvLyBhcHBseSB0aGUgbmV3IHotaW5kZXhcbiAgICAgICAgICBsYXllcnMub3ZlcmxheXNbb3ZlcmxheUlkXS5zZXRaSW5kZXgodGhpcy5jb3VudGVyKTtcbiAgICAgICAgfS5iaW5kKHt2YWx1ZTogdmFsdWUsY291bnRlcjogY291bnRlcn0pKTtcbiAgICAgICAgY291bnRlcisrO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIGJyb2FkY2FzdCB0aGUgZXZlbnRcbiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnbWFwTGF5ZXJzUmVvcmRlcmVkJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYWRkV0ZTTGF5ZXIobGF5ZXJOYW1lLCB2aWV3ZXJJZCkge1xuICAgICAgY29uc29sZS5sb2coXCI+Pj4gTWFwbGF5ZXJTZXJ2aWNlID4+PiBhZGRXRlNMYXllciA+Pj4gXCIsIGxheWVyTmFtZSk7XG4gICAgICBsZWFmbGV0RGF0YS5nZXRNYXAodmlld2VySWQpLnRoZW4oZnVuY3Rpb24gKG1hcCkge1xuICAgICAgdmFyIHRlbXBMYXllciA9IG5ldyBsZWFmbGV0LldGUyh7XG4gICAgICAgIHVybDogJ2h0dHBzOi8vZGVtby5nZW8tc29sdXRpb25zLml0OjQ0My9nZW9zZXJ2ZXIvb3dzJyxcbiAgICAgICAgdHlwZU5TOiAndG9wcCcsXG4gICAgICAgIHR5cGVOYW1lOiAndGFzbWFuaWFfc3RhdGVfYm91bmRhcmllcycsXG4gICAgICAgIC8qIHVybDogJ2h0dHA6Ly8wLjAuMC4wOjgwODEvZ2Vvc2VydmVyL293cycsXG4gICAgICAgIHR5cGVOUzogJ3B1YmxpYycsXG4gICAgICAgIHR5cGVOYW1lOiAnMF8xNTM2MTQ5ODc1JywgLy8gbGF5ZXJOYW1lICovXG4gICAgICAgIGNyczogbGVhZmxldC5DUlMuRVBTRzQzMjYsXG4gICAgICAgIGdlb21ldHJ5RmllbGQ6ICd0aGVfZ2VvbScsXG4gICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgICBjb2xvcjogJ2JsdWUnLFxuICAgICAgICAgICAgd2VpZ2h0OiAyXG4gICAgICAgIH1cbiAgICAgIH0pLmFkZFRvKG1hcClcbiAgICAgICAgLm9uKCdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIG1hcC5maXRCb3VuZHModGVtcExheWVyLmdldExheWVycygpWzBdLmdldEJvdW5kcygpKTtcbiAgICAgICAgfSlcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBzZXJ2aWNlO1xuICB9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuZmFjdG9yeSgnTWFwTWFya2VyU2VydmljZScsIE1hcE1hcmtlclNlcnZpY2UpO1xuXG5cbiAgZnVuY3Rpb24gTWFwTWFya2VyU2VydmljZShsb2Rhc2gsIGxlYWZsZXQpIHtcbiAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgIGJ1aWxkTWFya2VyOiBidWlsZE1hcmtlclxuICAgIH07ICAgXG5cbiAgICAvKipcbiAgICAgKiBCdWlsZHMgYSBtYXJrZXIgb2JqZWN0XG4gICAgICogXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGRlZmF1bHRPcHRpb25zIFxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBtYXJrZXJPcHRpb25zXG4gICAgICogQHJldHVybnMge29iamVjdH0gbWFya2VyXG4gICAgICovXG4gICAgZnVuY3Rpb24gYnVpbGRNYXJrZXIobWFya2Vyc0hvbGRlciwgbWFya2VyT3B0aW9ucykge1xuICAgICAgdmFyIGRlZmF1bHRPcHRpb25zID0ge1xuICAgICAgICBmb2N1czogdHJ1ZSxcbiAgICAgICAgZHJhZ2dhYmxlOiB0cnVlXG4gICAgICB9XG5cbiAgICAgIGFuZ3VsYXIubWVyZ2UoZGVmYXVsdE9wdGlvbnMsIG1hcmtlck9wdGlvbnMpO1xuICAgICAgdmFyIG1LZXkgPSBnZXROZXh0TWFya2VyS2V5KG1hcmtlcnNIb2xkZXIpO1xuICAgICAgdmFyIG1JZCA9ICdtJyArIG1LZXk7XG4gICAgICB2YXIgY2xhc3NlcyA9ICdtay1kaXYtaWNvbiAnICsgbUlkO1xuXG4gICAgICAvLyBidWlsZCB0aGUgaWNvbiBvYmplY3QgdG8gYmUgdXNlZCBpbiB0aGUgbWFya2VyXG4gICAgICB2YXIgbUljb24gPSB7XG4gICAgICAgIHR5cGU6ICdkaXYnLFxuICAgICAgICBjbGFzc05hbWU6IGNsYXNzZXMsXG4gICAgICAgIGljb25TaXplOiBudWxsLFxuICAgICAgICBodG1sOiAnPGRpdiBjbGFzcz1cIm1rLWljb24tY29udGFpbmVyIG1rLW9rXCI+JyArIG1LZXkgKyAnPC9kaXY+JyAvLyBtay1vaywgbWstd2FybiBvciBtay1lcnJvclxuICAgICAgfVxuXG4gICAgICAvLyByZXR1cm4gdGhlIG1hcmtlciBvYmplY3Qgd2l0aCBpdHMgcHJvcGVydGllcy92YWx1ZXNcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBtSWQsXG4gICAgICAgIGxhdDogZGVmYXVsdE9wdGlvbnMubGF0LFxuICAgICAgICBsbmc6IGRlZmF1bHRPcHRpb25zLmxuZyxcbiAgICAgICAgZm9jdXM6IGRlZmF1bHRPcHRpb25zLmZvY3VzLFxuICAgICAgICBtZXNzYWdlOiBkZWZhdWx0T3B0aW9ucy5tZXNzYWdlLFxuICAgICAgICBkcmFnZ2FibGU6IGRlZmF1bHRPcHRpb25zLmRyYWdnYWJsZSxcbiAgICAgICAgaWNvbjogbUljb25cbiAgICAgIH1cblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgbmV4dCBhdXRvIGluY3JlbWVudCBpZCB0aGF0IG11c3QgYmUgdXNlZCBmb3IgYSBuZXcgbWFya2VyXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IG1hcmtlcnNIb2xkZXIgXG4gICAgICogQHJldHVybnMgbmV4dEluZGV4XG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0TmV4dE1hcmtlcktleShtYXJrZXJzSG9sZGVyKSB7XG4gICAgICB2YXIgbWF4ID0gMDtcbiAgICAgIGxvZGFzaC5mb3JPd24obWFya2Vyc0hvbGRlciwgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgdmFyIGtleUluZGV4ID0gcGFyc2VJbnQoa2V5LnJlcGxhY2UoJ20nLCAnJykpO1xuICAgICAgICBpZiAoa2V5SW5kZXggPiBtYXgpIHtcbiAgICAgICAgICBtYXggPSBrZXlJbmRleDtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiAobWF4ICsgMSkudG9TdHJpbmcoKTtcbiAgICB9XG5cblxuICAgIHJldHVybiBzZXJ2aWNlO1xuICB9XG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuICBcbiAgICBhbmd1bGFyXG4gICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgLmZhY3RvcnkoJ01hcFByb2plY3RTZXJ2aWNlJywgTWFwUHJvamVjdFNlcnZpY2UpO1xuICBcbiAgICAvKiogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gTWFwUHJvamVjdFNlcnZpY2Uoc2VydmljZUZhY3RvcnksICRxKSB7ICAgICBcbiAgICAgIHZhciBtb2RlbCA9IHNlcnZpY2VGYWN0b3J5KCcvaGVpbWFwL21hcC1wcm9qZWN0Jywge1xuICAgICAgICBhY3Rpb25zOiB7IH0sXG4gICAgICAgIGluc3RhbmNlOiB7IH0gICAgICAgIFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gbW9kZWw7XG4gICAgfVxuICBcbiAgfSgpKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcbiAgXG4gICAgYW5ndWxhclxuICAgICAgLm1vZHVsZSgnYXBwJylcbiAgICAgIC5mYWN0b3J5KCdNYXBQcm9qZWN0aW9uU2VydmljZScsIE1hcFByb2plY3Rpb25TZXJ2aWNlKTtcbiAgXG4gICAgLyoqIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIE1hcFByb2plY3Rpb25TZXJ2aWNlKHNlcnZpY2VGYWN0b3J5LCAkcSkgeyAgICAgXG4gICAgICB2YXIgbW9kZWwgPSBzZXJ2aWNlRmFjdG9yeSgnL2hlaW1hcC9tYXAtcHJvamVjdGlvbicsIHtcbiAgICAgICAgYWN0aW9uczogeyB9LFxuICAgICAgICBpbnN0YW5jZTogeyB9ICAgICAgICBcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG1vZGVsO1xuICAgIH1cbiAgXG4gIH0oKSk7IiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gIFxuICAgIGFuZ3VsYXJcbiAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAuZmFjdG9yeSgnTWFwVHlwZVNlcnZpY2UnLCBNYXBUeXBlU2VydmljZSk7XG4gIFxuICAgIC8qKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBNYXBUeXBlU2VydmljZShzZXJ2aWNlRmFjdG9yeSwgJHEpIHsgICAgIFxuICAgICAgdmFyIG1vZGVsID0gc2VydmljZUZhY3RvcnkoJy9oZWltYXAvbWFwLXR5cGUnLCB7XG4gICAgICAgIGFjdGlvbnM6IHt9LFxuICAgICAgICBpbnN0YW5jZToge31cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG1vZGVsO1xuICAgIH1cbiAgXG4gIH0oKSk7IiwiLyoqXG4gKiBNYXAgTGF5ZXIgU2VydmljZSByZXNwb25zaWJsZSBmb3Igc3RvcmluZyBhbmQgcmV0dXJuaW5nIGdsb2JhbCB2aWV3ZXIgb3B0aW9uIHVzZWQgYnkgbXVsdGlwbGUgY29udHJvbGxlcnMuXG4gKiBcbiAqIEFzIGEgY2VudHJhbGl6ZWQgc2VydmljZSB0aGlzIHNlcnZpY2UgY2hhbmdlIHRoZSBvcHRpb24gdmFsdWUgd2hlbiBhc2tlZCBmb3IgYW5kIGJyb2FkY2FzdCBhbiBldmVudCB3aGVuXG4gKiB0aGlzIGNoYW5nZSBvY2N1cnMuIFRoZSBmb2xsb3dpbmcgZXZlbnQgaXMgYnJvYWRjYXN0ZWQ6XG4gKiBcbiAqIHZpZXdlck9wdGlvbkNoYW5nZWRcblxuICovXG4oZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgLnNlcnZpY2UoJ01hcFZpZXdlclNlcnZpY2UnLCBNYXBWaWV3ZXJTZXJ2aWNlKTtcblxuXG4gIGZ1bmN0aW9uIE1hcFZpZXdlclNlcnZpY2UoJHJvb3RTY29wZSkge1xuICAgIHZhciBzZXJ2aWNlID0ge1xuICAgICAgc2V0T3B0aW9uOiBzZXRPcHRpb24sXG4gICAgICBnZXRPcHRpb246IGdldE9wdGlvblxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBQcml2YXRlIHByb3BlcnR5IHRoYXQgc3RvcmVzIHRoZSB2aWV3ZXIgZ2xvYmFsIG9wdGlvbnMgXG4gICAgICogIFxuICAgICAqL1xuICAgIHZhciBzZXJ2aWNlRGF0YSA9IHt9O1xuXG4gICBcbiAgICAvKipcbiAgICAgKiBEZWZpbmUgYW4gb3B0aW9uIGZvciBhIHZpZXdlciB3aXRoIGEgZ2l2ZW4gdmFsdWVcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gdmlld2VySWQgXG4gICAgICogQHBhcmFtIHthbnl9IG9wdGlvbiBcbiAgICAgKiBAcGFyYW0ge2FueX0gdmFsdWUgXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2V0T3B0aW9uKHZpZXdlcklkLCBvcHRpb24sIHZhbHVlKSB7IFxuICAgICAgcGFyc2VWaWV3ZXIodmlld2VySWQsIG9wdGlvbik7ICAgXG4gICAgICBzZXJ2aWNlRGF0YVt2aWV3ZXJJZF1bb3B0aW9uXSA9IHZhbHVlO1xuICAgICAgdmFyIGNoYW5nZWQgPSB7IHZpZXdlcklkOiB2aWV3ZXJJZCwgb3B0aW9uOiB2aWV3ZXJJZCwgdmFsdWU6IHZhbHVlIH1cbiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgndmlld2VyT3B0aW9uQ2hhbmdlZCcsIGNoYW5nZWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhbiBnbG9iYWwgb3B0aW9uIHZhbHVlLCBvciwgaWYgaXQgaXMgbm90IGRlZmluZWQsIHRoZSBkZWZhdWx0IHZhbHVlXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IHZpZXdlcklkIFxuICAgICAqIEBwYXJhbSB7YW55fSBvcHRpb24gXG4gICAgICogQHBhcmFtIHthbnl9IGRlZmF1bHRWYWx1ZSBcbiAgICAgKiBAcmV0dXJucyBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRPcHRpb24odmlld2VySWQsIG9wdGlvbiwgZGVmYXVsdFZhbHVlKSB7XG4gICAgICBwYXJzZVZpZXdlcih2aWV3ZXJJZCwgb3B0aW9uKTsgICAgICAgIFxuICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZChzZXJ2aWNlRGF0YVt2aWV3ZXJJZF1bb3B0aW9uXSkpIHtcbiAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgICAgIH0gXG4gICAgICByZXR1cm4gc2VydmljZURhdGFbdmlld2VySWRdW29wdGlvbl07XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW5zdXJlcyB0aGF0IHRoZSB2aWV3ZXIgcHJvcGVydHkgZXhpc3RzXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IHZpZXdlcklkIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHBhcnNlVmlld2VyKHZpZXdlcklkKXtcbiAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQoc2VydmljZURhdGFbdmlld2VySWRdKSkge1xuICAgICAgICBzZXJ2aWNlRGF0YVt2aWV3ZXJJZF0gPSB7fVxuICAgICAgfSAgICAgXG4gICAgfVxuICAgIHJldHVybiBzZXJ2aWNlO1xuICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcblxuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgLmNvbnRyb2xsZXIoJ0ltcG9ydENvbnRyb2xsZXInLCBJbXBvcnRDb250cm9sbGVyKTtcblxuICAvKiogQG5nSW5qZWN0ICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gIGZ1bmN0aW9uIEltcG9ydENvbnRyb2xsZXIoJGNvbnRyb2xsZXIsIEltcG9ydFNlcnZpY2UpIHtcbiAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgLy9BdHRyaWJ1dGVzIEJsb2NrXG5cbiAgICAvL0Z1bmN0aW9ucyBCbG9ja1xuXG4gICAgLy8gaW5zdGFudGlhdGUgYmFzZSBjb250cm9sbGVyXG4gICAgJGNvbnRyb2xsZXIoJ0NSVURDb250cm9sbGVyJywgeyB2bTogdm0sIG1vZGVsU2VydmljZTogSW1wb3J0U2VydmljZSwgb3B0aW9uczogeyBzZWFyY2hPbkluaXQ6ZmFsc2UgfSB9KTtcblxuICB9XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuY29uZmlnKHJvdXRlcyk7XG5cbiAgLyoqXG4gICAqIEFycXVpdm8gZGUgY29uZmlndXJhw6fDo28gY29tIGFzIHJvdGFzIGVzcGVjw61maWNhcyBkbyByZWN1cnNvIGltcG9ydFxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gJHN0YXRlUHJvdmlkZXJcbiAgICogQHBhcmFtIHtvYmplY3R9IEdsb2JhbFxuICAgKi9cbiAgLyoqIEBuZ0luamVjdCAqL1xuICBmdW5jdGlvbiByb3V0ZXMoJHN0YXRlUHJvdmlkZXIsIEdsb2JhbCkge1xuICAgICRzdGF0ZVByb3ZpZGVyXG4gICAgICAuc3RhdGUoJ2FwcC5pbXBvcnQnLCB7XG4gICAgICAgIHVybDogJy9pbXBvcnQnLFxuICAgICAgICB0ZW1wbGF0ZVVybDogR2xvYmFsLmNsaWVudFBhdGggKyAnL2ltcG9ydC9pbXBvcnQuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6ICdJbXBvcnRDb250cm9sbGVyIGFzIGltcG9ydEN0cmwnLFxuICAgICAgICBkYXRhOiB7IH1cbiAgICAgIH0pO1xuICB9XG59KCkpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgLmZhY3RvcnkoJ0ltcG9ydFNlcnZpY2UnLCBJbXBvcnRTZXJ2aWNlKTtcblxuICAvKiogQG5nSW5qZWN0ICovXG4gIGZ1bmN0aW9uIEltcG9ydFNlcnZpY2Uoc2VydmljZUZhY3RvcnkpIHtcbiAgICB2YXIgbW9kZWwgPSBzZXJ2aWNlRmFjdG9yeSgnaW1wb3J0Jywge1xuICAgICAgYWN0aW9uczogeyB9LFxuICAgICAgaW5zdGFuY2U6IHsgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG1vZGVsO1xuICB9XG5cbn0oKSk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgLmZhY3RvcnkoJ1N1cHBvcnRTZXJ2aWNlJywgU3VwcG9ydFNlcnZpY2UpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgZnVuY3Rpb24gU3VwcG9ydFNlcnZpY2Uoc2VydmljZUZhY3RvcnksICRodHRwLCAkcSkge1xuICAgIHZhciBlbmRQb2ludCA9ICcvaGVpbWFwL3N1cHBvcnQnO1xuICAgIHZhciBtb2RlbCA9IHNlcnZpY2VGYWN0b3J5KGVuZFBvaW50LCB7XG4gICAgICBhY3Rpb25zOiB7XG4gICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgaXNBcnJheTogZmFsc2UsXG4gICAgICAgICAgd3JhcDogZmFsc2UsXG4gICAgICAgICAgdXJsOiAnY29uZmlnJyxcbiAgICAgICAgICBhZnRlclJlcXVlc3Q6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaW5zdGFuY2U6IHt9XG4gICAgfSk7XG4gICAgXG4gICAgcmV0dXJuIG1vZGVsO1xuICB9XG5cbn0oKSk7IiwiKGZ1bmN0aW9uKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuY29udHJvbGxlcignUHJlZmVyZW5jZXNDb250cm9sbGVyJywgUHJlZmVyZW5jZXNDb250cm9sbGVyKTtcblxuICAvKiogQG5nSW5qZWN0ICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gIGZ1bmN0aW9uIFByZWZlcmVuY2VzQ29udHJvbGxlcigkY29udHJvbGxlciwgUHJlZmVyZW5jZXNTZXJ2aWNlKSB7XG4gICAgdmFyIHZtID0gdGhpcztcblxuICAgIC8vQXR0cmlidXRlcyBCbG9ja1xuXG4gICAgLy9GdW5jdGlvbnMgQmxvY2tcblxuICAgIC8vIGluc3RhbnRpYXRlIGJhc2UgY29udHJvbGxlclxuICAgICRjb250cm9sbGVyKCdDUlVEQ29udHJvbGxlcicsIHsgdm06IHZtLCBtb2RlbFNlcnZpY2U6IFByZWZlcmVuY2VzU2VydmljZSwgb3B0aW9uczogeyBzZWFyY2hPbkluaXQ6ZmFsc2UgfSB9KTtcblxuICB9XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuY29uZmlnKHJvdXRlcyk7XG5cbiAgLyoqXG4gICAqIEFycXVpdm8gZGUgY29uZmlndXJhw6fDo28gY29tIGFzIHJvdGFzIGVzcGVjw61maWNhcyBkbyByZWN1cnNvIHByZWZlcmVuY2VzXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSAkc3RhdGVQcm92aWRlclxuICAgKiBAcGFyYW0ge29iamVjdH0gR2xvYmFsXG4gICAqL1xuICAvKiogQG5nSW5qZWN0ICovXG4gIGZ1bmN0aW9uIHJvdXRlcygkc3RhdGVQcm92aWRlciwgR2xvYmFsKSB7XG4gICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgIC5zdGF0ZSgnYXBwLnByZWZlcmVuY2VzJywge1xuICAgICAgICB1cmw6ICcvcHJlZmVyZW5jZXMnLFxuICAgICAgICB0ZW1wbGF0ZVVybDogR2xvYmFsLmNsaWVudFBhdGggKyAnL3ByZWZlcmVuY2VzL3ByZWZlcmVuY2VzLmh0bWwnLFxuICAgICAgICBjb250cm9sbGVyOiAnUHJlZmVyZW5jZXNDb250cm9sbGVyIGFzIHByZWZlcmVuY2VzQ3RybCcsXG4gICAgICAgIGRhdGE6IHsgfVxuICAgICAgfSk7XG4gIH1cbn0oKSk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuZmFjdG9yeSgnUHJlZmVyZW5jZXNTZXJ2aWNlJywgUHJlZmVyZW5jZXNTZXJ2aWNlKTtcblxuICAvKiogQG5nSW5qZWN0ICovXG4gIGZ1bmN0aW9uIFByZWZlcmVuY2VzU2VydmljZShzZXJ2aWNlRmFjdG9yeSkge1xuICAgIHZhciBtb2RlbCA9IHNlcnZpY2VGYWN0b3J5KCdwcmVmZXJlbmNlcycsIHtcbiAgICAgIGFjdGlvbnM6IHsgfSxcbiAgICAgIGluc3RhbmNlOiB7IH1cbiAgICB9KTtcblxuICAgIHJldHVybiBtb2RlbDtcbiAgfVxuXG59KCkpO1xuIiwiKGZ1bmN0aW9uKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuY29udHJvbGxlcignUHJvamVjdENvbnRyb2xsZXInLCBQcm9qZWN0Q29udHJvbGxlcik7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICBmdW5jdGlvbiBQcm9qZWN0Q29udHJvbGxlcigkbG9jYXRpb24sIEdsb2JhbCkge1xuICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAvL0F0dHJpYnV0ZXMgQmxvY2tcblxuICAgIC8vRnVuY3Rpb25zIEJsb2NrXG5cbiAgICAvLyBjb25zb2xlLmxvZygkbG9jYXRpb24uc2VhcmNoKCkpO1xuICAgIHZhciBxUGFyYW1zID0gJGxvY2F0aW9uLnNlYXJjaCgpO1xuICAgIHNlc3Npb25TdG9yYWdlLmNsZWFyKCk7XG4gICAgLy8gc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShcInJvbGVcIiwgXCJhZG1pblwiKTtcbiAgICBpZihxUGFyYW1zLnJvbGUgPT09IFwiYWRtaW5cIikge1xuICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKFwicm9sZVwiLCBcIjFcIik7XG4gICAgfSBlbHNlIGlmKHFQYXJhbXMucm9sZSA9PT0gXCJzZW5pb3JcIikge1xuICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKFwicm9sZVwiLCBcIjJcIik7XG4gICAgfSBlbHNlIGlmKHFQYXJhbXMucm9sZSA9PT0gXCJ1c2VyXCIpIHtcbiAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShcInJvbGVcIiwgXCIzXCIpO1xuICAgIH0gZWxzZSBpZihxUGFyYW1zLnJvbGUgPT09IFwiZ3Vlc3RcIikge1xuICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKFwicm9sZVwiLCBcIjRcIik7XG4gICAgfVxuICAgIFxuICAgIC8vIGNvbnNvbGUubG9nKFwiYXBwY29udHJvbGxlciBcIiwgJGxvY2FsU3RvcmFnZSk7XG4gICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShcInByb2pJZFwiLCBxUGFyYW1zLnByb2pJZCk7XG4gICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShcInVzZXJJZFwiLCBxUGFyYW1zLnVzZXJJZCk7XG4gICAgJGxvY2F0aW9uLnVybChHbG9iYWwuY2xpZW50UGF0aCk7XG4gIH1cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdhcHAnKVxuICAgIC5jb25maWcocm91dGVzKTtcblxuICAvKipcbiAgICogQXJxdWl2byBkZSBjb25maWd1cmHDp8OjbyBjb20gYXMgcm90YXMgZXNwZWPDrWZpY2FzIGRvIHJlY3Vyc28gZXhwb3J0XG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSAkc3RhdGVQcm92aWRlclxuICAgKiBAcGFyYW0ge29iamVjdH0gR2xvYmFsXG4gICAqL1xuICAvKiogQG5nSW5qZWN0ICovXG4gIGZ1bmN0aW9uIHJvdXRlcygkc3RhdGVQcm92aWRlciwgR2xvYmFsKSB7XG4gICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgIC5zdGF0ZSgnYXBwLnByb2plY3QnLCB7XG4gICAgICAgIHVybDogJy9wcm9qZWN0JyxcbiAgICAgICAgdGVtcGxhdGVVcmw6IEdsb2JhbC5jbGllbnRQYXRoICsgJy9wcm9qZWN0L3Byb2plY3QuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6ICdQcm9qZWN0Q29udHJvbGxlciBhcyBwcm9qZWN0Q3RybCcsXG4gICAgICAgIGRhdGE6IHsgfVxuICAgICAgfSk7XG4gIH1cbn0oKSk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuZmFjdG9yeSgnUHJvamVjdFNlcnZpY2UnLCBQcm9qZWN0U2VydmljZSk7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICBmdW5jdGlvbiBQcm9qZWN0U2VydmljZShzZXJ2aWNlRmFjdG9yeSkge1xuICAgIHZhciBtb2RlbCA9IHNlcnZpY2VGYWN0b3J5KCdleHBvcnQnLCB7XG4gICAgICBhY3Rpb25zOiB7IH0sXG4gICAgICBpbnN0YW5jZTogeyB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbW9kZWw7XG4gIH1cblxufSgpKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuZmFjdG9yeSgnRmVhdHVyZVNlcnZpY2UnLCBGZWF0dXJlU2VydmljZSk7XG5cblxuICBmdW5jdGlvbiBGZWF0dXJlU2VydmljZShsb2Rhc2gpIHtcbiAgICBcbiAgICB2YXIgc2VydmljZSA9IHtcbiAgICAgIGdldEF0dHJpYnV0ZTogZ2V0QXR0cmlidXRlLFxuICAgICAgc2V0QXR0cmlidXRlOiBzZXRBdHRyaWJ1dGUsXG4gICAgICBjcmVhdGVPYmplY3Q6IGNyZWF0ZU9iamVjdCxcbiAgICAgIHN0aXRjaE9iamVjdDogc3RpdGNoT2JqZWN0LFxuICAgICAgY3JlYXRlT2JqZWN0RnJvbUdlb0pzb246IGNyZWF0ZU9iamVjdEZyb21HZW9Kc29uLFxuICAgICAgY3JlYXRlR2VvSnNvbjogY3JlYXRlR2VvSnNvbixcbiAgICAgIHRlYXJPYmplY3Q6IHRlYXJPYmplY3RcbiAgICB9OyBcblxuICAgIGZ1bmN0aW9uIGdldEF0dHJpYnV0ZShmZWF0dXJlSWQpIHtcbiAgICAgIHJldHVybiB7XCJhYmNcIiA6IFwiZGVmXCJ9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNldEF0dHJpYnV0ZShmZWF0dXJlUHJvcGVydGllcykge1xuICAgICAgY29uc29sZS5sb2coXCI+Pj4gRmVhdHVyZVNlcnZpY2UgPj4+IHNldEF0dHJpYnV0ZSBcIiwgZmVhdHVyZVByb3BlcnRpZXMpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZU9iamVjdChvYmopIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiPj4+IEZlYXR1cmVTZXJ2aWNlID4+PiBjcmVhdGVPYmplY3QgXCIsIG9iaik7XG4gICAgICByZXR1cm4gb2JqO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZU9iamVjdEZyb21HZW9Kc29uKG9iaikge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gRmVhdHVyZVNlcnZpY2UgPj4+IGNyZWF0ZU9iamVjdEZyb21HZW9Kc29uIFwiLCBvYmoucHJvcGVydGllcyk7XG5cbiAgICAgIGlmKGxvZGFzaC5zaXplKG9iai5wcm9wZXJ0aWVzLmtleV9jaWRvY19hcnJheS5zcGxpdChcInxcIikpID09PSBsb2Rhc2guc2l6ZShvYmoucHJvcGVydGllcy52YWx1ZV9nYXpldHRlZXJfYXJyYXkuc3BsaXQoXCJ8XCIpKSkge1xuICAgICAgICB2YXIga2V5QXJyID0gb2JqLnByb3BlcnRpZXMua2V5X2NpZG9jX2FycmF5LnNwbGl0KFwifFwiKTtcbiAgICAgICAgdmFyIHZhbHVlQXJyID0gb2JqLnByb3BlcnRpZXMudmFsdWVfZ2F6ZXR0ZWVyX2FycmF5LnNwbGl0KFwifFwiKTtcbiAgICAgICAgdmFyIHRlbXAgPSB7XG4gICAgICAgICAgLy8gXCJpZFwiOiBvYmoucHJvcGVydGllcy50eXBlX2NybVxuICAgICAgICAgIFwidHlwZV9jcm1cIjogb2JqLnByb3BlcnRpZXMudHlwZV9jcm1cbiAgICAgICAgfTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCIga2V5QXJyIFwiLCBrZXlBcnIsIHZhbHVlQXJyKTtcblxuICAgICAgICBmb3IodmFyIGk9MDsgaSA8IGtleUFyci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmKHZhbHVlQXJyW2ldLmluZGV4T2YoXCJbXCIpICE9PSAtMSkge1xuICAgICAgICAgICAgaWYodmFsdWVBcnJbaV0gIT09IFwiW29iamVjdCBPYmplY3RdXCIpIHtcbiAgICAgICAgICAgICAgdGVtcFtrZXlBcnJbaV1dID0gSlNPTi5wYXJzZSh2YWx1ZUFycltpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmKGtleUFycltpXSAhPT0gXCJ0eXBlX2NybVwiKSB7XG4gICAgICAgICAgICAgIHRlbXBba2V5QXJyW2ldXSA9IHZhbHVlQXJyW2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0ZW1wW1wiZ2VvbVwiXSA9IG9iai5nZW9tZXRyeTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJ0ZW1wID0gXCIsIHRlbXApO1xuICAgICAgICByZXR1cm4gdGVtcDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBnZW5lcmF0ZSBhIG9iamVjdCB3aXRoIGhhcyBrZXkgOiB2YWx1ZSBwYWlyXG4gICAgICogXG4gICAgICogQHBhcmFtIHsqfSBrZXlzIFxuICAgICAqIEBwYXJhbSB7Kn0gdmFsdWVzIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHN0aXRjaE9iamVjdChrZXlzLCB2YWx1ZXMpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IEZlYXR1cmVTZXJ2aWNlID4+PiBzdGl0Y2hPYmplY3QgXCIsIGtleXMsIHZhbHVlcyk7XG4gICAgICB2YXIgcmV0dXJuT2JqID0ge307XG4gICAgICBpZihsb2Rhc2guc2l6ZShrZXlzKSA9PT0gbG9kYXNoLnNpemUodmFsdWVzKSkge1xuICAgICAgICBmb3IodmFyIGk9MDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICByZXR1cm5PYmpba2V5c1tpXV0gPSB2YWx1ZXNbaV07XG4gICAgICAgIH1cbiAgICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gRmVhdHVyZVNlcnZpY2UgPj4+IHN0aXRjaE9iamVjdCBcIiwgcmV0dXJuT2JqKTtcbiAgICAgICAgcmV0dXJuIHJldHVybk9iajtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0ZWFyT2JqZWN0KG9iaikge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gRmVhdHVyZVNlcnZpY2UgPj4+IHRlYXJPYmplY3QgXCIsIG9iaik7XG4gICAgICAvLyB2YXIgcmV0dXJuT2JqID0ge307XG4gICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iaik7XG4gICAgICB2YXIgdmFsdWVzID0gT2JqZWN0LnZhbHVlcyhvYmopO1xuXG4gICAgICB2YXIgcmVzdWx0VmFsID0gW107XG4gICAgICBmb3IodmFyIGk9MDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZihBcnJheS5pc0FycmF5KHZhbHVlc1tpXSkpIHtcbiAgICAgICAgICByZXN1bHRWYWwucHVzaChKU09OLnN0cmluZ2lmeSh2YWx1ZXNbaV0pKTtcbiAgICAgICAgLy8gfSBlbHNlIGlmKHR5cGVvZiB2YWx1ZXNbaV0gPT09IFwic3RyaW5nXCIgfHwgdHlwZW9mIHZhbHVlc1tpXSA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc3VsdFZhbC5wdXNoKHZhbHVlc1tpXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIGtleXMucHVzaChcImdlb21cIik7XG4gICAgICAvLyB2YWx1ZXMucHVzaChmZWF0dXJlLmdlb21ldHJ5KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIFwia2V5c1wiOiBrZXlzLFxuICAgICAgICBcInZhbHVlc1wiOiByZXN1bHRWYWxcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVHZW9Kc29uKGdlb2pzb24sIHByb3BlcnRpZXMpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiPj4+IEZlYXR1cmVTZXJ2aWNlID4+PiBjcmVhdGVHZW9Kc29uIFwiLCBnZW9qc29uLCBwcm9wZXJ0aWVzKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc2VydmljZTtcbiAgfVxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICBcbiAgICAndXNlIHN0cmljdCc7XG4gIFxuICAgIGFuZ3VsYXJcbiAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAuY29udHJvbGxlcignVmVjdG9yQ29udHJvbGxlcicsIFZlY3RvckNvbnRyb2xsZXIpO1xuICBcbiAgICAvKiogQG5nSW5qZWN0ICovXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgICBmdW5jdGlvbiBWZWN0b3JDb250cm9sbGVyKCRjb250cm9sbGVyLCAkc2NvcGUsIFZlY3RvclNlcnZpY2UsIEdsb2JhbCkge1xuICAgICAgdmFyIHZtID0gdGhpcztcbiAgXG4gICAgICAvLyBGdW5jdGlvbnMgQmxvY2sgICAgIFxuICAgICAgdm0ub25WaWV3ZXJBY3RpdmF0ZSA9IG9uVmlld2VyQWN0aXZhdGU7XG4gICAgICB2bS5iZWZvcmVWaWV3ZXJBY3RpdmF0ZSA9IGJlZm9yZVZpZXdlckFjdGl2YXRlO1xuXG4gICAgICAvLyBTZXQgdGhlIG1hcCB2aWV3ZXIgb3B0aW9uc1xuICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgIHN1cHBvcnRMaXN0aW5nVmlldyA6IGZhbHNlLFxuICAgICAgICBzdXBwb3J0RHJhd2luZyA6IGZhbHNlLFxuICAgICAgICB0aXRsZVRyYW5zbEtleSA6ICd2aWV3cy50aXRsZXMudmVjdG9yVGl0bGUnLFxuICAgICAgICBzaG93VmVjdG9yTGF5ZXJzIDogdHJ1ZSxcbiAgICAgICAgbGVmdFNpZGVCYXIgOiBHbG9iYWwuY2xpZW50UGF0aCArICcvdmVjdG9yL25hdnMvdmVjdG9yLWxlZnQtc2lkZW5hdi5odG1sJyxcbiAgICAgICAgcmlnaHRTaWRlQmFyIDogR2xvYmFsLmNsaWVudFBhdGggKyAnL3ZlY3Rvci9uYXZzL3ZlY3Rvci1yaWdodC1zaWRlbmF2Lmh0bWwnXG4gICAgICAgIC8vIGJvdHRvbU5hdiA6IGZhbHNlXG4gICAgICB9O1xuXG4gICAgICAvLyBpbml0aWFsaXplIGVtcHR5IG1hcmtlcnMgb2JqZWN0XG4gICAgICB2bS5yaWdodE1hcmtlcnMgPSB7fTtcbiAgICAgIHZtLmxlZnRNYXJrZXJzID0ge307XG4gICAgICB2bS5sYXllck5hbWVzID0gW107XG4gIFxuICAgICAgLy8gaW5zdGFudGlhdGUgdGhlIGJhc2UgTWFwVmlld2VyQ29udHJvbGxlclxuICAgICAgJGNvbnRyb2xsZXIoJ01hcFZpZXdlckNvbnRyb2xsZXInLCB7IHZtOiB2bSwgJHNjb3BlOiAkc2NvcGUsIG9wdGlvbnN9KTtcblxuICAgICAgLyoqXG4gICAgICAgKiBBY3Rpb25zIGV4ZWN1dGVkIGJlZm9yZSB0aGUgYmFzZSB2aWV3ZXIgaXMgYWN0aXZhdGVkXG4gICAgICAgKiBcbiAgICAgICAqL1xuICAgICAgZnVuY3Rpb24gYmVmb3JlVmlld2VyQWN0aXZhdGUoKXsgIFxuICAgICAgICAvLyBnZXQgdmVjdG9yIGxheWVycyBmcm9tIEFQSSBhbmQgbGlzdCB0aGVtIGluIGxlZnQgc2lkZSBuYXZcbiAgICAgICAgLy8gZ2V0TGF5ZXJOYW1lcygpO1xuICAgICAgICAvLyBnZXQgUHJvaklkXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCRzY29wZS4kcGFyZW50KTtcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBBY3Rpb25zIGV4ZWN1dGVkIGFmdGVyIHRoZSBiYXNlIHZpZXdlciBpcyBhY3RpdmF0ZWRcbiAgICAgICAqIFxuICAgICAgICovXG4gICAgICBmdW5jdGlvbiBvblZpZXdlckFjdGl2YXRlKCl7IFxuICAgICAgICAvLyBTZXQgZ2xvYmFsIHZpZXdlciBvcHRpb25zXG4gICAgICAgIC8vIGNoYW5nZWQgZm9yIHJlc29sdmluZyAjMTg0IFxuICAgICAgICAvLyBNYXBWaWV3ZXJTZXJ2aWNlLnNldE9wdGlvbigncmlnaHRNYXBWaWV3ZXInLCAnc2hvd0xvYWRNYXBJblJpZ2h0JywgZmFsc2UpO1xuICAgICAgICAvLyBNYXBWaWV3ZXJTZXJ2aWNlLnNldE9wdGlvbigncmlnaHRNYXBWaWV3ZXInLCAnc2hvd0xvYWRNYXBJblJpZ2h0JywgdHJ1ZSk7XG4gICAgICAgIC8vIE1hcFZpZXdlclNlcnZpY2Uuc2V0T3B0aW9uKCdsZWZ0TWFwVmlld2VyJywgJ3Nob3dMb2FkTWFwSW5SaWdodCcsIHRydWUpO1xuICAgICAgfVxuXG4gICAgICAvKipcbiAgICAgICAqIEdldCBMYXllciBuYW1lIGZyb20gQVBJXG4gICAgICAgKiBcbiAgICAgICAqL1xuICAgICAgZnVuY3Rpb24gZ2V0TGF5ZXJOYW1lcyAoKSB7XG4gICAgICAgIHZhciBsYXllclNlcnZpY2UgPSBuZXcgVmVjdG9yU2VydmljZSgpO1xuICAgICAgICBsYXllclNlcnZpY2UuZ2V0VmVjdG9yTGF5ZXJzKClcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuICAgICAgICAgICAgdm0ubGF5ZXJOYW1lcyA9IHJlc3VsdDtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibGF5ZXJOYW1lcyA9IFwiLCB2bS5sYXllck5hbWVzKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgICAgICAgLy8gdGhlIGNvZGUgaW5zaWRlIHRoaXMgYmxvY2sgd2lsbCBiZSBmaXJlZCBpZiBzb21lIGVycm9yIG9jY3VyXG4gICAgICAgICAgICAvLyBoZXJlIHlvdSBjYW4gc2hvdyBzb21lIGVycm9yIG1lc3NhZ2Ugb3IgZG8gbm90aGluZywgZGVwZW5kaW5nIG9uIHRoZSBidXNpbmVzcyBydWxlXG4gICAgXG4gICAgICAgICAgICAvL1RPRE86IG5vdGlmeSB0aGUgdXNlciBhYm91dCB0aGUgZXJyb3I/XG4gICAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgfVxuXG4gICAgfVxuICBcbiAgfSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuY29uZmlnKHJvdXRlcyk7XG5cbiAgLyoqXG4gICAqIENvbmZpZ3VyYXRpb24gZmlsZSBmb3IgZ2VvcmVmZXJlbmNlIHJvdXRlXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSAkc3RhdGVQcm92aWRlclxuICAgKiBAcGFyYW0ge29iamVjdH0gR2xvYmFsXG4gICAqL1xuICAvKiogQG5nSW5qZWN0ICovXG4gIGZ1bmN0aW9uIHJvdXRlcygkc3RhdGVQcm92aWRlciwgR2xvYmFsKSB7XG4gICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgIC5zdGF0ZSgnYXBwLnZlY3RvcicsIHtcbiAgICAgICAgdXJsOiAnL3ZlY3RvcicsXG4gICAgICAgIHRlbXBsYXRlVXJsOiBHbG9iYWwuY2xpZW50UGF0aCArICcvdmVjdG9yL3ZlY3Rvci5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogJ1ZlY3RvckNvbnRyb2xsZXIgYXMgbWFwQ3RybCcsXG4gICAgICAgIGRhdGE6IHsgfVxuICAgICAgfSk7XG4gIH1cbn0oKSk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuZmFjdG9yeSgnVmVjdG9yU2VydmljZScsIFZlY3RvclNlcnZpY2UpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgZnVuY3Rpb24gVmVjdG9yU2VydmljZShzZXJ2aWNlRmFjdG9yeSwgJGh0dHAsICRxKSB7XG4gICAgdmFyIGdldFZlY3RvckxheWVyc1VybCA9IFwiL2hlaW1hcC92ZWN0b3IvbGF5ZXJzXCJcblxuICAgIHZhciBtb2RlbCA9IHNlcnZpY2VGYWN0b3J5KGdldFZlY3RvckxheWVyc1VybCwge1xuICAgICAgYWN0aW9uczogeyB9LFxuICAgICAgaW5zdGFuY2U6IHsgXG4gICAgICAgIGdldFZlY3RvckxheWVyczogZ2V0VmVjdG9yTGF5ZXJzLFxuICAgICAgICBjcmVhdGVWZWN0b3JMYXllcnM6IGNyZWF0ZVZlY3RvckxheWVycyxcbiAgICAgICAgY3JlYXRlRmVhdHVyZXM6IGNyZWF0ZUZlYXR1cmVzLFxuICAgICAgICBlZGl0VmVjdG9yTGF5ZXJzOiBlZGl0VmVjdG9yTGF5ZXJzLFxuICAgICAgICBkZWxldGVWZWN0b3JMYXllcjogZGVsZXRlVmVjdG9yTGF5ZXIsXG4gICAgICAgIGdldEFsbEZlYXR1cmVWZXJzaW9uOiBnZXRBbGxGZWF0dXJlVmVyc2lvbixcbiAgICAgICAgZ2V0Rm9ybURhdGE6IGdldEZvcm1EYXRhLFxuICAgICAgICBleHBvcnRMYXllckdlb0pzb246IGV4cG9ydExheWVyR2VvSnNvblxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gZ2V0VmVjdG9yTGF5ZXJzKHBhcmFtRGF0YSkge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gVmVjdG9yU2VydmljZSA+Pj4gZ2V0VmVjdG9yTGF5ZXJzIFwiLCBwcmV2aWV3R2NwRW5kUG9pbnQsIHBhcmFtRGF0YSk7XG4gICAgICAvLyBodHRwOi8vbG9jYWxob3N0OjgwODAvaGVpbWFwL3ZlY3Rvcj91c2VyX2lkPTExMjM0NSZwcm9qX2lkPTMxMjM0NCZmZXRjaD1hbGxMYXllcnNcbiAgICAgIHZhciBnZXRMYXllclVybCA9IFwiL2hlaW1hcC92ZWN0b3JcIjtcbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICBcbiAgICAgICRodHRwKHtcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcbiAgICAgICAgdXJsOiBnZXRMYXllclVybCxcbiAgICAgICAgcGFyYW1zOiBwYXJhbURhdGFcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coXCJyZXNwb25zZSBcIiwgcmVzcG9uc2UpO1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UuZGF0YS5pdGVtcyk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVzcG9uc2UpO1xuICAgICAgICB9KTtcblxuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlVmVjdG9yTGF5ZXJzKHBhcmFtRGF0YSkge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gVmVjdG9yU2VydmljZSA+Pj4gY3JlYXRlVmVjdG9yTGF5ZXJzIFwiLCBwYXJhbURhdGEpO1xuICAgICAgdmFyIGNyZWF0ZUxheWVyVXJsID0gXCIvaGVpbWFwL3ZlY3Rvci9sYXllclwiO1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgJGh0dHAucG9zdChjcmVhdGVMYXllclVybCwgcGFyYW1EYXRhKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXN1bHQuZGF0YSk7XG4gICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgIGRlZmVycmVkLnJlamVjdChlcnIpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZUZlYXR1cmVzKHBhcmFtRGF0YSkge1xuICAgICAgdmFyIGNyZWF0ZUZlYXR1cmVVcmwgPSBcIi9oZWltYXAvdmVjdG9yL2ZlYXR1cmVcIjtcbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICBcbiAgICAgICRodHRwLnBvc3QoY3JlYXRlRmVhdHVyZVVybCwgcGFyYW1EYXRhKS50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVzcG9uc2UpO1xuICAgICAgICB9KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRlbGV0ZVZlY3RvckxheWVyKHBhcmFtRGF0YSkge1xuICAgICAgdmFyIGRlbExheWVyVXJsID0gXCIvaGVpbWFwL3ZlY3Rvci9sYXllclwiO1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgIFxuICAgICAgJGh0dHAucG9zdChkZWxMYXllclVybCwgcGFyYW1EYXRhKVxuICAgICAgICAudGhlbihmdW5jdGlvbiBzdWNjZXNzQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICB9LCBmdW5jdGlvbiBlcnJvckNhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgZGVmZXJyZWQucmVqZWN0KHJlc3BvbnNlKTtcbiAgICAgICAgfSk7XG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBlZGl0VmVjdG9yTGF5ZXJzKHBhcmFtRGF0YSkge1xuICAgICAgdmFyIGVkaXRMYXllclVybCA9IFwiL2hlaW1hcC92ZWN0b3IvbGF5ZXJcIjtcbiAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICBcbiAgICAgICRodHRwLnBvc3QoZWRpdExheWVyVXJsLCBwYXJhbURhdGEpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3NDYWxsYmFjayhyZXNwb25zZSkge1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVzcG9uc2UpO1xuICAgICAgICB9KTtcbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldEFsbEZlYXR1cmVWZXJzaW9uKHBhcmFtRGF0YSkge1xuICAgICAgdmFyIGdldEFsbFZlcnNpb25VcmwgPSBcIi9oZWltYXAvdmVjdG9yXCI7XG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgXG4gICAgICAkaHR0cCh7XG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIHVybDogZ2V0QWxsVmVyc2lvblVybCxcbiAgICAgICAgcGFyYW1zOiBwYXJhbURhdGFcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coXCJyZXNwb25zZSBcIiwgcmVzcG9uc2UpO1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UuZGF0YS5pdGVtcyk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVzcG9uc2UpO1xuICAgICAgICB9KTtcblxuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0Rm9ybURhdGEocGFyYW1EYXRhKSB7XG4gICAgICB2YXIgZ2V0Rm9ybVVybCA9IFwiL2hlaW1hcC9mZWF0dXJlLXNvdXJjZS10eXBlXCI7XG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgXG4gICAgICAkaHR0cCh7XG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIHVybDogZ2V0Rm9ybVVybCxcbiAgICAgICAgcGFyYW1zOiBwYXJhbURhdGFcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coXCJyZXNwb25zZSBcIiwgcmVzcG9uc2UpO1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UuZGF0YS5pdGVtcyk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVzcG9uc2UpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gZGVmZXJyZWQucmVzb2x2ZShbXG4gICAgICAgIC8vICAge1wibmFtZVwiOlwiYnVpbGRpbmdUeXBlXCIsXCJyZXF1aXJlZFwiOmZhbHNlLFwidHlwZVwiOlwidGV4dFwiLFwib3JkZXJcIjoxLFwicGxhY2Vob2xkZXJcIjpcImJ1aWxkaW5nVHlwZVwiLFwiZGVwZW5kZW50XCI6XCJidWlsZGluZ1R5cGVcIn0sXG4gICAgICAgIC8vICAge1wibmFtZVwiOlwiY291bnRyeVwiLFwicmVxdWlyZWRcIjpmYWxzZSxcInR5cGVcIjpcInRleHRcIixcIm9yZGVyXCI6MyxcInBsYWNlaG9sZGVyXCI6XCJjb3VudHJ5XCIsXCJkZXBlbmRlbnRcIjpcImNvdW50cnlcIn0sXG4gICAgICAgIC8vICAge1wibmFtZVwiOlwic3RhdGVcIixcInJlcXVpcmVkXCI6ZmFsc2UsXCJ0eXBlXCI6XCJ0ZXh0XCIsXCJvcmRlclwiOjIsXCJwbGFjZWhvbGRlclwiOlwic3RhdGVcIixcImRlcGVuZGVudFwiOlwiY291bnRyeVwifSxcbiAgICAgICAgLy8gICB7XCJuYW1lXCI6XCJraW5nXCIsXCJyZXF1aXJlZFwiOmZhbHNlLFwidHlwZVwiOlwidGV4dFwiLFwib3JkZXJcIjo0LFwicGxhY2Vob2xkZXJcIjpcImtpbmdcIixcImRlcGVuZGVudFwiOlwia2luZ1wifSxcbiAgICAgICAgLy8gICB7XCJuYW1lXCI6XCJjaXR5XCIsXCJvcmRlclwiOjUsXCJwbGFjZWhvbGRlclwiOlwiY2l0eVwiLFwiZGVwZW5kZW50XCI6XCJjb3VudHJ5XCIsXCJ0eXBlXCI6XCJzZWxlY3RcIixcIm9wdGlvbnNcIjpbe1wib3JkZXJcIjowLFwibmFtZVwiOlwibXVtYmFpXCIsXCJ2YWx1ZVwiOlwibXVtYmFpXCJ9LHtcIm9yZGVyXCI6MSxcIm5hbWVcIjpcImhlaWRlbGJlcmdcIixcInZhbHVlXCI6XCJoZWlkZWxiZXJnXCJ9XX0sXG4gICAgICAgIC8vICAge1wibmFtZVwiOlwibGFuZ3VhZ2VcIixcIm9yZGVyXCI6NixcInBsYWNlaG9sZGVyXCI6XCJsYW5ndWFnZVwiLFwidHlwZVwiOlwibXVsdGlwbGVcIixcImRlcGVuZGVudFwiOlwibGFuZ3VhZ2VcIixcIm9wdGlvbnNcIjpbe1wib3JkZXJcIjowLFwibmFtZVwiOlwiZW5nbGlzaFwiLFwidmFsdWVcIjpcImVuZ2xpc2hcIn0se1wib3JkZXJcIjoxLFwibmFtZVwiOlwiZ2VybWFuXCIsXCJ2YWx1ZVwiOlwiZ2VybWFuXCJ9XSxcInZhbHVlXCI6W1wiZW5nbGlzaFwiXX0sXG4gICAgICAgIC8vICAge1wibmFtZVwiOlwiZGVzY3JpcHRpb25cIixcIm9yZGVyXCI6NyxcInR5cGVcIjpcInRleHRhcmVhXCIsXCJwbGFjZWhvbGRlclwiOlwiZGVzY3JpcHRpb25cIixcInZhbHVlXCI6XCJcIixcImRlcGVuZGVudFwiOlwiZGVzY3JpcHRpb25cIixcInJlcXVpcmVkXCI6ZmFsc2V9XG4gICAgICAgIC8vIF0pO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBleHBvcnRMYXllckdlb0pzb24ocGFyYW1EYXRhKSB7XG4gICAgICB2YXIgZXhwb3J0VXJsID0gXCIvaGVpbWFwL3ZlY3RvclwiO1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgIFxuICAgICAgJGh0dHAoe1xuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICB1cmw6IGV4cG9ydFVybCxcbiAgICAgICAgcGFyYW1zOiBwYXJhbURhdGFcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gc3VjY2Vzc0NhbGxiYWNrKHJlc3BvbnNlKSB7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coXCJyZXNwb25zZSBcIiwgcmVzcG9uc2UpO1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzcG9uc2UuZGF0YSk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIGVycm9yQ2FsbGJhY2socmVzcG9uc2UpIHtcbiAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocmVzcG9uc2UpO1xuICAgICAgICB9KTtcblxuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1vZGVsO1xuICB9XG5cbn0oKSk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICBcbiAgICAndXNlIHN0cmljdCc7XG4gIFxuICAgIGFuZ3VsYXJcbiAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAuY29udHJvbGxlcignR2NwVGFibGVDb250cm9sbGVyJywgR2NwVGFibGVDb250cm9sbGVyKTtcbiAgXG4gICAgLyoqIEBuZ0luamVjdCAqL1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gICAgZnVuY3Rpb24gR2NwVGFibGVDb250cm9sbGVyKCRzY29wZSwgJHJvb3RTY29wZSwgJHRyYW5zbGF0ZSwgQzJEaWFsb2csICRtZENvbG9ycywgR2xvYmFsLCBHZW9yZWZlcmVuY2VTZXJ2aWNlLCBsb2Rhc2gpIHtcbiAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICB2bS5kZWxldGVHQ1BGcm9tVGFibGUgPSBkZWxldGVHQ1BGcm9tVGFibGU7XG4gICAgICB2bS5kZWxldGVHQ1BGcm9tTWFwID0gZGVsZXRlR0NQRnJvbU1hcDtcbiAgICAgIHZtLnJlZnJlc2hHQ1BUYWJsZSA9IHJlZnJlc2hHQ1BUYWJsZTtcbiAgICAgIHZtLmF2Z1Jtc2UgPSBudWxsO1xuICAgICAgJHNjb3BlLnNob3dUYWJsZSA9IGZhbHNlO1xuICAgICAgJHNjb3BlLnRhYmxlRGF0YSA9IFtdO1xuICAgICAgJHNjb3BlLnBhZ2luYXRpb25MaW1pdCA9IDU7XG4gICAgICAkc2NvcGUucGFnaW5hdGlvbkN1cnJlbnRQYWdlID0gMTtcblxuICAgICAgLy8gZ2xvYmFsIHZhcmlhYmxlIHVzZWQgZm9yIHJlZnJlc2hcbiAgICAgIHZtLmdlb1JlZiA9IG51bGw7XG5cbiAgICAgICRyb290U2NvcGUuJG9uKCdwcmV2aWV3R2NwJywgZnVuY3Rpb24oZXZlbnQsIGFyZ3MpeyAgICAgICAgICAgXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IEdjcFRhYmxlQ29udHJvbGxlciA+Pj4gcHJldmlld0djcEV2ZW50XCIsIGFyZ3MpO1xuICAgICAgICBwcmV2aWV3R2NwKGFyZ3MpO1xuICAgICAgfSk7XG5cbiAgICAgICRyb290U2NvcGUuJG9uKCdkZWxldGVHY3BGcm9tVGFibGVFdmVudCcsIGZ1bmN0aW9uKGV2ZW50LCBhcmdzKXsgICAgICAgICAgIFxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBHY3BUYWJsZUNvbnRyb2xsZXIgPj4+IGRlbGV0ZUdjcEZyb21UYWJsZUV2ZW50XCIsIGFyZ3MpO1xuICAgICAgICBkZWxldGVHQ1BGcm9tVGFibGUoYXJncyk7XG4gICAgICB9KTtcblxuICAgICAgJHJvb3RTY29wZS4kb24oJ3JlZnJlc2hHY3BUYWJsZUV2ZW50JywgZnVuY3Rpb24oZXZlbnQsIGFyZ3MpeyAgICAgICAgICAgXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IEdjcFRhYmxlQ29udHJvbGxlciA+Pj4gcmVmcmVzaEdjcFRhYmxlRXZlbnRcIiwgYXJncyk7XG4gICAgICAgIHJlZnJlc2hHQ1BUYWJsZSgpO1xuICAgICAgfSk7XG5cbiAgICAgICRyb290U2NvcGUuJG9uKCdjbGVhckdjcCcsIGZ1bmN0aW9uKGV2ZW50LCBhcmdzKXsgICAgICAgICAgIFxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBHY3BUYWJsZUNvbnRyb2xsZXIgPj4+IGNsZWFyR2NwXCIsIGFyZ3MpO1xuICAgICAgICBjbGVhckRhdGEoKTtcbiAgICAgIH0pO1xuXG4gICAgICAvKipcbiAgICAgICAqIFN0YXJ0IG9mIHRoZSBHQ1AgVGFibGUgY29udHJvbGxlclxuICAgICAgICogXG4gICAgICAgKi9cbiAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gR2NwVGFibGVDb250cm9sbGVyID4+PiBpbml0XCIpO1xuICAgICAgICAgIC8vIHByZXZpZXdHY3AoKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gcHJldmlld0djcEluVGFibGUodGFibGVEYXRhKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IEdjcFRhYmxlQ29udHJvbGxlciA+Pj4gcHJldmlld0djcEluVGFibGVcIiwgdGFibGVEYXRhKTtcbiAgICAgICAgLy8gJHNjb3BlLnRhYmxlRGF0YSA9IHJlc3VsdC5pdGVtc1szXTtcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBDYWxsIHRoZSBSTVNFIGFwaSB0byBjYWxjdWxhdGUgdGhlIFJNUyBlcnJvciBmb3IgZWFjaCBHQ1BvaW50c1xuICAgICAgICogYW5kIGZpbGwgdGhlIEdDUCB0YWJsZSBiZWxvdyB0byByZXNwb25zZSBkYXRhIGFuZCBjcmVhdGVzIG1hcmtlciBvbiBMZWZ0IGFuZCBSaWdodCBNYXBcbiAgICAgICAqIFxuICAgICAgICogQHBhcmFtIHtvYmplY3R9IGdlb1JlZlxuICAgICAgICovXG4gICAgICBmdW5jdGlvbiBwcmV2aWV3R2NwKGdlb1JlZikge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBHY3BUYWJsZUNvbnRyb2xsZXIgPj4+IHByZXZpZXdHY3BcIik7XG4gICAgICAgIC8vICRzY29wZS5zaG93VGFibGUgPSB0cnVlO1xuICAgICAgICAvLyB2YXIgZ2VvUmVmID0gbmV3IEdlb3JlZmVyZW5jZVNlcnZpY2UoKTtcbiAgICAgICAgaWYoIXZtLmdlb1JlZikge1xuICAgICAgICAgIHZtLmdlb1JlZiA9IGdlb1JlZjtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZ2VvUmVmLnByZXZpZXdHQ1AoZ2VvUmVmKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcInJlc3VsdCBmcm9tIEFQSSBcIiwgcmVzdWx0KTtcbiAgICAgICAgICAgICRzY29wZS50YWJsZURhdGEgPSByZXN1bHQuaXRlbXNbM107XG4gICAgICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZChyZXN1bHQuaXRlbXNbMl1bXCJhdmVyYWdlIGVycm9yXCJdKSkge1xuICAgICAgICAgICAgICB2bS5hdmdSbXNlID0gcmVzdWx0Lml0ZW1zWzJdW1wiYXZlcmFnZSBlcnJvclwiXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwicmVzdWx0IGZyb20gQVBJIFwiLCAkc2NvcGUudGFibGVEYXRhKTtcbiAgICAgICAgICAgIC8vY3JlYXRlIG1hcmtlciBvYmplY3QgYXMgcmVxdWlyZWQgYnkgbGVhZmxldCBtYXJrZXIgb2JqZWN0XG4gICAgICAgICAgICAkc2NvcGUuc2hvd1RhYmxlID0gdHJ1ZTsgIFxuICAgICAgICAgICAgbG9kYXNoLmZvckVhY2goJHNjb3BlLnRhYmxlRGF0YSwgZnVuY3Rpb24obWFya2VyRnJvbURCKSB7XG4gICAgICAgICAgICAgIC8vIHJlbW92ZSBcIm1cIiBmcm9tIGlkIGF0dHJpYnV0ZVxuICAgICAgICAgICAgICBtYXJrZXJGcm9tREIuZ2NwTm8gPSBtYXJrZXJGcm9tREIuaWRbMV07XG4gICAgICAgICAgICAgIC8vIG1hcmtlcnMgZm9yIGxlZnQgbWFwIGllIE5vbiBnZW9yZWZlcmVuY2VcbiAgICAgICAgICAgICAgLy8gZ2VuZXJhdGVMZWZ0TWFya2VyKG1hcmtlckZyb21EQiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIC8vICAgZ2VuZXJhdGVSaWdodE1hcmtlcihtYXJrZXJGcm9tREIpO1xuICAgICAgICAgICAgICAvLyB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICAgICAgICAvLyB0aGUgY29kZSBpbnNpZGUgdGhpcyBibG9jayB3aWxsIGJlIGZpcmVkIGlmIHNvbWUgZXJyb3Igb2NjdXJcbiAgICAgICAgICAgIC8vIGhlcmUgeW91IGNhbiBzaG93IHNvbWUgZXJyb3IgbWVzc2FnZSBvciBkbyBub3RoaW5nLCBkZXBlbmRpbmcgb24gdGhlIGJ1c2luZXNzIHJ1bGVcbiAgICBcbiAgICAgICAgICAgIC8vVE9ETzogbm90aWZ5IHRoZSB1c2VyIGFib3V0IHRoZSBlcnJvcj9cbiAgICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBHZW5lcmF0ZSBtYXJrZXJzIG9uIExlZnQgTWFwXG4gICAgICAgKiBcbiAgICAgICAqIFRvIGJlIHVzZWQgd2hlbiBhIHVzZXIgd2FudHMgdG8gdmlldyBoaXMgb3Igc29tZW9uZSBlbHNlJ3MgR0NQXG4gICAgICAgKiBcbiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBtYXJrZXJGcm9tREJcbiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBjYWxsYmFja1xuICAgICAgICovXG4gICAgICBmdW5jdGlvbiBnZW5lcmF0ZUxlZnRNYXJrZXIobWFya2VyRnJvbURCLCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgbWFya2VyID0gbnVsbDtcbiAgICAgICAgICBtYXJrZXIgPSB7XG4gICAgICAgICAgXCJkcmFnZ2FibGVcIjogdHJ1ZSxcbiAgICAgICAgICAvLyBcImljb25cIjoge3R5cGU6IFwiZGl2XCIsIGNsYXNzTmFtZTogXCJtay1kaXYtaWNvbiBcIittYXJrZXJGcm9tREIuaWQsIGljb25TaXplOiBudWxsLCBodG1sOiBcIjxkaXYgY2xhc3M9XFxcIm1rLWljb24tY29udGFpbmVyIG1rLW9rXFxcIj5cIisgdGVtcE1hcmtlck5vICtcIjwvZGl2PlwifSxcbiAgICAgICAgICBcImlkXCI6IG1hcmtlckZyb21EQi5pZCxcbiAgICAgICAgICBcImxhdGxuZ1wiOiB7XG4gICAgICAgICAgICBcImxhdFwiOiBtYXJrZXJGcm9tREIuaW1hZ2VYLFxuICAgICAgICAgICAgXCJsbmdcIjogbWFya2VyRnJvbURCLmltYWdlWSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwibWVzc2FnZVwiOiB1bmRlZmluZWQsXG4gICAgICAgICAgXCJtYXJrZXJzS2VlcGVyXCI6IFwibGVmdE1hcmtlcnNcIlxuICAgICAgICB9XG4gICAgICBcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJ0aHJvdyBtYXJrZXIgdG8gZ2VvcmVmZXJlbmNlLmNvbnRyb2xsZXIgXCIsIG1hcmtlcik7XG4gICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY3JlYXRlTWFya2VyRm9yVGFibGUnLCBtYXJrZXIpO1xuICAgICAgICAvLyBhIGRlbGF5IG9mIDEwIG1pbGxzZWNvbmRzIGZvciBsZXR0aW5nIHRoZSBtYXJrZXJzIGJlIHJlbmRlcmVkIG9uIG1hcCBhbmQgdGhlbiBmaXJpbmcgZm9yIGFub3RoZXIgbWFwXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfSwgMTApO1xuICAgICAgICBcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBHZW5lcmF0ZSBtYXJrZXJzIG9uIFJpZ2h0IE1hcFxuICAgICAgICogXG4gICAgICAgKiBUbyBiZSB1c2VkIHdoZW4gYSB1c2VyIHdhbnRzIHRvIHZpZXcgaGlzIG9yIHNvbWVvbmUgZWxzZSdzIEdDUFxuICAgICAgICogXG4gICAgICAgKiBAcGFyYW0ge29iamVjdH0gbWFya2VyRnJvbURCXG4gICAgICAgKi9cbiAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlUmlnaHRNYXJrZXIobWFya2VyRnJvbURCKSB7XG4gICAgICAgIHZhciBtYXJrZXIgPSBudWxsO1xuICAgICAgICBcbiAgICAgICAgbWFya2VyID0ge1xuICAgICAgICAgIFwiZHJhZ2dhYmxlXCI6IHRydWUsXG4gICAgICAgICAgLy8gXCJpY29uXCI6IHt0eXBlOiBcImRpdlwiLCBjbGFzc05hbWU6IFwibWstZGl2LWljb24gXCIrbWFya2VyRnJvbURCLmlkLCBpY29uU2l6ZTogbnVsbCwgaHRtbDogXCI8ZGl2IGNsYXNzPVxcXCJtay1pY29uLWNvbnRhaW5lciBtay1va1xcXCI+XCIrIHRlbXBNYXJrZXJObyArXCI8L2Rpdj5cIn0sXG4gICAgICAgICAgXCJpZFwiOiBtYXJrZXJGcm9tREIuaWQsXG4gICAgICAgICAgXCJsYXRsbmdcIjoge1xuICAgICAgICAgICAgXCJsYXRcIjogbWFya2VyRnJvbURCLmxhdCxcbiAgICAgICAgICAgIFwibG5nXCI6IG1hcmtlckZyb21EQi5sb24sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcIm1lc3NhZ2VcIjogdW5kZWZpbmVkLFxuICAgICAgICAgIFwibWFya2Vyc0tlZXBlclwiOiBcInJpZ2h0TWFya2Vyc1wiXG4gICAgICAgIH1cbiAgICAgIFxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInRocm93IG1hcmtlciB0byBnZW9yZWZlcmVuY2UuY29udHJvbGxlciBcIiwgbWFya2VyKTtcbiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjcmVhdGVNYXJrZXJGb3JUYWJsZScsIG1hcmtlcik7XG4gICAgICB9XG5cbiAgICAgIC8qKlxuICAgICAgICogZGVsZXRlIGV2ZW50IGZpcmVkIGZyb20gR0NQIFRhYmxlIHRvIGRlbGV0ZSB0aGUgR0NQIGZyb20gTGVmdCBhbmQgUmlnaHQgTWFwIFxuICAgICAgICogXG4gICAgICAgKiBAcGFyYW0ge3N0cmluZ30gZ2NwSWRcbiAgICAgICAqL1xuICAgICAgZnVuY3Rpb24gZGVsZXRlR0NQRnJvbU1hcChnY3BJZCkge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBHY3BUYWJsZUNvbnRyb2xsZXIgPj4+IGRlbGV0ZUdDUEZyb21NYXAgXCIsIGdjcElkLCAkc2NvcGUudGFibGVEYXRhKTtcbiAgICAgICAgLy8gY2hlY2sgaWYgZ2NwSWQgYWV4aXN0IGluIFRhYmxlIGRhdGFcbiAgICAgICAgLy8gY29uc29sZS5sb2coXy5maW5kKCRzY29wZS50YWJsZURhdGEsIFsnaWQnLCBnY3BJZF0pKTtcbiAgICAgICAgaWYoXy5maW5kKCRzY29wZS50YWJsZURhdGEsIFsnaWQnLCBnY3BJZF0pKSB7XG4gICAgICAgICAgLy8gVE9ETyA6IGNhbGwgc29tZSBldmVudCB0byBkZWxldGUgbWFya2VycyBmcm9tIGJvdGggdGhlIG1hcHMgXG4gICAgICAgICAgdmFyIHRlbXAgPSB7XG4gICAgICAgICAgICBtb2RlbDoge1xuICAgICAgICAgICAgICBpZDogZ2NwSWQsXG4gICAgICAgICAgICAgIGV2ZW50RnJvbTogXCJnY3BUYWJsZVwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgICAvLyBmaXJlIGEgZXZlbnQgdG8gcmVtb3ZlIG1hcmtlcnMgZnJvbSBtYXBzXG4gICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KFwibGVhZmxldERpcmVjdGl2ZU1hcmtlci5sZWZ0TWFwVmlld2VyLmNsaWNrXCIsIHRlbXApO1xuICAgICAgICAgIC8vICRyb290U2NvcGUuJGJyb2FkY2FzdChcImxlYWZsZXREaXJlY3RpdmVNYXJrZXIubGVmdE1hcFZpZXdlci5jbGlja1wiLCB0ZW1wKTtcbiAgICAgICAgICAvLyBkZWxldGUgZnJvbSB0YWJsZVxuICAgICAgICAgICRzY29wZS50YWJsZURhdGEgPSBfLmZpbHRlcigkc2NvcGUudGFibGVEYXRhLCBmdW5jdGlvbihvKSB7IHJldHVybiAhKG8uaWQgPT09IGdjcElkKTsgfSk7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coXCJmaWx0ZXJlZFRhYmxlRGF0YSA9IFwiLCAkc2NvcGUudGFibGVEYXRhKTtcbiAgICAgICAgfVxuICAgICAgICByZWZyZXNoR0NQVGFibGUoKTtcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBEZWxldGUgZXZlbnQgZmlyZWQgZnJvbSBtYXAgdG8gZGVsZXRlIHRoZSBHQ1AgZnJvbSBUYWJsZSBcbiAgICAgICAqIFxuICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGdjcElkXG4gICAgICAgKi9cbiAgICAgIGZ1bmN0aW9uIGRlbGV0ZUdDUEZyb21UYWJsZShnY3BJZCkge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBHY3BUYWJsZUNvbnRyb2xsZXIgPj4+IGRlbGV0ZUdDUEZyb21UYWJsZSBcIiwgZ2NwSWQsICRzY29wZS50YWJsZURhdGEpO1xuICAgICAgICAvLyBjaGVjayBpZiBnY3BJZCBhZXhpc3QgaW4gVGFibGUgZGF0YVxuICAgICAgICAvLyBjb25zb2xlLmxvZyhfLmZpbmQoJHNjb3BlLnRhYmxlRGF0YSwgWydpZCcsIGdjcElkXSkpO1xuICAgICAgICBpZihfLmZpbmQoJHNjb3BlLnRhYmxlRGF0YSwgWydpZCcsIGdjcElkXSkpIHtcbiAgICAgICAgICAkc2NvcGUudGFibGVEYXRhID0gXy5maWx0ZXIoJHNjb3BlLnRhYmxlRGF0YSwgZnVuY3Rpb24obykgeyByZXR1cm4gIShvLmlkID09PSBnY3BJZCk7IH0pO1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZmlsdGVyZWRUYWJsZURhdGEgPSBcIiwgJHNjb3BlLnRhYmxlRGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVmcmVzaEdDUFRhYmxlKCk7XG4gICAgICB9XG5cbiAgICAgIC8qKlxuICAgICAgICogUmVmcmVzaCBHQ1AgZnJvbSBUYWJsZSB3aXRoIGN1cnJlbnQgR0NQXG4gICAgICAgKiBcbiAgICAgICAqL1xuICAgICAgZnVuY3Rpb24gcmVmcmVzaEdDUFRhYmxlKCkge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBHY3BUYWJsZUNvbnRyb2xsZXIgPj4+IHJlZnJlc2hHQ1BUYWJsZSBcIiwgdm0uZ2VvUmVmKTtcbiAgICAgICAgaWYodm0uZ2VvUmVmKSB7XG4gICAgICAgICAgJHNjb3BlLnNob3dUYWJsZSA9IGZhbHNlO1xuICAgICAgICAgIGlmKF8uc2l6ZSh2bS5nZW9SZWYuaW1hZ2VDb29yZGluYXRlcykgPj0gMyAmJiBfLnNpemUodm0uZ2VvUmVmLndvcmxkQ29vcmRpbmF0ZXMpID49IDMpIHtcbiAgICAgICAgICAgIC8vIGNoZWNrIGlmIGJvdGggdGhlIG1hcHMgaGF2ZSBzYW1lIG51bWJlciBvZiBHQ1BzXG4gICAgICAgICAgICBpZihfLnNpemUodm0uZ2VvUmVmLmltYWdlQ29vcmRpbmF0ZXMpID09PSBfLnNpemUodm0uZ2VvUmVmLndvcmxkQ29vcmRpbmF0ZXMpKSB7XG4gICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKF8uc2l6ZSh2bS5nZW9SZWYuaW1hZ2VDb29yZGluYXRlcykgKyBcIiAtIFwiKyBfLnNpemUodm0uZ2VvUmVmLndvcmxkQ29vcmRpbmF0ZXMpKVxuICAgICAgICAgICAgICBwcmV2aWV3R2NwKHZtLmdlb1JlZik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgICAgICAgIHRpdGxlOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2RpYWxvZy5pbnZhbGlkR2VvcmVmVGl0bGUnKSxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJHRyYW5zbGF0ZS5pbnN0YW50KCdkaWFsb2cuaW52YWxpZEdlb3JlZlRleHQnKSxcbiAgICAgICAgICAgICAgICB0b29sYmFyQmdDb2xvcjokbWRDb2xvcnMuZ2V0VGhlbWVDb2xvcigncHJpbWFyeScpLFxuICAgICAgICAgICAgICAgIG9rQmdDb2xvcjokbWRDb2xvcnMuZ2V0VGhlbWVDb2xvcigncHJpbWFyeScpLFxuICAgICAgICAgICAgICAgIG9rOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2dsb2JhbC5vaycpXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIEMyRGlhbG9nLmFsZXJ0KGNvbmZpZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGNsZWFyRGF0YSgpIHtcbiAgICAgICAgdm0uZ2VvUmVmID0gbnVsbDtcbiAgICAgICAgJHNjb3BlLnNob3dUYWJsZSA9IGZhbHNlO1xuICAgICAgICAkc2NvcGUudGFibGVEYXRhID0gW107XG4gICAgICB9XG5cbiAgICAgIGluaXQoKTtcbiAgICB9XG59KSAoKTsiLCIoZnVuY3Rpb24gKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuY29udHJvbGxlcignR2VvTGVmdFNpZGVuYXZDb250cm9sbGVyJywgR2VvTGVmdFNpZGVuYXZDb250cm9sbGVyKTtcblxuICAvKiogQG5nSW5qZWN0ICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gIGZ1bmN0aW9uIEdlb0xlZnRTaWRlbmF2Q29udHJvbGxlcigkc2NvcGUsICR0aW1lb3V0LCAkbWRTaWRlbmF2LCAkbG9nLCAkcm9vdFNjb3BlLCBsb2Rhc2gsICRtZFNlbGVjdCwgJHdpbmRvdywgTWFwTGF5ZXJTZXJ2aWNlLCBHZW9yZWZlcmVuY2VTZXJ2aWNlLCBDMlRvYXN0LCAkdHJhbnNsYXRlLCBHbG9iYWwsICRtZENvbG9ycywgQzJEaWFsb2csICRtZERpYWxvZywgJHN0YXRlLCBsZWFmbGV0RGF0YSwgJGxvY2FsU3RvcmFnZSkge1xuICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICB2bS5jbG9zZSA9IGNsb3NlOyBcbiAgICB2bS5zYXZlID0gc2F2ZTtcbiAgICB2bS5yZWN0aWZ5RGlzYWJsZSA9IHJlY3RpZnlEaXNhYmxlO1xuICAgIHZtLnByZXZpZXdHY3AgPSBwcmV2aWV3R2NwO1xuICAgIHZtLmdlbmVyYXRlRmlsZW5hbWVhbmRFeHRlbnQgPSBnZW5lcmF0ZUZpbGVuYW1lYW5kRXh0ZW50O1xuICAgIHZtLm1pbnggPSBudWxsO1xuICAgIHZtLm1pbnkgPSBudWxsO1xuICAgIHZtLm1heHggPSBudWxsO1xuICAgIHZtLm1heHkgPSBudWxsO1xuICAgIHZtLmdjcCA9IG51bGw7XG4gICAgdm0ubWFudWFsRXh0ZW50ID0gZmFsc2U7XG4gICAgJHNjb3BlLmV4dGVudFNlbGVjdGlvbiA9ICcwJztcblxuICAgICRzY29wZS4kd2F0Y2goXCJleHRlbnRTZWxlY3Rpb25cIiwgZnVuY3Rpb24obmV3VmFsLCBvbGQpe1xuICAgICAgLy8gaWYgMiBzZWxlY3RlZCBtZWFucyBkcmF3IG1hbmF1bCByZWN0XG4gICAgICBpZihuZXdWYWwgPT09IDIpIHtcbiAgICAgICAgLy8gcmVtb3ZlRXh0ZW50UmVjdGFuZ2xlKGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGRyYXdSZWN0YW5nbGVGb3JFeHRlbnQoKTtcbiAgICAgICAgLy8gfSk7XG4gICAgICB9IGVsc2UgaWYobmV3VmFsID09PSAxKSB7XG4gICAgICAgIGNsZWFuVXAoKTtcbiAgICAgICAgLy8gY2FsY3VsYXRlIG1pbngsIG1pbnkgdmFsdWVzXG4gICAgICAgIGNhbGNNaW5NYXhWYWx1ZXMoKTtcbiAgICAgIH0gZWxzZSBpZihuZXdWYWwgPT09IDApIHtcbiAgICAgICAgLy8gcmVtb3ZlIEV4dGVudCByZWN0YW5nbGUgZnJvbSBtYXBcbiAgICAgICAgY2xlYW5VcCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gZW1pdCBsaXN0ZW5lciB3aGVuIHNhdmUgb2YgR2VvcmVmZXJlbmNlIGNvbnRyb2xsZXIgY2FsbGVkLiBJdCBwYXNzZXMgdGhlIEdDUCBvbiBsZWZ0IHBhbmVsXG4gICAgJHJvb3RTY29wZS4kb24oJ3NhdmVHZW9SZWYnLCBmdW5jdGlvbihldmVudCwgYXJncykge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gZ2UubGVmdC5zaWRlbmF2LmNvbnRyb2xsZXIgPj4+IHNhdmVHZW9SZWYgXCIsIGFyZ3MpO1xuICAgICAgdm0uZ2NwID0gYXJncztcbiAgICAgIC8vIHJlZHJhdyB0aGUgcmVzYW1wbGluZyBtZXRob2QgZHJvcGRvd25cbiAgICAgIGdldFJlc2FtcGxpbmdNZXRob2RzQmFzZWRPbkdDUChPYmplY3Qua2V5cyh2bS5nY3ApLmxlbmd0aCk7XG4gICAgICAvLyByZWRyYXcgdGhlIHJlY3RpZnkgbWV0aG9kIGRyb3Bkb3duXG4gICAgICBnZXRSZWN0aWZ5TWV0aG9kc0Jhc2VkT25HQ1AoT2JqZWN0LmtleXModm0uZ2NwKS5sZW5ndGgpO1xuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogRW5hYmxlcyAvIERpc2FibGVzIFJlY3RpZnkgb3B0aW9ucyBpbiBkcm9wZG93biBiYXNlZCBvbiBudW1iZXIgb2YgR0NQU1xuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlY3RpZnlEaXNhYmxlKGlkKXtcbiAgICAgIC8vIENhbid0IGFjY2VzcyBudW1PZkdDUCgpIGZ1biBvZiBnZW9yZWZlcmVuY2UuY29udHJvbGxlci5qcyBoZXJlLlxuICAgICAgaWYgKGlkID09IFwiMm5kT3JkZXJQb2x5blwiKXtcbiAgICAgICAgcmV0dXJuIGZhbHNlOyAvLyBHZW9yZWZlcmVuY2VDb250cm9sbGVyLm51bU9mR0NQID49IDZcbiAgICAgIH0gZWxzZSBpZiAoaWQgPT0gXCIzcmRPcmRlclBvbHluXCIpe1xuICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gR2VvcmVmZXJlbmNlQ29udHJvbGxlci5udW1PZkdDUCA+PSAxMFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlIC8vIEtlZXAgdGhlIGJ1dHRvbiBlbmFibGVkIGZvciBBdXRvIGFuZCAxc3QgT3JkZXJcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaXJzdCBmdW5jdGlvbiBjYWxsZWQgYWZ0ZXIgdGhlIGNvbnRyb2xsZXIgaXMgcmFuXG4gICAgICogaGVyZSB0aGUgc3R1ZmYgYXJlIGluaXRpYWxpemVkXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBnZS5sZWZ0LnNpZGVuYXYuY29udHJvbGxlciA+Pj4gYWN0aXZhdGUgXCIpO1xuICAgICAgdm0ucmVjdGlmeU1ldGhvZHMgPSBnZXRSZWN0aWZ5TWV0aG9kcygpO1xuICAgICAgdm0ucmVjdGlmeU1ldGhvZCA9IGxvZGFzaC5maW5kKHZtLnJlY3RpZnlNZXRob2RzLCBmdW5jdGlvbiAocm0pIHtcbiAgICAgICAgLy8gcmV0dXJuIHJtLmlkID09PSAnQXV0b0Jhc2VkT25HQ1AnO1xuICAgICAgICByZXR1cm4gcm0uaWQgPT09ICcnOyAvLyBUbyBub3QgYWxsb3cgJ0F1dG9CYXNlZE9uR0NQJyB0byBiZSB0aGVyZSBieSBkZWZhdWx0XG4gICAgICB9KTtcbiAgICAgIHZtLnJlc2FtcGxpbmdNZXRob2RzID0gZ2V0UmVzYW1wbGluZ01ldGhvZHMoKTtcbiAgICAgIHZtLnJlc2FtcGxpbmdNZXRob2QgPSBsb2Rhc2guZmluZCh2bS5yZXNhbXBsaW5nTWV0aG9kcywgZnVuY3Rpb24gKHJtKSB7XG4gICAgICAgIC8vIHJldHVybiBybS5pZCA9PT0gJ25lYXInO1xuICAgICAgICByZXR1cm4gcm0uaWQgPT09ICcnOyAvLyBUbyBub3QgYWxsb3cgJ25lYXInIHRvIGJlIHRoZXJlIGJ5IGRlZmF1bHQuXG4gICAgICB9KTtcbiAgICAgIG1vbml0b3JDbG9zZVNlbGVjdCgpOyBcbiAgICAgICRtZFNpZGVuYXYoJ2xlZnQnKS5vbkNsb3NlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJG1kU2VsZWN0LmhpZGUoKTtcbiAgICAgIH0pOyAgICAgXG4gICAgICB2bS5nZW9SZWZGaWxlbmFtZSA9ICcnO1xuICAgICAgLy8gcmVzb2x2aW5nICMyMDhcbiAgICAgIGlmKCEgbG9kYXNoLmlzRW1wdHkoJGxvY2FsU3RvcmFnZS5nZXRPYmplY3QoXCJnZW9yZWZMYXllclwiKSkpIHtcbiAgICAgICAgLy8gcmVtb3ZlIGJhc2UgbGF5ZXJcbiAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgTWFwTGF5ZXJTZXJ2aWNlLnJlbW92ZUFsbE1hcExheWVycyhcImxlZnRNYXBWaWV3ZXJcIik7IFxuICAgICAgICB9LCAyMDApO1xuICAgICAgICAvLyBBZGQgbGF5ZXIgdG8gcmlnaHQgbWFwXG4gICAgICAgIE1hcExheWVyU2VydmljZS5hZGRNYXBMYXllcigkbG9jYWxTdG9yYWdlLmdldE9iamVjdChcImdlb3JlZkxheWVyXCIpLCBcInJpZ2h0TWFwVmlld2VyXCIpOyBcbiAgICAgICAgLy8gQWRkIGltYWdlIGxheWVyIHRvIGxlZnQgbWFwXG4gICAgICAgIE1hcExheWVyU2VydmljZS5hZGRNYXBMYXllcigkbG9jYWxTdG9yYWdlLmdldE9iamVjdChcIm5vbmdlb3JlZkxheWVyXCIpLCBcImxlZnRNYXBWaWV3ZXJcIik7XG4gICAgICAgICRsb2NhbFN0b3JhZ2UucmVtb3ZlKFwiZ2VvcmVmTGF5ZXJcIik7XG4gICAgICAgICRsb2NhbFN0b3JhZ2UucmVtb3ZlKFwibm9uZ2VvcmVmTGF5ZXJcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xvc2UgdGhpcyBzaWRlbmF2XG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gY2xvc2UgKCkge1xuICAgICAgJG1kU2lkZW5hdignbGVmdCcpLmNsb3NlKCk7XG4gICAgfSAgICBcblxuICAgIC8qKlxuICAgICAqIE9wZW4gdGhpcyBzaWRlbmF2XG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gb3BlbiAoKSB7XG4gICAgICAkbWRTaWRlbmF2KCdsZWZ0Jykub3BlbigpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgdGhlIHJlY3RpZnkgbWV0aG9kcyBhdmFpbGFibGUgdG8gYmUgdXNlZFxuICAgICAqIFxuICAgICAqIEByZXR1cm5zIHthcnJheX1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRSZWN0aWZ5TWV0aG9kcygpIHtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIHtuYW1lOiAnQXV0byAoYmFzZWQgb24gR0NQKScsIGlkOiAnQXV0b0Jhc2VkT25HQ1AnLCBkaXNhYmxlOiB0cnVlfSxcbiAgICAgICAgeyBuYW1lOiAnMXN0IE9yZGVyIFBvbHluLiAobWluIDMgcG9pbnRzIHJlcXVpcmVkKScsaWQ6ICcxc3RPcmRlclBvbHluJywgZGlzYWJsZTogdHJ1ZX0sXG4gICAgICAgIHsgbmFtZTogJzJuZCBPcmRlciBQb2x5bi4gKG1pbiA2IHBvaW50cyByZXF1aXJlZCknLGlkOiAnMm5kT3JkZXJQb2x5bicsIGRpc2FibGU6IHRydWV9LFxuICAgICAgICB7IG5hbWU6ICczcmQgT3JkZXIgUG9seW4uIChtaW4gMTAgcG9pbnRzIHJlcXVpcmVkKScsaWQ6ICczcmRPcmRlclBvbHluJywgZGlzYWJsZTogdHJ1ZX1cbiAgICAgIF1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHRoZSByZWN0aWZ5IG1ldGhvZHMgYmFzZWQgb24gbnVtYmVyIG9mIEdDUFxuICAgICAqIFxuICAgICAqIEByZXR1cm5zIHthcnJheX1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRSZWN0aWZ5TWV0aG9kc0Jhc2VkT25HQ1AoKSB7XG4gICAgICAvKiB2bS5yZWN0aWZ5TWV0aG9kcyA9IFtcbiAgICAgICAge25hbWU6ICdBdXRvIChiYXNlZCBvbiBHQ1ApJywgaWQ6ICdBdXRvQmFzZWRPbkdDUCcsIGRpc2FibGU6IGZhbHNlfSxcbiAgICAgICAgeyBuYW1lOiAnMXN0IE9yZGVyIFBvbHluLiAobWluIDMgcG9pbnRzIHJlcXVpcmVkKScsaWQ6ICcxc3RPcmRlclBvbHluJywgZGlzYWJsZTogZmFsc2V9LFxuICAgICAgICB7IG5hbWU6ICcybmQgT3JkZXIgUG9seW4uIChtaW4gNiBwb2ludHMgcmVxdWlyZWQpJyxpZDogJzJuZE9yZGVyUG9seW4nLCBkaXNhYmxlOiBmYWxzZX0sXG4gICAgICAgIHsgbmFtZTogJzNyZCBPcmRlciBQb2x5bi4gKG1pbiAxMCBwb2ludHMgcmVxdWlyZWQpJyxpZDogJzNyZE9yZGVyUG9seW4nLCBkaXNhYmxlOiBmYWxzZX1cbiAgICAgIF07ICovXG4gICAgICBpZihPYmplY3Qua2V5cyh2bS5nY3ApLmxlbmd0aCA+PSAzICYmIE9iamVjdC5rZXlzKHZtLmdjcCkubGVuZ3RoIDwgNikge1xuICAgICAgICB2bS5yZWN0aWZ5TWV0aG9kcyA9IFtcbiAgICAgICAgICB7bmFtZTogJ0F1dG8gKGJhc2VkIG9uIEdDUCknLCBpZDogJ0F1dG9CYXNlZE9uR0NQJywgZGlzYWJsZTogZmFsc2V9LFxuICAgICAgICAgIHsgbmFtZTogJzFzdCBPcmRlciBQb2x5bi4gKG1pbiAzIHBvaW50cyByZXF1aXJlZCknLGlkOiAnMXN0T3JkZXJQb2x5bicsIGRpc2FibGU6IGZhbHNlfSxcbiAgICAgICAgICB7IG5hbWU6ICcybmQgT3JkZXIgUG9seW4uIChtaW4gNiBwb2ludHMgcmVxdWlyZWQpJyxpZDogJzJuZE9yZGVyUG9seW4nLCBkaXNhYmxlOiB0cnVlfSxcbiAgICAgICAgICB7IG5hbWU6ICczcmQgT3JkZXIgUG9seW4uIChtaW4gMTAgcG9pbnRzIHJlcXVpcmVkKScsaWQ6ICczcmRPcmRlclBvbHluJywgZGlzYWJsZTogdHJ1ZX1cbiAgICAgICAgXVxuICAgICAgfSBlbHNlIGlmKE9iamVjdC5rZXlzKHZtLmdjcCkubGVuZ3RoID49IDYgJiYgT2JqZWN0LmtleXModm0uZ2NwKS5sZW5ndGggPCAxMCl7XG4gICAgICAgIHZtLnJlY3RpZnlNZXRob2RzID0gW1xuICAgICAgICAgIHtuYW1lOiAnQXV0byAoYmFzZWQgb24gR0NQKScsIGlkOiAnQXV0b0Jhc2VkT25HQ1AnLCBkaXNhYmxlOiBmYWxzZX0sXG4gICAgICAgICAgeyBuYW1lOiAnMXN0IE9yZGVyIFBvbHluLiAobWluIDMgcG9pbnRzIHJlcXVpcmVkKScsaWQ6ICcxc3RPcmRlclBvbHluJywgZGlzYWJsZTogZmFsc2V9LFxuICAgICAgICAgIHsgbmFtZTogJzJuZCBPcmRlciBQb2x5bi4gKG1pbiA2IHBvaW50cyByZXF1aXJlZCknLGlkOiAnMm5kT3JkZXJQb2x5bicsIGRpc2FibGU6IGZhbHNlfSxcbiAgICAgICAgICB7IG5hbWU6ICczcmQgT3JkZXIgUG9seW4uIChtaW4gMTAgcG9pbnRzIHJlcXVpcmVkKScsaWQ6ICczcmRPcmRlclBvbHluJywgZGlzYWJsZTogdHJ1ZX1cbiAgICAgICAgXVxuICAgICAgfSBlbHNlIGlmKE9iamVjdC5rZXlzKHZtLmdjcCkubGVuZ3RoID49IDEwKSB7XG4gICAgICAgIHZtLnJlY3RpZnlNZXRob2RzID0gW1xuICAgICAgICAgIHtuYW1lOiAnQXV0byAoYmFzZWQgb24gR0NQKScsIGlkOiAnQXV0b0Jhc2VkT25HQ1AnLCBkaXNhYmxlOiBmYWxzZX0sXG4gICAgICAgICAgeyBuYW1lOiAnMXN0IE9yZGVyIFBvbHluLiAobWluIDMgcG9pbnRzIHJlcXVpcmVkKScsaWQ6ICcxc3RPcmRlclBvbHluJywgZGlzYWJsZTogZmFsc2V9LFxuICAgICAgICAgIHsgbmFtZTogJzJuZCBPcmRlciBQb2x5bi4gKG1pbiA2IHBvaW50cyByZXF1aXJlZCknLGlkOiAnMm5kT3JkZXJQb2x5bicsIGRpc2FibGU6IGZhbHNlfSxcbiAgICAgICAgICB7IG5hbWU6ICczcmQgT3JkZXIgUG9seW4uIChtaW4gMTAgcG9pbnRzIHJlcXVpcmVkKScsaWQ6ICczcmRPcmRlclBvbHluJywgZGlzYWJsZTogZmFsc2V9XG4gICAgICAgIF1cbiAgICAgIH1cbiAgICAgIC8vIGlmIHVzZXIgaGF2ZSBhbHJlYWR5IHNlbGVjdGVkIGFuIG9wdGlvbiBmcm9tIGRyb3Bkb3duIHRoYW4gcmVzZWxlY3RlZCBpdFxuICAgICAgaWYodHlwZW9mIHZtLnJlY3RpZnlNZXRob2QgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgbG9kYXNoLmZvckVhY2godm0ucmVjdGlmeU1ldGhvZHMsIGZ1bmN0aW9uKG1ldGhvZCkge1xuICAgICAgICAgIGlmKG1ldGhvZC5pZCA9PT0gdm0ucmVjdGlmeU1ldGhvZC5pZCkge1xuICAgICAgICAgICAgdm0ucmVjdGlmeU1ldGhvZCA9IG1ldGhvZDtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgdGhlIHJlc2FtcGxpbmcgbWV0aG9kcyBhdmFpbGFibGUgdG8gYmUgdXNlZFxuICAgICAqIFxuICAgICAqIEByZXR1cm5zIHthcnJheX1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRSZXNhbXBsaW5nTWV0aG9kcygpIHtcbiAgICAgIHJldHVybiBbXG4gICAgICAgIC8vIGlkID0gZ2RhbHdhcnAgcGFyYW1ldGVyXG4gICAgICAgIHsgbmFtZTogJ05lYXJlc3QgbmVpZ2hib3VyIHJlc2FtcGxpbmcnLGlkOiAnbmVhcicsIGRpc2FibGU6IHRydWV9LFxuICAgICAgICB7IG5hbWU6ICdCaWxpbmVhciByZXNhbXBsaW5nJyxpZDogJ2JpbGluZWFyJywgZGlzYWJsZTogdHJ1ZX0sXG4gICAgICAgIHsgbmFtZTogJ0N1YmljIHJlc2FtcGxpbmcnLGlkOiAnY3ViaWMnLCBkaXNhYmxlOiB0cnVlfVxuICAgICAgXVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgdGhlIHJlc2FtcGxpbmcgbWV0aG9kcyBiYXNlZCBvbiB0aGUgbnVtYmVyIG9mIEdDUCBwb2ludHMgYXZhaWxhYmxlXG4gICAgICogXG4gICAgICogQHJldHVybnMge2FycmF5fVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGdldFJlc2FtcGxpbmdNZXRob2RzQmFzZWRPbkdDUCgpIHtcbiAgICAgIGlmKE9iamVjdC5rZXlzKHZtLmdjcCkubGVuZ3RoIDwgMykge1xuICAgICAgICB2bS5yZXNhbXBsaW5nTWV0aG9kcyA9IFtcbiAgICAgICAgICB7IG5hbWU6ICdOZWFyZXN0IG5laWdoYm91ciByZXNhbXBsaW5nJyxpZDogJ25lYXInLCBkaXNhYmxlOiBmYWxzZX0sXG4gICAgICAgICAgeyBuYW1lOiAnQmlsaW5lYXIgcmVzYW1wbGluZycsaWQ6ICdiaWxpbmVhcicsIGRpc2FibGU6IGZhbHNlfSxcbiAgICAgICAgICB7IG5hbWU6ICdDdWJpYyByZXNhbXBsaW5nJyxpZDogJ2N1YmljJywgZGlzYWJsZTogZmFsc2V9XG4gICAgICAgIF1cbiAgICAgIH0gZWxzZSBpZihPYmplY3Qua2V5cyh2bS5nY3ApLmxlbmd0aCA+PSAzICYmIE9iamVjdC5rZXlzKHZtLmdjcCkubGVuZ3RoIDwgNikge1xuICAgICAgICB2bS5yZXNhbXBsaW5nTWV0aG9kcyA9IFtcbiAgICAgICAgICB7IG5hbWU6ICdOZWFyZXN0IG5laWdoYm91ciByZXNhbXBsaW5nJyxpZDogJ25lYXInLCBkaXNhYmxlOiBmYWxzZX0sXG4gICAgICAgICAgeyBuYW1lOiAnQmlsaW5lYXIgcmVzYW1wbGluZycsaWQ6ICdiaWxpbmVhcicsIGRpc2FibGU6IHRydWV9LFxuICAgICAgICAgIHsgbmFtZTogJ0N1YmljIHJlc2FtcGxpbmcnLGlkOiAnY3ViaWMnLCBkaXNhYmxlOiB0cnVlfVxuICAgICAgICBdXG4gICAgICB9IGVsc2UgaWYoT2JqZWN0LmtleXModm0uZ2NwKS5sZW5ndGggPj0gNiAmJiBPYmplY3Qua2V5cyh2bS5nY3ApLmxlbmd0aCA8IDEwKXtcbiAgICAgICAgdm0ucmVzYW1wbGluZ01ldGhvZHMgPSBbXG4gICAgICAgICAgeyBuYW1lOiAnTmVhcmVzdCBuZWlnaGJvdXIgcmVzYW1wbGluZycsaWQ6ICduZWFyJywgZGlzYWJsZTogZmFsc2V9LFxuICAgICAgICAgIHsgbmFtZTogJ0JpbGluZWFyIHJlc2FtcGxpbmcnLGlkOiAnYmlsaW5lYXInLCBkaXNhYmxlOiBmYWxzZX0sXG4gICAgICAgICAgeyBuYW1lOiAnQ3ViaWMgcmVzYW1wbGluZycsaWQ6ICdjdWJpYycsIGRpc2FibGU6IHRydWV9XG4gICAgICAgIF1cbiAgICAgIH0gZWxzZSBpZihPYmplY3Qua2V5cyh2bS5nY3ApLmxlbmd0aCA+PSAxMCkge1xuICAgICAgICB2bS5yZXNhbXBsaW5nTWV0aG9kcyA9IFtcbiAgICAgICAgICB7IG5hbWU6ICdOZWFyZXN0IG5laWdoYm91ciByZXNhbXBsaW5nJyxpZDogJ25lYXInLCBkaXNhYmxlOiBmYWxzZX0sXG4gICAgICAgICAgeyBuYW1lOiAnQmlsaW5lYXIgcmVzYW1wbGluZycsaWQ6ICdiaWxpbmVhcicsIGRpc2FibGU6IGZhbHNlfSxcbiAgICAgICAgICB7IG5hbWU6ICdDdWJpYyByZXNhbXBsaW5nJyxpZDogJ2N1YmljJywgZGlzYWJsZTogZmFsc2V9XG4gICAgICAgIF1cbiAgICAgIH1cbiAgICAgIC8vIGlmIHVzZXIgaGF2ZSBhbHJlYWR5IHNlbGVjdGVkIGFuIG9wdGlvbiBmcm9tIGRyb3Bkb3duIHRoYW4gcmVzZWxlY3RlZCBpdFxuICAgICAgaWYodHlwZW9mIHZtLnJlc2FtcGxpbmdNZXRob2QgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgbG9kYXNoLmZvckVhY2godm0ucmVzYW1wbGluZ01ldGhvZHMsIGZ1bmN0aW9uKG1ldGhvZCkge1xuICAgICAgICAgIGlmKG1ldGhvZC5pZCA9PT0gdm0ucmVzYW1wbGluZ01ldGhvZC5pZCkge1xuICAgICAgICAgICAgdm0ucmVzYW1wbGluZ01ldGhvZCA9IG1ldGhvZDtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldHMgY2FsbGVkIG9uIHJlc2FtcGxlIERyb3Bkb3duIHNlbGVjdGlvbiBjaGFuZ2UsIHRvIGdldCBnZW5lcmF0ZSB0aGUgXG4gICAgICogJ2ZpbGVuYW1lJyBhbmQgZXh0ZW50ICd2YWx1ZSdcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZW5lcmF0ZUZpbGVuYW1lYW5kRXh0ZW50KCkge1xuICAgICAgLy8gZ2V0IHRoZSBsYXllciB0aGF0IGNvbnRhaW5zIHRoZSByZXNvdXJjZS9tYXAgdG8gYmUgZ2VvcmVmZXJlbmNlZFxuICAgICAgdmFyIGxheWVyID0gTWFwTGF5ZXJTZXJ2aWNlLmdldFZpZXdlck92ZXJsYXlzKFwibGVmdE1hcFZpZXdlclwiKTtcbiAgICAgIFxuICAgICAgLy8gZ2V0IHRoZSByZXNvdXJjZS9tYXAgaWQgZnJvbSB0aGUgbG9hZGVkIGxheWVyXG4gICAgICAvLyBhcyBpbiB0aGUgY2FzZSBvZiBnZW9yZWZlcmVuY2UgbW9kdWxlIG9ubHkgb25lIHJlc291cmNlL21hcCB3aWxsXG4gICAgICAvLyBiZSBsb2FkZWQsIHdlIGdldCB0aGUgcHJvcGVydGllcyBmcm9tIHRoZSBmaXJzdCByZXNvdXJjZSBpbiB0aGUgbGF5ZXJcbiAgICAgIHZhciBmaXJzdExheWVyS2V5ID0gT2JqZWN0LmtleXMobGF5ZXIpWzBdOyAgIFxuXG4gICAgICAvLyBHZXQgbmV3IGdlb3JlZmVuY2VkIGZpbGUgbmFtZSBmcm9tIHRoZSB1c2VyXG4gICAgICB2bS5nZW9SZWZGaWxlbmFtZSA9IGxheWVyW2ZpcnN0TGF5ZXJLZXldLnJlc291cmNlLnRpdGxlICsgXCJfZ19cIiArIHZtLnJlY3RpZnlNZXRob2QuaWQgKyBcIl9cIiArIHZtLnJlc2FtcGxpbmdNZXRob2QuaWQgKyBcIl9cIiArICgobmV3IERhdGUoKSkuZ2V0TW9udGgoKSsxKSArIFwiLlwiICsgKG5ldyBEYXRlKCkpLmdldERhdGUoKSArIFwiLlwiICsgKG5ldyBEYXRlKCkpLmdldEZ1bGxZZWFyKCk7XG4gICAgICBcbiAgICAgIC8vIGNhbGN1bGF0ZSBtaW54LCBtaW55IHZhbHVlc1xuICAgICAgY2FsY01pbk1heFZhbHVlcygpO1xuICAgICAgdm0uYmJveENyb3BJbWFnZSA9IHZtLm1pbnggKyBcIiBcIiArIHZtLm1pbnkgKyBcIiBcIiArIHZtLm1heHggKyBcIiBcIiArIHZtLm1heHk7XG4gICAgfVxuICAgIFxuICAgIC8qKlxuICAgICAqIENhbGN1bGF0ZXMgdGhlIG1pbngsIG1pbnksIG1heHggYW5kIG1heHkgdmFsdWVzIGJhc2VkIG9uIEdDUCBjcmVhdGVkIFxuICAgICAqIG9uIHJpZ2h0IG1hcFxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNhbGNNaW5NYXhWYWx1ZXMoKSB7XG4gICAgICAvLyBDcm9wIGZpbmFsIGdlb3JlZmVyZW5jZWQgaW1hZ2VcbiAgICAgIHZhciBsYXQgPSBbXTsgdmFyIGxuZyA9IFtdO1xuICAgICAgZm9yICh2YXIgaT0wOyBpPE9iamVjdC5rZXlzKCRzY29wZS4kcGFyZW50LnZtLnJpZ2h0TWFya2VycykubGVuZ3RoOyBpKyspe1xuICAgICAgICBsYXQucHVzaChPYmplY3QudmFsdWVzKCRzY29wZS4kcGFyZW50LnZtLnJpZ2h0TWFya2VycylbaV1bXCJsYXRcIl0pO1xuICAgICAgICBsbmcucHVzaChPYmplY3QudmFsdWVzKCRzY29wZS4kcGFyZW50LnZtLnJpZ2h0TWFya2VycylbaV1bXCJsbmdcIl0pXG4gICAgICB9XG4gICAgICAvLyBhc3NpZ24gdGhlIGV4dGVudCB2YWx1ZXMgdG8gc2NvcGUgdmFyaWFibGUgdG8gZGlwbGF5IG9uIHBhZ2VcbiAgICAgIHZtLm1pbnggPSBwYXJzZUZsb2F0KE1hdGgubWluLmFwcGx5KE1hdGgsIGxuZykudG9GaXhlZCg1KSk7XG4gICAgICB2bS5taW55ID0gcGFyc2VGbG9hdChNYXRoLm1pbi5hcHBseShNYXRoLCBsYXQpLnRvRml4ZWQoNSkpO1xuICAgICAgdm0ubWF4eCA9IHBhcnNlRmxvYXQoTWF0aC5tYXguYXBwbHkoTWF0aCwgbG5nKS50b0ZpeGVkKDUpKTtcbiAgICAgIHZtLm1heHkgPSBwYXJzZUZsb2F0KE1hdGgubWF4LmFwcGx5KE1hdGgsIGxhdCkudG9GaXhlZCg1KSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW4gYSBjb21iaW5hdGlvbiBvZiBsZWFmbGV0LCB1aS1sZWFmbGV0LCBzaWRlbmF2IGFuZCBtZC1zZWxlY3RcbiAgICAgKiB3aGVuIHRoZSBtZC1zZWxlY3QgZHJvcCBkb3duIG9wdGlvbnMgYXJlIG9wZW4gYW5kIHRoZSB1c2VyIGNsaWNrc1xuICAgICAqIG91dHNpZGUgdGhlIG9wdGlvbnMgb3ZlcmxheSwgdGhlIG1kLXNlbGVjdCBpcyBub3QgYmVlbiBjbG9zZWQgYXV0b21hdGljYWxseVxuICAgICAqIFNvLCBmb3IgaW5zdGFuY2Ugd2UgaGFkIHRvIGNyZWF0ZSB0aGlzIGhhY2sgdW50aWwgd2UgZmluZCBhIG5pY2Ugc29sdXRpb24gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gbW9uaXRvckNsb3NlU2VsZWN0KCkge1xuICAgICAgdmFyICQkd2luZG93ID0gYW5ndWxhci5lbGVtZW50KCR3aW5kb3cpO1xuICAgICAgJCR3aW5kb3cub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpe1xuICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdFswXSA9PT0gJ21kLXNpZGVuYXYtbGVmdCcpIHtcbiAgICAgICAgICAkbWRTZWxlY3QuaGlkZSgpO1xuICAgICAgICB9XG4gICAgICB9KTsgICAgICBcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogU2F2ZS8vYXBwbHkgdGhlIGdlb3JlZmVyZW5jZSB0byB0aGUgbGF5ZXIvcmVzb3VyY2UgbG9hZGVkIGluIHRoZSBsZWZ0TWFwVmlld2VyXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2F2ZSgpe1xuICAgICAgLy8gY2hlY2sgZm9yIG51bWJlciBvZiBtYXJrZXJzIG9uIGJvdGggbWFwcyB0byBiZSBlcXVhbFxuICAgICAgaWYoT2JqZWN0LnZhbHVlcygkc2NvcGUuJHBhcmVudC52bS5sZWZ0TWFya2VycykubGVuZ3RoID09PSBPYmplY3QudmFsdWVzKCRzY29wZS4kcGFyZW50LnZtLnJpZ2h0TWFya2VycykubGVuZ3RoKSB7XG4gICAgICAgIC8vIGdldCB0aGUgbGF5ZXIgdGhhdCBjb250YWlucyB0aGUgcmVzb3VyY2UvbWFwIHRvIGJlIGdlb3JlZmVyZW5jZWRcbiAgICAgICAgdmFyIGxheWVyID0gTWFwTGF5ZXJTZXJ2aWNlLmdldFZpZXdlck92ZXJsYXlzKFwibGVmdE1hcFZpZXdlclwiKTtcblxuICAgICAgICAvLyBpbnN0YW50aWF0ZSB0aGUgZ2VvcmVmZXJlbmNlIHNlcnZpY2UgdGhhdCBpcyBsaW5rZWQgd2l0aCB0aGUgYmFjay1lbmQgZW5kLXBvaW50XG4gICAgICAgIHZhciBnZW9SZWYgPSBuZXcgR2VvcmVmZXJlbmNlU2VydmljZSgpO1xuXG4gICAgICAgIC8vIGdldCB0aGUgbWFya2VycyBmcm9tIGxlZnQgYW5kIHJpZ2h0IHZpZXdlcnMgZnJvbSBwYXJlbnQgY29udHJvbGxlclxuICAgICAgICBnZW9SZWYuaW1hZ2VDb29yZGluYXRlcyA9ICRzY29wZS4kcGFyZW50LnZtLmxlZnRNYXJrZXJzO1xuICAgICAgICBnZW9SZWYud29ybGRDb29yZGluYXRlcyA9ICRzY29wZS4kcGFyZW50LnZtLnJpZ2h0TWFya2VycztcbiAgICAgICAgZ2VvUmVmLnJlY3RpZnlNZXRob2QgPSB2bS5yZWN0aWZ5TWV0aG9kLmlkO1xuICAgICAgICBnZW9SZWYucmVzYW1wbGluZ01ldGhvZCA9IHZtLnJlc2FtcGxpbmdNZXRob2QuaWQ7XG5cbiAgICAgICAgLy8gY29uc29sZS5sb2coJHNjb3BlLiRwYXJlbnQudm0pO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyh2bSk7XG5cblxuICAgICAgICAvLyBnZXQgdGhlIHJlc291cmNlL21hcCBpZCBmcm9tIHRoZSBsb2FkZWQgbGF5ZXJcbiAgICAgICAgLy8gYXMgaW4gdGhlIGNhc2Ugb2YgZ2VvcmVmZXJlbmNlIG1vZHVsZSBvbmx5IG9uZSByZXNvdXJjZS9tYXAgd2lsbFxuICAgICAgICAvLyBiZSBsb2FkZWQsIHdlIGdldCB0aGUgcHJvcGVydGllcyBmcm9tIHRoZSBmaXJzdCByZXNvdXJjZSBpbiB0aGUgbGF5ZXJcblxuICAgICAgICB2YXIgZmlyc3RMYXllcktleSA9IE9iamVjdC5rZXlzKGxheWVyKVswXTsgICAgICBcbiAgICAgICAgZ2VvUmVmLm1hcElkID0gbGF5ZXJbZmlyc3RMYXllcktleV0ucmVzb3VyY2UuaWQ7XG5cbiAgICAgICAgLy8gQ29udmVydCBBdXRvQmFzZWRPbkdDUCB0byBPcmRlciBcbiAgICAgICAgdmFyIG51bUNvb3JkaW5hdGVzID0gT2JqZWN0LnZhbHVlcyhnZW9SZWYuaW1hZ2VDb29yZGluYXRlcykubGVuZ3RoO1xuICAgICAgICAoZ2VvUmVmLnJlY3RpZnlNZXRob2QgPT0gXCJBdXRvQmFzZWRPbkdDUFwiKSA/IChudW1Db29yZGluYXRlcyA+PSAzICYmIG51bUNvb3JkaW5hdGVzIDwgNikgPyBnZW9SZWYucmVjdGlmeU1ldGhvZCA9IFwiMXN0T3JkZXJQb2x5blwiIDogKG51bUNvb3JkaW5hdGVzID49IDYgJiYgbnVtQ29vcmRpbmF0ZXMgPCAxMCkgPyBnZW9SZWYucmVjdGlmeU1ldGhvZCA9IFwiMm5kT3JkZXJQb2x5blwiIDogZ2VvUmVmLnJlY3RpZnlNZXRob2QgPSBcIjNyZE9yZGVyUG9seW5cIiA6IG51bGw7XG5cbiAgICAgICAgLy8gR2V0IG5ldyBnZW9yZWZlbmNlZCBmaWxlIG5hbWUgZnJvbSB0aGUgdXNlclxuICAgICAgICAvLyBnZW9SZWYubmV3RmlsZU5hbWUgPSBwcm9tcHQoXCJFbnRlciBuZXcgZmlsZSBuYW1lLiBEZWZhdWx0IGlzIGZvbGxvd3M6XCIsIGxheWVyW2ZpcnN0TGF5ZXJLZXldLnJlc291cmNlLnRpdGxlICsgXCJfZ19cIiArIGdlb1JlZi5yZWN0aWZ5TWV0aG9kICsgXCJfXCIgKyBnZW9SZWYucmVzYW1wbGluZ01ldGhvZCArIFwiX1wiICsgKChuZXcgRGF0ZSgpKS5nZXRNb250aCgpKzEpICsgXCIuXCIgKyAobmV3IERhdGUoKSkuZ2V0RGF0ZSgpICsgXCIuXCIgKyAobmV3IERhdGUoKSkuZ2V0RnVsbFllYXIoKSk7XG4gICAgICAgIC8vIHVzZSB0aGUgZmlsZW5hbWUgZ2VuZXJhdGVkIGluIFxuICAgICAgICBnZW9SZWYubmV3RmlsZU5hbWUgPSB2bS5nZW9SZWZGaWxlbmFtZTtcbiAgICAgICAgXG4gICAgICAgIC8vIENyb3AgZmluYWwgZ2VvcmVmZXJlbmNlZCBpbWFnZVxuICAgICAgICAvKiB2YXIgbGF0ID0gW107IHZhciBsbmcgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaT0wOyBpPE9iamVjdC5rZXlzKGdlb1JlZi53b3JsZENvb3JkaW5hdGVzKS5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgbGF0LnB1c2goT2JqZWN0LnZhbHVlcyhnZW9SZWYud29ybGRDb29yZGluYXRlcylbaV1bXCJsYXRcIl0pO1xuICAgICAgICAgIGxuZy5wdXNoKE9iamVjdC52YWx1ZXMoZ2VvUmVmLndvcmxkQ29vcmRpbmF0ZXMpW2ldW1wibG5nXCJdKVxuICAgICAgICB9XG4gICAgICAgIHZhciBsbmdtaW4gPSBNYXRoLm1pbi5hcHBseShNYXRoLCBsbmcpO1xuICAgICAgICB2YXIgbGF0bWluID0gTWF0aC5taW4uYXBwbHkoTWF0aCwgbGF0KTtcbiAgICAgICAgdmFyIGxuZ21heCA9IE1hdGgubWF4LmFwcGx5KE1hdGgsIGxuZyk7XG4gICAgICAgIHZhciBsYXRtYXggPSBNYXRoLm1heC5hcHBseShNYXRoLCBsYXQpOyAqL1xuICAgICAgICAvLyBnZW9SZWYuYmJveENyb3BJbWFnZSA9IHByb21wdChcIkVudGVyIGNvb3JkaW5hdGVzIHRvIGNyb3AgdGhlIGltYWdlOiBtaW4gTG5nLCBtaW4gTGF0LCBtYXggTG5nLCBtYXggTGF0LiBEZWZhdWx0IGV4dGVudCwgYXMgc2hvd24gYmVsb3csIGlzIHNlbGVjdGVkIGJhc2VkIGZyb20gdGhlIHByb3ZpZGVkIEdDUHMuIElmIGRvbid0IHdhbnQgYW55IGNyb3BwaW5nIHRoZW4gc2ltcGx5IGRlbGV0ZSB0aGUgZGVmYXVsdCBjb29yZGluYXRlcy5cIiwgbG5nbWluICsgXCIgXCIgKyBsYXRtaW4gKyBcIiBcIiArIGxuZ21heCArIFwiIFwiICsgbGF0bWF4KTtcbiAgICAgICAgaWYoJHNjb3BlLmV4dGVudFNlbGVjdGlvbj09JzAnKSB7XG4gICAgICAgICAgZ2VvUmVmLmJib3hDcm9wSW1hZ2UgPSBcIlwiO1xuICAgICAgICB9IFxuICAgICAgICAvLyBpZiBleHRlbnQgaXMgYnkgdmFsdWVzIHByb3ZpZGVkIGJ5IHRoZSB1c2VyIHRoZW4ganVzdCBzZW5kIDQgcGFyYW1zIHRvIC9hcHBseSBBUElcbiAgICAgICAgZWxzZSBpZigkc2NvcGUuZXh0ZW50U2VsZWN0aW9uPT0nMScpIHtcbiAgICAgICAgICBnZW9SZWYuYmJveENyb3BJbWFnZSA9IHZtLm1pbnggK1wiIFwiKyB2bS5taW55ICtcIiBcIisgdm0ubWF4eCArXCIgXCIrIHZtLm1heHk7XG4gICAgICAgIH0gXG4gICAgICAgIC8vIGlmIGV4dGVudCBpcyBieSBkcmF3aW5nIGEgcmVjdGFuZ2xlIG9uIG1hcCB0aGVuIHNlbmQgOCBwYXJhbXMgdG8gL2FwcGx5IEFQSVxuICAgICAgICBlbHNlIGlmKCRzY29wZS5leHRlbnRTZWxlY3Rpb249PScyJykge1xuICAgICAgICAgIGdlb1JlZi5iYm94Q3JvcEltYWdlID0gXG4gICAgICAgICAgICB2bS5taW54ICtcIiBcIisgdm0ubWlueSArXCIgXCIrXG4gICAgICAgICAgICB2bS5tYXh4ICtcIiBcIisgdm0ubWlueSArXCIgXCIrXG4gICAgICAgICAgICB2bS5tYXh4ICtcIiBcIisgdm0ubWF4eSArXCIgXCIrXG4gICAgICAgICAgICB2bS5taW54ICtcIiBcIisgdm0ubWF4eTtcbiAgICAgICAgfVxuICAgICAgICAvLyBjb25zb2xlLmxvZyhnZW9SZWYuYmJveENyb3BJbWFnZSlcblxuICAgICAgICBnZW9SZWYuYXBwbHlFbmRQb2ludCA9ICcvaGVpbWFwL2dlb3JlZi9hcHBseSc7XG4gICAgICAgIGdlb1JlZi4kc2F2ZSgpXG4gICAgICAgIC8vIGdlb1JlZi5zYXZlR2VvUmVmKClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0KXtcblxuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3VsdC5pZClcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhhbmd1bGFyLmlzRGVmaW5lZChyZXN1bHQuaWQpKVxuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwienpcIik7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQocmVzdWx0LmlkKSl7XG4gICAgICAgICAgICBjbG9zZSgpO1xuICAgICAgICAgICAgQzJUb2FzdC5zdWNjZXNzKCR0cmFuc2xhdGUuaW5zdGFudCgnbWVzc2FnZXMuc2F2ZUdlb3JlZmVyZW5jZVN1Y2Nlc3MnKSk7XG4gICAgICAgICAgfSBcblxuICAgICAgICAgIGZvcih2YXIgaT0wOyBpIDwgbnVtQ29vcmRpbmF0ZXM7IGkrKyl7XG4gICAgICAgICAgICBkZWxldGUgJHNjb3BlLiRwYXJlbnQudm0ubGVmdE1hcmtlcnNbT2JqZWN0LnZhbHVlcygkc2NvcGUuJHBhcmVudC52bS5sZWZ0TWFya2VycylbMF1bXCJpZFwiXV1cbiAgICAgICAgICAgIGRlbGV0ZSAkc2NvcGUuJHBhcmVudC52bS5yaWdodE1hcmtlcnNbT2JqZWN0LnZhbHVlcygkc2NvcGUuJHBhcmVudC52bS5yaWdodE1hcmtlcnMpWzBdW1wiaWRcIl1dXG4gICAgICAgICAgfTtcblxuICAgICAgICAgIC8vVE9ETzogXG4gICAgICAgICAgLyogdXBkYXRlIHRoZSB2aWV3ZXIgc3RhdGUgd2l0aCB0aGUgZ2VvcmVmZXJlbmNlZCByZXNvdXJjZVxuICAgICAgICAgICAgICByZXNldCB0aGUgR0NQXG4gICAgICAgICAgKi9cbiAgICAgICAgICAvKiB2YXIgd2hlcmVUb0dvID0gcHJvbXB0KFwiRW50ZXIgeW91ciBuZXh0IGFjdGlvbjogMSB0byB2aWV3IHJlY2VudGx5IGdlb3JlZmVyZW5jZWQgaW1hZ2UgYW5kL29yIGdlb3JlZmVyZW5jZSBhbm90aGVyIGltYWdlIGFuZCAyIHRvIHVwbG9hZCBuZXcgaW1hZ2VcIiwgXCIxXCIpO1xuXG4gICAgICAgICAgc3dpdGNoKHdoZXJlVG9Hbyl7XG4gICAgICAgICAgICBjYXNlIFwiMVwiOiBcbiAgICAgICAgICAgICAgTWFwTGF5ZXJTZXJ2aWNlLnJlbW92ZUFsbE1hcExheWVycyhcImxlZnRNYXBWaWV3ZXJcIik7IFxuICAgICAgICAgICAgICBNYXBMYXllclNlcnZpY2UuYWRkTWFwTGF5ZXIocmVzdWx0LCBcInJpZ2h0TWFwVmlld2VyXCIpOyBcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiMlwiOiBcbiAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJyMhL21hcCc7IFxuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9ICovXG5cbiAgICAgICAgICAvLyAvLyBmaXJlIGV2ZW50IHRvIEdDUCBjb250cm9sbGVyIGZvciBjYWxsIHJlZnJlc2hHQ1BUYWJsZVxuICAgICAgICAgIC8vICRyb290U2NvcGUuJGJyb2FkY2FzdChcInJlZnJlc2hHY3BUYWJsZUV2ZW50XCIpO1xuICAgICAgICAgIC8vIGNyZWF0ZSBwb3B1cCBib3hcbiAgICAgICAgICB2YXIgY29uZmlybSA9ICRtZERpYWxvZy5jb25maXJtKClcbiAgICAgICAgICAgIC50aXRsZSgnTmV4dCBBY3Rpb24/JylcbiAgICAgICAgICAgIC50ZXh0Q29udGVudCgnVmlldyByZWNlbnRseSBnZW9yZWZlcmVuY2VkIGltYWdlIGFuZC9vciBnZW9yZWZlcmVuY2UgYW5vdGhlciBpbWFnZSBPUiB1cGxvYWQgYSBuZXcgaW1hZ2UnKVxuICAgICAgICAgICAgLy8gLmFyaWFMYWJlbCgnTHVja3kgZGF5JylcbiAgICAgICAgICAgIC5vaygnTG9hZCBpdCBpbiBSaWdodCBNYXAnKVxuICAgICAgICAgICAgLmNhbmNlbCgnVXBsb2FkIGEgbmV3IGZpbGUnKTtcblxuICAgICAgICAgICRtZERpYWxvZy5zaG93KGNvbmZpcm0pLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIkxvYWQgaW4gcmlnaHQgbWFwIGNsaWNrZWRcIik7XG4gICAgICAgICAgICAvLyBNYXBMYXllclNlcnZpY2UucmVtb3ZlQWxsTWFwTGF5ZXJzKFwibGVmdE1hcFZpZXdlclwiKTsgXG4gICAgICAgICAgICAvLyBNYXBMYXllclNlcnZpY2UuYWRkTWFwTGF5ZXIocmVzdWx0LCBcInJpZ2h0TWFwVmlld2VyXCIpOyBcbiAgICAgICAgICAgIC8vIHJlc29sdmluZyBEaXJrJ3MgcmVxdWVzdCBtZW5pdG9uZWQgaW4gIzE4MlxuICAgICAgICAgICAgLy8gcmVzb2x2aW5nICMyMDggd2l0aCB1c2Ugb2YgbG9jYWxzdG9yYWdlXG4gICAgICAgICAgICB2YXIgdGVtcExlZnRMYXllciA9IGxheWVyW09iamVjdC5rZXlzKGxheWVyKVswXV0ucmVzb3VyY2U7XG4gICAgICAgICAgICAvLyBkZWxldGUgaXQgYmVjYXVzZSBpdCBoYXMgcmVmZXJlbmNlIHRvIG90aGVyIE1vZGVscywgd2hpY2ggY3JlYXRlcyBhIGNpcmN1bGFyIEpTT05cbiAgICAgICAgICAgIGlmKHR5cGVvZiB0ZW1wTGVmdExheWVyLiQkYXJyYXkgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgZGVsZXRlIHRlbXBMZWZ0TGF5ZXIuJCRhcnJheTsgIFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGxvY2FsU3RvcmFnZS5zZXRPYmplY3QoXCJub25nZW9yZWZMYXllclwiLCB0ZW1wTGVmdExheWVyKTtcbiAgICAgICAgICAgICRsb2NhbFN0b3JhZ2Uuc2V0T2JqZWN0KFwiZ2VvcmVmTGF5ZXJcIiwgcmVzdWx0KTtcbiAgICAgICAgICAgICRzdGF0ZS5yZWxvYWQoKTtcbiAgICAgICAgICB9LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwidXBsb2FkIGEgbmV3IGZpbGVcIik7XG4gICAgICAgICAgICAvLyBjaGFuZ2UgYXBwIHN0YXRlIHRvIG1hcCwgZmlyc3QgcGFnZSBvZiBhcHBcbiAgICAgICAgICAgICRzdGF0ZS5nbygnYXBwLm1hcCcpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICB9LCBmdW5jdGlvbihlcnIpe1xuICAgICAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICAgICAgICAvLyB0aGUgY29kZSBpbnNpZGUgdGhpcyBibG9jayB3aWxsIGJlIGZpcmVkIGlmIHNvbWUgZXJyb3Igb2NjdXJcbiAgICAgICAgICAvLyBoZXJlIHlvdSBjYW4gc2hvdyBzb21lIGVycm9yIG1lc3NhZ2Ugb3IgZG8gbm90aGluZywgZGVwZW5kaW5nIG9uIHRoZSBidXNpbmVzcyBydWxlXG5cbiAgICAgICAgICAvL1RPRE86IG5vdGlmeSB0aGUgdXNlciBhYm91dCB0aGUgZXJyb3I/XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgICB0aXRsZTogJHRyYW5zbGF0ZS5pbnN0YW50KCdkaWFsb2cuaW52YWxpZEdlb3JlZlRpdGxlJyksXG4gICAgICAgICAgZGVzY3JpcHRpb246ICR0cmFuc2xhdGUuaW5zdGFudCgnZGlhbG9nLmludmFsaWRHZW9yZWZUZXh0JyksXG4gICAgICAgICAgdG9vbGJhckJnQ29sb3I6JG1kQ29sb3JzLmdldFRoZW1lQ29sb3IoJ3ByaW1hcnknKSxcbiAgICAgICAgICBva0JnQ29sb3I6JG1kQ29sb3JzLmdldFRoZW1lQ29sb3IoJ3ByaW1hcnknKSxcbiAgICAgICAgICBvazogJHRyYW5zbGF0ZS5pbnN0YW50KCdnbG9iYWwub2snKVxuICAgICAgICB9O1xuICAgICAgICBDMkRpYWxvZy5hbGVydChjb25maWcpO1xuICAgICAgfVxuICAgIH1cbiAgIFxuICAgIC8qKlxuICAgICAqIFNob3cgdGhlIEdDUCB0YWJsZSBpbiBhIHByZXZpZXcgdGFibGVcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBwcmV2aWV3R2NwKCkge1xuICAgICAgLy8gY2hlY2sgZm9yIG51bWJlciBvZiBtYXJrZXJzIG9uIGJvdGggbWFwcyB0byBiZSBlcXVhbFxuICAgICAgaWYoT2JqZWN0LnZhbHVlcygkc2NvcGUuJHBhcmVudC52bS5sZWZ0TWFya2VycykubGVuZ3RoID09PSBPYmplY3QudmFsdWVzKCRzY29wZS4kcGFyZW50LnZtLnJpZ2h0TWFya2VycykubGVuZ3RoKSB7XG4gICAgICAgIGlmKHZtLnJlY3RpZnlNZXRob2QgJiYgdm0ucmVzYW1wbGluZ01ldGhvZCkge1xuICAgICAgICAgIC8vIGdldCB0aGUgbGF5ZXIgdGhhdCBjb250YWlucyB0aGUgcmVzb3VyY2UvbWFwIHRvIGJlIGdlb3JlZmVyZW5jZWRcbiAgICAgICAgICB2YXIgbGF5ZXIgPSBNYXBMYXllclNlcnZpY2UuZ2V0Vmlld2VyT3ZlcmxheXMoXCJsZWZ0TWFwVmlld2VyXCIpO1xuXG4gICAgICAgICAgLy8gaW5zdGFudGlhdGUgdGhlIGdlb3JlZmVyZW5jZSBzZXJ2aWNlIHRoYXQgaXMgbGlua2VkIHdpdGggdGhlIGJhY2stZW5kIGVuZC1wb2ludFxuICAgICAgICAgIHZhciBnZW9SZWYgPSBuZXcgR2VvcmVmZXJlbmNlU2VydmljZSgpO1xuXG4gICAgICAgICAgLy8gZ2V0IHRoZSBtYXJrZXJzIGZyb20gbGVmdCBhbmQgcmlnaHQgdmlld2VycyBmcm9tIHBhcmVudCBjb250cm9sbGVyXG4gICAgICAgICAgZ2VvUmVmLmltYWdlQ29vcmRpbmF0ZXMgPSAkc2NvcGUuJHBhcmVudC52bS5sZWZ0TWFya2VycztcbiAgICAgICAgICBnZW9SZWYud29ybGRDb29yZGluYXRlcyA9ICRzY29wZS4kcGFyZW50LnZtLnJpZ2h0TWFya2VycztcbiAgICAgICAgICBnZW9SZWYucmVjdGlmeU1ldGhvZCA9IHZtLnJlY3RpZnlNZXRob2QuaWQ7XG4gICAgICAgICAgZ2VvUmVmLnJlc2FtcGxpbmdNZXRob2QgPSB2bS5yZXNhbXBsaW5nTWV0aG9kLmlkO1xuXG4gICAgICAgICAgLy8gZ2V0IHRoZSByZXNvdXJjZS9tYXAgaWQgZnJvbSB0aGUgbG9hZGVkIGxheWVyXG4gICAgICAgICAgLy8gYXMgaW4gdGhlIGNhc2Ugb2YgZ2VvcmVmZXJlbmNlIG1vZHVsZSBvbmx5IG9uZSByZXNvdXJjZS9tYXAgd2lsbFxuICAgICAgICAgIC8vIGJlIGxvYWRlZCwgd2UgZ2V0IHRoZSBwcm9wZXJ0aWVzIGZyb20gdGhlIGZpcnN0IHJlc291cmNlIGluIHRoZSBsYXllclxuXG4gICAgICAgICAgdmFyIGZpcnN0TGF5ZXJLZXkgPSBPYmplY3Qua2V5cyhsYXllcilbMF07ICAgICAgXG4gICAgICAgICAgZ2VvUmVmLm1hcElkID0gbGF5ZXJbZmlyc3RMYXllcktleV0ucmVzb3VyY2UuaWQ7XG5cbiAgICAgICAgICAvLyBDb252ZXJ0IEF1dG9CYXNlZE9uR0NQIHRvIE9yZGVyIFxuICAgICAgICAgIHZhciBudW1Db29yZGluYXRlcyA9IE9iamVjdC52YWx1ZXMoZ2VvUmVmLmltYWdlQ29vcmRpbmF0ZXMpLmxlbmd0aDtcbiAgICAgICAgICAoZ2VvUmVmLnJlY3RpZnlNZXRob2QgPT0gXCJBdXRvQmFzZWRPbkdDUFwiKSA/IChudW1Db29yZGluYXRlcyA+PSAzICYmIG51bUNvb3JkaW5hdGVzIDwgNikgPyBnZW9SZWYucmVjdGlmeU1ldGhvZCA9IFwiMXN0T3JkZXJQb2x5blwiIDogKG51bUNvb3JkaW5hdGVzID49IDYgJiYgbnVtQ29vcmRpbmF0ZXMgPCAxMCkgPyBnZW9SZWYucmVjdGlmeU1ldGhvZCA9IFwiMm5kT3JkZXJQb2x5blwiIDogZ2VvUmVmLnJlY3RpZnlNZXRob2QgPSBcIjNyZE9yZGVyUG9seW5cIiA6IG51bGw7XG5cbiAgICAgICAgICAvLyBHZXQgbmV3IGdlb3JlZmVuY2VkIGZpbGUgbmFtZSBmcm9tIHRoZSB1c2VyXG4gICAgICAgICAgZ2VvUmVmLm5ld0ZpbGVOYW1lID0gdm0uZ2VvUmVmRmlsZW5hbWU7XG5cbiAgICAgICAgICAvLyBDcm9wIGZpbmFsIGdlb3JlZmVyZW5jZWQgaW1hZ2VcbiAgICAgICAgICBpZih2bS5tYW51YWxFeHRlbnQpIHtcbiAgICAgICAgICAgIGdlb1JlZi5iYm94Q3JvcEltYWdlID0gdm0ubWlueCArXCIgXCIrIHZtLm1pbnkgK1wiIFwiKyB2bS5tYXh4ICtcIiBcIisgdm0ubWF4eTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGdlb1JlZi5iYm94Q3JvcEltYWdlKVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBnZW9SZWYuYmJveENyb3BJbWFnZSA9IFwiXCI7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdwcmV2aWV3R2NwJywgZ2VvUmVmKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBjbG9zaW5nIGxlZnQgc2lkZW5hdiBzaW5jZSBpdCB3YXMgb3ZlcmxhcGluZyBhbGVydCBtZXNzYWdlXG4gICAgICAgICAgY2xvc2UoKTtcbiAgICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgICAgdGl0bGU6ICR0cmFuc2xhdGUuaW5zdGFudCgnZGlhbG9nLmNhbnRQcmV2aWV3R2NwdGFibGVUaXRsZScpLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICR0cmFuc2xhdGUuaW5zdGFudCgnZGlhbG9nLmNhbnRQcmV2aWV3R2NwdGFibGVUZXh0JyksXG4gICAgICAgICAgICB0b29sYmFyQmdDb2xvcjokbWRDb2xvcnMuZ2V0VGhlbWVDb2xvcigncHJpbWFyeScpLFxuICAgICAgICAgICAgb2tCZ0NvbG9yOiRtZENvbG9ycy5nZXRUaGVtZUNvbG9yKCdwcmltYXJ5JyksXG4gICAgICAgICAgICBvazogJHRyYW5zbGF0ZS5pbnN0YW50KCdnbG9iYWwub2snKVxuICAgICAgICAgIH07XG4gICAgICAgICAgQzJEaWFsb2cuYWxlcnQoY29uZmlnKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgICB0aXRsZTogJHRyYW5zbGF0ZS5pbnN0YW50KCdkaWFsb2cuaW52YWxpZEdlb3JlZlRpdGxlJyksXG4gICAgICAgICAgZGVzY3JpcHRpb246ICR0cmFuc2xhdGUuaW5zdGFudCgnZGlhbG9nLmludmFsaWRHZW9yZWZUZXh0JyksXG4gICAgICAgICAgdG9vbGJhckJnQ29sb3I6JG1kQ29sb3JzLmdldFRoZW1lQ29sb3IoJ3ByaW1hcnknKSxcbiAgICAgICAgICBva0JnQ29sb3I6JG1kQ29sb3JzLmdldFRoZW1lQ29sb3IoJ3ByaW1hcnknKSxcbiAgICAgICAgICBvazogJHRyYW5zbGF0ZS5pbnN0YW50KCdnbG9iYWwub2snKVxuICAgICAgICB9O1xuICAgICAgICBDMkRpYWxvZy5hbGVydChjb25maWcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlbW92ZUdjcFRhYmxlKCkge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gZ2UubGVmdC5zaWRlbmF2LmNvbnRyb2xsZXIgPj4+IHJlbW92ZUdjcFRhYmxlIFwiKTtcbiAgICAgIGFuZ3VsYXIuZWxlbWVudCggZG9jdW1lbnQucXVlcnlTZWxlY3RvciggJyNnY3BUYWJsZScgKSApLmVtcHR5KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFN0YXJ0cyB0aGUgZHJhd2luZyBpbnRlcmFjdGlvbiB0byBkcmF3IGEgcmVjdGFuZ2xlIG9uIGxlZnQgbWFwIHRvIGNyb3AgdGhlIGltYWdlXG4gICAgICogXG4gICAgICogQWx0ZXJuYXRpdmVseSwgQ09NTUVOVEVEIENPREUgaXMgZm9yIHNob3dpbmcgdGhlIGV4dGVudCByZWN0YW5nbGUgb24gcmlnaHQgbWFwXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gZHJhd1JlY3RhbmdsZUZvckV4dGVudCgpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IGdlLmxlZnQuc2lkZW5hdi5jb250cm9sbGVyID4+PiBkcmF3UmVjdGFuZ2xlRm9yRXh0ZW50IFwiKTtcbiAgICAgIGNsb3NlKCk7XG4gICAgICBDMlRvYXN0LnN1Y2Nlc3MoJHRyYW5zbGF0ZS5pbnN0YW50KCdtZXNzYWdlcy5nZW9yZWZTdGFydFJlY3RhbmdsZUV4dGVudCcpKTtcbiAgICAgIHZhciB2aWV3ZXJJZCA9IFwibGVmdE1hcFZpZXdlclwiO1xuICAgICAgLy8gZGlzYmxlIG1hcmtlciBjcmVhdGlvbiBieSBmaXJpbmcgYW4gZXZlbnQgdG8gR2VvcmVmZXJlbmNlIGNvbnRyb2xsZXJcbiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgndG9nZ2xlTWFya2VyQ3JlYXRpb24nLCB7J21hcmtlcnNLZWVwZXInIDogdmlld2VySWR9KTtcbiAgICAgIFxuICAgICAgbGVhZmxldERhdGEuZ2V0TWFwKHZpZXdlcklkKS50aGVuKGZ1bmN0aW9uIChtYXApIHtcbiAgICAgICAgLy8gQXBwcm9hY2ggMiA6IGRyYXcgZXh0ZW50IHJlY3RhbmdsZSBvbiByaWdodCBNYXAgYW5kIGxldCB0aGUgdXNlciBieSBhYmxlIHRvIGVkaXQgaXRcbiAgICAgICAgLy8gaWYobWFwLmhhc0xheWVyKGRyYXduSXRlbXMpKXtcbiAgICAgICAgLy8gICBjb25zb2xlLmxvZyhkcmF3bkl0ZW1zKTtcbiAgICAgICAgLy8gfVxuICAgICAgICAvLyB2YXIgZHJhd25JdGVtcyA9IG5ldyBMLkZlYXR1cmVHcm91cCgpO1xuXG4gICAgICAgIC8vIC8vIGRyYXduSXRlbXMuZm9yRWFjaChmdW5jdGlvbihsYXllcikge1xuICAgICAgICAvLyAvLyAgIGNvbnNvbGUubG9nKGxheWVyKTtcbiAgICAgICAgLy8gLy8gICBtYXAucmVtb3ZlTGF5ZXIobGF5ZXIpO1xuICAgICAgICAvLyAvLyB9KTtcbiAgICAgICAgLy8gLy8gY3JlYXRlIGEgcmVjdGFuZ2xlIGJhc2VkIG9uIGV4dGVuZCBjYWxjdWxhdGVkXG4gICAgICAgIC8vIHZhciBleHRlbnRSZWN0ID0gTC5yZWN0YW5nbGUoW1t2bS5taW55LCB2bS5taW54XSwgW3ZtLm1heHksIHZtLm1heHhdXSkuYWRkVG8oZHJhd25JdGVtcyk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGV4dGVudFJlY3QpO1xuICAgICAgICAvLyBleHRlbnRSZWN0LnR5cGUgPSBleHRlbnRSZWN0LnR5cGUgfHwgXCJGZWF0dXJlXCI7IC8vIEludGlhbGl6ZSBmZWF0dXJlLnR5cGVcbiAgICAgICAgLy8gdmFyIHByb3BzID0gZXh0ZW50UmVjdC5wcm9wZXJ0aWVzID0gZXh0ZW50UmVjdC5wcm9wZXJ0aWVzIHx8IHt9OyAvLyBJbnRpYWxpemUgZmVhdHVyZS5wcm9wZXJ0aWVzXG4gICAgICAgIC8vIHByb3BzLnRpdGxlID0gXCJleHRlbnRSZWN0YW5nbGVGb3JDcm9wcGluZ1wiO1xuICAgICAgICAvLyAvLyBwcm9wcy5jb250ZW50ID0gXCJteSBjb250ZW50XCI7XG4gICAgICAgIC8vIGV4dGVudFJlY3QuZWRpdGluZy5lbmFibGUoKTtcbiAgICAgICAgLy8gbWFwLm9uKCdkcmF3OmVkaXRyZXNpemUnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAvLyAgIGNvbnNvbGUubG9nKFwiZHJhdzplZGl0cmVzaXplIFwiLCBlLmxheWVyKTtcbiAgICAgICAgLy8gICB2bS5taW54ID0gZS5sYXllci5nZXRCb3VuZHMoKS5nZXRXZXN0KCk7XG4gICAgICAgIC8vICAgdm0ubWlueSA9IGUubGF5ZXIuZ2V0Qm91bmRzKCkuZ2V0U291dGgoKTtcbiAgICAgICAgLy8gICB2bS5tYXh4ID0gZS5sYXllci5nZXRCb3VuZHMoKS5nZXRFYXN0KCk7XG4gICAgICAgIC8vICAgdm0ubWF4eSA9IGUubGF5ZXIuZ2V0Qm91bmRzKCkuZ2V0Tm9ydGgoKTtcbiAgICAgICAgLy8gfS5iaW5kKGRyYXduSXRlbXMpKTtcbiAgICAgICAgLy8gbWFwLmFkZExheWVyKGRyYXduSXRlbXMpO1xuICAgICAgXG4gICAgICAgIC8vIEFwcHJvYWNoIDIgOiBMZXQgdGhlIFVzZXIgZHJhdyByZWN0YW5nbGUgb24gTGVmdCBNYXBcbiAgICAgICAgLy8gRmVhdHVyZUdyb3VwIGlzIHRvIHN0b3JlIGVkaXRhYmxlIGxheWVyc1xuICAgICAgICB2YXIgZHJhd25JdGVtcyA9IG5ldyBMLkZlYXR1cmVHcm91cCgpO1xuICAgICAgICBtYXAuYWRkTGF5ZXIoZHJhd25JdGVtcyk7XG4gICAgICAgIHZhciBwb2x5Z29uRHJhd2VyID0gbmV3IEwuRHJhdy5SZWN0YW5nbGUobWFwKTsgICAgIFxuICAgICAgICBwb2x5Z29uRHJhd2VyLmVuYWJsZSgpO1xuXG4gICAgICAgIG1hcC5vbignZHJhdzpjcmVhdGVkJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICB2YXIgbGF5ZXIgPSBlLmxheWVyO1xuICAgICAgICAgIGxheWVyLnR5cGUgPSBsYXllci50eXBlIHx8IFwiRmVhdHVyZVwiOyAvLyBJbnRpYWxpemUgZmVhdHVyZS50eXBlXG4gICAgICAgICAgdmFyIHByb3BzID0gbGF5ZXIucHJvcGVydGllcyA9IGxheWVyLnByb3BlcnRpZXMgfHwge307IC8vIEludGlhbGl6ZSBmZWF0dXJlLnByb3BlcnRpZXNcbiAgICAgICAgICBwcm9wcy50aXRsZSA9IFwiZXh0ZW50UmVjdGFuZ2xlRm9yQ3JvcHBpbmdcIjtcbiAgICAgICAgICBcbiAgICAgICAgICBkcmF3bkl0ZW1zLmFkZExheWVyKGxheWVyKTtcbiAgICAgICAgICAvLyB2YXIgZHJhd3NHZW9Kc29uID0gbGF5ZXIudG9HZW9KU09OKCk7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coXCJwb3lnb24gZ2VvanNvbiA9IFwiLCBkcmF3c0dlb0pzb24pO1xuICAgICAgICAgIHZtLm1pbnggPSBsYXllci5nZXRCb3VuZHMoKS5nZXRTb3V0aFdlc3QoKS5sbmc7XG4gICAgICAgICAgdm0ubWlueSA9IGxheWVyLmdldEJvdW5kcygpLmdldFNvdXRoV2VzdCgpLmxhdDtcbiAgICAgICAgICB2bS5tYXh4ID0gbGF5ZXIuZ2V0Qm91bmRzKCkuZ2V0Tm9ydGhFYXN0KCkubG5nO1xuICAgICAgICAgIHZtLm1heHkgPSBsYXllci5nZXRCb3VuZHMoKS5nZXROb3J0aEVhc3QoKS5sYXQ7XG4gICAgICAgICAgLy8gb3BlbiB0aGUgc2lkZW5hdlxuICAgICAgICAgIC8vIG9wZW4oKTtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcInZtLm1pbnggPSBcIiwgdm0ubWlueCwgdm0ubWlueSwgdm0ubWF4eCwgdm0ubWF4eSk7XG4gICAgICAgIH0uYmluZChkcmF3bkl0ZW1zKSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKiogXG4gICAgICogSWYgYW55IHJlY3RhbmdsZSBkcmF3biBvbiBsZWZ0IG1hcCB0aGFuIGNsZWFycyBpdCBhbmQgXG4gICAgICogcmVpbml0aWFsaXplcyBtaW4sIG1heCB2YWx1ZXMgdG8gbnVsbFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNsZWFuVXAoKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBnZS5sZWZ0LnNpZGVuYXYuY29udHJvbGxlciA+Pj4gY2xlYW5VcFwiKTtcbiAgICAgIC8vIGFsd2F5IGRpc3BsYXkgZXh0ZW50IHJlY3RhbmdsZSBpbiBSaWdodCBtYXBcbiAgICAgIHZhciB2aWV3ZXJJZCA9IFwibGVmdE1hcFZpZXdlclwiO1xuICAgICAgbGVhZmxldERhdGEuZ2V0TWFwKHZpZXdlcklkKS50aGVuKGZ1bmN0aW9uIChtYXApIHtcbiAgICAgICAgbG9kYXNoLmZvckVhY2gobWFwLl9sYXllcnMsIChmZWF0dXJlKT0+IHtcbiAgICAgICAgICBpZih0eXBlb2YgZmVhdHVyZS50eXBlICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICBpZihmZWF0dXJlLnR5cGUgPT09IFwiRmVhdHVyZVwiKSB7XG4gICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGZlYXR1cmUpO1xuICAgICAgICAgICAgICAvLyBmZWF0dXJlLnJlbW92ZUZyb20oZHJhd25JdGVtcyk7XG4gICAgICAgICAgICAgIC8vIGZlYXR1cmUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgIG1hcC5yZW1vdmVMYXllcihmZWF0dXJlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICB2bS5taW54ID0gdm0ubWlueSA9IHZtLm1heHggPSB2bS5tYXh5ID0gbnVsbDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIEV4dGVudCByZWN0YW5sZyBmcm9tIFJpZ2h0IG1hcCBiZWZvcmUgZHJhd2luZyBhIG5ldyBvbmVcbiAgICAgKiAqKioqIFVudXNlZCBjb2RlLCBnb29kIGZvciBjYWxsYmFjayBleGFtcGxlXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmVtb3ZlRXh0ZW50UmVjdGFuZ2xlKGNhbGxiYWNrKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIj4+PiBnZS5sZWZ0LnNpZGVuYXYuY29udHJvbGxlciA+Pj4gcmVtb3ZlRXh0ZW50UmVjdGFuZ2xlXCIpO1xuICAgICAgLy8gYWx3YXkgZGlzcGxheSBleHRlbnQgcmVjdGFuZ2xlIGluIFJpZ2h0IG1hcFxuICAgICAgdmFyIHZpZXdlcklkID0gXCJyaWdodE1hcFZpZXdlclwiO1xuICAgICAgbGVhZmxldERhdGEuZ2V0TWFwKHZpZXdlcklkKS50aGVuKGZ1bmN0aW9uIChtYXApIHtcbiAgICAgICAgLy8gY2hlY2sgaWYgcmVjdGFuZ2xlIGFscmVhZHkgZHJhd24sIGlmIHllcyB0aGFuIHJlbW92ZSBpdFxuICAgICAgICBsb2Rhc2guZm9yRWFjaChtYXAuX2xheWVycywgKGZlYXR1cmUpPT4ge1xuICAgICAgICAgIGlmKHR5cGVvZiBmZWF0dXJlLnR5cGUgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIGlmKGZlYXR1cmUudHlwZSA9PT0gXCJGZWF0dXJlXCIpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coZmVhdHVyZSk7XG4gICAgICAgICAgICAgIC8vIGZlYXR1cmUucmVtb3ZlRnJvbShkcmF3bkl0ZW1zKTtcbiAgICAgICAgICAgICAgLy8gZmVhdHVyZS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgbWFwLnJlbW92ZUxheWVyKGZlYXR1cmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgfVxuXG4gICAgYWN0aXZhdGUoKTtcbiAgICBcbiAgfVxuXG59KSgpOyIsIi8qZXNsaW50IGFuZ3VsYXIvZmlsZS1uYW1lOiAwLCBuby11bmRlZjogMCovXHJcbihmdW5jdGlvbigpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIGFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29uc3RhbnQoJ2VuLUdCLmkxOG4uYXR0cmlidXRlcycsIHtcclxuICAgICAgZW1haWw6ICdFbWFpbCcsXHJcbiAgICAgIHBhc3N3b3JkOiAnUGFzc3dvcmQnLFxyXG4gICAgICBuYW1lOiAnTmFtZScsXHJcbiAgICAgIGltYWdlOiAnSW1hZ2UnLFxyXG4gICAgICByb2xlczogJ1Byb2ZpbGVzJyxcclxuICAgICAgZGF0ZTogJ0RhdGUnLFxyXG4gICAgICBpbml0aWFsRGF0ZTogJ0luaXRpYWwgZGF0ZScsXHJcbiAgICAgIGZpbmFsRGF0ZTogJ0VuZCBkYXRlJyxcclxuICAgICAgdGl0bGU6ICdUaXRsZScsXHJcbiAgICAgIG1hcFR5cGU6ICdNYXAgdHlwZScsXHJcbiAgICAgIHByb2plY3Rpb246ICdQcm9qZWN0aW9uJyxcclxuICAgICAgZ2VvcmVmZXJlbmNlZDogJ0dlb3JlZmVyZW5jZWQnLFxyXG4gICAgICBpc0dlb3JlZmVyZW5jZWQ6ICdJcyBnZW9yZWZlcmVuY2VkJyxcclxuICAgICAgaXNOb3RHZW9yZWZlcmVuY2VkOiAnSXMgbm90IGdlb3JlZmVyZW5jZWQnLFxyXG4gICAgICBtYXBPcHRpb25zOiAnTWFwIG9wdGlvbnMnLCAgICAgICAgICBcclxuICAgICAgdmVyaWZpZWQ6ICdWZXJpZmllZCcsXHJcbiAgICAgIHJlY3RpZnlNZXRob2Q6ICdSZWN0aWZ5IG1ldGhvZCcsXHJcbiAgICAgIHJlc2FtcGxpbmdNZXRob2Q6ICdSZXNhbXBsaW5nIG1ldGhvZCcsXHJcbiAgICAgIGVudGVyR2VvcmVmRmlsZU5hbWU6ICdHZW9yZWZlcmVuY2VkIGZpbGUgbmFtZScsXHJcbiAgICAgIGV4dGVudEdlb1JlZjogJ0VudGVyIGNvb3JkaW5hdGVzIHRvIGNyb3AgdGhlIGltYWdlOiBtaW4gTG5nLCBtaW4gTGF0LCBtYXggTG5nLCBtYXggTGF0LiBEZWZhdWx0IGV4dGVudCwgYXMgc2hvd24gYmVsb3csIGlzIHNlbGVjdGVkIGJhc2VkIGZyb20gdGhlIHByb3ZpZGVkIEdDUHMuIElmIGRvblxcJ3Qgd2FudCBhbnkgY3JvcHBpbmcgdGhlbiBzaW1wbHkgZGVsZXRlIHRoZSBkZWZhdWx0IGNvb3JkaW5hdGVzJyxcclxuICAgICAgbWlueDogJ1dlc3QnLFxyXG4gICAgICBtaW55OiAnU291dGgnLFxyXG4gICAgICBtYXh4OiAnRWFzdCcsXHJcbiAgICAgIG1heHk6ICdOb3J0aCcsXHJcbiAgICAgIGNyb3BJbWFnZTogJ0Nyb3AgSW1hZ2UgYmFzZWQgb24gRXh0ZW50IFZhbHVlcz8nLFxyXG4gICAgICBjcm9wSW1hZ2VCeURyYXc6ICdDcm9wIEltYWdlIGJhc2VkIGJ5IGRyYXdpbmcgb24gbWFwPycsXHJcbiAgICAgIGNyb3BJbWFnZU5vbmU6ICdOb25lJyxcclxuICAgICAgcHJldmlld0dDUDogJ1Nob3cgR0NQIFRhYmxlJyxcclxuICAgICAgc2hvd09ubHlDaGlsZE1hcDogJ1Nob3cgb25seSBNYXBzIHdoaWNoIHVzZWQgdGhlIGxvYWRlZCBOb25HZW9yZWZlcmVuY2VkIGltYWdlJyxcclxuICAgICAgZGVzY3JpcHRpb246ICdEZXNjcmlwdGlvbicsXHJcbiAgICAgIGdhenpUeXBlOiAnQ1JNIEVudGl0eSBUeXBlJyxcclxuICAgICAgYnVpbGRpbmdUeXBlOiAnQnVpZGxpbmcgVHlwZScsXHJcbiAgICAgIHN0YXRlOiAnU3RhdGUnLFxyXG4gICAgICBjb3VudHJ5OiAnQ291bnRyeScsXHJcbiAgICAgIHRpbWVTcGFuOiAnVGltZSBTcGFuJyxcclxuICAgICAgbWF0ZXJpYWw6ICdNYXRlcmlhbCcsXHJcbiAgICAgIHJlZkRvY3VtZW50OiAnRG9jdW1lbnQgUmVmZXJlbmNlJyxcclxuICAgICAgY3JlYXRlZERhdGU6ICdDcmVhdGVkIERhdGUnLFxyXG4gICAgICBraW5nOiAnS2luZycsXHJcbiAgICAgIHRpdGxlOiAnVGl0bGUnXHJcbiAgICB9KVxyXG5cclxufSgpKTtcclxuIiwiLyplc2xpbnQgYW5ndWxhci9maWxlLW5hbWU6IDAsIG5vLXVuZGVmOiAwKi9cclxuKGZ1bmN0aW9uKCkge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb25zdGFudCgnZW4tR0IuaTE4bi5kaWFsb2cnLCB7XHJcbiAgICAgIGNvbmZpcm1UaXRsZTogJ0NvbmZpcm0/JyxcclxuICAgICAgY29uZmlybURlc2NyaXB0aW9uOiAnQ29uZmlybSBhY3Rpb24/JyxcclxuICAgICAgY29uZmlybUxvYWRVbmdlb3JlZmVyZW5jZWRUaXRsZTogJ0NvbmZpcm0gbG9hZCB1bmdlb3JlZmVyZW5jZWQgbWFwJyxcclxuICAgICAgY29uZmlybUxvYWRHZW9yZWZlcmVuY2VkVGl0bGU6ICdDb25maXJtIGxvYWQgZ2VvcmVmZXJlbmNlZCBtYXAnLFxyXG4gICAgICBMb2FkVW5nZW9yZWZlcmVuY2VkRGVzY3JpcHRpb246ICdJZiB5b3UgbG9hZCB0aGlzIHVuZ2VvcmVmZXJlbmNlZCBtYXAgYWxsIGJhc2UgbGF5ZXJzIGFuZCBvdGhlciBtYXBzIHdpbGwgYmUgcmVtb3ZlZCBmcm9tIHRoZSB2aWV3ZXIuIERvIHlvdSB3YW50IHRvIHByb2NlZWQ/JyxcclxuICAgICAgTG9hZEdlb3JlZmVyZW5jZWREZXNjcmlwdGlvbjogJ0lmIHlvdSBsb2FkIHRoaXMgZ2VvcmVmZXJlbmNlZCBtYXAgY3VycmVudCB1bmdlb3JlZmVyZW5jZWQgbGF5ZXJzIHdpbGwgYmUgcmVtb3ZlZCBmcm9tIHRoZSB2aWV3ZXIuIERvIHlvdSB3YW50IHRvIHByb2NlZWQ/JyxcclxuICAgICAgcmVtb3ZlRGVzY3JpcHRpb246ICdEbyB5b3Ugd2FudCB0byByZW1vdmUgcGVybWFuZW50bHkge3tuYW1lfX0/JyxcclxuICAgICAgaW52YWxpZEdlb3JlZlRpdGxlOiAnSW52YWxpZCBudW1iZXIgb2YgR3JvdW5kIENvbnRyb2wgUG9pbnRzJywgIFxyXG4gICAgICBpbnZhbGlkR2VvcmVmVGV4dDogJ1NhbWUgbnVtYmVyIG9mIEdyb3VuZCBDb250cm9sIFBvaW50cyBhbmQgYSBtaW5pbXVtIG9mIDMgR3JvdW5kIENvbnRyb2wgUG9pbnRzIGlzIHJlcXVpcmVkIGluIGVhY2ggdmlld2VyIHRvIGdlb3JlZmVyZW5jZSBhIG1hcCcsICAgICBcclxuICAgICAgbG9naW46IHtcclxuICAgICAgICByZXNldFBhc3N3b3JkOiB7XHJcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ1R5cGUgeW91ciByZWdpc3RlcmVkIGUtbWFpbCBpbiB0aGUgc3lzdGVtLidcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGNhbnRMb2FkVGl0bGU6ICdDYW5cXCd0IGxpbmsgQm90aCB0aGUgbWFwcycsXHJcbiAgICAgIGNhbnRMb2FkRGVzY3JpcHRpb246ICdDYW5cXCd0IGxpbmsgbWFwcyBzaW5jZSBvbmUgb2YgbWFwcyBoYXMgVW5nZW9yZWZlcmVuY2VkIGltYWdlJyxcclxuICAgICAgY2FudFByZXZpZXdHY3B0YWJsZVRpdGxlOiAnU2VsZWN0IFJlY3RpZnkgTWV0aG9kIGFuZCBSZXNhbXBsaW5nIE1ldGhvZCcsXHJcbiAgICAgIGNhbnRQcmV2aWV3R2NwdGFibGVUZXh0OiAnUGxlYXNlIHNlbGVjdCBSZWN0aWZ5IE1ldGhvZCBhbmQgUmVzYW1wbGluZyBNZXRob2QgdG8gUHJldmlldyBHQ1AnXHJcbiAgICB9KVxyXG5cclxufSgpKTtcclxuIiwiLyplc2xpbnQgYW5ndWxhci9maWxlLW5hbWU6IDAsIG5vLXVuZGVmOiAwKi9cclxuKGZ1bmN0aW9uKCkge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb25zdGFudCgnZW4tR0IuaTE4bi5nbG9iYWwnLCB7XHJcbiAgICAgIGxvYWRpbmc6ICdMb2FkaW5nLi4uJyxcclxuICAgICAgcHJvY2Vzc2luZzogJ1Byb2Nlc3NpbmcuLi4nLFxyXG4gICAgICB5ZXM6ICdZZXMnLFxyXG4gICAgICBubzogJ05vJyxcclxuICAgICAgYWxsOiAnQWxsJyxcclxuICAgICAgb2s6ICdPSydcclxuICAgIH0pXHJcblxyXG59KCkpO1xyXG4iLCIvKmVzbGludCBhbmd1bGFyL2ZpbGUtbmFtZTogMCwgbm8tdW5kZWY6IDAqL1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbnN0YW50KCdlbi1HQi5pMThuLm1lc3NhZ2VzJywge1xyXG4gICAgICBpbnRlcm5hbEVycm9yOiAnSW50ZXJuYWwgZXJyb3IuIGNvbnRhY3QgdGhlIHN5c3RlbSBhZG1pbicsXHJcbiAgICAgIG1hcEZpbGVJc01hbmRhdG9yeTogJ1NlbGVjdCBhIG1hcCBmaWxlIGlzIG1hbmRhdG9yeScsXHJcbiAgICAgIGludmFsaWRJbWFnZUZpbGU6ICdGaWxlIHNlbGVjdGVkIGlzIG5vdCBhIHZhbGlkIGltYWdlIGZpbGUnLFxyXG4gICAgICBmaWxlVG9vQmlnOiAnRmlsZSBzZWxlY3RlZCBpcyB0b28gYmlnJyxcclxuICAgICAgbm90Rm91bmQ6ICdOb3QgZm91bmQnLFxyXG4gICAgICBub3RBdXRob3JpemVkOiAnWW91IGRvIG5vdCBoYXZlIGFjY2VzcyB0byB0aGlzIGZ1bmN0aW9uYWxpdHkuJyxcclxuICAgICAgc2VhcmNoRXJyb3I6ICdTZWFyY2ggZXJyb3IuJyxcclxuICAgICAgc2F2ZVN1Y2Nlc3M6ICdJdGVtIHNhdmVkIHN1Y2Nlc3NmdWxseS4nLFxyXG4gICAgICBzYXZlR2VvcmVmZXJlbmNlU3VjY2VzczogJ0ltYWdlIGhhcyBiZWVuIHJlY3RpZmllZC4nLFxyXG4gICAgICBvcGVyYXRpb25TdWNjZXNzOiAnT3BlcmF0aW9uIGRvbmUgd2l0aCBzdWNjZXNzLicsXHJcbiAgICAgIG9wZXJhdGlvbkVycm9yOiAnRXJyb3Igd2hpbGUgZG9pbmcgdGhlIG9wZXJhdGlvbicsXHJcbiAgICAgIHNhdmVFcnJvcjogJ0Vycm9yIHdoaWxlIHRyeWluZyB0byBzYXZlIHRoZSBpdGVtLicsXHJcbiAgICAgIHJlbW92ZVN1Y2Nlc3M6ICdSZW1vdmFsIGRvbmUgd2l0aCBzdWNjZXNzLicsXHJcbiAgICAgIHJlbW92ZUVycm9yOiAnRXJyb3Igd2hpbGUgdHJ5aW5nIHRvIHJlbW92ZSB0aGUgaXRlbS4nLFxyXG4gICAgICByZXNvdXJjZU5vdEZvdW5kRXJyb3I6ICdJdGVtIG5vdCBmb3VuZCcsXHJcbiAgICAgIG5vdE51bGxFcnJvcjogJ0FsbCB0aGUgbWFuZGF0b3J5IGZpZWxkcyBtdXN0IGJlIGZpbGxlZC4nLFxyXG4gICAgICBkdXBsaWNhdGVkUmVzb3VyY2VFcnJvcjogJ0FscmVhZHkgZXhpc3RzIGFuIGl0ZW0gd2l0aCB0aGVzZSBkYXRhLicsXHJcbiAgICAgIGRlbGV0ZUxheWVyVGl0bGU6ICdEZWxldGUgTGF5ZXI/JyxcclxuICAgICAgZGVsZXRlTGF5ZXJNZXNzYWdlOiAnV291bGQgeW91IGxpa2UgdG8gRGVsZXRlIGxheWVyPycsXHJcbiAgICAgIHllczogJ1llcycsXHJcbiAgICAgIG5vOiAnTm8nLFxyXG4gICAgICB2YWxpZGF0ZToge1xyXG4gICAgICAgIGZpZWxkUmVxdWlyZWQ6ICdUaGUgZmllbGQge3tmaWVsZH19IGlzIG1hbmRhdG9yeS4nXHJcbiAgICAgIH0sXHJcbiAgICAgIGxheW91dDoge1xyXG4gICAgICAgIGVycm9yNDA0OiAnUGFnZSBubyBmb3VuZCdcclxuICAgICAgfSxcclxuICAgICAgbG9naW46IHtcclxuICAgICAgICBsb2dvdXRJbmFjdGl2ZTogJ1lvdSBoYXZlIGJlZW4gbG9nZ2VkIG91dC4gTG9naW4gYWdhaW4uJyxcclxuICAgICAgICBpbnZhbGlkQ3JlZGVudGlhbHM6ICdJbnZhbGlkIGNyZWRlbnRpYWxzJyxcclxuICAgICAgICB1bmtub3duRXJyb3I6ICdJdCB3YXMgbm90IHBvc3NpYmxlIHRvIGxvZyB5b3UgaW4uICcgK1xyXG4gICAgICAgICAgJ1RyeSBhZ2Fpbi4gSWYgdGhlIGVycm9yIHBlcnNpc3RzLCBjb250YWN0IHRoZSBzeXN0ZW0gYWRtaW5pc3RyYXRvci4nLFxyXG4gICAgICAgIHVzZXJOb3RGb3VuZDogJ1VzZXIgbm90IGZvdW5kJ1xyXG4gICAgICB9LFxyXG4gICAgICBkYXNoYm9hcmQ6IHtcclxuICAgICAgICB3ZWxjb21lOiAnV2VsY29tZSB7e3VzZXJOYW1lfX0nLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVXNlIHRoZSBmb3IgbmF2aWdhdGlvbi4nXHJcbiAgICAgIH0sXHJcbiAgICAgIG1haWw6IHtcclxuICAgICAgICBtYWlsRXJyb3JzOiAnQW4gZXJyb3IgaGFzIG9jY3VycmVkIGluIHRoZSBmb2xsb3dpbmcgZS1tYWlsczpcXG4nLFxyXG4gICAgICAgIHNlbmRNYWlsU3VjY2VzczogJ0VtYWlsIHNlbnQgd2l0aCBzdWNjZXNzIScsXHJcbiAgICAgICAgc2VuZE1haWxFcnJvcjogJ0l0IHdhcyBub3QgcG9zc2libGUgdG8gc2VuZCB0aGUgZS1tYWlsLicsXHJcbiAgICAgICAgcGFzc3dvcmRTZW5kaW5nU3VjY2VzczogJ1RoZSBwYXNzd29yZCByZWNvdmVyIHByb2Nlc3Mgd2FzIGluaXRpYXRlZC4gSWYgdGhlIGUtbWFpbCBkb2VzIG5vdCBhcnJpdmUgaW4gMTAgbWludXRlcywgdHJ5IGFnYWluLidcclxuICAgICAgfSxcclxuICAgICAgdXNlcjoge1xyXG4gICAgICAgIHJlbW92ZVlvdXJTZWxmRXJyb3I6ICdZb3UgY2FuIG5vdCByZW1vdmUgeW91ciBvd24gdXNlci4nLFxyXG4gICAgICAgIHVzZXJFeGlzdHM6ICdVc2VyIGFscmVhZHkgZXhpc3RzIScsXHJcbiAgICAgICAgcHJvZmlsZToge1xyXG4gICAgICAgICAgdXBkYXRlRXJyb3I6ICdJdCB3YXMgbm90IHBvc3NpYmxlIHRvIHVwZGF0ZSB5b3VyIHByb2ZpbGUuJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgbWFwOiB7XHJcbiAgICAgICAgZHJvcE1hcDogJ0Ryb3AgbWFwIGhlcmUnLFxyXG4gICAgICAgIHNlbGVjdEFNYXA6ICdTZWxlY3QgYSBtYXAgaW1hZ2UnLFxyXG4gICAgICAgIHNlbGVjdEFHZW9GaWxlOiAnU2VsZWN0IGEgZ2VvIGZpbGUnLFxyXG4gICAgICAgIGNsaWNrVG9BZGQ6ICdDbGljayB0byBhZGQgYSBuZXcgbWFwJ1xyXG4gICAgICB9LFxyXG4gICAgICBnZW9yZWZTdGFydFJlY3RhbmdsZUV4dGVudDogJ0RyYXcgYSBSZWN0YW5nbGUgb24gTGVmdCBNYXAnXHJcbiAgICB9KVxyXG5cclxufSgpKTtcclxuIiwiLyplc2xpbnQgYW5ndWxhci9maWxlLW5hbWU6IDAsIG5vLXVuZGVmOiAwKi9cclxuKGZ1bmN0aW9uKCkge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb25zdGFudCgnZW4tR0IuaTE4bi5tb2RlbHMnLCB7XHJcbiAgICAgIHVzZXI6ICdVc2VyJyAgICAgIFxyXG4gICAgfSlcclxuXHJcbn0oKSk7XHJcbiIsIi8qZXNsaW50IGFuZ3VsYXIvZmlsZS1uYW1lOiAwLCBuby11bmRlZjogMCovXHJcbihmdW5jdGlvbigpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIGFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29uc3RhbnQoJ2VuLUdCLmkxOG4udmlld3MnLCB7XHJcbiAgICAgIGJyZWFkY3J1bWJzOiB7XHJcbiAgICAgICAgdXNlcjogJ1VzZSBhZG1pbicsXHJcbiAgICAgICAgJ3VzZXItcHJvZmlsZSc6ICdVc2VyIHByb2ZpbGUnLFxyXG4gICAgICAgIGRhc2hib2FyZDogJ0Rhc2hib2FyZCcsXHJcbiAgICAgICAgYXVkaXQ6ICdBdWRpdCcsXHJcbiAgICAgICAgbWFpbDogJ01haWwgc2VuZCcsXHJcbiAgICAgICAgcHJvamVjdDogJ1Byb2plY3RzJywgICAgICAgIFxyXG4gICAgICAgICdub3QtYXV0aG9yaXplZCc6ICdOb3QgYXV0aG9yaXplZCdcclxuICAgICAgfSxcclxuICAgICAgdGl0bGVzOiB7XHJcbiAgICAgICAgZGFzaGJvYXJkOiAnSG9tZSBwYWdlJyxcclxuICAgICAgICBtYWlsU2VuZDogJ1NlbmQgbWFpbCcsXHJcbiAgICAgICAgdGFza0xpc3Q6ICdUYXNrIGxpc3QnLFxyXG4gICAgICAgIHVzZXJMaXN0OiAnVXNlciBsaXN0JyxcclxuICAgICAgICBhdWRpdExpc3Q6ICdBdWRpdCBMaXN0JyxcclxuICAgICAgICByZWdpc3RlcjogJ1JlZ2lzdGVyJyxcclxuICAgICAgICByZXNldFBhc3N3b3JkOiAnUmVzZXQgcGFzc3dvcmQnLFxyXG4gICAgICAgIHVwZGF0ZTogJ1VwZGF0ZScsXHJcbiAgICAgICAgYWRkTWFwOiAnQWRkIG1hcCcsXHJcbiAgICAgICAgZWRpdE1hcDogJ0VkaXQgbWFwJyAsXHJcbiAgICAgICAgbWFwTGlzdDogJ01hcCBsaXN0JyxcclxuICAgICAgICBtYXBWaWV3OiAnTWFwIHZpZXcnLFxyXG4gICAgICAgIG1hcEVsZW1lbnRzOiAnTWFwIGVsZW1lbnRzJyxcclxuICAgICAgICBtYXBMYXllcnM6ICdNYXAgbGF5ZXJzJyxcclxuICAgICAgICBuZXdNYXA6ICdOZXcgbWFwJyxcclxuICAgICAgICBtYXBHZW9yZWZlcmVuY2luZzogJ01hcCBnZW9yZWZlcmVuY2luZycsXHJcbiAgICAgICAgc2F2ZUNvbnRyb2xQb2ludHM6ICdTYXZlIENvbnRyb2wgUG9pbnRzJyxcclxuICAgICAgICB2ZWN0b3JUaXRsZTogJ1ZlY3RvcicsXHJcbiAgICAgICAgZmVhdHVyZUF0dHI6ICdGZWF0dXJlIEF0dHJpYnV0ZScsXHJcbiAgICAgICAgbGF5ZXJMaXN0OiAnTGF5ZXIgbGlzdCcsXHJcbiAgICAgICAgYWRkTGF5ZXI6ICdBZGQgbGF5ZXInLFxyXG4gICAgICAgIGVkaXRMYXllcjogJ0VkaXQgbGF5ZXInXHJcbiAgICAgIH0sXHJcbiAgICAgIGFjdGlvbnM6IHtcclxuICAgICAgICBzZW5kOiAnU2VuZCcsXHJcbiAgICAgICAgc2F2ZTogJ1NhdmUnLFxyXG4gICAgICAgIGNsZWFyOiAnQ2xlYXInLFxyXG4gICAgICAgIGNsZWFyQWxsOiAnQ2xlYXIgYWxsJyxcclxuICAgICAgICByZXN0YXJ0OiAnUmVzdGFydCcsXHJcbiAgICAgICAgZmlsdGVyOiAnRmlsdGVyJyxcclxuICAgICAgICBzZWFyY2g6ICdTZWFyY2gnLFxyXG4gICAgICAgIGxpc3Q6ICdMaXN0JyxcclxuICAgICAgICBlZGl0OiAnRWRpdCcsXHJcbiAgICAgICAgY2FuY2VsOiAnQ2FuY2VsJyxcclxuICAgICAgICB1cGRhdGU6ICdVcGRhdGUnLFxyXG4gICAgICAgIHJlbW92ZTogJ1JlbW92ZScsXHJcbiAgICAgICAgZ2V0T3V0OiAnRXhpdCcsXHJcbiAgICAgICAgYWRkOiAnQWRkJyxcclxuICAgICAgICBpbjogJ2VudGVyJyxcclxuICAgICAgICBsb2FkSW1hZ2U6ICdMb2FkIGltYWdlJyxcclxuICAgICAgICBvcGVuOidPcGVuJyxcclxuICAgICAgICBjbG9zZTogJ0Nsb3NlJyxcclxuICAgICAgICB2aWV3OiAnVmlldycsXHJcbiAgICAgICAgZmlsdGVyTWFwczogJ0ZpbHRlciBtYXBzJyxcclxuICAgICAgICBzaG93OiAnU2hvdycsXHJcbiAgICAgICAgaGlkZTogJ0hpZGUnLFxyXG4gICAgICAgIGxvYWRNYXBJbkxlZnQ6ICdMb2FkIGluIHRoZSBsZWZ0IHZpZXdlcicsXHJcbiAgICAgICAgbG9hZE1hcEluUmlnaHQ6ICdMb2FkIGluIHRoZSByaWdodCB2aWV3ZXInLFxyXG4gICAgICAgIGhpZGVNYXBMYXllcjogJ0hpZGUgbWFwIGxheWVyJyxcclxuICAgICAgICBzaG93TWFwTGF5ZXI6ICdTaG93IG1hcCBsYXllcicsXHJcbiAgICAgICAgcmVtb3ZlTWFwTGF5ZXI6ICdSZW1vdmUgbWFwIGxheWVyJyxcclxuICAgICAgICB6b29tVG9NYXBMYXllcjogJ1pvb20gdG8gbWFwIGxheWVyJyxcclxuICAgICAgICBsb2FkZWRJbkxlZnRWaWV3ZXI6ICdMb2FkZWQgaW4gdGhlIGxlZnQgdmlld2VyJyxcclxuICAgICAgICBsb2FkZWRJblJpZ2h0Vmlld2VyOiAnTG9hZGVkIGluIHRoZSByaWdodCB2aWV3ZXInLFxyXG4gICAgICAgIHJlc2V0OiAnUmVzZXQnLFxyXG4gICAgICAgIHVubGlua0xpbms6ICdVbmxpbmsvbGluayB2aWV3ZXJzJyxcclxuICAgICAgICBzcGxpdDogJ1NwbGl0IHZpZXdlcnMnLFxyXG4gICAgICAgIHRvZ2dsZVZlcmlmaWVkOiAnSXMgb3Igbm90IGEgdmVyaWZpZWQgbWFwPycsXHJcbiAgICAgICAgdG9nZ2xlRmF2b3JpdGU6ICdUb2dnbGUgZmF2b3JpdGUnLFxyXG4gICAgICAgIHRvZ2dsZVdoZWVsWm9vbTogJ1RvZ2dsZSB3aGVlbCB6b29tJywgXHJcbiAgICAgICAgdG9nZ2xlTWFya2VyQ3JlYXRpb246ICdFbmFibGUvZGlzYWJsZSBtYXJrZXIgY3JlYXRpb24nLFxyXG4gICAgICAgIHRvZ2dsZU1hcmtlclJlbW92YWw6ICdFbmFibGUvZGlzYWJsZSBtYXJrZXIgcmVtb3ZhbCcsXHJcbiAgICAgICAgc2F2ZUdlb3JlZjogJ1NhdmUgZ2VvcmVmJyxcclxuICAgICAgICBsb2FkR2NwT25NYXA6ICdMb2FkIEdDUCBvbiBNYXAnLFxyXG4gICAgICAgIGNyZWF0ZWxheWVyOiAnTmV3IExheWVyJyxcclxuICAgICAgICBwdWJsaXNoOiAnUHVibGlzaCcsXHJcbiAgICAgICAgc2hvd0ZlYXR1cmVWZXJzaW9uOiAnU2hvdyBGZWF0dXJlcyBWZXJzaW9uIHNkZmdhc2RnYXNkIGFzZGdmYXNkZ2FzZGZnYSBhc2RnYXNkZ2Zhc2RmYXNkIGFzZGZhc2RmYXNkZmFzZCBhc2RmYXNkZmFzZGYnXHJcbiAgICAgIH0sXHJcbiAgICAgIGZpZWxkczoge1xyXG4gICAgICAgIGRhdGU6ICdEYXRlJyxcclxuICAgICAgICBhY3Rpb246ICdBY3Rpb24nLFxyXG4gICAgICAgIGFjdGlvbnM6ICdBY3Rpb25zJyxcclxuICAgICAgICBvcGFjaXR5OiAnT3BhY2l0eScsICAgICAgXHJcbiAgICAgICAgbG9naW46IHtcclxuICAgICAgICAgIHJlc2V0UGFzc3dvcmQ6ICdSZXNldCBwYXNzd29yZCcsXHJcbiAgICAgICAgICBjb25maXJtUGFzc3dvcmQ6ICdDb25maXJtIHBhc3N3b3JkJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbWFpbDoge1xyXG4gICAgICAgICAgdG86ICdUbycsXHJcbiAgICAgICAgICBzdWJqZWN0OiAnU3ViamVjdCcsXHJcbiAgICAgICAgICBtZXNzYWdlOiAnTWVzc2FnZSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHVzZXI6IHtcclxuICAgICAgICAgIHByb2ZpbGU6ICdQcm9maWxlcycsXHJcbiAgICAgICAgICBuYW1lT3JFbWFpbDogJ05hbWUgb3IgZS1tYWlsJ1xyXG4gICAgICAgIH1cclxuICAgICAgfSxcclxuICAgICAgbGF5b3V0OiB7XHJcbiAgICAgICAgbWVudToge1xyXG4gICAgICAgICAgbWFwOiAnTWFwJywgICAgICAgICAgXHJcbiAgICAgICAgICBleHBvcnQ6ICdFeHBvcnQnLFxyXG4gICAgICAgICAgaW1wb3J0OiAnSW1wb3J0JyxcclxuICAgICAgICAgIHZlY3RvcjogJ1ZlY3RvcicsXHJcbiAgICAgICAgICBnZW9yZWZlcmVuY2U6ICdHZW9yZWZlcmVuY2UnLFxyXG4gICAgICAgICAgcHJlZmVyZW5jZXM6ICdwcmVmZXJlbmNlcydcclxuICAgICAgICB9LFxyXG4gICAgICAgIGlucHV0OntcclxuICAgICAgICAgIHNlbGVjdDogJ1NlbGVjdCcgICAgICAgICAgXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICB0b29sdGlwczogeyAgICAgICAgXHJcbiAgICAgICAgdXNlcjoge1xyXG4gICAgICAgICAgcHJvZmlsZTogJ1Byb2ZpbGUnLFxyXG4gICAgICAgICAgdHJhbnNmZXI6ICdUcmFuc2ZlcidcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIHBhZ2luYXRpb246IHsgXHJcbiAgICAgICAgdG90YWw6ICdUb3RhbCcsXHJcbiAgICAgICAgaXRlbXM6ICdJdGVtKHMpJyAgICAgIFxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxufSgpKTtcclxuIiwiLyplc2xpbnQgYW5ndWxhci9maWxlLW5hbWU6IDAsIG5vLXVuZGVmOiAwKi9cclxuKGZ1bmN0aW9uKCkge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb25zdGFudCgnZGUtREUuaTE4bi5hdHRyaWJ1dGVzJywge1xyXG4gICAgICBlbWFpbDogJ0VtYWlsJyxcclxuICAgICAgcGFzc3dvcmQ6ICdQYXNzd29yZCcsXHJcbiAgICAgIG5hbWU6ICdOYW1lJyxcclxuICAgICAgaW1hZ2U6ICdJbWFnZScsXHJcbiAgICAgIHJvbGVzOiAnUHJvZmlsZXMnLFxyXG4gICAgICBkYXRlOiAnRGF0ZScsXHJcbiAgICAgIGluaXRpYWxEYXRlOiAnSW5pdGlhbCBkYXRlJyxcclxuICAgICAgZmluYWxEYXRlOiAnRW5kIGRhdGUnLFxyXG4gICAgICB0YXNrOiB7XHJcbiAgICAgICAgZGVzY3JpcHRpb246ICdEZXNjcmlwdGlvbicsXHJcbiAgICAgICAgZG9uZTogJ0RvbmU/JyxcclxuICAgICAgICBwcmlvcml0eTogJ1ByaW9yaXR5JyxcclxuICAgICAgICBzY2hlZHVsZWRfdG86ICdTY2hlZHVsZWQgdG8/JyxcclxuICAgICAgICBwcm9qZWN0OiAnUHJvamVjdCdcclxuICAgICAgfSxcclxuICAgICAgcHJvamVjdDoge1xyXG4gICAgICAgIGNvc3Q6ICdjb3N0J1xyXG4gICAgICB9LFxyXG4gICAgICBhdWRpdE1vZGVsOiB7XHJcbiAgICAgIH1cclxuICAgIH0pXHJcblxyXG59KCkpO1xyXG4iLCIvKmVzbGludCBhbmd1bGFyL2ZpbGUtbmFtZTogMCwgbm8tdW5kZWY6IDAqL1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbnN0YW50KCdkZS1ERS5pMThuLmRpYWxvZycsIHtcclxuICAgICAgY29uZmlybVRpdGxlOiAnQ29uZmlybT8nLFxyXG4gICAgICBjb25maXJtRGVzY3JpcHRpb246ICdDb25maXJtIGFjdGlvbj8nLFxyXG4gICAgICByZW1vdmVEZXNjcmlwdGlvbjogJ0RvIHlvdSB3YW50IHRvIHJlbW92ZSBwZXJtYW5lbnRseSB7e25hbWV9fT8nLFxyXG4gICAgICBhdWRpdDoge1xyXG4gICAgICAgIGNyZWF0ZWQ6ICdDcmVhdGVkJyxcclxuICAgICAgICB1cGRhdGVkQmVmb3JlOiAnVXBkYXRlZCBiZWZvcmUnLFxyXG4gICAgICAgIHVwZGF0ZWRBZnRlcjogJ1VwZGF0ZWQgYWZ0ZXInLFxyXG4gICAgICAgIGRlbGV0ZWQ6ICdEZWxldGVkJ1xyXG4gICAgICB9LFxyXG4gICAgICBsb2dpbjoge1xyXG4gICAgICAgIHJlc2V0UGFzc3dvcmQ6IHtcclxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVHlwZSB5b3VyIHJlZ2lzdGVyZWQgZS1tYWlsIGluIHRoZSBzeXN0ZW0uJ1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbn0oKSk7XHJcbiIsIi8qZXNsaW50IGFuZ3VsYXIvZmlsZS1uYW1lOiAwLCBuby11bmRlZjogMCovXHJcbihmdW5jdGlvbigpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIGFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29uc3RhbnQoJ2RlLURFLmkxOG4uZ2xvYmFsJywge1xyXG4gICAgICBsb2FkaW5nOiAnTG9hZGluZy4uLicsXHJcbiAgICAgIHByb2Nlc3Npbmc6ICdQcm9jZXNzaW5nLi4uJyxcclxuICAgICAgeWVzOiAnWWVzJyxcclxuICAgICAgbm86ICdObycsXHJcbiAgICAgIGFsbDogJ0FsbCdcclxuICAgIH0pXHJcblxyXG59KCkpO1xyXG4iLCIvKmVzbGludCBhbmd1bGFyL2ZpbGUtbmFtZTogMCwgbm8tdW5kZWY6IDAqL1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbnN0YW50KCdkZS1ERS5pMThuLm1lc3NhZ2VzJywge1xyXG4gICAgICBpbnRlcm5hbEVycm9yOiAnSW50ZXJuYWwgZXJyb3IuIGNvbnRhY3QgdGhlIHN5c3RlbSBhZG1pbicsXHJcbiAgICAgIG1hcEZpbGVJc01hbmRhdG9yeTogJ1NlbGVjdCBhIG1hcCBmaWxlIGlzIG1hbmRhdG9yeScsXHJcbiAgICAgIGludmFsaWRJbWFnZUZpbGU6ICdGaWxlIHNlbGVjdGVkIGlzIG5vdCBhIHZhbGlkIGltYWdlIGZpbGUnLFxyXG4gICAgICBmaWxlVG9vQmlnOiAnRmlsZSBzZWxlY3RlZCBpcyB0b28gYmlnJyxcclxuICAgICAgbm90Rm91bmQ6ICdOb3QgZm91bmQnLFxyXG4gICAgICBub3RBdXRob3JpemVkOiAnWW91IGRvIG5vdCBoYXZlIGFjY2VzcyB0byB0aGlzIGZ1bmN0aW9uYWxpdHkuJyxcclxuICAgICAgc2VhcmNoRXJyb3I6ICdTZWFyY2ggZXJyb3IuJyxcclxuICAgICAgc2F2ZVN1Y2Nlc3M6ICdJdGVtIHNhdmVkIHN1Y2Nlc3NmdWxseS4nLFxyXG4gICAgICBvcGVyYXRpb25TdWNjZXNzOiAnT3BlcmF0aW9uIGRvbmUgd2l0aCBzdWNjZXNzLicsXHJcbiAgICAgIG9wZXJhdGlvbkVycm9yOiAnRXJyb3Igd2hpbGUgZG9pbmcgdGhlIG9wZXJhdGlvbicsXHJcbiAgICAgIHNhdmVFcnJvcjogJ0Vycm9yIHdoaWxlIHRyeWluZyB0byBzYXZlIHRoZSBpdGVtLicsXHJcbiAgICAgIHJlbW92ZVN1Y2Nlc3M6ICdSZW1vdmFsIGRvbmUgd2l0aCBzdWNjZXNzLicsXHJcbiAgICAgIHJlbW92ZUVycm9yOiAnRXJyb3Igd2hpbGUgdHJ5aW5nIHRvIHJlbW92ZSB0aGUgaXRlbS4nLFxyXG4gICAgICByZXNvdXJjZU5vdEZvdW5kRXJyb3I6ICdJdGVtIG5vdCBmb3VuZCcsXHJcbiAgICAgIG5vdE51bGxFcnJvcjogJ0FsbCB0aGUgbWFuZGF0b3J5IGZpZWxkcyBtdXN0IGJlIGZpbGxlZC4nLFxyXG4gICAgICBkdXBsaWNhdGVkUmVzb3VyY2VFcnJvcjogJ0FscmVhZHkgZXhpc3RzIGFuIGl0ZW0gd2l0aCB0aGVzZSBkYXRhLicsXHJcbiAgICAgIHZhbGlkYXRlOiB7XHJcbiAgICAgICAgZmllbGRSZXF1aXJlZDogJ1RoZSBmaWVsZCB7e2ZpZWxkfX0gaXMgbWFuZGF0b3J5LidcclxuICAgICAgfSxcclxuICAgICAgbGF5b3V0OiB7XHJcbiAgICAgICAgZXJyb3I0MDQ6ICdQYWdlIG5vIGZvdW5kJ1xyXG4gICAgICB9LFxyXG4gICAgICBsb2dpbjoge1xyXG4gICAgICAgIGxvZ291dEluYWN0aXZlOiAnWW91IGhhdmUgYmVlbiBsb2dnZWQgb3V0LiBMb2dpbiBhZ2Fpbi4nLFxyXG4gICAgICAgIGludmFsaWRDcmVkZW50aWFsczogJ0ludmFsaWQgY3JlZGVudGlhbHMnLFxyXG4gICAgICAgIHVua25vd25FcnJvcjogJ0l0IHdhcyBub3QgcG9zc2libGUgdG8gbG9nIHlvdSBpbi4gJyArXHJcbiAgICAgICAgICAnVHJ5IGFnYWluLiBJZiB0aGUgZXJyb3IgcGVyc2lzdHMsIGNvbnRhY3QgdGhlIHN5c3RlbSBhZG1pbmlzdHJhdG9yLicsXHJcbiAgICAgICAgdXNlck5vdEZvdW5kOiAnVXNlciBub3QgZm91bmQnXHJcbiAgICAgIH0sXHJcbiAgICAgIGRhc2hib2FyZDoge1xyXG4gICAgICAgIHdlbGNvbWU6ICdXZWxjb21lIHt7dXNlck5hbWV9fScsXHJcbiAgICAgICAgZGVzY3JpcHRpb246ICdVc2UgdGhlIGZvciBuYXZpZ2F0aW9uLidcclxuICAgICAgfSxcclxuICAgICAgbWFpbDoge1xyXG4gICAgICAgIG1haWxFcnJvcnM6ICdBbiBlcnJvciBoYXMgb2NjdXJyZWQgaW4gdGhlIGZvbGxvd2luZyBlLW1haWxzOlxcbicsXHJcbiAgICAgICAgc2VuZE1haWxTdWNjZXNzOiAnRW1haWwgc2VudCB3aXRoIHN1Y2Nlc3MhJyxcclxuICAgICAgICBzZW5kTWFpbEVycm9yOiAnSXQgd2FzIG5vdCBwb3NzaWJsZSB0byBzZW5kIHRoZSBlLW1haWwuJyxcclxuICAgICAgICBwYXNzd29yZFNlbmRpbmdTdWNjZXNzOiAnVGhlIHBhc3N3b3JkIHJlY292ZXIgcHJvY2VzcyB3YXMgaW5pdGlhdGVkLiBJZiB0aGUgZS1tYWlsIGRvZXMgbm90IGFycml2ZSBpbiAxMCBtaW51dGVzLCB0cnkgYWdhaW4uJ1xyXG4gICAgICB9LFxyXG4gICAgICB1c2VyOiB7XHJcbiAgICAgICAgcmVtb3ZlWW91clNlbGZFcnJvcjogJ1lvdSBjYW4gbm90IHJlbW92ZSB5b3VyIG93biB1c2VyLicsXHJcbiAgICAgICAgdXNlckV4aXN0czogJ1VzZXIgYWxyZWFkeSBleGlzdHMhJyxcclxuICAgICAgICBwcm9maWxlOiB7XHJcbiAgICAgICAgICB1cGRhdGVFcnJvcjogJ0l0IHdhcyBub3QgcG9zc2libGUgdG8gdXBkYXRlIHlvdXIgcHJvZmlsZS4nXHJcbiAgICAgICAgfVxyXG4gICAgICB9ICAgICAgXHJcbiAgICB9KVxyXG5cclxufSgpKTtcclxuIiwiLyplc2xpbnQgYW5ndWxhci9maWxlLW5hbWU6IDAsIG5vLXVuZGVmOiAwKi9cclxuKGZ1bmN0aW9uKCkge1xyXG4gICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb25zdGFudCgnZGUtREUuaTE4bi5tb2RlbHMnLCB7XHJcbiAgICAgIHVzZXI6ICdVc2VyJyAgICAgIFxyXG4gICAgfSlcclxuXHJcbn0oKSk7XHJcbiIsIi8qZXNsaW50IGFuZ3VsYXIvZmlsZS1uYW1lOiAwLCBuby11bmRlZjogMCovXHJcbihmdW5jdGlvbigpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIGFuZ3VsYXJcclxuICAgIC5tb2R1bGUoJ2FwcCcpXHJcbiAgICAuY29uc3RhbnQoJ2RlLURFLmkxOG4udmlld3MnLCB7XHJcbiAgICAgIGJyZWFkY3J1bWJzOiB7XHJcbiAgICAgICAgdXNlcjogJ1VzZSBhZG1pbicsXHJcbiAgICAgICAgJ3VzZXItcHJvZmlsZSc6ICdVc2VyIHByb2ZpbGUnLFxyXG4gICAgICAgIGRhc2hib2FyZDogJ0Rhc2hib2FyZCcsXHJcbiAgICAgICAgYXVkaXQ6ICdBdWRpdCcsXHJcbiAgICAgICAgbWFpbDogJ01haWwgc2VuZCcsXHJcbiAgICAgICAgcHJvamVjdDogJ1Byb2plY3RzJywgICAgICAgIFxyXG4gICAgICAgICdub3QtYXV0aG9yaXplZCc6ICdOb3QgYXV0aG9yaXplZCdcclxuICAgICAgfSxcclxuICAgICAgdGl0bGVzOiB7XHJcbiAgICAgICAgZGFzaGJvYXJkOiAnSG9tZSBwYWdlJyxcclxuICAgICAgICBtYWlsU2VuZDogJ1NlbmQgbWFpbCcsXHJcbiAgICAgICAgdGFza0xpc3Q6ICdUYXNrIGxpc3QnLFxyXG4gICAgICAgIHVzZXJMaXN0OiAnVXNlciBsaXN0JyxcclxuICAgICAgICBhdWRpdExpc3Q6ICdBdWRpdCBMaXN0JyxcclxuICAgICAgICByZWdpc3RlcjogJ1JlZ2lzdGVyJyxcclxuICAgICAgICByZXNldFBhc3N3b3JkOiAnUmVzZXQgcGFzc3dvcmQnLFxyXG4gICAgICAgIHVwZGF0ZTogJ1VwZGF0ZSdcclxuICAgICAgfSxcclxuICAgICAgYWN0aW9uczoge1xyXG4gICAgICAgIHNlbmQ6ICdTZW5kJyxcclxuICAgICAgICBzYXZlOiAnU2F2ZScsXHJcbiAgICAgICAgY2xlYXI6ICdDbGVhcicsXHJcbiAgICAgICAgY2xlYXJBbGw6ICdDbGVhciBhbGwnLFxyXG4gICAgICAgIHJlc3RhcnQ6ICdSZXN0YXJ0JyxcclxuICAgICAgICBmaWx0ZXI6ICdGaWx0ZXInLFxyXG4gICAgICAgIHNlYXJjaDogJ1NlYXJjaCcsXHJcbiAgICAgICAgbGlzdDogJ0xpc3QnLFxyXG4gICAgICAgIGVkaXQ6ICdFZGl0JyxcclxuICAgICAgICBjYW5jZWw6ICdDYW5jZWwnLFxyXG4gICAgICAgIHVwZGF0ZTogJ1VwZGF0ZScsXHJcbiAgICAgICAgcmVtb3ZlOiAnUmVtb3ZlJyxcclxuICAgICAgICBnZXRPdXQ6ICdFeGl0JyxcclxuICAgICAgICBhZGQ6ICdBZGQnLFxyXG4gICAgICAgIGluOiAnZW50ZXInLFxyXG4gICAgICAgIGxvYWRJbWFnZTogJ0xvYWQgaW1hZ2UnXHJcbiAgICAgIH0sXHJcbiAgICAgIGZpZWxkczoge1xyXG4gICAgICAgIGRhdGU6ICdEYXRlJyxcclxuICAgICAgICBhY3Rpb246ICdBY3Rpb24nLFxyXG4gICAgICAgIGFjdGlvbnM6ICdBY3Rpb25zJywgICAgICAgIFxyXG4gICAgICAgIGxvZ2luOiB7XHJcbiAgICAgICAgICByZXNldFBhc3N3b3JkOiAnUmVzZXQgcGFzc3dvcmQnLFxyXG4gICAgICAgICAgY29uZmlybVBhc3N3b3JkOiAnQ29uZmlybSBwYXNzd29yZCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIG1haWw6IHtcclxuICAgICAgICAgIHRvOiAnVG8nLFxyXG4gICAgICAgICAgc3ViamVjdDogJ1N1YmplY3QnLFxyXG4gICAgICAgICAgbWVzc2FnZTogJ01lc3NhZ2UnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB1c2VyOiB7XHJcbiAgICAgICAgICBwcm9maWxlOiAnUHJvZmlsZXMnLFxyXG4gICAgICAgICAgbmFtZU9yRW1haWw6ICdOYW1lIG9yIGUtbWFpbCdcclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIGxheW91dDoge1xyXG4gICAgICAgIG1lbnU6IHtcclxuICAgICAgICAgIGRhc2hib2FyZDogJ0Rhc2hib2FyZCcsICAgICAgICAgIFxyXG4gICAgICAgICAgYWRtaW46ICdBZG1pbmlzdHJhdGlvbicsXHJcbiAgICAgICAgICBleGFtcGxlczogJ0V4YW1wbGVzJyxcclxuICAgICAgICAgIHVzZXI6ICdVc2VyJyxcclxuICAgICAgICAgIG1haWw6ICdTZW5kIGVtYWlsJyxcclxuICAgICAgICAgIGF1ZGl0OiAnQXVkaXQnXHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgICB0b29sdGlwczogeyAgICAgICAgXHJcbiAgICAgICAgdXNlcjoge1xyXG4gICAgICAgICAgcHJvZmlsZTogJ1Byb2ZpbGUnLFxyXG4gICAgICAgICAgdHJhbnNmZXI6ICdUcmFuc2ZlcidcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pXHJcblxyXG59KCkpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuY29udHJvbGxlcignTWFwRGlhbG9nQ29udHJvbGxlcicsIE1hcERpYWxvZ0NvbnRyb2xsZXIpO1xuXG4gICAgLyoqIEBuZ0luamVjdCAqL1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gICAgZnVuY3Rpb24gTWFwRGlhbG9nQ29udHJvbGxlcigkY29udHJvbGxlciwgTWFwU2VydmljZSwgQzJEaWFsb2csIG1hcERpYWxvZ0lucHV0LCBGaWxlU2VydmljZSwgQzJUb2FzdCwgJHRyYW5zbGF0ZSwgTWFwVHlwZVNlcnZpY2UsIE1hcFByb2plY3Rpb25TZXJ2aWNlLCBNYXBQcm9qZWN0U2VydmljZSwgbG9kYXNoLCBNYXBMYXllclNlcnZpY2UpIHtcblxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLm9uQWN0aXZhdGUgPSBvbkFjdGl2YXRlO1xuICAgICAgICB2bS5iZWZvcmVTYXZlID0gYmVmb3JlU2F2ZTtcbiAgICAgICAgdm0uYWZ0ZXJTYXZlID0gYWZ0ZXJTYXZlOyAgICAgICAgXG4gICAgICAgIHZtLm9uRmlsZVJlbW92ZSA9IG9uRmlsZVJlbW92ZTtcbiAgICAgICAgdm0ucmVtb3ZlRmlsZSA9IHJlbW92ZUZpbGU7ICAgICAgIFxuICAgICAgICB2bS5vbkFjdGl2YXRlID0gb25BY3RpdmF0ZTtcbiAgICAgICAgdm0uY2xvc2UgPSBjbG9zZTtcbiAgICAgICAgdm0uZ2VvRmlsZU5lZWRlZCA9IGZhbHNlO1xuICAgICAgICB2bS5vbkltYWdlRmlsZUNoYW5nZSA9IG9uSW1hZ2VGaWxlQ2hhbmdlO1xuICAgICAgICB2bS5vbkdlb0ZpbGVDaGFuZ2UgPSBvbkdlb0ZpbGVDaGFuZ2U7XG4gICAgICAgIHZtLnNob3dHZW9GaWxlSW5wdXQgPSBzaG93R2VvRmlsZUlucHV0O1xuICAgICAgICB2bS5zaG93UHJvamVjdGlvbklucHV0ID0gc2hvd1Byb2plY3Rpb25JbnB1dDsgICBcbiAgICAgICAgdm0uc2hvd0dlb3JlZkJhZGdlID0gc2hvd0dlb3JlZkJhZGdlO1xuXG4gICAgICAgIC8vIGluc3RhbnRpYXRlIGJhc2UgY29udHJvbGxlclxuICAgICAgICAkY29udHJvbGxlcignQ1JVRENvbnRyb2xsZXInLCB7XG4gICAgICAgICAgICB2bTogdm0sXG4gICAgICAgICAgICBtb2RlbFNlcnZpY2U6IE1hcFNlcnZpY2UsXG4gICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgc2VhcmNoT25Jbml0OiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogUnVuIGluaXRpYWwgZnVuY3Rpb25zIG9uIGRpYWxvZyBvcGVuSW5nXG4gICAgICAgICAqIEByZXR1cm4gdm9pZFxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gb25BY3RpdmF0ZSgpIHtcbiAgICAgICAgICAgIHZtLnNhdmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgZGVmaW5lVmlld1N0YXRlKCk7XG4gICAgICAgICAgICB2bS5yZW1vdmVNYXAgPSBtYXBEaWFsb2dJbnB1dC5yZW1vdmVGbjtcbiAgICAgICAgICAgIE1hcFR5cGVTZXJ2aWNlLnBhZ2luYXRlKCkudGhlbihcbiAgICAgICAgICAgICAgICBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICB2bS5tYXBUeXBlcyA9IHJlc3BvbnNlLml0ZW1zO1xuICAgICAgICAgICAgICAgICAgICBhZGp1c3RSZXNvdXJjZSgpOyAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTsgIFxuICAgICAgICAgICBNYXBQcm9qZWN0aW9uU2VydmljZS5wYWdpbmF0ZSgpLnRoZW4oXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ucHJvamVjdGlvbnMgPSByZXNwb25zZS5pdGVtcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBNYXBQcm9qZWN0U2VydmljZS5wYWdpbmF0ZSgpLnRoZW4oXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICB2bS5wcm9qZWN0cyA9IHJlc3BvbnNlLml0ZW1zO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7IFxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENoZWNrIGlmIGEgdmFsaWQgcHJvamVjdGlvbiBpcyBzZWxlY3RlZCBhbmQgdGh1cyBpZiB3ZSBzaGFsbCBzaG93IHRoZSBnZW8gZmlsZSBpbnB1dFxuICAgICAgICAgKiBcbiAgICAgICAgICogQHJldHVybnMgYm9vbGVhblxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gc2hvd0dlb0ZpbGVJbnB1dCgpe1xuICAgICAgICAgICAgcmV0dXJuIGFuZ3VsYXIuaXNEZWZpbmVkKHZtLnJlc291cmNlLnByb2plY3Rpb24pICYmIHZtLnJlc291cmNlLnByb2plY3Rpb24gIT0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZWZpbmUgdGhlIGRpYWxvZyB2aWV3IHN0YXRlIGFzIGFkZCBvciBlZGl0IFxuICAgICAgICAgKiBhbmQgcGFyc2UgdGhlIHZpZXcgdGl0bGVcbiAgICAgICAgICogQHJldHVybiB2b2lkXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBkZWZpbmVWaWV3U3RhdGUoKXtcbiAgICAgICAgICAgIHZtLm1vZGUgPSBhbmd1bGFyLmlzRGVmaW5lZChtYXBEaWFsb2dJbnB1dC5tb2RlbCk/ICdlZGl0JyA6ICdhZGQnO1xuICAgICAgICAgICAgaWYgKHZtLm1vZGUgPT0gJ2FkZCcpIHtcbiAgICAgICAgICAgICAgICB2bS52aWV3VGl0bGUgPSAkdHJhbnNsYXRlLmluc3RhbnQoJ3ZpZXdzLnRpdGxlcy5hZGRNYXAnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdm0udmlld1RpdGxlID0gJHRyYW5zbGF0ZS5pbnN0YW50KCd2aWV3cy50aXRsZXMuZWRpdE1hcCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2hvd1Byb2plY3Rpb25JbnB1dCgpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSB2bS5nZW9GaWxlTmVlZGVkICYmIHZtLm1vZGUgPT09ICdhZGQnO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsgICAgICAgICAgIFxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFkanVzdCByZXNvdXJjZSBtYXBwaW5nIHRoZSBmaWVsZCBuYW1lcyBhbmQgc2V0IHRoZSByZXNvdXJjZSBtb2RlbFxuICAgICAgICAgKiBAcmV0dXJuIHZvaWRcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIGFkanVzdFJlc291cmNlKCl7XG4gICAgICAgICAgICBpZiAodm0ubW9kZSA9PT0gJ2VkaXQnKSB7XG4gICAgICAgICAgICAgICAgdm0ucmVzb3VyY2UgPSBtYXBEaWFsb2dJbnB1dC5tb2RlbDsgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdmFyIG1hcFR5cGUgPSBsb2Rhc2guZmluZCh2bS5tYXBUeXBlcywgZnVuY3Rpb24obSkgeyBcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG0uaWQgPT09IHZtLnJlc291cmNlLmZpZWxkX21hcF90eXBlIFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHZtLnJlc291cmNlLm1hcFR5cGUgPSBtYXBUeXBlO1xuICAgICAgICAgICAgICAgIHZtLmdlb0ZpbGVOZWVkZWQgPSAhdm0ucmVzb3VyY2UubWFwSW1hZ2VGaWxlLmdlb3JlZmVyZW5jZWQ7ICAgICAgICAgICBcbiAgICAgICAgICAgIH0gIFxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENsb3NlIHRoZSBkaWFsb2dcbiAgICAgICAgICogXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBjbG9zZSgpIHtcbiAgICAgICAgICAgIEMyRGlhbG9nLmNsb3NlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogSGFuZGxlIHRoZSBhZnRlciBzYXZlIGV2ZW50LCByZWZyZXNoaW5nIHRoZSBtYXBzIGZyb20gc2VydmVyIGFuZCBjbG9zaW5nIHRoZSBkaWFsb2dcbiAgICAgICAgICogXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBhZnRlclNhdmUoKXtcbiAgICAgICAgICAgIHZtLnNhdmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQobWFwRGlhbG9nSW5wdXQub25TYXZlKSl7XG4gICAgICAgICAgICAgICAgbWFwRGlhbG9nSW5wdXQub25TYXZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbG9zZSgpO1xuICAgICAgICAgICAgTWFwTGF5ZXJTZXJ2aWNlLnJlZnJlc2hNYXBSZXNvdXJjZSh2bS5yZXNvdXJjZVVwZGF0ZWQpOyBcblxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENoZWNrIHRoZSBjb25zdHJhaW50cyBhbmQgYWRqdXN0IHJlc291cmNlIG1hcHBpbmcgdGhlIGZpZWxkIG5hbWVzIGFuZCBzZXQgdGhlIHJlc291cmNlIG1vZGVsXG4gICAgICAgICAqIFxuICAgICAgICAgKiBAcmV0dXJucyB2b2lkXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBiZWZvcmVTYXZlKCkge1xuICAgICAgICAgICAgdm0uc2F2aW5nID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLnJlc291cmNlLm1hcEltYWdlRmlsZSkpIHtcbiAgICAgICAgICAgICAgICB2bS5zYXZpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBDMlRvYXN0LmVycm9yKCR0cmFuc2xhdGUuaW5zdGFudCgnbWVzc2FnZXMubWFwRmlsZUlzTWFuZGF0b3J5JykpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdm0ucmVzb3VyY2UuaW1hZ2VfZmlsZV9pZCA9IHZtLnJlc291cmNlLm1hcEltYWdlRmlsZS5pZDtcbiAgICAgICAgICAgICAgICB2bS5yZXNvdXJjZS5tYXBfdHlwZV9pZCA9IHZtLnJlc291cmNlLm1hcFR5cGUuaWQ7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLnJlc291cmNlLm1hcEdlb0ZpbGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnJlc291cmNlLmZpZWxkX21hcF9nZW9faWQgPSB2bS5yZXNvdXJjZS5tYXBHZW9GaWxlLmlkOyAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9IFxuICAgICAgICAgICAgLy8gV2hpbGUgd2UgZG9uJ3QgaGF2ZSBwcm9qZWN0cyBtYW5hZ2VtZW50LCBhc3NpZ24gdGhlIGZpcnN0XG4gICAgICAgICAgICB2bS5yZXNvdXJjZS5tYXBfcHJvamVjdF9pZCA9IHZtLnByb2plY3RzWzBdLmlkO1xuICAgICAgICAgICAgdm0ucmVzb3VyY2VVcGRhdGVkID0gYW5ndWxhci5jb3B5KHZtLnJlc291cmNlKTsgICAgICAgICAgIFxuICAgICAgICB9ICAgICAgICBcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGFuZGxlcyB0aGUgZmlsZSByZW1vdmUgZXZlbnQsIGRlbGV0aW5nIHRoZSBmaWxlIGZyb20gdGhlIGJhY2stZW5kIFxuICAgICAgICAgKiBhbmQgcmVtb3ZpbmcgaXQgZnJvbSB0aGUgcmVzb3VyY2UuZmlsZXMgY29sbGVjdGlvbiAgXG4gICAgICAgICAqIEBwYXJhbSB7YW55fSBmaWxlRGF0YSBcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIG9uRmlsZVJlbW92ZSgpIHtcbiAgICAgICAgICAgIC8vdm0ucmVtb3ZlTWFwKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogSGFuZGxlcyB0aGUgZmlsZSByZW1vdmUgZXZlbnQsIGRlbGV0aW5nIHRoZSBmaWxlIGZyb20gdGhlIGJhY2stZW5kIFxuICAgICAgICAgKiBhbmQgcmVtb3ZpbmcgaXQgZnJvbSB0aGUgcmVzb3VyY2UuZmlsZXMgY29sbGVjdGlvblxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlRmlsZShmaWxlKSB7ICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgZmlsZVNlcnZpY2UgPSBuZXcgRmlsZVNlcnZpY2UoKTtcbiAgICAgICAgICAgIGZpbGVTZXJ2aWNlLmlkID0gZmlsZS5pZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKGZpbGVTZXJ2aWNlKSkge1xuICAgICAgICAgICAgICAgIGZpbGVTZXJ2aWNlLiRkZXN0cm95KCkudGhlbihcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0U3RhdGVBZnRlckZpbGVSZW1vdmFsKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXQgdGhlIHRoZSB2YXJpYWJsZXMgc3RhdGUgYWZ0ZXIgYSBmaWxlIChpbWFnZSBvciBnZW8pIGlzIHJlbW92ZWRcbiAgICAgICAgICogXG4gICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBzYXZlZEZpbGVEYXRhIFxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gc2V0U3RhdGVBZnRlckZpbGVSZW1vdmFsKHJlbW92ZWRGaWxlKXtcbiAgICAgICAgICAgIHNldElzR2VvcmVmZXJlbmNlZCgpO1xuICAgICAgICAgICAgdmFyIGlzSW1hZ2UgPSBhbmd1bGFyLmlzRGVmaW5lZChyZW1vdmVkRmlsZS50aHVtYik/IHRydWUgOiBmYWxzZTtcbiAgICAgICAgICAgIGlmKGlzSW1hZ2Upe1xuICAgICAgICAgICAgICAgIHZtLnJlc291cmNlLm1hcEltYWdlRmlsZSA9IHt9O1xuICAgICAgICAgICAgICAgIHZtLnJlc291cmNlLm1hcEdlb0ZpbGUgPSB7fTtcbiAgICAgICAgICAgICAgICB2bS5nZW9GaWxlTmVlZGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZtLnJlc291cmNlLm1hcEdlb0ZpbGUgPSB7fTtcbiAgICAgICAgICAgICAgICB2bS5nZW9GaWxlTmVlZGVkID0gIXZtLnJlc291cmNlLmdlb3JlZmVyZW5jZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBIYW5kbGVzIHRoZSBpbWFnZSBmaWxlIGNoYW5nZSAod2hlbiBhIGZpbGUgaXMgYWRkZWQpLCBwcmVwYXJpbmcsIGFuZCB1cGxvYWRpbmcgaXQgXG4gICAgICAgICAqIHRvIHRoZSBiYWNrLWVuZCBhbmQgYWRkaW5nIGl0IHRvIHRoZSBjbGllbnQgcmVzb3VyY2UuZmlsZXMgY29sbGVjdGlvbiBcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIG9uSW1hZ2VGaWxlQ2hhbmdlKCl7ICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBJbiBzZXF1ZW5jZSB3ZSB1cGxvYWQgdGhlIG5ldyBmaWxlICh3ZSBkb250IGhhdmUgdG8gd2FpdCB0aGUgcmVtb3ZhbClcbiAgICAgICAgICAgIHZhciBmaWxlT2JqID0gdm0uaW1hZ2VGaWxlWzBdO1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKGZpbGVPYmopICYmICFmaWxlT2JqLmlzUmVtb3RlKSB7XG4gICAgICAgICAgICAgICAgaWYoZmlsZU9iai5sZlRhZ1R5cGUgPT09IFwiaW1hZ2VcIikge1xuICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayB3aGV0aGVyIHRoZSBmaWxlIHNpemUgaXMgbGVzcyB0aGFuIDIwMCBNQlxuICAgICAgICAgICAgICAgICAgICBpZihmaWxlT2JqLmxmRmlsZS5zaXplLzEwMjQvMTAyNCA8PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWxlU2VydmljZSA9IG5ldyBGaWxlU2VydmljZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZVNlcnZpY2UuZmlsZSA9IGZpbGVPYmoubGZGaWxlOyAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIHVwbG9hZEZpbGUoZmlsZVNlcnZpY2UpOyAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIEMyVG9hc3QuZXJyb3IoJHRyYW5zbGF0ZS5pbnN0YW50KCdtZXNzYWdlcy5maWxlVG9vQmlnJykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgQzJUb2FzdC5lcnJvcigkdHJhbnNsYXRlLmluc3RhbnQoJ21lc3NhZ2VzLmludmFsaWRJbWFnZUZpbGUnKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhhbmRsZXMgdGhlIGdlbyBmaWxlIGNoYW5nZSAod2hlbiBhIGZpbGUgaXMgYWRkZWQpLCBwcmVwYXJpbmcsIGFuZCB1cGxvYWRpbmcgaXQgXG4gICAgICAgICAqIHRvIHRoZSBiYWNrLWVuZCBhbmQgYWRkaW5nIGl0IHRvIHRoZSBjbGllbnQgcmVzb3VyY2UuZmlsZXMgY29sbGVjdGlvbiBcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIG9uR2VvRmlsZUNoYW5nZSgpe1xuICAgICAgICAgICAgLy8gV2UgdGhlIGhhcyBhIGltYWdlLCB3ZSBhc2sgdGhlIHNlcnZlciB0byByZW12b2UgdGhpcyBmaWxlXG4gICAgICAgICAgICAvLyB0byBhdm9pZCBnYXJiYWdlIGluIHRoZSBiYWNrLWVuZFxuICAgICAgICAgICAgdmFyIGltYWdlSWQgPSBudWxsO1xuICAgICAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQodm0ucmVzb3VyY2UubWFwSW1hZ2VGaWxlKSAmJiBhbmd1bGFyLmlzRGVmaW5lZCh2bS5yZXNvdXJjZS5tYXBJbWFnZUZpbGUuaWQpKSB7XG4gICAgICAgICAgICAgICAgaW1hZ2VJZCA9IHZtLnJlc291cmNlLm1hcEltYWdlRmlsZS5pZDsgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJbiBzZXF1ZW5jZSB3ZSB1cGxvYWQgdGhlIG5ldyBmaWxlICh3ZSBkb250IGhhdmUgdG8gd2FpdCB0aGUgcmVtb3ZhbClcbiAgICAgICAgICAgIHZhciBmaWxlT2JqID0gdm0uZ2VvRmlsZVswXTtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZChmaWxlT2JqKSAmJiAhZmlsZU9iai5pc1JlbW90ZSkge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlU2VydmljZSA9IG5ldyBGaWxlU2VydmljZSgpO1xuICAgICAgICAgICAgICAgIGZpbGVTZXJ2aWNlLmZpbGUgPSBmaWxlT2JqLmxmRmlsZTtcbiAgICAgICAgICAgICAgICBmaWxlU2VydmljZS5tYXBfaW1hZ2VfZmlsZV9pZCA9IGltYWdlSWQ7XG4gICAgICAgICAgICAgICAgZmlsZVNlcnZpY2UubWFwX2dlb19maWxlX3Byb2plY3Rpb24gPSB2bS5yZXNvdXJjZS5wcm9qZWN0aW9uLnZhbHVlO1xuICAgICAgICAgICAgICAgIHVwbG9hZEZpbGUoZmlsZVNlcnZpY2UpOyAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gICAgICAgIFxuICAgICAgICBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFByb2Nlc3MgYSBmaWxlIHVwbG9hZCAoaW1hZ2Ugb3IgZ2VvIGZpbGUpXG4gICAgICAgICAqIFxuICAgICAgICAgKiBAcGFyYW0ge0ZpbGVTZXJ2aWNlfSBmaWxlU2VydmljZSBcbiAgICAgICAgICovXG4gICAgICAgIGZ1bmN0aW9uIHVwbG9hZEZpbGUoZmlsZVNlcnZpY2Upe1xuICAgICAgICAgICAgZmlsZVNlcnZpY2UudXBsb2FkKCkudGhlbihcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoc2F2ZWRGaWxlRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBzZXRTdGF0ZUFmdGVyRmlsZVVwbG9hZChzYXZlZEZpbGVEYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldCB0aGUgdGhlIHZhcmlhYmxlcyBzdGF0ZSBhZnRlciBhIGZpbGUgKGltYWdlIG9yIGdlbykgaXMgdXBsb2FkZWRcbiAgICAgICAgICogXG4gICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBzYXZlZEZpbGVEYXRhIFxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gc2V0U3RhdGVBZnRlckZpbGVVcGxvYWQoc2F2ZWRGaWxlRGF0YSl7ICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQoc2F2ZWRGaWxlRGF0YS5pZCkpIHtcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQoc2F2ZWRGaWxlRGF0YS50aHVtYikpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0ucmVzb3VyY2UubWFwSW1hZ2VGaWxlID0gc2F2ZWRGaWxlRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYoIXZtLnJlc291cmNlLm1hcEltYWdlRmlsZS5nZW9yZWZlcmVuY2VkKXtcbiAgICAgICAgICAgICAgICAgICAgaWYoIXZtLnJlc291cmNlLm1hcEltYWdlRmlsZS5pc2dlb3JlZil7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5nZW9GaWxlTmVlZGVkID0gdHJ1ZTsgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfSBcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2bS5yZXNvdXJjZS5tYXBHZW9GaWxlID0gc2F2ZWRGaWxlRGF0YTtcbiAgICAgICAgICAgICAgICAgICAgdm0uZ2VvRmlsZU5lZWRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZXRJc0dlb3JlZmVyZW5jZWQoKTsgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICogRGVmaW5lIGEgc2hvcnRoYW5kIHByb3BlcnR5IGlmIHRoZSBtYXAgaXMgZ2VvcmVmZXJlbmNlZCBvciBub3RcbiAgICAgICAgICogXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBzZXRJc0dlb3JlZmVyZW5jZWQoKXtcbiAgICAgICAgICAgIC8vIHZtLnJlc291cmNlLmdlb3JlZmVyZW5jZWQgPSB2bS5yZXNvdXJjZS5tYXBJbWFnZUZpbGUuZ2VvcmVmZXJlbmNlZCA9PT0gdHJ1ZSB8fCBhbmd1bGFyLmlzRGVmaW5lZCh2bS5yZXNvdXJjZS5tYXBHZW9GaWxlLmlkKTtcbiAgICAgICAgICAgIHZtLnJlc291cmNlLmdlb3JlZmVyZW5jZWQgPSB2bS5yZXNvdXJjZS5tYXBJbWFnZUZpbGUuaXNnZW9yZWY7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzaG93R2VvcmVmQmFkZ2UoKSB7XG4gICAgICAgICAgICBpZih2bS5yZXNvdXJjZS5nZW9yZWZlcmVuY2VkICE9PSB1bmRlZmluZWQgJiYgdm0ubW9kZSAhPT0gJ2VkaXQnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuICAgIFxuICAgICAgJ3VzZSBzdHJpY3QnO1xuICAgIFxuICAgICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCdhcHAnKVxuICAgICAgICAuY29udHJvbGxlcignTWFwTGVmdFNpZGVuYXZDb250cm9sbGVyJywgTWFwTGVmdFNpZGVuYXZDb250cm9sbGVyKTtcbiAgICBcbiAgICAgIC8qKiBAbmdJbmplY3QgKi9cbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gICAgICBmdW5jdGlvbiBNYXBMZWZ0U2lkZW5hdkNvbnRyb2xsZXIoJHNjb3BlLCAkdGltZW91dCwgJG1kU2lkZW5hdiwgJGxvZywgJHJvb3RTY29wZSkge1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIC8vIENvbXBvbmVudCBsb29rdXAgc2hvdWxkIGFsd2F5cyBiZSBhdmFpbGFibGUgc2luY2Ugd2UgYXJlIG5vdCB1c2luZyBgbmctaWZgXG4gICAgICAgICAgJG1kU2lkZW5hdignbGVmdCcpLmNsb3NlKClcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgJGxvZy5kZWJ1ZyhcImNsb3NlIExFRlQgaXMgZG9uZVwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgIFxuICAgICAgICB9O1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCdhZGRUb1dvcmtpbmdMaXN0JywgZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7IC8vICdTb21lIGRhdGEnXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIFxuICAgIH0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcblx0J3VzZSBzdHJpY3QnO1xuXHR2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xuXG5cdGFwcC5mYWN0b3J5KCckbG9jYWxTdG9yYWdlJywgWyckd2luZG93JywgZnVuY3Rpb24oJHdpbmRvdykge1xuXHRcdHJldHVybiB7XG5cdFx0XHRzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcblx0XHRcdFx0JHdpbmRvdy5sb2NhbFN0b3JhZ2Vba2V5XSA9IHZhbHVlO1xuXHRcdFx0fSxcblx0XHRcdGdldDogZnVuY3Rpb24oa2V5LCBkZWZhdWx0VmFsdWUpIHtcblx0XHRcdFx0cmV0dXJuICR3aW5kb3cubG9jYWxTdG9yYWdlW2tleV0gfHwgZGVmYXVsdFZhbHVlO1xuXHRcdFx0fSxcblx0XHRcdHNldE9iamVjdDogZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuXHRcdFx0XHQkd2luZG93LmxvY2FsU3RvcmFnZVtrZXldID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuXHRcdFx0fSxcblx0XHRcdGdldE9iamVjdDogZnVuY3Rpb24oa2V5KSB7XG5cdFx0XHRcdHJldHVybiBKU09OLnBhcnNlKCR3aW5kb3cubG9jYWxTdG9yYWdlW2tleV0gfHwgJ3t9Jyk7XG5cdFx0XHR9LFxuXHRcdFx0cmVtb3ZlOiBmdW5jdGlvbihrZXkpe1xuXHRcdFx0XHRkZWxldGUgJHdpbmRvdy5sb2NhbFN0b3JhZ2Vba2V5XTtcblx0XHRcdH1cblx0XHR9XG5cdH1dKTtcblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuXHQndXNlIHN0cmljdCc7XG5cdHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XG5cblx0YXBwLmZhY3RvcnkoJyRzZXNzaW9uU3RvcmFnZScsIFsnJHdpbmRvdycsIGZ1bmN0aW9uKCR3aW5kb3cpIHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0c2V0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG5cdFx0XHRcdCR3aW5kb3cuc2Vzc2lvblN0b3JhZ2Vba2V5XSA9IHZhbHVlO1xuXHRcdFx0fSxcblx0XHRcdGdldDogZnVuY3Rpb24oa2V5LCBkZWZhdWx0VmFsdWUpIHtcblx0XHRcdFx0cmV0dXJuICR3aW5kb3cuc2Vzc2lvblN0b3JhZ2Vba2V5XSB8fCBkZWZhdWx0VmFsdWU7XG5cdFx0XHR9LFxuXHRcdFx0c2V0T2JqZWN0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG5cdFx0XHRcdCR3aW5kb3cuc2Vzc2lvblN0b3JhZ2Vba2V5XSA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcblx0XHRcdH0sXG5cdFx0XHRnZXRPYmplY3Q6IGZ1bmN0aW9uKGtleSkge1xuXHRcdFx0XHRyZXR1cm4gSlNPTi5wYXJzZSgkd2luZG93LnNlc3Npb25TdG9yYWdlW2tleV0gfHwgJ3t9Jyk7XG5cdFx0XHR9LFxuXHRcdFx0cmVtb3ZlOiBmdW5jdGlvbihrZXkpe1xuXHRcdFx0XHRkZWxldGUgJHdpbmRvdy5zZXNzaW9uU3RvcmFnZVtrZXldO1xuXHRcdFx0fVxuXHRcdH1cblx0fV0pO1xuXG59KSgpOyIsIihmdW5jdGlvbigpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAvKiogQG5nSW5qZWN0ICovXHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb21wb25lbnQoJ2JveCcsIHtcclxuICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgdGVtcGxhdGVVcmw6IFsnR2xvYmFsJywgZnVuY3Rpb24oR2xvYmFsKSB7XHJcbiAgICAgICAgcmV0dXJuIEdsb2JhbC5jbGllbnRQYXRoICsgJy9zaGFyZWQvY29tcG9uZW50cy9ib3guaHRtbCdcclxuICAgICAgfV0sXHJcbiAgICAgIHRyYW5zY2x1ZGU6IHtcclxuICAgICAgICB0b29sYmFyQnV0dG9uczogJz9ib3hUb29sYmFyQnV0dG9ucycsXHJcbiAgICAgICAgZm9vdGVyQnV0dG9uczogJz9ib3hGb290ZXJCdXR0b25zJ1xyXG4gICAgICB9LFxyXG4gICAgICBiaW5kaW5nczoge1xyXG4gICAgICAgIGJveFRpdGxlOiAnQCcsXHJcbiAgICAgICAgdG9vbGJhckNsYXNzOiAnQCcsXHJcbiAgICAgICAgdG9vbGJhckJnQ29sb3I6ICdAJ1xyXG4gICAgICB9LFxyXG4gICAgICBjb250cm9sbGVyOiBbJyR0cmFuc2NsdWRlJywgZnVuY3Rpb24oJHRyYW5zY2x1ZGUpIHtcclxuICAgICAgICB2YXIgY3RybCA9IHRoaXM7XHJcblxyXG4gICAgICAgIGN0cmwudHJhbnNjbHVkZSA9ICR0cmFuc2NsdWRlO1xyXG5cclxuICAgICAgICBjdHJsLiRvbkluaXQgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgIGlmIChhbmd1bGFyLmlzVW5kZWZpbmVkKGN0cmwudG9vbGJhckJnQ29sb3IpKSBjdHJsLnRvb2xiYXJCZ0NvbG9yID0gJ2RlZmF1bHQtcHJpbWFyeSc7XHJcbiAgICAgICAgfTtcclxuICAgICAgfV1cclxuICAgIH0pO1xyXG59KCkpO1xyXG4iLCIoZnVuY3Rpb24oKSB7XHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAvKiogQG5nSW5qZWN0ICovXHJcbiAgYW5ndWxhclxyXG4gICAgLm1vZHVsZSgnYXBwJylcclxuICAgIC5jb21wb25lbnQoJ2NvbnRlbnRCb2R5Jywge1xyXG4gICAgICByZXBsYWNlOiB0cnVlLFxyXG4gICAgICB0cmFuc2NsdWRlOiB0cnVlLFxyXG4gICAgICB0ZW1wbGF0ZVVybDogWydHbG9iYWwnLCBmdW5jdGlvbihHbG9iYWwpIHtcclxuICAgICAgICByZXR1cm4gR2xvYmFsLmNsaWVudFBhdGggKyAnL3NoYXJlZC9jb21wb25lbnRzL2NvbnRlbnQtYm9keS5odG1sJ1xyXG4gICAgICB9XSxcclxuICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICBsYXlvdXRBbGlnbjogJ0AnXHJcbiAgICAgIH0sXHJcbiAgICAgIGNvbnRyb2xsZXI6IFtmdW5jdGlvbigpIHtcclxuICAgICAgICB2YXIgY3RybCA9IHRoaXM7XHJcblxyXG4gICAgICAgIGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgLy8gTWFrZSBhIGNvcHkgb2YgdGhlIGluaXRpYWwgdmFsdWUgdG8gYmUgYWJsZSB0byByZXNldCBpdCBsYXRlclxyXG4gICAgICAgICAgY3RybC5sYXlvdXRBbGlnbiA9IGFuZ3VsYXIuaXNEZWZpbmVkKGN0cmwubGF5b3V0QWxpZ24pID8gY3RybC5sYXlvdXRBbGlnbiA6ICdjZW50ZXIgc3RhcnQnO1xyXG4gICAgICAgIH07XHJcbiAgICAgIH1dXHJcbiAgICB9KTtcclxuXHJcbn0oKSk7XHJcbiIsIihmdW5jdGlvbigpIHtcclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIC8qKiBAbmdJbmplY3QgKi9cclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbXBvbmVudCgnY29udGVudEhlYWRlcicsIHtcclxuICAgICAgdGVtcGxhdGVVcmw6IFsnR2xvYmFsJywgZnVuY3Rpb24oR2xvYmFsKSB7XHJcbiAgICAgICAgcmV0dXJuIEdsb2JhbC5jbGllbnRQYXRoICsgJy9zaGFyZWQvY29tcG9uZW50cy9jb250ZW50LWhlYWRlci5odG1sJ1xyXG4gICAgICB9XSxcclxuICAgICAgcmVwbGFjZTogdHJ1ZSxcclxuICAgICAgYmluZGluZ3M6IHtcclxuICAgICAgICB0aXRsZTogJ0AnLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnQCdcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG59KCkpO1xyXG4iLCIoZnVuY3Rpb24gKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuY29udHJvbGxlcignTWFwVmlld2VyQ29udHJvbGxlcicsIE1hcFZpZXdlckNvbnRyb2xsZXIpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgZnVuY3Rpb24gTWFwVmlld2VyQ29udHJvbGxlcih2bSwgJHNjb3BlLCBvcHRpb25zLCAkY29udHJvbGxlciwgTWFwU2VydmljZSwgbG9kYXNoLCBHbG9iYWwsIEMyRGlhbG9nLCBNYXBUeXBlU2VydmljZSwgbGVhZmxldERhdGEsIGxlYWZsZXQsICRtZFNpZGVuYXYsIFN1cHBvcnRTZXJ2aWNlLCAkcm9vdFNjb3BlLCBNYXBMYXllclNlcnZpY2UsICR0aW1lb3V0LCAkd2luZG93LCAkc3RhdGUsICR0cmFuc2xhdGUsICRtZENvbG9ycywgQzJUb2FzdCkge1xuXG4gICAgLy8gRnVuY3Rpb25zIEJsb2NrICAgIFxuICAgIHZtLmFmdGVyU2VhcmNoID0gYWZ0ZXJTZWFyY2g7XG4gICAgdm0ub25BY3RpdmF0ZSA9IG9uQWN0aXZhdGU7XG4gICAgdm0uYXBwbHlGaWx0ZXJzID0gYXBwbHlGaWx0ZXJzO1xuICAgIHZtLnRvZ2dsZUxlZnQgPSB0b2dnbGVMZWZ0O1xuICAgIHZtLnRvZ2dsZVJpZ2h0ID0gdG9nZ2xlUmlnaHQ7XG4gICAgdm0uc3dpdGNoVG9WaWV3ID0gc3dpdGNoVG9WaWV3O1xuICAgIHZtLnJlc2V0ID0gcmVzZXQ7XG4gICAgdm0udG9nZ2xlVmlld2Vyc0NlbnRlckxpbmsgPSB0b2dnbGVWaWV3ZXJzQ2VudGVyTGluaztcbiAgICB2bS5oaWRlVmlld2VyID0gaGlkZVZpZXdlcjtcbiAgICB2bS5zaG93Qm90aFZpZXdlcnMgPSBzaG93Qm90aFZpZXdlcnM7XG4gICAgdm0udG9nZ2xlV2hlZWxab29tID0gdG9nZ2xlV2hlZWxab29tO1xuICAgIHZtLnRvZ2dsZUFkZEdDUCA9IHRvZ2dsZUFkZEdDUDtcblxuICAgIC8vIFNldCBvcHRpb25zIGFzIGNvbnRleHQgdmFyaWFibGVzXG4gICAgdm0uc3VwcG9ydExpc3RpbmdWaWV3ID0gb3B0aW9ucy5zdXBwb3J0TGlzdGluZ1ZpZXc7XG4gICAgdm0uc3VwcG9ydERyYXdpbmcgPSBvcHRpb25zLnN1cHBvcnREcmF3aW5nO1xuICAgIHZtLnRpdGxlVHJhbnNsS2V5ID0gb3B0aW9ucy50aXRsZVRyYW5zbEtleTtcbiAgICB2bS5zaG93R2VvUmVmVG9vbHMgPSBvcHRpb25zLnNob3dHZW9SZWZUb29scztcbiAgICB2bS5sZWZ0U2lkZUJhciA9IG9wdGlvbnMubGVmdFNpZGVCYXI7XG4gICAgLy8gdm0ucmlnaHRTaWRlQmFyID0gb3B0aW9ucy5yaWdodFNpZGVCYXI7XG4gICAgdm0uc2hvd0djcFRhYmxlID0gb3B0aW9ucy5zaG93R2NwVGFibGU7XG4gICAgdm0uZ2NwVGFibGUgPSBvcHRpb25zLmdjcFRhYmxlO1xuICAgIHZtLmRpc3BsYXlCb3R0b21OYXYgPSBmYWxzZTtcblxuICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQob3B0aW9ucy5yaWdodFNpZGVCYXIpKSB7XG4gICAgICB2bS5yaWdodFNpZGVCYXIgPSBHbG9iYWwuY2xpZW50UGF0aCArIFwiL3NoYXJlZC9tYXAtdmlld2VyL25hdnMvbWFwLXJpZ2h0LXNpZGVuYXYuaHRtbFwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB2bS5yaWdodFNpZGVCYXIgPSBvcHRpb25zLnJpZ2h0U2lkZUJhcjtcbiAgICB9XG5cbiAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKG9wdGlvbnMuYm90dG9tTmF2KSkge1xuICAgICAgdm0uZGlzcGxheUJvdHRvbU5hdiA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZtLmRpc3BsYXlCb3R0b21OYXYgPSBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBpbnN0YW50aWF0ZSBiYXNlIGNvbnRyb2xsZXJcbiAgICAkY29udHJvbGxlcignQ1JVRENvbnRyb2xsZXInLCB7XG4gICAgICB2bTogdm0sXG4gICAgICBtb2RlbFNlcnZpY2U6IE1hcFNlcnZpY2UsXG4gICAgICBvcHRpb25zOiB7XG4gICAgICAgIHNlYXJjaE9uSW5pdDogdHJ1ZSxcbiAgICAgICAgcGVyUGFnZTogN1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogRXhlY3V0ZSB0aGUgYWN0aW9uIHdoZW4gdGhpcyBjb250cm9sbGVyIGlzIGFjdGl2YXRlZFxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG9uQWN0aXZhdGUoKSB7XG4gICAgICAvLyBjYWxsIGNoaWxkIG9uQWN0aXZhdGUgZnVuY3Rpb24sIGlmIGl0IGV4aXN0c1xuICAgICAgaWYgKGFuZ3VsYXIuaXNGdW5jdGlvbih2bS5iZWZvcmVWaWV3ZXJBY3RpdmF0ZSkpIHtcbiAgICAgICAgdm0uYmVmb3JlVmlld2VyQWN0aXZhdGUoKTtcbiAgICAgIH1cblxuICAgICAgLy8gSW5pdGlhbGx5IHRoZSBib3R0b20gbmF2IHN0YXJ0IHJldHJhY3RlZFxuICAgICAgdm0uc2hvd0JvdHRvbU5hdiA9IGZhbHNlO1xuXG4gICAgICAvLyBHZXQgdGhlIG1hcCB0eXBlcyBmcm9tIHRoZSBzZXJ2aWNlXG4gICAgICBNYXBUeXBlU2VydmljZS5wYWdpbmF0ZSgpLnRoZW4oXG4gICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgIHZtLm1hcFR5cGVzID0gcmVzcG9uc2UuaXRlbXM7XG4gICAgICAgIH1cbiAgICAgICk7XG5cbiAgICAgIC8vIEJ1aWxkIHRoZSBvcHRpb25zIGZvciB0aGUgZGVmYXVsdCBsYXllcnMgYnVpbGRpbmcgdGFzayAgICAgIFxuICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgIHN1cHBvcnREcmF3aW5nOiB2bS5zdXBwb3J0RHJhd2luZ1xuICAgICAgfTtcblxuICAgICAgLy8gQnVpbGQgdGhlIGJhc2UgbGF5ZXJzIGZvciBib3RoIHZpZXdlcnMgKGxlZnRNYXBWaWV3ZXIgYW5kIHJpZ2h0TWFwVmlld2VyKSAgICBcbiAgICAgIE1hcExheWVyU2VydmljZS5idWlsZERlZmF1bHRMYXllcnMob3B0aW9ucyk7XG5cbiAgICAgIC8vIGNoZWNrIGlmIGF0IHRoZSBiZWdpbm5pbmcsIGJvdGggdmlld2VycyBcbiAgICAgIC8vIHNob3VsZCBoYXZlIGRyYXcgY2FwYWJpbGl0aWVzIGFuZCAoaWYgeWVzKSBhZGRcbiAgICAgIGlmICh2bS5zdXBwb3J0RHJhd2luZyA9PT0gdHJ1ZSkge1xuICAgICAgICB2bS5yaWdodENvbnRyb2xzID0ge1xuICAgICAgICAgIGRyYXc6IHt9XG4gICAgICAgIH07XG4gICAgICAgIHZtLmxlZnRDb250cm9scyA9IHtcbiAgICAgICAgICBkcmF3OiB7fVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEluaXRpYWwgY2VudGVyIGluIEhlaWRlbGJlcmcsIEdlcm1hbnlcbiAgICAgIHZtLmxlZnRDZW50ZXIgPSBNYXBMYXllclNlcnZpY2UuZ2V0RGVmYXVsdENlbnRlcigpO1xuXG4gICAgICAvLyBHZXQgZWFjaCB2aWV3ZXIgZGF0YVxuICAgICAgdm0ubGVmdE1hcFZpZXdlciA9IE1hcExheWVyU2VydmljZS5nZXRWaWV3ZXJEYXRhKCdsZWZ0TWFwVmlld2VyJyk7XG4gICAgICB2bS5yaWdodE1hcFZpZXdlciA9IE1hcExheWVyU2VydmljZS5nZXRWaWV3ZXJEYXRhKCdyaWdodE1hcFZpZXdlcicpO1xuXG4gICAgICAvLyBBdCB0aGUgYmVnaW5uaW5nLCBib3RoIHZpZXdlcnMgYXJlIHZpc2libGUgICAgIFxuICAgICAgdm0uc2hvd1JpZ2h0TWFwVmlld2VyID0gdHJ1ZTtcbiAgICAgIHZtLnNob3dMZWZ0TWFwVmlld2VyID0gdHJ1ZTtcblxuICAgICAgLy8gSW5pdGlhbGx5LCBib3RoIG1hcHMgc2hvdWxkIGhhdmUgdGhlIHNhbWUgY2VudGVyLCBtb3ZpbmcgdG9nZXRoZXIgICAgICBcbiAgICAgIHZtLnJpZ2h0Q2VudGVyID0gdm0ubGVmdENlbnRlcjtcblxuICAgICAgLy8gUmVmcmVzaCB0aGUgdmlld2Vycywgc28gdGhlIHRpbGVzIGFyZSBsb2FkZWQvYWRqdXN0ZWRcbiAgICAgIC8vIGFjY29yZGluZyB0aGUgdmlldyBzaXplXG4gICAgICByZWZyZXNoTWFwVmlld2VyKCk7XG5cbiAgICAgIC8vIEluaXRpYWxseSB0aGUgbW91c2Ugd2hlZWwgc2Nyb2xsIGFzIGEgem9vbSBjb250cm9sIHN0YXJ0cyBkaXNhYmxlZFxuICAgICAgLy8gc28gdGhlIHVzZXIgY2FuIHNjcm9sbCB0aGUgcGFnZSBlYXNpbHlcbiAgICAgIHZtLnJpZ2h0V2hlZWxab29tRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgdm0ubGVmdFdoZWVsWm9vbUVuYWJsZWQgPSBmYWxzZTtcbiAgICAgIE1hcExheWVyU2VydmljZS5zZXRXaGVlbFpvb21TdGF0dXMoJ2xlZnRNYXBWaWV3ZXInLCBmYWxzZSk7XG4gICAgICBNYXBMYXllclNlcnZpY2Uuc2V0V2hlZWxab29tU3RhdHVzKCdyaWdodE1hcFZpZXdlcicsIGZhbHNlKTtcblxuICAgICAgLy8gY2FsbCBjaGlsZCBvbkFjdGl2YXRlIGZ1bmN0aW9uLCBpZiBpdCBleGlzdHNcbiAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24odm0ub25WaWV3ZXJBY3RpdmF0ZSkpIHtcbiAgICAgICAgdm0ub25WaWV3ZXJBY3RpdmF0ZSgpO1xuICAgICAgfVxuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICogU3dpdGNoZWQgdGhlIHZpZXcgYW5kIGJyb2FkY2FzdCBhbmQgZXZlbnQgd2hlbiB0aGUgdmlldyBpcyBzd2l0Y2hlZFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHN3aXRjaFRvVmlldyh2aWV3KSB7XG4gICAgICB2bS5nb1RvKHZpZXcpO1xuICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdzd2l0Y2hlZFZpZXcnLCB2aWV3KTtcbiAgICAgIGlmICh2aWV3ID09PSAnZm9ybScpIHtcbiAgICAgICAgLy8gUmVmcmVzaCB0aGUgdmlld2Vycywgc28gdGhlIHRpbGVzIGFyZSBsb2FkZWQvYWRqdXN0ZWRcbiAgICAgICAgLy8gYWNjb3JkaW5nIHRoZSB2aWV3IHNpemVcbiAgICAgICAgcmVmcmVzaE1hcFZpZXdlcigpO1xuICAgICAgfVxuICAgIH1cbiAgXG4gICAgLyoqXG4gICAgICogRGlhc2JsZSBBZGQgR0NQIFBvaW50cyBidXR0b24uIFRoZSBmaXJzdCB0aW1lIHRoYXQgdGhlIHZpZXdlcnMgbG9hZCwgdGhlIGJ1dHRvbnMgc2hvdWxkIGJlIGRpc2FibGVkIGFyZSB0aGVyZSBpcyBubyBvdmVybGF5cyBvdGhlciB0aGFuIGJhc2VsYXllcnMuXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9nZ2xlQWRkR0NQKCl7XG4gICAgICByZXR1cm4gTWFwTGF5ZXJTZXJ2aWNlLmdldE92ZXJsYXlzQ291bnRCb29sKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVG9nZ2xlIHRoZSBtb3VzZSB3aGVlbCBzY3JvbGwgYXMgYSB6b29tIGNvbnRyb2wgZm9yIGEgdmlld2VyXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IHZpZXdlcklkIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHRvZ2dsZVdoZWVsWm9vbSh2aWV3ZXJJZCkge1xuICAgICAgaWYgKHZpZXdlcklkID09PSAncmlnaHRNYXBWaWV3ZXInKSB7XG4gICAgICAgIHZtLnJpZ2h0V2hlZWxab29tRW5hYmxlZCA9ICF2bS5yaWdodFdoZWVsWm9vbUVuYWJsZWQ7XG4gICAgICAgIE1hcExheWVyU2VydmljZS5zZXRXaGVlbFpvb21TdGF0dXModmlld2VySWQsIHZtLnJpZ2h0V2hlZWxab29tRW5hYmxlZCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2bS5sZWZ0V2hlZWxab29tRW5hYmxlZCA9ICF2bS5sZWZ0V2hlZWxab29tRW5hYmxlZDtcbiAgICAgICAgTWFwTGF5ZXJTZXJ2aWNlLnNldFdoZWVsWm9vbVN0YXR1cyh2aWV3ZXJJZCwgdm0ubGVmdFdoZWVsWm9vbUVuYWJsZWQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlZnJlc2ggdGhlIG1hcCBvbiB0aGUgdmlld2VyLiBcbiAgICAgKiBVc2VmdWwgd2hlbiB0aGUgdmlld2VyIGlzIHJlc2l6ZWQgb3Igc3dpdGNoZWQgZnJvbSBvbmUvdHdvIHZpZXdlcnNcbiAgICAgKiBcbiAgICAgKiBAcmV0dXJuIHZvaWQgXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmVmcmVzaE1hcFZpZXdlcigpIHtcbiAgICAgIC8vIFRoaXMgaXMgYSBoYWNrIHRvIGZvcmNlIGxlYWZsZXQgcmVkcmF3L3Jlc2l6ZSBjb3JyZWN0bHkgdGhlIG1hcHNcbiAgICAgIC8vIGluIHRoZSBjYXNlIHdoZW4gdGhlcmUgYXJlIHR3byBtYXAgdmlld2VycyBhbmQgdGhlIGNvbnRhaW5lciBvZiBvbmUgb2YgdGhlbSBcbiAgICAgIC8vIGlzIHJlc2l6ZWQuIFxuICAgICAgLy8gVGhlIGNhbmRpZGF0ZXMgbWFwLmludmFsaWRhdGVTaXplKCkgYW5kIG1hcC5lYWNoTGF5ZXIoZnVuY3Rpb24obGF5ZXIpe2xheWVyLnJlZHJhdygpO30pO1xuICAgICAgLy8gaGF2ZSBub3Qgd29ya2VkIGF0IGFsbCBvbiB0aGlzIGNhc2VcbiAgICAgIC8vIEBzZWUgIGh0dHBzOi8vZ2l0aHViLmNvbS9MZWFmbGV0L0xlYWZsZXQvaXNzdWVzLzY5NFxuICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBXZSBtYW51YWxseSBmaXJlIHRoZSBicm93c2VyIHJlc2l6ZSBldmVudCBpbnNpZGUgYVxuICAgICAgICAvLyB0aW1lb3V0IGZ1bmN0aW9uIHdpdGggYSBkZWxheSBvZiAxIHRlbnRoIG9mIHNlY29uZFxuICAgICAgICAvLyBGb3Igc29tZSByZWFzb24sIHdoZW4gdGhpcyBldmVudCBvY2N1cnMsIGxlYWZsZXRcbiAgICAgICAgLy8gaXMgYWJsZSB0byByZXNpemUvcmVkcmF3IHRoZSB0aWxlcyBjb3JyZWN0bHlcbiAgICAgICAgJHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgncmVzaXplJykpO1xuICAgICAgfSwgMTAwKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIaWRlIGEgdmlld2VyXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IHZpZXdlcklkIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGhpZGVWaWV3ZXIodmlld2VySWQpIHtcbiAgICAgIGlmICh2aWV3ZXJJZCA9PT0gJ2xlZnRNYXBWaWV3ZXInKSB7XG4gICAgICAgIHZtLnNob3dMZWZ0TWFwVmlld2VyID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2bS5zaG93UmlnaHRNYXBWaWV3ZXIgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIC8vIFRlbGxzIHRoZSBzZXJ2aWNlIHRoYXQgYSB2aWV3ZXIgaXMgbm93IGhpZGRlblxuICAgICAgLy8gSW50ZXJuYWxseSB0aGUgc2VydmljZSBwcm9wYWdhdGUgdGhpcyBzbyBvdGhlciBjb250cm9sbGVycy9zZXJ2aWNlc1xuICAgICAgLy8gY2FuIGxpc3RlbiB0byB0aGlzIGV2ZW50IGFuZCBhcHBseSBjaGFuZ2VzXG4gICAgICBNYXBMYXllclNlcnZpY2UuaGlkZVZpZXdlcih2aWV3ZXJJZCk7XG5cbiAgICAgIC8vIEFzIHRoZXJlIGlzIG9ubHkgb25lIHZpZXdlciwgaXQgbXVzdCBoYXZlIHVzZWQgdGhlIGZ1bGwgc3BhY2VcbiAgICAgIHZtLnZpZXdlcldpZHRoID0gMTAwO1xuXG4gICAgICAvLyBUaGlzIGF0dHJpYnV0ZSBpcyB1c2VkIHRvIGRldGVybWluZSBpZiB0aGUgdmlld2VyIHNwbGl0IGJ1dHRvbiBtdXN0IGJlIHNob3duXG4gICAgICB2bS5ib3RoVmlld2Vyc1Zpc2libGUgPSBmYWxzZTtcblxuICAgICAgLy8gUmVmcmVzaCB0aGUgdmlld2Vycywgc28gdGhlIHRpbGVzIGFyZSBsb2FkZWQvYWRqdXN0ZWRcbiAgICAgIC8vIGFjY29yZGluZyB0byB0aGUgdmlldyBzaXplXG4gICAgICByZWZyZXNoTWFwVmlld2VyKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2hvdyBib3RoIHRoZSB2aWV3ZXJzLCByZXNpemUgYm90aCB0byA1MCVcbiAgICAgKiBhbmQgcmVmcmVzaCB0aGUgdmlld2VycyAocmVsb2FkIHRoZSB0aWxlcylcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzaG93Qm90aFZpZXdlcnMoKSB7XG4gICAgICAvLyBBcyB0aGVyZSBhcmUgdHdvIHZpZXdlcnMsIGVhY2ggb25lIG11c3QgaGF2ZSBoYWxmIHNwYWNlXG4gICAgICB2bS52aWV3ZXJXaWR0aCA9IDUwO1xuXG4gICAgICAvLyBpZiB0aGUgcmlnaHQgdmlld2VyIGlzIGhpZGRlbiwgc2hvdyBpdFxuICAgICAgaWYgKHZtLnNob3dSaWdodE1hcFZpZXdlciA9PT0gZmFsc2UpIHtcbiAgICAgICAgdm0uc2hvd1JpZ2h0TWFwVmlld2VyID0gdHJ1ZTtcblxuICAgICAgICAvLyBUZWxscyB0aGUgdGhlIHNlcnZpY2UgdGhhdCBhIHZpZXdlciBpcyBub3cgc2hvd25cbiAgICAgICAgLy8gSW50ZXJuYWxseSB0aGUgc2VydmljZSBwcm9wYWdhdGUgdGhpcyBzbyBvdGhlciBjb250cm9sbGVycy9zZXJ2aWNlc1xuICAgICAgICAvLyBjYW4gbGlzdGVuIHRvIHRoaXMgZXZlbnQgYW5kIGFwcGx5IGNoYW5nZXNcbiAgICAgICAgTWFwTGF5ZXJTZXJ2aWNlLnNob3dWaWV3ZXIoJ3JpZ2h0TWFwVmlld2VyJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIGlmIHRoZSBsZWZ0IHZpZXdlciBpcyBoaWRkZW4sIHNob3cgaXRcbiAgICAgIGlmICh2bS5zaG93TGVmdE1hcFZpZXdlciA9PT0gZmFsc2UpIHtcbiAgICAgICAgdm0uc2hvd0xlZnRNYXBWaWV3ZXIgPSB0cnVlO1xuXG4gICAgICAgIC8vIFRlbGxzIHRoZSB0aGUgc2VydmljZSB0aGF0IGEgdmlld2VyIGlzIG5vdyBzaG93blxuICAgICAgICAvLyBJbnRlcm5hbGx5IHRoZSBzZXJ2aWNlIHByb3BhZ2F0ZSB0aGlzIGFuZCBvdGhlciBjb250cm9sbGVycy9zZXJ2aWNlc1xuICAgICAgICAvLyBjYW4gbGlzdGVuIHRvIHRoaXMgZXZlbnQgYW5kIGFwcGx5IGNoYW5nZXNcbiAgICAgICAgTWFwTGF5ZXJTZXJ2aWNlLnNob3dWaWV3ZXIoJ2xlZnRNYXBWaWV3ZXInKTtcbiAgICAgIH1cbiAgICAgIC8vIFRoaXMgYXR0cmlidXRlIGlzIHVzZWQgdG8gZGV0ZXJtaW5lIGlmIHRoZSB2aWV3ZXIgc3BsaXQgYnV0dG9uIG11c3QgYmUgc2hvd25cbiAgICAgIHZtLmJvdGhWaWV3ZXJzVmlzaWJsZSA9IHRydWU7XG5cbiAgICAgIC8vIEFmdGVyIHRoZSBjaGFuZ2VzIHdlIHJlZnJlc2ggdGhlIHZpZXdlcnMsIHRvIHRoZSB0aWxlcyBhcmUgYWRqdXN0ZWRcbiAgICAgIHJlZnJlc2hNYXBWaWV3ZXIoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMaW5rIG9yIHVubGluayB0aGUgY2VudGVyIG9mIGJvdGggdmlld2Vyc1xuICAgICAqIFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtYXN0ZXJWaWV3ZXIgLSB0aGUgdmlld2VyIGZyb20gd2hpY2ggdGhlIGNlbnRlciB3aWxsIGJlIHVzZWQgdG8gY2VudHJhbGl6ZWQgaXRzZWxmXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9nZ2xlVmlld2Vyc0NlbnRlckxpbmsobWFzdGVyVmlld2VyKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBtYXAtdmlld2VyLmNvbnRyb2xsZXIgPj4+IHRvZ2dsZVZpZXdlcnNDZW50ZXJMaW5rID4+PiBcIiwgbWFzdGVyVmlld2VyKTtcbiAgICAgIC8vIGlmIGxvYWRlZCB1bmdlb3JlZmVyZW5jZWQgZmlsZSB0aGVuIGNhbid0IGxpbmsgdGhlIG1hcHNcbiAgICAgIC8vIGlmIHRoZSB2aWV3ZXJzJyBjZW50ZXIgYXJlIGxpbmtlZCwgdW5saW5rIHRoZW5cbiAgICAgIC8vIGJ1dCBrZWVwIHRoZW0gd2l0aCB0aGUgc2FtZSBjZW50ZXJcbiAgICAgIGlmICh2bS5yaWdodENlbnRlciA9PSB2bS5sZWZ0Q2VudGVyKSB7XG4gICAgICAgIHZtLnJpZ2h0Q2VudGVyID0gYW5ndWxhci5jb3B5KHZtLmxlZnRDZW50ZXIpO1xuXG4gICAgICB9XG4gICAgICAvLyBpZiB0aGUgdmlld2VycycgY2VudGVyIGFyZSBub3QgbGlua2VkLCBsaW5rXG4gICAgICAvLyB0aGVtLCBtb3ZpbmcgdGhlIHNsYXZlIHZpZXdlcidzIGNlbnRlciB0byB0aGUgY2VudGVyIG9mXG4gICAgICAvLyB0aGUgJ21hc3RlciB2aWV3ZXInIGNlbnRlciBwYXNzZWQgYXMgcGFyYW1ldGVyXG4gICAgICBlbHNlIHtcbiAgICAgICAgaWYoISBNYXBMYXllclNlcnZpY2UuaGFzTm9uR2VvcmVmZXJlbmNlZExheWVyKCdsZWZ0TWFwVmlld2VyJykpIHtcbiAgICAgICAgICBpZiAobWFzdGVyVmlld2VyID09PSAnbGVmdE1hcFZpZXdlcicpIHtcbiAgICAgICAgICAgIHZtLnJpZ2h0Q2VudGVyID0gdm0ubGVmdENlbnRlcjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdm0ubGVmdENlbnRlciA9IHZtLnJpZ2h0Q2VudGVyO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcImNhbid0IGxvYWQgcmlnaHQgbWFwIHNpbmNlIHJpZ2h0IHNpZGUgaXMgdW5nZW9yZWZlcm5jZWRcIilcbiAgICAgICAgICBDMlRvYXN0LmluZm8oJHRyYW5zbGF0ZS5pbnN0YW50KCdkaWFsb2cuY2FudExvYWREZXNjcmlwdGlvbicpKTtcbiAgICAgICAgfSBcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMaXN0ZW4gdG8gdGhlIGV2ZW50IHRoYXQgdGVsbHMgdXMgdGhhdCBhbiB1bmdlb3JlZmVyZW5jZWQgbWFwIHdpbGwgYmUgbG9hZGVkXG4gICAgICogYW5kIHVubGluayB0aGUgdmlld2VycycgY2VudGVyLiBUaGlzIGV2ZW50IG9jY3VycyBiZWZvcmUgdGhlIG1hcCBpcyBsb2FkZWRcbiAgICAgKiBhbmQgcmVjZWl2ZSB0aGUgdmlld2VyIGlkIHdoZXJlIHRoZSB1bmdlb3JlZmVyZW5jZWQgbWFvIHdpbGwgYmUgbG9hZGVkXG4gICAgICovXG4gICAgJHJvb3RTY29wZS4kb24oJ3VuZ2VvcmVmZXJlbmNlZExheWVyVG9CZUxvYWRlZCcsIGZ1bmN0aW9uIChldmVudCwgdmlld2VySWQpIHtcbiAgICAgIC8vIHRoZSB0b2dnbGUgZnVuY3Rpb24gdW5saW5rIG9uIHZpZXdlcidzIGNlbnRlciAgICAgICBcbiAgICAgIGlmICh2bS5yaWdodENlbnRlciA9PSB2bS5sZWZ0Q2VudGVyKSB7XG4gICAgICAgIHRvZ2dsZVZpZXdlcnNDZW50ZXJMaW5rKHZpZXdlcklkKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIExpc3RlbiB0byB0aGUgZXZlbnQgdGhhdCB0ZWxscyB1cyB0aGF0IGFuIGdlb3JlZmVyZW5jZWQgbWFwIHdpbGwgYmUgbG9hZGVkXG4gICAgICogYW5kIGxpbmsgdGhlIHZpZXdlcnMnIGNlbnRlci4gVGhpcyBldmVudCBvY2N1cnMgYmVmb3JlIHRoZSBtYXAgaXMgbG9hZGVkXG4gICAgICogYW5kIHJlY2VpdmUgdGhlIHZpZXdlciBpZCB3aGVyZSB0aGUgZ2VvcmVmZXJlbmNlZCBtYW8gd2lsbCBiZSBsb2FkZWRcbiAgICAgKi9cbiAgICAkcm9vdFNjb3BlLiRvbignZ2VvcmVmZXJlbmNlZExheWVyVG9CZUxvYWRlZCcsIGZ1bmN0aW9uIChldmVudCwgdmlld2VySWQpIHtcbiAgICAgIC8vIHRoZSB0b2dnbGUgZnVuY3Rpb24gdW5saW5rIG9uIHZpZXdlcidzIGNlbnRlciAgICAgICBcbiAgICAgIGlmICh2bS5yaWdodENlbnRlciAhPSB2bS5sZWZ0Q2VudGVyKSB7XG4gICAgICAgIHRvZ2dsZVZpZXdlcnNDZW50ZXJMaW5rKHZpZXdlcklkKTtcbiAgICAgIH1cbiAgICB9KTtcblxuXG5cbiAgICAvKipcbiAgICAgKiBNYWtlIHNvbWUgYWRqdXN0bWVudHMgaW4gdGhlIHJlc291cmNlcyBsaXN0IGFmdGVyIGxvYWRpbmcgdGhlbVxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7YW55fSByZXNwb25zZSBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhZnRlclNlYXJjaChyZXNwb25zZSkge1xuICAgICAgbG9kYXNoLm1hcCh2bS5yZXNvdXJjZXMsIGZ1bmN0aW9uIChtYXApIHtcbiAgICAgICAgbWFwLm1hcEltYWdlRmlsZSA9IG1hcC5tYXBfaW1hZ2VfZmlsZTtcbiAgICAgICAgbWFwLm1hcFR5cGVOYW1lID0gbWFwLm1hcF90eXBlX25hbWU7XG4gICAgICAgIG1hcC5tYXBHZW9GaWxlID0gbWFwLmZpZWxkX21hcF9nZW9maWxlO1xuICAgICAgICByZXR1cm4gbWFwO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGVyZSB3ZSBsaXN0ZW4gdG8gdGhlIGFwcGx5RmlsdGVycyBjYWxsYmFjayB0byBhZGQgY3VzdG9tIGZpbHRlcnNcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gZGVmYXVsdFF1ZXJ5RmlsdGVycyBcbiAgICAgKiBAcmV0dXJucyB7fVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFwcGx5RmlsdGVycyhkZWZhdWx0UXVlcnlGaWx0ZXJzKSB7XG4gICAgICB2YXIgZmlsdGVycyA9IHt9O1xuICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLnF1ZXJ5RmlsdGVycykpIHtcbiAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLnF1ZXJ5RmlsdGVycy5tYXBUeXBlKSkge1xuICAgICAgICAgIGZpbHRlcnMuZmllbGRfbWFwX3R5cGUgPSBhbmd1bGFyLmNvcHkodm0ucXVlcnlGaWx0ZXJzLm1hcFR5cGUuaWQpO1xuICAgICAgICB9XG4gICAgICAgIGZpbHRlcnMudGl0bGUgPSB2bS5xdWVyeUZpbHRlcnMudGl0bGU7XG4gICAgICAgIGlmICh2bS5xdWVyeUZpbHRlcnMuZ2VvcmVmZXJlbmNlZCAhPT0gJ0FsbCcpIHtcbiAgICAgICAgICBmaWx0ZXJzLmdlb3JlZmVyZW5jZWQgPSB2bS5xdWVyeUZpbHRlcnMuZ2VvcmVmZXJlbmNlZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodm0ucXVlcnlGaWx0ZXJzLnZlcmlmaWVkICE9PSAnQWxsJykge1xuICAgICAgICAgIGZpbHRlcnMudmVyaWZpZWQgPSB2bS5xdWVyeUZpbHRlcnMudmVyaWZpZWQ7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGFuZ3VsYXIuZXh0ZW5kKGRlZmF1bHRRdWVyeUZpbHRlcnMsIGZpbHRlcnMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlc2V0IHRoZSBzZWFyY2ggc3RhdGUgYW5kIHJlbG9hZCBpdGVtc1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHJlc2V0KCkge1xuICAgICAgdm0ucXVlcnlGaWx0ZXJzID0ge307XG4gICAgICB2bS5zZWFyY2goKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVuL2Nsb3NlIHRoZSBsZWZ0IHNpZGUgbmF2XG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9nZ2xlTGVmdCgpIHtcbiAgICAgICRtZFNpZGVuYXYoJ2xlZnQnKS50b2dnbGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVuL2Nsb3NlIHRoZSByaWdodCBzaWRlIG5hdlxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHRvZ2dsZVJpZ2h0KCkge1xuICAgICAgJG1kU2lkZW5hdigncmlnaHQnKS50b2dnbGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkZWxldGVHQ1AoZ2NwSWQpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiPj4+IG1hLXZpZXdlci5jb250cm9sbGVyID4+PiBkZWxldGVHQ1AgXCIsZ2NwSWQpO1xuICAgIH1cbiAgfVxuXG59KSgpOyIsIi8qZXNsaW50LWVudiBlczYqL1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICBhbmd1bGFyXHJcbiAgICAubW9kdWxlKCdhcHAnKVxyXG4gICAgLmNvbnRyb2xsZXIoJ01lbnVDb250cm9sbGVyJywgTWVudUNvbnRyb2xsZXIpO1xyXG5cclxuICAvKiogQG5nSW5qZWN0ICovXHJcbiAgZnVuY3Rpb24gTWVudUNvbnRyb2xsZXIoJG1kU2lkZW5hdiwgJHN0YXRlLCAkbWRDb2xvcnMsICRyb290U2NvcGUpIHtcclxuICAgIHZhciB2bSA9IHRoaXM7XHJcblxyXG4gICAgLy9CbG9jbyBkZSBkZWNsYXJhY29lcyBkZSBmdW5jb2VzXHJcbiAgICB2bS5vcGVuID0gb3BlbjtcclxuICAgIHZtLm9wZW5NZW51T3JSZWRpcmVjdFRvU3RhdGUgPSBvcGVuTWVudU9yUmVkaXJlY3RUb1N0YXRlO1xyXG4gICAgXHJcbiAgICAvLyBhZGRlZCB0byBtYWtlIHRoZSBtZW51IGhpZ2hsaWdodGVkXHJcbiAgICB2bS5jdXJyZW50TmF2SXRlbSA9ICRzdGF0ZS5jdXJyZW50Lm5hbWU7XHJcbiAgICAvLyByb290IHN0YXRlIGNoYW5nZSB3YXRjaGVyIHRvIGhpZ2hsaWdodCB0aGUgdGFiIG9uIGVhY2ggc3RhdGUgY2hhbmdlXHJcbiAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBcclxuICAgICAgZnVuY3Rpb24oZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMpeyBcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInN0YXRlIGNoYW5nZWQgZnJvbSAtIFwiLCBmcm9tU3RhdGUsIFwiIHRvIC0gXCIsIHRvU3RhdGUpO1xyXG4gICAgICAgIHZtLmN1cnJlbnROYXZJdGVtID0gdG9TdGF0ZS5uYW1lO1xyXG4gICAgfSlcclxuICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgIC8vIEFycmF5IGNvbnRlbmRvIG9zIGl0ZW5zIHF1ZSBzw6NvIG1vc3RyYWRvcyBubyBtZW51IGxhdGVyYWxcclxuICAgICAgdm0uaXRlbnNNZW51ID0gW107ICAgICBcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBvcGVuKCkgeyAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogTcOpdG9kbyBxdWUgZXhpYmUgbyBzdWIgbWVudSBkb3MgaXRlbnMgZG8gbWVudSBsYXRlcmFsIGNhc28gdGVuaGEgc3ViIGl0ZW5zXHJcbiAgICAgKiBjYXNvIGNvbnRyw6FyaW8gcmVkaXJlY2lvbmEgcGFyYSBvIHN0YXRlIHBhc3NhZG8gY29tbyBwYXLDom1ldHJvXHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIG9wZW5NZW51T3JSZWRpcmVjdFRvU3RhdGUoJG1kTWVudSwgZXYsIGl0ZW0pIHtcclxuICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKGl0ZW0uc3ViSXRlbnMpICYmIGl0ZW0uc3ViSXRlbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICRtZE1lbnUub3Blbihldik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJHN0YXRlLmdvKGl0ZW0uc3RhdGUpO1xyXG4gICAgICAgICRtZFNpZGVuYXYoJ2xlZnQnKS5jbG9zZSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0Q29sb3IoY29sb3JQYWxldHRlcykge1xyXG4gICAgICByZXR1cm4gJG1kQ29sb3JzLmdldFRoZW1lQ29sb3IoY29sb3JQYWxldHRlcyk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbn0pKCk7XHJcbiIsIihmdW5jdGlvbiAoKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXJcbiAgICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgICAuY29udHJvbGxlcignVmVjdG9yTGF5ZXJDb250cm9sbGVyJywgVmVjdG9yTGF5ZXJDb250cm9sbGVyKTtcblxuICBmdW5jdGlvbiBWZWN0b3JMYXllckNvbnRyb2xsZXIoJHN0YXRlLCBWZWN0b3JTZXJ2aWNlLCBsb2Rhc2gsIEMyRGlhbG9nLCBDMlRvYXN0LCAkdHJhbnNsYXRlLCBtYXBEaWFsb2dJbnB1dCkge1xuXG4gICAgdmFyIHZtID0gdGhpcztcbiAgICB2bS5zYXZlID0gc2F2ZTtcbiAgICB2bS5jbG9zZSA9IGNsb3NlO1xuICAgIHZtLm1vZGUgPSBudWxsO1xuXG4gICAgdm0udmlld1RpdGxlID0gXCJBZGQgTGF5ZXJcIjtcbiAgICB2bS5yZXNvdXJjZSA9IHtcbiAgICAgIHRpdGxlOiBudWxsLFxuICAgICAgZGVzY3JpcHRpb246IG51bGwsXG4gICAgICAvLyBsYXllck5hbWU6IFwidmVydGV4X3Byb2pfaWRfcHJvamVjdElkMV9sYXllcl9pZF9sYXllcklkX2xhdGVzdFwiLFxuICAgICAgcHJval9pZDogbnVsbCxcbiAgICAgIHVzZXJfaWQ6IG51bGwsXG4gICAgICBsYXllck5hbWU6IG51bGwsXG4gICAgICBsYXllcklkOiBudWxsXG4gICAgfVxuICAgIFxuICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBWZWN0b3JMYXllckNvbnRyb2xsZXIgPj4+IGluaXQgXCIpO1xuICAgICAgZGVmaW5lVmlld1N0YXRlKCk7XG4gICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZChtYXBEaWFsb2dJbnB1dC5tb2RlbCkpIHtcbiAgICAgICAgdm0ucmVzb3VyY2UudGl0bGUgPSBtYXBEaWFsb2dJbnB1dC5tb2RlbC50aXRsZTtcbiAgICAgICAgdm0ucmVzb3VyY2UuZGVzY3JpcHRpb24gPSBtYXBEaWFsb2dJbnB1dC5tb2RlbC5kZXNjO1xuICAgICAgICB2bS5yZXNvdXJjZS5sYXllck5hbWUgPSBtYXBEaWFsb2dJbnB1dC5tb2RlbC5sYXllck5hbWU7XG4gICAgICAgIHZtLnJlc291cmNlLmxheWVySWQgPSBtYXBEaWFsb2dJbnB1dC5tb2RlbC5sYXllcklkO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcImluaXQgLi4uLi4uIFwiLCB2bS5yZXNvdXJjZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2F2ZSgpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IFZlY3RvckxheWVyQ29udHJvbGxlciA+Pj4gc2F2ZSBcIiwgdm0ucmVzb3VyY2UpO1xuICAgICAgdmFyIHZlY3RvclNlcnZpY2UgPSBuZXcgVmVjdG9yU2VydmljZSgpO1xuICAgICAgaWYoYW5ndWxhci5lcXVhbHModm0ubW9kZSwgXCJhZGRcIikpIHtcbiAgICAgICAgaWYoISBsb2Rhc2guaXNFbXB0eShzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicHJvaklkXCIpKSkge1xuICAgICAgICAgIHZtLnJlc291cmNlLnByb2pfaWQgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicHJvaklkXCIpO1xuICAgICAgICAgIHZtLnJlc291cmNlLnVzZXJfaWQgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwidXNlcklkXCIpO1xuICAgICAgICB9XG4gICAgICAgIHZhciByZXFQYXJhbSA9IHtcbiAgICAgICAgICBcImFjdGlvblwiOiBcImNyZWF0ZUxheWVyc1wiLFxuICAgICAgICAgIFwiZGF0YVwiOiBbXVxuICAgICAgICB9O1xuICAgICAgICByZXFQYXJhbS5kYXRhLnB1c2godm0ucmVzb3VyY2UpO1xuICAgICAgICB2ZWN0b3JTZXJ2aWNlLmNyZWF0ZVZlY3RvckxheWVycyhyZXFQYXJhbSlcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcInJlc3BvbnNlIFwiLCByZXNwb25zZSk7XG4gICAgICAgICAgICBpZihyZXNwb25zZSA9PT0gXCJzdWNjZXNzXCIpIHtcbiAgICAgICAgICAgICAgQzJUb2FzdC5zdWNjZXNzKCR0cmFuc2xhdGUuaW5zdGFudCgnbWVzc2FnZXMuc2F2ZVN1Y2Nlc3MnKSk7ICBcbiAgICAgICAgICAgICAgY2xvc2UoKTtcbiAgICAgICAgICAgICAgLy8gJHN0YXRlLnJlbG9hZCgpO1xuICAgICAgICAgICAgICBsb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIEMyVG9hc3QuZXJyb3IoJHRyYW5zbGF0ZS5pbnN0YW50KCdtZXNzYWdlcy5zYXZlRXJyb3InKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICAgICAgICB9KTtcbiAgICAgIH0gXG4gICAgICBlbHNlIGlmKGFuZ3VsYXIuZXF1YWxzKHZtLm1vZGUsIFwiZWRpdFwiKSkge1xuICAgICAgICBpZighIGxvZGFzaC5pc0VtcHR5KHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJwcm9qSWRcIikpKSB7XG4gICAgICAgICAgdm0ucmVzb3VyY2UucHJval9pZCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJwcm9qSWRcIik7XG4gICAgICAgICAgdm0ucmVzb3VyY2UudXNlcl9pZCA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJ1c2VySWRcIik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJlZGl0IHNhdmluZy4uLi4uLiBcIiwgdm0ucmVzb3VyY2UpO1xuICAgICAgICB2YXIgcmVxUGFyYW0gPSB7XG4gICAgICAgICAgXCJhY3Rpb25cIjogXCJlZGl0TGF5ZXJzXCIsXG4gICAgICAgICAgXCJkYXRhXCI6IFt7XG4gICAgICAgICAgICBcInRpdGxlXCI6IHZtLnJlc291cmNlLnRpdGxlLFxuICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiOiB2bS5yZXNvdXJjZS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgIFwibGF5ZXJfaWRcIjogdm0ucmVzb3VyY2UubGF5ZXJJZCxcbiAgICAgICAgICAgIFwidXNlcl9pZFwiOiB2bS5yZXNvdXJjZS51c2VyX2lkLFxuICAgICAgICAgICAgXCJwcm9qX2lkXCI6IHZtLnJlc291cmNlLnByb2pfaWRcbiAgICAgICAgICAgIH1dXG4gICAgICAgIH07XG4gICAgICAgIC8vIHJlcVBhcmFtLmRhdGEucHVzaCh2bS5yZXNvdXJjZSk7XG4gICAgICAgIHZlY3RvclNlcnZpY2UuZWRpdFZlY3RvckxheWVycyhyZXFQYXJhbSlcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcInJlc3BvbnNlIFwiLCByZXNwb25zZSk7XG4gICAgICAgICAgICBpZihyZXNwb25zZSA9PT0gXCJzdWNjZXNzXCIpIHtcbiAgICAgICAgICAgICAgQzJUb2FzdC5zdWNjZXNzKCR0cmFuc2xhdGUuaW5zdGFudCgnbWVzc2FnZXMuc2F2ZVN1Y2Nlc3MnKSk7ICBcbiAgICAgICAgICAgICAgY2xvc2UoKTtcbiAgICAgICAgICAgICAgJHN0YXRlLnJlbG9hZCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgQzJUb2FzdC5lcnJvcigkdHJhbnNsYXRlLmluc3RhbnQoJ21lc3NhZ2VzLnNhdmVFcnJvcicpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERlZmluZSB0aGUgZGlhbG9nIHZpZXcgc3RhdGUgYXMgYWRkIG9yIGVkaXQgXG4gICAgICogYW5kIHBhcnNlIHRoZSB2aWV3IHRpdGxlXG4gICAgICogXG4gICAgICogQHJldHVybiB2b2lkXG4gICAgICovXG4gICAgZnVuY3Rpb24gZGVmaW5lVmlld1N0YXRlKCl7XG4gICAgICB2bS5tb2RlID0gYW5ndWxhci5pc0RlZmluZWQobWFwRGlhbG9nSW5wdXQubW9kZWwpPyAnZWRpdCcgOiAnYWRkJztcbiAgICAgIGlmICh2bS5tb2RlID09ICdhZGQnKSB7XG4gICAgICAgICAgdm0udmlld1RpdGxlID0gJHRyYW5zbGF0ZS5pbnN0YW50KCd2aWV3cy50aXRsZXMuYWRkTGF5ZXInKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdm0udmlld1RpdGxlID0gJHRyYW5zbGF0ZS5pbnN0YW50KCd2aWV3cy50aXRsZXMuZWRpdExheWVyJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xvc2UgdGhlIGRpYWxvZ1xuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNsb3NlKCkge1xuICAgICAgQzJEaWFsb2cuY2xvc2UoKTtcbiAgICB9XG5cbiAgICBpbml0KCk7XG4gIH1cblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuY29udHJvbGxlcignVmVjdG9yTGVmdFNpZGVuYXZDb250cm9sbGVyJywgVmVjdG9yTGVmdFNpZGVuYXZDb250cm9sbGVyKTtcblxuICAvKiogQG5nSW5qZWN0ICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gIGZ1bmN0aW9uIFZlY3RvckxlZnRTaWRlbmF2Q29udHJvbGxlcihHbG9iYWwsICRtZFNpZGVuYXYsICRtZERpYWxvZywgJHdpbmRvdywgbG9kYXNoLCAkcm9vdFNjb3BlLCBDMkRpYWxvZywgQzJUb2FzdCwgJHRyYW5zbGF0ZSwgJHN0YXRlLCBsZWFmbGV0LCBsZWFmbGV0RGF0YSwgJHNlc3Npb25TdG9yYWdlLCBWZWN0b3JTZXJ2aWNlKSB7XG4gICAgdmFyIHZtID0gdGhpcztcblxuICAgIHZtLmxheWVyQ2xpY2tlZCA9IGxheWVyQ2xpY2tlZDtcbiAgICB2bS5hY3RpdmF0ZUZlYXR1cmVFZGl0ID0gYWN0aXZhdGVGZWF0dXJlRWRpdDtcbiAgICB2bS5kZWxldGVMYXllciA9IGRlbGV0ZUxheWVyO1xuICAgIHZtLm9wZW5BdHRyaWJ1dGVQb3BVcCA9IG9wZW5BdHRyaWJ1dGVQb3BVcDtcbiAgICB2bS5sYXllclZpc2liaWxpdHkgPSBsYXllclZpc2liaWxpdHk7XG4gICAgdm0uY3JlYXRlTGF5ZXIgPSBjcmVhdGVMYXllcjtcbiAgICB2bS5zYXZlID0gc2F2ZTtcbiAgICB2bS50b2dnbGVMZWZ0ID0gdG9nZ2xlTGVmdDtcbiAgICB2bS5leHBvcnRMYXllciA9IGV4cG9ydExheWVyO1xuICAgIHZtLnVzZXJBbGxvdyA9IHVzZXJBbGxvdztcbiAgICB2bS5kcmF3Q29udHJvbCA9IG51bGw7IC8vIHRvb2xiYXIgY29udHJvbFxuICAgIHZtLmRyYXduSXRlbXMgPSBudWxsO1xuICAgIHZtLmxheWVycyA9IFtdO1xuICAgIHZtLmxlYWZsZXRMYXllcnMgPSBbXTtcbiAgICB2bS5jdXJyZW50bHlFZGl0aW5nTGF5ZXIgPSBudWxsO1xuICAgIHZtLmVkaXRNb2RlID0gbnVsbDtcbiAgICBcbiAgICAvLyBDYWxsZWQgZnJvbSByaWdodCBzaWRlIG5hdiBmb3IgYWRkaW5nIG5ld2x5IGNyZWF0ZWQgZmVhdHVyZSB0byBsZWFmbGV0IGxheWVyXG4gICAgJHJvb3RTY29wZS4kb24oJ2FkZEZlYXR1cmVUb0xheWVyJywgZnVuY3Rpb24oZXZlbnQsIGFyZ3Mpe1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gVmVjdG9yTGVmdFNpZGVuYXZDb250cm9sbGVyID4+PiBhZGRGZWF0dXJlVG9MYXllciBcIiwgYXJncyk7XG4gICAgICAvLyBsZWFmbGV0Lmdlb0pTT04oYXJncywge30pLmFkZFRvKHZtLmRyYXduSXRlbXMpO1xuICAgICAgdm0uZHJhd25JdGVtcy5hZGRMYXllcihhcmdzKTtcbiAgICAgIGxlYWZsZXREYXRhLmdldE1hcCgnbGVmdE1hcFZpZXdlcicpLnRoZW4oZnVuY3Rpb24gKG1hcCkge1xuICAgICAgICB2bS5kcmF3bkl0ZW1zLmFkZFRvKG1hcCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIEZpcnN0IGZ1bmN0aW9uIGNhbGxlZCBhZnRlciB0aGUgY29udHJvbGxlciBpcyByYW5cbiAgICAgKiBoZXJlIHRoZSBzdHVmZiBhcmUgaW5pdGlhbGl6ZWRcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IGdlLmxlZnQuc2lkZW5hdi5jb250cm9sbGVyID4+PiBhY3RpdmF0ZSBcIik7XG4gICAgICBpZighIGxvZGFzaC5pc0VtcHR5KCRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJwcm9qSWRcIikudG9TdHJpbmcoKSkpIHtcbiAgICAgICAgdmFyIHByb2pJZCA9ICRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJwcm9qSWRcIikudG9TdHJpbmcoKTtcbiAgICAgICAgdmFyIGxheWVyU2VydmljZSA9IG5ldyBWZWN0b3JTZXJ2aWNlKCk7XG4gICAgICAgIHZhciByZXFQYXJhbURhdGEgPSB7IFxuICAgICAgICAgIHByb2pfaWQ6IHByb2pJZCxcbiAgICAgICAgICB1c2VyX2lkOiAkc2Vzc2lvblN0b3JhZ2UuZ2V0T2JqZWN0KFwidXNlcklkXCIpLnRvU3RyaW5nKCksXG4gICAgICAgICAgZmV0Y2g6ICdhbGxMYXllcnMnXG4gICAgICAgIH07XG4gICAgICAgIGxheWVyU2VydmljZS5nZXRWZWN0b3JMYXllcnMocmVxUGFyYW1EYXRhKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCl7XG4gICAgICAgICAgICBsb2Rhc2guZm9yRWFjaChyZXN1bHQsIGZ1bmN0aW9uKGxheWVyKSB7XG4gICAgICAgICAgICAgIGxheWVyLmxheWVyTmFtZSA9IFwidmVydGV4X3Byb2pfaWRfXCIrIHByb2pJZCArXCJfbGF5ZXJfaWRfXCIrIGxheWVyLmxheWVyX2lkICtcIl9sYXRlc3RcIlxuICAgICAgICAgICAgICAvLyBsb2FkIFdGUyBsYXllcnMgZnJvbSBHZW9zZXJ2ZXJcbiAgICAgICAgICAgICAgbG9hZFdGU0xheWVycyhsYXllcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBoYW5kbGUgZmVhdHVyZSBjcmVhdGlvbiBvbiBtYXBcbiAgICAgIGxlYWZsZXREYXRhLmdldE1hcCgnbGVmdE1hcFZpZXdlcicpLnRoZW4oZnVuY3Rpb24gKG1hcCkge1xuICAgICAgICBpZih0eXBlb2Ygdm0uZHJhd25JdGVtcyAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgIC8vIGFkZGVkIHRoaXMgYmxvYyBvZiBjb2RlIGZvciBsZXR0aW5nIHVzZXIgZ2V0IGZlYXR1cmUtaW5mbyB3aXRob3V0IGVudGVyaW5nIGVkaXQtbW9kZVxuICAgICAgICAgIGlmKHZtLmRyYXduSXRlbXMgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHZtLmRyYXduSXRlbXMgPSBuZXcgbGVhZmxldC5GZWF0dXJlR3JvdXAoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdm0uZHJhd25JdGVtcy5vbignY2xpY2snLCBvbkZlYXR1cmVDbGlja2VkKTtcbiAgICAgICAgICAvLyB2bS5kcmF3bkl0ZW1zLmFkZFRvKG1hcCk7XG4gICAgICAgICAgLy8gbWFwLmFkZExheWVyKHZtLmRyYXduSXRlbXMpO1xuICAgICAgICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICBpZigkc3RhdGUuY3VycmVudC5uYW1lID09PSBcImFwcC52ZWN0b3JcIikge1xuICAgICAgICAgICAgbWFwLm9uKCdkcmF3OmNyZWF0ZWQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICB2YXIgbGVhZkxheWVyID0gZS5sYXllcjtcbiAgICAgICAgICAgICAgLy8gdm0uZHJhd25JdGVtcy5hZGRMYXllcihsZWFmTGF5ZXIpO1xuICAgICAgICAgICAgICB2YXIgZHJhd3NHZW9Kc29uID0gbGVhZkxheWVyLnRvR2VvSlNPTigpO1xuICAgICAgICAgICAgICB2bS5lZGl0TW9kZSA9IFwiYWRkXCI7XG4gICAgICAgICAgICAgIC8vIG9wZW5BdHRyaWJ1dGVQb3BVcChkcmF3c0dlb0pzb24sIHZtLmN1cnJlbnRseUVkaXRpbmdMYXllciwgdm0uZWRpdE1vZGUsIGUpO1xuICAgICAgICAgICAgICBvcGVuQXR0cmlidXRlUG9wVXAobGVhZkxheWVyLCB2bS5jdXJyZW50bHlFZGl0aW5nTGF5ZXIsIHZtLmVkaXRNb2RlLCBlKTtcbiAgICAgICAgICAgIH0uYmluZCh2bS5kcmF3bkl0ZW1zKSk7XG4gICAgICAgICAgICBtYXAub24oJ2RyYXc6ZWRpdHN0YXJ0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgLy8gIGNvbnNvbGUubG9nKFwiPj4+IGRyYXc6ZWRpdHN0YXJ0IFwiKTtcbiAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSBcImVkaXQtR2VvbVwiO1xuICAgICAgICAgICAgICAvLyAgdm0uZHJhd25JdGVtcy5vZmYoJ2NsaWNrJywgb25GZWF0dXJlQ2xpY2tlZCk7XG4gICAgICAgICAgICB9LmJpbmQodm0uZHJhd25JdGVtcykpO1xuICAgICAgICAgICAgbWFwLm9uKCdkcmF3OmVkaXRzdG9wJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gZHJhdzplZGl0c3RvcCBcIik7XG4gICAgICAgICAgICAgIHZtLmVkaXRNb2RlID0gbnVsbDtcbiAgICAgICAgICAgIH0uYmluZCh2bS5kcmF3bkl0ZW1zKSk7XG4gICAgICAgICAgICBtYXAub24oJ2RyYXc6ZWRpdGVkJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gZHJhdzplZGl0ZWQgXCIpO1xuICAgICAgICAgICAgICB2YXIgbGF5ZXJzID0gZS5sYXllcnM7XG4gICAgICAgICAgICAgIC8qIGxheWVycy5lYWNoTGF5ZXIoZnVuY3Rpb24gKGxheWVyKSB7XG4gICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhsYXllcik7XG4gICAgICAgICAgICAgICAgICAvLyByZXBsYWNlIGZlYXR1cmUgZ2VvbSB3aXRoIHRoZSBuZXcgZWRpdHRlZCBnZW9tIHZhbHVlXG4gICAgICAgICAgICAgICAgICBsYXllci5mZWF0dXJlLmdlb21ldHJ5LmNvb3JkaW5hdGVzID0gT2JqZWN0LnZhbHVlcyhsYXllci5nZXRMYXRMbmcoKSk7XG4gICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoXCJhZGRGZWF0dXJlVG9VcGRhdGVcIiwgbGF5ZXIuZmVhdHVyZSk7XG4gICAgICAgICAgICAgIH0pOyAqL1xuICAgICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoXCJnZW9tVXBkYXRlZFwiLCBsYXllcnMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBtYXAub24oJ2RyYXc6ZGVsZXRlc3RhcnQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBkcmF3OmRlbGV0ZXN0YXJ0IFwiKTtcbiAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSBcImRlbGV0ZVwiO1xuICAgICAgICAgICAgfS5iaW5kKHZtLmRyYXduSXRlbXMpKTtcbiAgICAgICAgICAgIG1hcC5vbignZHJhdzpkZWxldGVzdG9wJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gZHJhdzpkZWxldGVzdG9wIFwiKTtcbiAgICAgICAgICAgICAgdm0uZWRpdE1vZGUgPSBudWxsO1xuICAgICAgICAgICAgfS5iaW5kKHZtLmRyYXduSXRlbXMpKTtcbiAgICAgICAgICAgIG1hcC5vbignZHJhdzpkZWxldGVkJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gZHJhdzpkZWxldGVkIFwiKTtcbiAgICAgICAgICAgICAgdmFyIGxheWVycyA9IGUubGF5ZXJzO1xuICAgICAgICAgICAgICBwcmVwYXJlRGVsZXRlUGFyYW1zKGxheWVycyk7XG4gICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gb25GZWF0dXJlQ2xpY2tlZChlKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBvbkZlYXR1cmVDbGlja2VkID4+PiBcIiwgZSk7XG4gICAgICBpZighKHZtLmVkaXRNb2RlID09PSBcImVkaXQtR2VvbVwiIHx8IHZtLmVkaXRNb2RlID09PSBcImRlbGV0ZVwiKSkge1xuICAgICAgICAvLyBleHBlY3RzIG9ubHkgYSBzaW5nbGUgZmVhdHVyZVxuICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoXCJzaG93RmVhdHVyZUF0dHJcIiwgZS5sYXllci5mZWF0dXJlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVMYXllcigpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IGdlLmxlZnQuc2lkZW5hdi5jb250cm9sbGVyID4+PiBjcmVhdGVMYXllclwiKTtcbiAgICAgIGNsb3NlKCk7XG4gICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICBsb2NhbHM6IHtcbiAgICAgICAgICBtYXBEaWFsb2dJbnB1dDoge1xuICAgICAgICAgICAgLy8gbW9kZWw6IHJlc291cmNlLFxuICAgICAgICAgICAgcmVtb3ZlRm46IHZtLnJlbW92ZVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgY29udHJvbGxlcjogJ1ZlY3RvckxheWVyQ29udHJvbGxlcicsXG4gICAgICAgIGNvbnRyb2xsZXJBczogJ2N0cmwnLFxuICAgICAgICB0ZW1wbGF0ZVVybDogR2xvYmFsLmNsaWVudFBhdGggKyAnL3ZlY3Rvci9kaWFsb2cvdmVjdG9yTGF5ZXIuaHRtbCcsXG4gICAgICAgIGhhc0JhY2tkcm9wOiBmYWxzZVxuICAgICAgfTtcblxuICAgICAgQzJEaWFsb2cuY3VzdG9tKGNvbmZpZykudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIHJlbG9hZCB0aGUgaXRlbXMgZnJvbSBiYWNrLWVuZFxuICAgICAgICAvLyB2bS5zZWFyY2goKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJzYXZlIGRvbmVcIik7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBsYXllckNsaWNrZWQobGF5ZXIpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiPj4+IHZlY3Rvci5sZWZ0LnNpZGVuYXYuY29udHJvbGxlciA+Pj4gbGF5ZXJDbGlja2VkIFwiLCBsYXllcik7XG4gICAgICBjbG9zZSgpO1xuICAgICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgbG9jYWxzOiB7XG4gICAgICAgICAgbWFwRGlhbG9nSW5wdXQ6IHtcbiAgICAgICAgICAgIG1vZGVsOiBsYXllclxuICAgICAgICAgICAgLy8gcmVtb3ZlRm46IHZtLnJlbW92ZVxuICAgICAgICAgICAgLy8gbW9kZTogJ2VkaXQnXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBjb250cm9sbGVyOiAnVmVjdG9yTGF5ZXJDb250cm9sbGVyJyxcbiAgICAgICAgY29udHJvbGxlckFzOiAnY3RybCcsXG4gICAgICAgIHRlbXBsYXRlVXJsOiBHbG9iYWwuY2xpZW50UGF0aCArICcvdmVjdG9yL2RpYWxvZy92ZWN0b3JMYXllci5odG1sJyxcbiAgICAgICAgaGFzQmFja2Ryb3A6IGZhbHNlXG4gICAgICB9O1xuXG4gICAgICBDMkRpYWxvZy5jdXN0b20oY29uZmlnKS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gcmVsb2FkIHRoZSBpdGVtcyBmcm9tIGJhY2stZW5kXG4gICAgICAgIC8vIHZtLnNlYXJjaCgpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInNhdmUgZG9uZVwiKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFjdGl2YXRlIEVkaXQgdG9vbGJhciBmb3IgcGFydGljdWxhciBsYXllclxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7YW55fSBsYXllciBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhY3RpdmF0ZUZlYXR1cmVFZGl0KGxheWVyKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiB2ZWN0b3IubGVmdC5zaWRlbmF2LmNvbnRyb2xsZXIgPj4+IGFjdGl2YXRlRmVhdHVyZUVkaXQgXCIsIGxheWVyKTtcblxuICAgICAgbGVhZmxldERhdGEuZ2V0TWFwKCdsZWZ0TWFwVmlld2VyJykudGhlbihmdW5jdGlvbiAobWFwKSB7XG4gICAgICAgIGlmKHZtLmRyYXdDb250cm9sICE9PSBudWxsKSB7XG4gICAgICAgICAgdm0uZHJhd0NvbnRyb2wucmVtb3ZlKCk7XG4gICAgICAgICAgdm0uZHJhd0NvbnRyb2wgPSBudWxsO1xuICAgICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLmRyYXduSXRlbXMpKSB7XG4gICAgICAgICAgICB2bS5kcmF3bkl0ZW1zID0gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYodm0uZHJhd0NvbnRyb2wgPT09IG51bGwpIHtcbiAgICAgICAgICAvLyB2bS5kcmF3bkl0ZW1zID0gbmV3IGxlYWZsZXQuRmVhdHVyZUdyb3VwKCk7XG4gICAgICAgICAgLy8gdm0uZHJhd25JdGVtcy5vbih7XG4gICAgICAgICAgLy8gICAnY2xpY2snOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIC8vICAgICAvLyBleHBlY3RzIG9ubHkgYSBzaW5nbGUgZmVhdHVyZVxuICAgICAgICAgIC8vICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoXCJzaG93RmVhdHVyZUF0dHJcIiwgZS5sYXllci5mZWF0dXJlKTtcbiAgICAgICAgICAvLyAgIH1cbiAgICAgICAgICAvLyB9KVxuICAgICAgICAgIC8vIGFkZGluZyBjdXJyZW50IGxheWVycyBmZWF0dXJlcyB0byBkcmF3bkl0ZW1zXG4gICAgICAgICAgLy8gbG9kYXNoLmZvckVhY2gobGF5ZXIuZ2V0TGF5ZXJzKCksIGZ1bmN0aW9uKGVhY2hGZWF0dXJlKSB7XG4gICAgICAgICAgLy8gICAvLyBjb25zb2xlLmxvZyhcIj4+PiBlYWNoRmVhdHVyZSBcIiwgZWFjaEZlYXR1cmUpO1xuICAgICAgICAgIC8vICAgLy8gZWFjaEZlYXR1cmUuZWRpdGluZy5lbmFibGUoKTtcbiAgICAgICAgICAvLyAgIGVhY2hGZWF0dXJlLmFkZFRvKHZtLmRyYXduSXRlbXMpO1xuICAgICAgICAgIC8vIH0pO1xuICAgICAgICAgIC8vIHZtLmRyYXduSXRlbXMuYWRkVG8obWFwKTtcbiAgICAgICAgICAvLyBtYXAuYWRkTGF5ZXIodm0uZHJhd25JdGVtcyk7XG4gICAgICAgICAgLy8gXG4gICAgICAgICAgdm0uZHJhd25JdGVtcyA9IG5ldyBsZWFmbGV0LkZlYXR1cmVHcm91cCgpO1xuICAgICAgICAgIC8vIGFkZGluZyBjdXJyZW50IGxheWVycyBmZWF0dXJlcyB0byBkcmF3bkl0ZW1zXG4gICAgICAgICAgbG9kYXNoLmZvckVhY2gobGF5ZXIuZ2V0TGF5ZXJzKCksIGZ1bmN0aW9uKGVhY2hGZWF0dXJlKSB7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBlYWNoRmVhdHVyZSBcIiwgZWFjaEZlYXR1cmUpO1xuICAgICAgICAgICAgLy8gZWFjaEZlYXR1cmUuZWRpdGluZy5lbmFibGUoKTtcbiAgICAgICAgICAgIC8vIGNoZWNrIGlzIHJvbGUgaXMgMywgaWYgc28gdGhhbiBjaGVjayBpZiB0aGUgZmVhdHVyZSdzIHVzZXIgaXMgdGhlIHNhbWUgYXMgbG9nZ2VkIGluIHVzZXJcbiAgICAgICAgICAgIGlmKGVhY2hGZWF0dXJlLmZlYXR1cmUucHJvcGVydGllcy5sYXllck5hbWUgPT09IGxheWVyLmxheWVySWQpIHtcbiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJiZWZvcmUgYWRkaW5nIHRvIGRyYXduaXRlbXMgXCIsIGVhY2hGZWF0dXJlLmZlYXR1cmUpO1xuICAgICAgICAgICAgICBpZigkc2Vzc2lvblN0b3JhZ2UuZ2V0T2JqZWN0KFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjNcIikge1xuICAgICAgICAgICAgICAgIGlmKGVhY2hGZWF0dXJlLmZlYXR1cmUucHJvcGVydGllcy51c2VyX2lkID09PSAkc2Vzc2lvblN0b3JhZ2UuZ2V0T2JqZWN0KFwidXNlcklkXCIpKSB7XG4gICAgICAgICAgICAgICAgICBlYWNoRmVhdHVyZS5hZGRUbyh2bS5kcmF3bkl0ZW1zKTsgIFxuICAgICAgICAgICAgICAgICAgdm0uZHJhd25JdGVtcy5hZGRUbyhtYXApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlYWNoRmVhdHVyZS5hZGRUbyh2bS5kcmF3bkl0ZW1zKTtcbiAgICAgICAgICAgICAgICB2bS5kcmF3bkl0ZW1zLmFkZFRvKG1hcCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICB2bS5kcmF3Q29udHJvbCA9IG5ldyBsZWFmbGV0LkNvbnRyb2wuRHJhdyh7XG4gICAgICAgICAgICBkcmF3OiB7XG4gICAgICAgICAgICAgIHBvbHlnb246IHRydWUsXG4gICAgICAgICAgICAgIHBvbHlsaW5lOiB0cnVlLFxuICAgICAgICAgICAgICByZWN0YW5nbGU6IGZhbHNlLFxuICAgICAgICAgICAgICBjaXJjbGU6IGZhbHNlLFxuICAgICAgICAgICAgICBtYXJrZXI6IHRydWUsXG4gICAgICAgICAgICAgIGNpcmNsZW1hcmtlcjogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlZGl0OiB7XG4gICAgICAgICAgICAgICAgICAgIGZlYXR1cmVHcm91cDogdm0uZHJhd25JdGVtc1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBvc2l0aW9uOiAndG9wcmlnaHQnXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgbWFwLmFkZENvbnRyb2wodm0uZHJhd0NvbnRyb2wpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHNldCB0aGUgY3VycmVudGx5IGVkaXRpbmcgbGF5ZXJcbiAgICAgICAgdm0uY3VycmVudGx5RWRpdGluZ0xheWVyID0gbGF5ZXI7XG4gICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdChcInNldEN1cnJlbnRFZGl0TGF5ZXJcIiwgeyBkYXRhIDogeyBsYXllciA6IHZtLmN1cnJlbnRseUVkaXRpbmdMYXllciB9fSk7XG4gICAgICAgIGNsb3NlKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIFxuICAgIGZ1bmN0aW9uIGFkZE5vbkdyb3VwTGF5ZXJzKHNvdXJjZUxheWVyLCB0YXJnZXRHcm91cCkge1xuICAgICAgaWYgKHNvdXJjZUxheWVyIGluc3RhbmNlb2YgTC5MYXllckdyb3VwKSB7XG4gICAgICAgIHNvdXJjZUxheWVyLmVhY2hMYXllcihmdW5jdGlvbiAobGF5ZXIpIHtcbiAgICAgICAgICBhZGROb25Hcm91cExheWVycyhsYXllciwgdGFyZ2V0R3JvdXApO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRhcmdldEdyb3VwLmFkZExheWVyKHNvdXJjZUxheWVyKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIHRoZSBsYXllciBmcm9tIG1hcCBhbmQgZGVsZXRlcyBpdCBmcm9tIG91ciBjb2xsZWN0aW9uXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IGxheWVyIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGRlbGV0ZUxheWVyKGxheWVyKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiB2ZWN0b3IubGVmdC5zaWRlbmF2LmNvbnRyb2xsZXIgPj4+IGRlbGV0ZUxheWVyIFwiLCBsYXllcik7XG4gICAgICAvLyBjaGVjayBmb3IgZHJhdyBjb250cm9sXG4gICAgICAvLyBpZih2bS5kcmF3Q29udHJvbCAhPT0gbnVsbCkge1xuICAgICAgLy8gICB2bS5kcmF3Q29udHJvbC5yZW1vdmUoKTtcbiAgICAgIC8vICAgdm0uZHJhd0NvbnRyb2wgPSBudWxsO1xuICAgICAgLy8gICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5kcmF3bkl0ZW1zKSkge1xuICAgICAgLy8gICAgIGNvbnNvbGUubG9nKFwidm0uZHJhd25JdGVtcyA9IFwiLCB2bS5kcmF3bkl0ZW1zKTtcbiAgICAgIC8vICAgICB2bS5kcmF3bkl0ZW1zID0gbnVsbDtcbiAgICAgIC8vICAgfVxuICAgICAgLy8gfVxuXG4gICAgICAvLyAvLyBjbGVhbiBmZWF0dXJlcyBmcm9tIG1hcCBpLmUgcmVtb3ZlIGxheWVyIGZyb20gbWFwXG4gICAgICAvLyBsZWFmbGV0RGF0YS5nZXRNYXAoJ2xlZnRNYXBWaWV3ZXInKS50aGVuKGZ1bmN0aW9uIChtYXApIHtcbiAgICAgIC8vICAgbWFwLnJlbW92ZUxheWVyKGxheWVyKTtcbiAgICAgIC8vIH0pO1xuXG4gICAgICAvLyB2bS5sZWFmbGV0TGF5ZXJzID0gbG9kYXNoLnJlamVjdCh2bS5sZWFmbGV0TGF5ZXJzLCBmdW5jdGlvbihsYXllclRvRGVsZXRlKSB7IFxuICAgICAgLy8gICBpZihsZWFmbGV0LnN0YW1wKGxheWVyVG9EZWxldGUpID09PSBsZWFmbGV0LnN0YW1wKGxheWVyKSkge1xuICAgICAgLy8gICAgIHJldHVybiB0cnVlO1xuICAgICAgLy8gICB9XG4gICAgICAvLyB9KTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiQWZ0ZXIgZGVsZXRlaW5nIFwiLCB2bS5sZWFmbGV0TGF5ZXJzKTtcblxuICAgICAgdmFyIGNvbmZpcm0gPSAkbWREaWFsb2cuY29uZmlybSgpXG4gICAgICAgICAgICAudGl0bGUoJHRyYW5zbGF0ZS5pbnN0YW50KCdtZXNzYWdlcy5kZWxldGVMYXllclRpdGxlJykpXG4gICAgICAgICAgICAudGV4dENvbnRlbnQoJHRyYW5zbGF0ZS5pbnN0YW50KCdtZXNzYWdlcy5kZWxldGVMYXllck1lc3NhZ2UnKSlcbiAgICAgICAgICAgIC5hcmlhTGFiZWwoJ0x1Y2t5IGRheScpXG4gICAgICAgICAgICAvLyAudGFyZ2V0RXZlbnQoZXYpXG4gICAgICAgICAgICAub2soJHRyYW5zbGF0ZS5pbnN0YW50KCdtZXNzYWdlcy55ZXMnKSlcbiAgICAgICAgICAgIC5jYW5jZWwoJHRyYW5zbGF0ZS5pbnN0YW50KCdtZXNzYWdlcy5ubycpKTtcblxuICAgICAgJG1kRGlhbG9nLnNob3coY29uZmlybSkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgLy8gJHNjb3BlLnN0YXR1cyA9ICdZb3UgZGVjaWRlZCB0byBnZXQgcmlkIG9mIHlvdXIgZGVidC4nO1xuICAgICAgICB2YXIgcmVxUGFyYW0gPSB7XG4gICAgICAgICAgXCJhY3Rpb25cIjogXCJkZWxldGVMYXllcnNcIixcbiAgICAgICAgICBcImRhdGFcIjogW3tcbiAgICAgICAgICAgIFwibGF5ZXJfaWRcIjogbGF5ZXIubGF5ZXJJZCxcbiAgICAgICAgICAgIFwidXNlcl9pZFwiOiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwidXNlcklkXCIpLFxuICAgICAgICAgICAgXCJwcm9qX2lkXCI6IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJwcm9qSWRcIilcbiAgICAgICAgICB9XVxuICAgICAgICAgIH07XG4gICAgICAgIC8vIGNhbGwgZGVsZXRlIEFQSSBhbmQgc3RhdGUucmVsb2FkXG4gICAgICAgIHZhciB2ZWN0b3JTZXJ2aWNlID0gbmV3IFZlY3RvclNlcnZpY2UoKTtcbiAgICAgICAgdmVjdG9yU2VydmljZS5kZWxldGVWZWN0b3JMYXllcihyZXFQYXJhbSlcbiAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXMpe1xuICAgICAgICAgICAgaWYocmVzID09PSBcInN1Y2Nlc3NcIikge1xuICAgICAgICAgICAgICAkc3RhdGUucmVsb2FkKCk7XG4gICAgICAgICAgICAgIEMyVG9hc3Quc3VjY2VzcygkdHJhbnNsYXRlLmluc3RhbnQoJ21lc3NhZ2VzLm9wZXJhdGlvblN1Y2Nlc3MnKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBDMlRvYXN0LnN1Y2Nlc3MoJHRyYW5zbGF0ZS5pbnN0YW50KCdtZXNzYWdlcy5vcGVyYXRpb25FcnJvcicpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJFcnJvciB3aGlsZSBkZWxldGluZyBcIixlcnIpO1xuICAgICAgICB9KTtcbiAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIkRlbGV0aW5nIExheWVyIENhbmNlbGxlZFwiKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQWNjZXB0cyBhcnJheSBvZiBsYXllciBuYW1lcyBhbmQgZmlyZXMgV0ZTIGNhbGxzIHRvIGxvYWQgdGhlbSBhcyBXRlMgbGF5ZXJcbiAgICAgKiBHZW5lcmF0ZXMgYW4gYXJyYXkgb2YgbGF5ZXIgbGlzdCBcImxlYWZsZXRMYXllcnNcIiB3aGljaCBtYWludGFpbnMgYSBsaXN0IG9mIGxheWVycyBhZGRlZCB0byBtYXBcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gW3thbnl9XSBsYXllcnMgXG4gICAgICovXG4gICAgZnVuY3Rpb24gbG9hZFdGU0xheWVycyhsYXllcikge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gdmVjdG9yLmxlZnQuc2lkZW5hdi5jb250cm9sbGVyID4+PiBsb2FkV0ZTTGF5ZXJzIFwiLCBsYXllcik7XG4gICAgICAvLyBsb2Rhc2guZm9yRWFjaChsYXllcnMsIGZ1bmN0aW9uKGxheWVyKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiY2FsbGluZyBnZW9zZXJ2ZXIgZm9yIGxheWVyID0gXCIsIGxheWVyKTtcbiAgICAgICAgbGVhZmxldERhdGEuZ2V0TWFwKCdsZWZ0TWFwVmlld2VyJykudGhlbihmdW5jdGlvbiAobWFwKSB7XG4gICAgICAgICAgLy8gTWFwTGF5ZXJTZXJ2aWNlLmFkZFdGU0xheWVyKGxheWVyLmxheWVyTmFtZSwgJ2xlZnRNYXBWaWV3ZXInKTtcbiAgICAgICAgICAvLyBjcmVhdGUgbGF5ZXIgb2JqZWN0cyBhbmQga2VlcCBpdCBpbiB2bS5sYXllcnMgbGlzdCBcbiAgICAgICAgICB2YXIgdGVtcExheWVyID0gbmV3IGxlYWZsZXQuV0ZTVCh7XG4gICAgICAgICAgICAvLyB1cmw6ICdodHRwczovL2RlbW8uZ2VvLXNvbHV0aW9ucy5pdDo0NDMvZ2Vvc2VydmVyL293cycsXG4gICAgICAgICAgICAvLyB0eXBlTlM6ICd0aWdlcicsXG4gICAgICAgICAgICAvLyB0eXBlTmFtZTogJ3RpZ2VyX3JvYWRzJyxcbiAgICAgICAgICAgIHVybDogJ2h0dHA6Ly8wLjAuMC4wOjgwODEvZ2Vvc2VydmVyL293cycsXG4gICAgICAgICAgICB0eXBlTlM6ICd2ZWN0b3InLFxuICAgICAgICAgICAgdHlwZU5hbWU6IGxheWVyLmxheWVyTmFtZSxcbiAgICAgICAgICAgIC8vIGNyczogbGVhZmxldC5DUlMuRVBTRzQzMjYsXG4gICAgICAgICAgICBnZW9tZXRyeUZpZWxkOiAndGhlX2dlb20nLFxuICAgICAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAgICAgY29sb3I6IFwiI1wiKygoMTw8MjQpKk1hdGgucmFuZG9tKCl8MCkudG9TdHJpbmcoMTYpLFxuICAgICAgICAgICAgICAvLyB3ZWlnaHQ6IDEsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZmlsbE9wYWNpdHk6MC4yXG4gICAgICAgICAgfSwgbmV3IGxlYWZsZXQuRm9ybWF0Lkdlb0pTT04oe1xuICAgICAgICAgICAgY3JzOiBsZWFmbGV0LkNSUy5FUFNHNDMyNi8qICxcbiAgICAgICAgICAgIHBvaW50VG9MYXllcihnZW9Kc29uUG9pbnQsIGxhdGxuZykge1xuICAgICAgICAgICAgICBjb25zdCBsYXllciA9IG5ldyBMLkNpcmNsZU1hcmtlcihsYXRsbmcsIHtcbiAgICAgICAgICAgICAgICByYWRpdXM6IDEwLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgcmV0dXJuIGxheWVyO1xuICAgICAgICAgICAgfSwgKi9cbiAgICAgICAgICB9KSkuYWRkVG8obWFwKVxuICAgICAgICAgICAgLm9uKCdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAvLyBtYXAuZml0Qm91bmRzKHRlbXBMYXllci5nZXRMYXllcnMoKVswXS5nZXRCb3VuZHMoKSk7XG4gICAgICAgICAgICAgIGlmKHRlbXBMYXllci5nZXRCb3VuZHMoKS5pc1ZhbGlkKCkpIHtcbiAgICAgICAgICAgICAgICBtYXAuZml0Qm91bmRzKHRlbXBMYXllci5nZXRCb3VuZHMoKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdGVtcExheWVyLnZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgICB0ZW1wTGF5ZXIubGF5ZXJOYW1lID0gXCJ2ZXJ0ZXhfcHJval9pZF9cIisgc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInByb2pJZFwiKSArXCJfbGF5ZXJfaWRfXCIrIGxheWVyLmxheWVyX2lkICtcIl9sYXRlc3RcIjtcbiAgICAgICAgICAgICAgdGVtcExheWVyLnRpdGxlID0gbGF5ZXIudGl0bGU7XG4gICAgICAgICAgICAgIHRlbXBMYXllci5sYXllcklkID0gbGF5ZXIubGF5ZXJfaWQ7XG4gICAgICAgICAgICAgIHRlbXBMYXllci5kZXNjID0gbGF5ZXIuZGVzY3JpcHRpb247XG4gICAgICAgICAgICAgIC8vIHN0b3JlIGluIG15IGNvbGxlY3Rpb24gdG8gYmUgdXNlZCBcbiAgICAgICAgICAgICAgdm0ubGVhZmxldExheWVycy5wdXNoKHRlbXBMYXllcik7XG5cbiAgICAgICAgICAgICAgbG9kYXNoLmZvckVhY2godGVtcExheWVyLmdldExheWVycygpLCBmdW5jdGlvbihlYWNoRmVhdHVyZSkge1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IGVhY2hGZWF0dXJlIFwiLCBlYWNoRmVhdHVyZSwgbGF5ZXIubGF5ZXJfaWQpO1xuICAgICAgICAgICAgICAgIGVhY2hGZWF0dXJlLmZlYXR1cmUucHJvcGVydGllcy5sYXllck5hbWUgPSBsYXllci5sYXllcl9pZDtcbiAgICAgICAgICAgICAgICBlYWNoRmVhdHVyZS5hZGRUbyh2bS5kcmF3bkl0ZW1zKTtcbiAgICAgICAgICAgICAgfSk7ICBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIC8vIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG9wZW5BdHRyaWJ1dGVQb3BVcChmZWF0dXJlR2VvanNvbiwgbGF5ZXIsIG1vZGUsIGV2KSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiB2ZWN0b3IubGVmdC5zaWRlbmF2LmNvbnRyb2xsZXIgPj4+IG9wZW5BdHRyaWJ1dGVQb3BVcCBcIiwgZmVhdHVyZUdlb2pzb24sIGxheWVyKTtcbiAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdChcIm9wZW5SaWdodE5hdlwiLCAvKiBGZWF0dXJlU2VydmljZS5jcmVhdGVPYmplY3RGcm9tR2VvSnNvbihsYXllci5mZWF0dXJlKSAqL1xuICAgICAgeyBkYXRhOnsgXG4gICAgICAgICAgbGF5ZXI6IGxheWVyLCBcbiAgICAgICAgICBsYXllcklkOiBsYXllci5sYXllcklkLCBcbiAgICAgICAgICBmZWF0dXJlOiBmZWF0dXJlR2VvanNvbiwgXG4gICAgICAgICAgb3BlcmF0aW9uOiBcImNyZWF0ZVwiLFxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoYW5nZXMgdGhlIHZpc2liaWx0eSBvZiBhIGxheWVyXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IGxheWVyIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGxheWVyVmlzaWJpbGl0eShsYXllcikge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gbGF5ZXJWaXNpYmlsaXR5IFwiLCBsYXllciwgbGF5ZXIudmlzaWJsZSk7XG4gICAgICBsZWFmbGV0RGF0YS5nZXRNYXAoJ2xlZnRNYXBWaWV3ZXInKS50aGVuKGZ1bmN0aW9uIChtYXApIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gbGF5ZXJWaXNpYmlsaXR5ID4+PiBcIiwgbWFwKTtcbiAgICAgICAgaWYobGF5ZXIudmlzaWJsZSkge1xuICAgICAgICAgIG1hcC5hZGRMYXllcihsYXllcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbWFwLnJlbW92ZUxheWVyKGxheWVyKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcHJlcGFyZURlbGV0ZVBhcmFtcyhmZWF0dXJlcykge1xuICAgICAgXG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoXCJmZWF0dXJlRGVsZXRlZFwiLCBcbiAgICAgICAgeyBkYXRhOnsgXG4gICAgICAgICAgICBmZWF0dXJlczogZmVhdHVyZXMsXG4gICAgICAgICAgICBvcGVyYXRpb246IFwiZGVsZXRlXCIsXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRMYXllckJ5TmFtZShsYXllck5hbWUpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiPj4+IGdldExheWVyQnlOYW1lID4+PiBcIiwgbGF5ZXJOYW1lKTtcbiAgICAgIGxlYWZsZXREYXRhLmdldE1hcCgnbGVmdE1hcFZpZXdlcicpLnRoZW4oZnVuY3Rpb24gKG1hcCkge1xuICAgICAgICBtYXAuZWFjaExheWVyKGZ1bmN0aW9uKGxheWVyKXtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcImVhY2ggbGF5ZXIgPSBcIiwgbGF5ZXIpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsb3NlIHRoaXMgc2lkZW5hdlxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNsb3NlICgpIHtcbiAgICAgICRtZFNpZGVuYXYoJ2xlZnQnKS5jbG9zZSgpO1xuICAgIH0gICAgXG5cbiAgICAvKipcbiAgICAgKiBPcGVuIHRoaXMgc2lkZW5hdlxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG9wZW4gKCkge1xuICAgICAgJG1kU2lkZW5hdignbGVmdCcpLm9wZW4oKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNYWluIGZ1bmN0aW9uIHdoaWNoIHNlbmQgdGhlIE1vZGlmaWNhdGlvbnMgdG8gc2VydmVyXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2F2ZSgpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IFZlY3RvckxlZnRTaWRlbmF2Q29udHJvbGxlciA+Pj4gc2F2ZSBcIik7XG4gICAgICB2YXIgcmVxUGFyYW0gPSB7XG4gICAgICAgICAgXCJhY3Rpb25cIjogXCJjcmVhdGVGZWF0dXJlc1wiLFxuICAgICAgICAgIFwidXNlcl9pZFwiOiAkc2Vzc2lvblN0b3JhZ2UuZ2V0T2JqZWN0KFwidXNlcklkXCIpLFxuICAgICAgICAgIFwicHJval9pZFwiOiAkc2Vzc2lvblN0b3JhZ2UuZ2V0T2JqZWN0KFwicHJvaklkXCIpLFxuICAgICAgICAgIFwicm9sZVwiOiAkc2Vzc2lvblN0b3JhZ2UuZ2V0T2JqZWN0KFwicm9sZVwiKSxcbiAgICAgICAgICBcImRhdGFcIjogW11cbiAgICAgIH07XG4gICAgICB2YXIgY3JlYXRlUGFyYW0gPSB7XG4gICAgICAgIFwiYWN0aW9uXCI6IFwiY3JlYXRlXCIsXG4gICAgICAgIFwiZGF0YVwiOltdXG4gICAgICB9O1xuICAgICAgdmFyIGVkaXRQYXJhbSA9IHtcbiAgICAgICAgXCJhY3Rpb25cIjogXCJlZGl0XCIsXG4gICAgICAgIFwiZGF0YVwiOiBbXVxuICAgICAgfTtcbiAgICAgIHZhciBkZWxldGVQYXJhbSA9IHtcbiAgICAgICAgXCJhY3Rpb25cIjogXCJkZWxldGVcIixcbiAgICAgICAgXCJkYXRhXCI6IFtdXG4gICAgICB9O1xuICAgICAgaWYoYW5ndWxhci5lcXVhbHMoJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcImNyZWF0ZVBhcmFtXCIpLCB7fSkpIHtcbiAgICAgICAgcmVxUGFyYW0uZGF0YS5wdXNoKGNyZWF0ZVBhcmFtKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcVBhcmFtLmRhdGEucHVzaCgkc2Vzc2lvblN0b3JhZ2UuZ2V0T2JqZWN0KFwiY3JlYXRlUGFyYW1cIikpO1xuICAgICAgfVxuICAgICAgaWYoYW5ndWxhci5lcXVhbHMoJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcImVkaXRQYXJhbVwiKSwge30pKSB7XG4gICAgICAgIHJlcVBhcmFtLmRhdGEucHVzaChlZGl0UGFyYW0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVxUGFyYW0uZGF0YS5wdXNoKCRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJlZGl0UGFyYW1cIikpO1xuICAgICAgfVxuICAgICAgaWYoYW5ndWxhci5lcXVhbHMoJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcImRlbGV0ZVBhcmFtXCIpLCB7fSkpIHtcbiAgICAgICAgcmVxUGFyYW0uZGF0YS5wdXNoKGRlbGV0ZVBhcmFtKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcVBhcmFtLmRhdGEucHVzaCgkc2Vzc2lvblN0b3JhZ2UuZ2V0T2JqZWN0KFwiZGVsZXRlUGFyYW1cIikpO1xuICAgICAgfVxuICAgICAgLy8gY29uc29sZS5sb2coXCJyZXFQYXJhbSA9IFwiLCByZXFQYXJhbSk7XG5cbiAgICAgIHZhciBsYXllclNlcnZpY2UgPSBuZXcgVmVjdG9yU2VydmljZSgpO1xuICAgICAgbGF5ZXJTZXJ2aWNlLmNyZWF0ZUZlYXR1cmVzKHJlcVBhcmFtKVxuICAgICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwic2F2ZWQgaW4gQVBJIFwiLCByZXN1bHQpO1xuICAgICAgICAgIGlmKHJlc3VsdCA9PT0gXCJzdWNjZXNzXCIpIHtcbiAgICAgICAgICAgIEMyVG9hc3Quc3VjY2VzcygkdHJhbnNsYXRlLmluc3RhbnQoJ21lc3NhZ2VzLnNhdmVTdWNjZXNzJykpO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJzYXZlZCBpbiBBUEkgXCIsIHJlc3VsdCk7XG4gICAgICAgICAgICAkc2Vzc2lvblN0b3JhZ2UucmVtb3ZlKFwiY3JlYXRlUGFyYW1cIik7XG4gICAgICAgICAgICAkc2Vzc2lvblN0b3JhZ2UucmVtb3ZlKFwiZWRpdFBhcmFtXCIpO1xuICAgICAgICAgICAgJHNlc3Npb25TdG9yYWdlLnJlbW92ZShcImRlbGV0ZVBhcmFtXCIpO1xuICAgICAgICAgICAgJHN0YXRlLnJlbG9hZCgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBDMlRvYXN0LmVycm9yKCR0cmFuc2xhdGUuaW5zdGFudCgnbWVzc2FnZXMuc2F2ZUVycm9yJykpO1xuICAgICAgICAgIH1cbiAgICAgIH0sIGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJFcnJvciB3aGlsZSBzYXZpbmcgXCIsZXJyKTtcbiAgICAgICAgICAkc2Vzc2lvblN0b3JhZ2UucmVtb3ZlKFwiY3JlYXRlUGFyYW1cIik7XG4gICAgICAgICAgJHNlc3Npb25TdG9yYWdlLnJlbW92ZShcImVkaXRQYXJhbVwiKTtcbiAgICAgICAgICAkc2Vzc2lvblN0b3JhZ2UucmVtb3ZlKFwiZGVsZXRlUGFyYW1cIik7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPcGVuL2Nsb3NlIHRoZSBsZWZ0IHNpZGUgbmF2XG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9nZ2xlTGVmdCgpIHtcbiAgICAgICRtZFNpZGVuYXYoJ2xlZnQnKS50b2dnbGUoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFeHBvcnQgbGF5ZXIgZGF0YSBhcyBHZW9KU09OIGluIGEgZmlsZVxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGV4cG9ydExheWVyKGxheWVyKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBsZWZ0U2lkZU5hdiA+Pj4gZXhwb3J0TGF5ZXIgXCIsIGxheWVyKTtcbiAgICAgIC8vICR3aW5kb3cub3BlbihcIi9oZWltYXAvdmVjdG9yP3Byb2pfaWQ9XCIrXG4gICAgICAvLyAgICRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJwcm9qSWRcIikgK1xuICAgICAgLy8gICBcIiZsYXllcl9pZD1cIisgbGF5ZXIubGF5ZXJJZCArXCImZmV0Y2g9bGF0ZXN0VmVyc2lvblwiLFxuICAgICAgLy8gICBcIl9ibGFua1wiKTtcblxuICAgICAgdmFyIHJlcVBhcmFtID0ge1xuICAgICAgICAvLyBcInVzZXJfaWRcIjogJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcInVzZXJJZFwiKSxcbiAgICAgICAgXCJsYXllcl9pZFwiOiBsYXllci5sYXllcklkLFxuICAgICAgICBcInByb2pfaWRcIjogJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcInByb2pJZFwiKSxcbiAgICAgICAgXCJmZXRjaFwiOiBcImxhdGVzdFZlcnNpb25cIlxuICAgICAgfTtcbiAgICAgIFxuICAgICAgdmFyIGxheWVyU2VydmljZSA9IG5ldyBWZWN0b3JTZXJ2aWNlKCk7XG4gICAgICBsYXllclNlcnZpY2UuZXhwb3J0TGF5ZXJHZW9Kc29uKHJlcVBhcmFtKVxuICAgICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpe1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZXhwb3J0TGF5ZXJHZW9Kc29uIFwiLCByZXN1bHQpO1xuICAgICAgICAgIHZhciBsYXllckRhdGEgPSBcImRhdGE6YXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtO2NoYXJzZXQ9dXRmLTgsXCIgKyBlbmNvZGVVUklDb21wb25lbnQoSlNPTi5zdHJpbmdpZnkocmVzdWx0KSk7XG4gICAgICAgICAgdmFyIGRvd25sb2FkQW5jaG9yTm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICAgICAgICBkb3dubG9hZEFuY2hvck5vZGUuc2V0QXR0cmlidXRlKFwiaHJlZlwiLCBsYXllckRhdGEpO1xuICAgICAgICAgIGRvd25sb2FkQW5jaG9yTm9kZS5zZXRBdHRyaWJ1dGUoXCJkb3dubG9hZFwiLCBcImxheWVyLmpzb25cIik7XG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkb3dubG9hZEFuY2hvck5vZGUpOyAvLyByZXF1aXJlZCBmb3IgZmlyZWZveFxuICAgICAgICAgIGRvd25sb2FkQW5jaG9yTm9kZS5jbGljaygpO1xuICAgICAgICAgIGRvd25sb2FkQW5jaG9yTm9kZS5yZW1vdmUoKTtcbiAgICAgIH0sIGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJFcnJvciB3aGlsZSBzYXZpbmcgXCIsZXJyKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENoZWNrIGZ1bmN0aW9uYWxpdHkgaXMgYWxsb3dlZCBmb3IgYSB1c2VyIGJhc2VkIG9uIGhpcyByb2xlXG4gICAgICogXG4gICAgICogQHJldHVybnMgYm9vbGVhblxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVzZXJBbGxvdyhmdW5jdGlvbmFsaXR5KSB7XG4gICAgICBpZihmdW5jdGlvbmFsaXR5ID09PSBcImZlYXR1cmVFZGl0XCIpIHtcbiAgICAgICAgaWYoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCIxXCIpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiMlwiKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjNcIikge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCI0XCIpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmKGZ1bmN0aW9uYWxpdHkgPT09IFwibGF5ZXJDcmVhdGVcIikge1xuICAgICAgICBpZihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjFcIikge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCIyXCIpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiM1wiKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjRcIikge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYoZnVuY3Rpb25hbGl0eSA9PT0gXCJsYXllckVkaXRcIikge1xuICAgICAgICBpZihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjFcIikge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCIyXCIpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiM1wiKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjRcIikge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYoZnVuY3Rpb25hbGl0eSA9PT0gXCJsYXllckRlbGV0ZVwiKSB7XG4gICAgICAgIGlmKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiMVwiKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjJcIikge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCIzXCIpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiNFwiKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZihmdW5jdGlvbmFsaXR5ID09PSBcImxheWVyRXhwb3J0XCIpIHtcbiAgICAgICAgaWYoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCIxXCIpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiMlwiKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjNcIikge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCI0XCIpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmKGZ1bmN0aW9uYWxpdHkgPT09IFwicHVibGlzaERhdGFcIikge1xuICAgICAgICBpZihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjFcIikge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYoc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCIyXCIpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmKHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiM1wiKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gZWxzZSBpZihzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjRcIikge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGFjdGl2YXRlKCk7XG4gICAgXG4gIH1cblxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xuXG4gICd1c2Ugc3RyaWN0JztcblxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnYXBwJylcbiAgICAuY29udHJvbGxlcignVmVjdG9yUmlnaHRTaWRlbmF2Q29udHJvbGxlcicsIFZlY3RvclJpZ2h0U2lkZW5hdkNvbnRyb2xsZXIpO1xuXG4gIC8qKiBAbmdJbmplY3QgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1wYXJhbXNcbiAgZnVuY3Rpb24gVmVjdG9yUmlnaHRTaWRlbmF2Q29udHJvbGxlcigkbWRTaWRlbmF2LCBsb2Rhc2gsICRyb290U2NvcGUsIGxlYWZsZXQsIGxlYWZsZXREYXRhLCBGZWF0dXJlU2VydmljZSwgJHNlc3Npb25TdG9yYWdlLCBWZWN0b3JTZXJ2aWNlLCBNYXBMYXllclNlcnZpY2UpIHtcbiAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgdm0uc2hvd0F0dHJpYnV0ZXMgPSBzaG93QXR0cmlidXRlcztcbiAgICB2bS51cGRhdGUgPSB1cGRhdGU7XG4gICAgdm0uY2xvc2UgPSBjbG9zZTtcbiAgICB2bS5vcGVuID0gb3BlbjtcbiAgICB2bS5zaG93QWxsRmVhdHVyZVZlcnNpb25zID0gc2hvd0FsbEZlYXR1cmVWZXJzaW9ucztcbiAgICB2bS50b2dnbGVSaWdodCA9IHRvZ2dsZVJpZ2h0O1xuICAgIHZtLmNoZWNrRGVwZW5kZW50VmFsdWUgPSBjaGVja0RlcGVuZGVudFZhbHVlO1xuICAgIHZtLmdldEZvcm1BdHRyaWJ1dGUgPSBnZXRGb3JtQXR0cmlidXRlO1xuICAgIHZtLmZlYXR1cmVBdHRyID0gbnVsbDtcbiAgICB2bS5nYXp6VHlwZXMgPSBbXCJQaHlzaWNhbCBUaGluZ1wiLCBcIkV2ZW50XCIsIFwiUGxhY2VcIl07XG4gICAgdm0uZWRpdE1vZGUgPSBudWxsOyAvLyBcImVkaXRcIiwgXCJjcmVhdGVcIiwgXCJkZWxldGVcIlxuICAgIHZtLmN1cnJlbnRMYXllciA9IG51bGw7XG4gICAgdm0uY3JlYXRlUGFyYW0gPSB7XG4gICAgICBcImFjdGlvblwiOiBcImNyZWF0ZVwiLFxuICAgICAgXCJkYXRhXCI6W11cbiAgICB9O1xuICAgIHZtLmVkaXRQYXJhbSA9IHtcbiAgICAgIFwiYWN0aW9uXCI6IFwiZWRpdFwiLFxuICAgICAgXCJkYXRhXCI6IFtdXG4gICAgfTtcbiAgICB2bS5kZWxldGVQYXJhbSA9IHtcbiAgICAgIFwiYWN0aW9uXCI6IFwiZGVsZXRlXCIsXG4gICAgICBcImRhdGFcIjogW11cbiAgICB9O1xuICAgIHZtLmRpc2FibGVTYXZlID0gZmFsc2U7XG4gICAgdm0uc2hvd0FsbFZlcnNpb25zID0gdHJ1ZTtcbiAgICB2bS5mb3JtUGFyYW1zID0gbnVsbDtcblxuICAgIC8vIHVzZWQgZm9yIEVkaXQgZmVhdHVyZSBjYWxsIChhdHRyaWJ1dGUgdXBkYXRlKVxuICAgICRyb290U2NvcGUuJG9uKCdzaG93RmVhdHVyZUF0dHInLCBmdW5jdGlvbihldmVudCwgYXJncyl7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBWZWN0b3JSaWdodFNpZGVuYXZDb250cm9sbGVyID4+PiBzaG93RmVhdHVyZUF0dHIgXCIsIGFyZ3MpO1xuICAgICAgdm0uZmVhdHVyZUF0dHIgPSBudWxsO1xuICAgICAgLy8gY2xvc2UgYW5kIG9wZW4gdG8gbGV0IHRoZSBkaXZzIHJlZnJlc2hcbiAgICAgIGNsb3NlKCk7XG4gICAgICB2bS5lZGl0TW9kZSA9IFwiZWRpdFwiO1xuICAgICAgdm0uY3VycmVudEZlYXR1cmUgPSBhcmdzO1xuICAgICAgYXJncyA9IEZlYXR1cmVTZXJ2aWNlLmNyZWF0ZU9iamVjdEZyb21HZW9Kc29uKGFyZ3MpO1xuICAgICAgLy8gY2hlY2sgd2hldGhlciBmZWF0dXJlIGFscmVhZHkgZXhpc3QgaW4gdm0uZWRpdFBhcmFtXG4gICAgICBpZih2bS5lZGl0UGFyYW0uZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHZhciB0ZW1wT2JqID0gc2VhcmNoRnJvbUNvbGxlY3Rpb25Ub0ZlYXR1cmUoYXJncywgdm0uZWRpdFBhcmFtKTtcbiAgICAgICAgaWYodGVtcE9iaiAhPT0gbnVsbCkge1xuICAgICAgICAgIHRlbXBPYmoudHlwZV9jcm0gPSB2bS5jdXJyZW50RmVhdHVyZS5wcm9wZXJ0aWVzLnR5cGVfY3JtO1xuICAgICAgICAgIGFyZ3MgPSB0ZW1wT2JqO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBzaG93QXR0cmlidXRlcyhhcmdzKTtcbiAgICAgIG9wZW4oKTtcbiAgICAgIGlmKHZtLmN1cnJlbnRMYXllciAhPT0gbnVsbCkge1xuICAgICAgICBpZih2bS5jdXJyZW50TGF5ZXIubGF5ZXJJZCA9PT0gdm0uY3VycmVudEZlYXR1cmUucHJvcGVydGllcy5sYXllck5hbWUpIHtcbiAgICAgICAgICAvLyBjaGVjayBmb3IgdXNlcidzIGFjY2VzcyBvbiB0aGlzIGZlYXR1cmVcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhjaGVja1VzZXJBY2Nlc3NPbkZlYXR1cmUodm0uY3VycmVudEZlYXR1cmUsICRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJ1c2VySWRcIikudG9TdHJpbmcoKSkpO1xuICAgICAgICAgIGlmKGNoZWNrVXNlckFjY2Vzc09uRmVhdHVyZSh2bS5jdXJyZW50RmVhdHVyZSwgJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcInVzZXJJZFwiKS50b1N0cmluZygpKSkge1xuICAgICAgICAgICAgdm0uZGlzYWJsZVNhdmUgPSBmYWxzZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdm0uZGlzYWJsZVNhdmUgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2bS5kaXNhYmxlU2F2ZSA9IHRydWU7XG4gICAgICAgIH0gXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2bS5kaXNhYmxlU2F2ZSA9IHRydWU7XG4gICAgICB9XG4gICAgICB2bS5zaG93QWxsVmVyc2lvbnMgPSB0cnVlO1xuICAgIH0pO1xuXG4gICAgLy8gZ2VvbSB1cGRhdGVcbiAgICAkcm9vdFNjb3BlLiRvbignZ2VvbVVwZGF0ZWQnLCBmdW5jdGlvbihldmVudCwgYXJncyl7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBWZWN0b3JSaWdodFNpZGVuYXZDb250cm9sbGVyID4+PiBhZGRGZWF0dXJlVG9VcGRhdGUgXCIsIGFyZ3MpO1xuICAgICAgYXJncy5lYWNoTGF5ZXIoZnVuY3Rpb24gKGxheWVyKSB7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGxheWVyKTtcbiAgICAgICAgLy8gcmVwbGFjZSBmZWF0dXJlIGdlb20gd2l0aCB0aGUgbmV3IGVkaXR0ZWQgZ2VvbSB2YWx1ZVxuICAgICAgICAvLyBsYXllci5mZWF0dXJlLmdlb21ldHJ5LmNvb3JkaW5hdGVzID0gT2JqZWN0LnZhbHVlcyhsYXllci5nZXRMYXRMbmcoKSk7XG4gICAgICAgIGxheWVyLmZlYXR1cmUuZ2VvbWV0cnkgPSBsYXllci50b0dlb0pTT04oKS5nZW9tZXRyeTtcbiAgICAgICAgdm0uY3VycmVudEZlYXR1cmUgPSBsYXllci5mZWF0dXJlO1xuICAgICAgICAvLyBhZGRGZWF0dXJlVG9VcGRhdGVMaXN0KGxheWVyLmZlYXR1cmUpO1xuICAgICAgICAvLyAtLS0tLS1cbiAgICAgICAgaWYodm0uY3JlYXRlUGFyYW0uZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgLy8gZmluZCBlZGl0dGVkIGZlYXR1cmUgaW4gZWRpdFBhcmFtIFxuICAgICAgICAgIHZhciBmb3VuZE9iamVjdEluQ3JlYXRlUGFyYW0gPSBsb2Rhc2guZmluZCh2bS5jcmVhdGVQYXJhbS5kYXRhLCBmdW5jdGlvbihlYWNoRmVhdHVyZSl7XG4gICAgICAgICAgICByZXR1cm4gKHBhcnNlSW50KGxheWVyLmZlYXR1cmUucHJvcGVydGllcy50eXBlX2NybSkgPT09IGVhY2hGZWF0dXJlLnR5cGVfY3JtIHx8IFxuICAgICAgICAgICAgbGF5ZXIuZmVhdHVyZS5wcm9wZXJ0aWVzLnR5cGVfY3JtID09PSBlYWNoRmVhdHVyZS50eXBlX2NybSkgXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYodHlwZW9mIGZvdW5kT2JqZWN0SW5DcmVhdGVQYXJhbSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJmb3VuZCBpbiBjcmVhdGVQYXJhbSBcIiwgZm91bmRPYmplY3RJbkNyZWF0ZVBhcmFtKTtcbiAgICAgICAgICAgIHNlYXJjaEFuZFJlcGxhY2VPbmx5R2VvbShsYXllci5mZWF0dXJlLCB2bS5jcmVhdGVQYXJhbSk7XG4gICAgICAgICAgICAvLyBhZGRGZWF0dXJlVG9VcGRhdGVMaXN0KGxheWVyLmZlYXR1cmUpO1xuICAgICAgICAgICAgLy8gZmlyZSBiYWNrIHRvIGxlZnQgc2lkZW5hdiB0byBhZGQgbmV3bHkgYWRkZWQgZmVhdHVyZSB0byBpdHMgbGF5ZXJcbiAgICAgICAgICAgIC8vICRyb290U2NvcGUuJGJyb2FkY2FzdChcImFkZEZlYXR1cmVUb0xheWVyXCIsIHZtLmN1cnJlbnRGZWF0dXJlKTtcbiAgICAgICAgICAgICRzZXNzaW9uU3RvcmFnZS5zZXRPYmplY3QoXCJjcmVhdGVQYXJhbVwiLCB2bS5jcmVhdGVQYXJhbSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGhhbmRsZUVkaXRQYXJhbSh2bS5mZWF0dXJlQXR0ciwgdm0uZWRpdFBhcmFtLCB2bS5jdXJyZW50RmVhdHVyZSk7XG4gICAgICAgICAgICBhZGRGZWF0dXJlVG9VcGRhdGVMaXN0KGxheWVyLmZlYXR1cmUpO1xuICAgICAgICAgICAgJHNlc3Npb25TdG9yYWdlLnNldE9iamVjdChcImVkaXRQYXJhbVwiLCB2bS5lZGl0UGFyYW0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBoYW5kbGVFZGl0UGFyYW0odm0uZmVhdHVyZUF0dHIsIHZtLmVkaXRQYXJhbSwgdm0uY3VycmVudEZlYXR1cmUpO1xuICAgICAgICAgIGFkZEZlYXR1cmVUb1VwZGF0ZUxpc3QobGF5ZXIuZmVhdHVyZSk7XG4gICAgICAgICAgJHNlc3Npb25TdG9yYWdlLnNldE9iamVjdChcImVkaXRQYXJhbVwiLCB2bS5lZGl0UGFyYW0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIHVzZWQgZm9yIGNyZWF0ZSBmZWF0dXJlIGNhbGxcbiAgICAkcm9vdFNjb3BlLiRvbignb3BlblJpZ2h0TmF2JywgZnVuY3Rpb24oZXZlbnQsIGFyZ3Mpe1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gVmVjdG9yUmlnaHRTaWRlbmF2Q29udHJvbGxlciA+Pj4gb3BlblJpZ2h0TmF2IFwiLCBhcmdzKTtcbiAgICAgIHZtLmZlYXR1cmVBdHRyID0gbnVsbDtcbiAgICAgIGNsb3NlKCk7XG4gICAgICB2bS5lZGl0TW9kZSA9IGFyZ3MuZGF0YS5vcGVyYXRpb247XG4gICAgICB2bS5jdXJyZW50TGF5ZXIgPSBhcmdzLmRhdGEubGF5ZXI7XG4gICAgICB2bS5jdXJyZW50TGVhZkZlYXR1cmUgPSBhcmdzLmRhdGEuZmVhdHVyZTtcbiAgICAgIHZtLmN1cnJlbnRGZWF0dXJlID0gYXJncy5kYXRhLmZlYXR1cmUudG9HZW9KU09OKCk7XG4gICAgICB2bS5kaXNhYmxlU2F2ZSA9IGZhbHNlO1xuICAgICAgb3BlbigpO1xuICAgIH0pO1xuXG4gICAgLy8gdXNlZCBmb3IgZGVsZXRlIGZlYXR1cmUgY2FsbFxuICAgICRyb290U2NvcGUuJG9uKCdmZWF0dXJlRGVsZXRlZCcsIGZ1bmN0aW9uKGV2ZW50LCBhcmdzKXtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IFZlY3RvclJpZ2h0U2lkZW5hdkNvbnRyb2xsZXIgPj4+IGZlYXR1cmVEZWxldGVkIFwiLCBhcmdzKTtcbiAgICAgIHZhciBsYXllcnMgPSBhcmdzLmRhdGEuZmVhdHVyZXM7XG4gICAgICBsYXllcnMuZWFjaExheWVyKGZ1bmN0aW9uIChsYXllcikge1xuICAgICAgICAvLyBjaGVjayBmb3IgaXQgZXhpc3QgaW4gY3JlYXRlIG9yIGVkaXQgY29sbGVjdGlvblxuICAgICAgICBpZigoc2VhcmNoSW5Db2xsZWN0aW9uKHZtLmNyZWF0ZVBhcmFtLCBsYXllcikgPT09IGZhbHNlKSAmJiAoc2VhcmNoSW5Db2xsZWN0aW9uKHZtLmVkaXRQYXJhbSwgbGF5ZXIpID09PSBmYWxzZSkpIHtcbiAgICAgICAgICB2YXIgdGVtcERlbGV0ZURhdGEgPSB7XG4gICAgICAgICAgICBcImxheWVyX2lkXCI6IHZtLmN1cnJlbnRMYXllci5sYXllcklkLFxuICAgICAgICAgICAgXCJ0eXBlX2NybVwiOiBsYXllci5mZWF0dXJlLnByb3BlcnRpZXMudHlwZV9jcm1cbiAgICAgICAgICB9O1xuICAgICAgICAgIHZtLmRlbGV0ZVBhcmFtLmRhdGEucHVzaCh0ZW1wRGVsZXRlRGF0YSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYoc2VhcmNoSW5Db2xsZWN0aW9uKHZtLmNyZWF0ZVBhcmFtLCBsYXllcikpIHtcbiAgICAgICAgICAgIC8vIGRlbGV0ZSBpdCBmcm9tIHRoYXQgY29sbGVjdGlvblxuICAgICAgICAgICAgZGVsZXRlRmVhdHVyZUZyb21Db2xsZWN0aW9uKGxheWVyLCB2bS5jcmVhdGVQYXJhbSk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcInZtLmNyZWF0ZVBhcmFtID0gXCIsIHZtLmNyZWF0ZVBhcmFtKTtcbiAgICAgICAgICAgICRzZXNzaW9uU3RvcmFnZS5zZXRPYmplY3QoXCJjcmVhdGVQYXJhbVwiLCB2bS5jcmVhdGVQYXJhbSk7XG4gICAgICAgICAgfSBcbiAgICAgICAgICBpZihzZWFyY2hJbkNvbGxlY3Rpb24odm0uZWRpdFBhcmFtLCBsYXllcikpIHtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IGdvdCBhIGZlYXR1cmUgaW4gY29sbGVjdGlvblwiKTtcbiAgICAgICAgICAgIC8vIGRlbGV0ZSBpdCBmcm9tIHRoYXQgY29sbGVjdGlvblxuICAgICAgICAgICAgZGVsZXRlRmVhdHVyZUZyb21Db2xsZWN0aW9uKGxheWVyLCB2bS5lZGl0UGFyYW0pO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJ2bS5lZGl0UGFyYW0gPSBcIiwgdm0uZWRpdFBhcmFtKTtcbiAgICAgICAgICAgICRzZXNzaW9uU3RvcmFnZS5zZXRPYmplY3QoXCJlZGl0UGFyYW1cIiwgdm0uZWRpdFBhcmFtKTtcbiAgICAgICAgICAgIC8vIHNpbmNlIGEgZWRpdGVkIGZlYXR1cmUgaXMgZGVsZXRlZCB0aGF0IG1lYW5zIGl0cyBhIHNpbXBsZSBkZWxldGVcbiAgICAgICAgICAgIHZhciB0ZW1wRGVsZXRlRGF0YSA9IHtcbiAgICAgICAgICAgICAgXCJsYXllcl9pZFwiOiB2bS5jdXJyZW50TGF5ZXIubGF5ZXJJZCxcbiAgICAgICAgICAgICAgXCJ0eXBlX2NybVwiOiBsYXllci5mZWF0dXJlLnByb3BlcnRpZXMudHlwZV9jcm1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2bS5kZWxldGVQYXJhbS5kYXRhLnB1c2godGVtcERlbGV0ZURhdGEpO1xuICAgICAgICAgIH0gXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgLy8gY29uc29sZS5sb2coXCJ2bS5kZWxldGVQYXJhbSA9IFwiLCB2bS5kZWxldGVQYXJhbSk7XG4gICAgICAkc2Vzc2lvblN0b3JhZ2Uuc2V0T2JqZWN0KFwiZGVsZXRlUGFyYW1cIiwgdm0uZGVsZXRlUGFyYW0pO1xuICAgIH0pO1xuXG4gICAgLy8gQXNzaWduIGN1cnJlbnQgRWRpdGluZyBsYXllclxuICAgICRyb290U2NvcGUuJG9uKCdzZXRDdXJyZW50RWRpdExheWVyJywgZnVuY3Rpb24oZXZlbnQsIGFyZ3Mpe1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gVmVjdG9yUmlnaHRTaWRlbmF2Q29udHJvbGxlciA+Pj4gc2V0Q3VycmVudEVkaXRMYXllciBcIiwgYXJncyk7XG4gICAgICB2bS5jdXJyZW50TGF5ZXIgPSBhcmdzLmRhdGEubGF5ZXI7XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBGaXJzdCBmdW5jdGlvbiBjYWxsZWQgYWZ0ZXIgdGhlIGNvbnRyb2xsZXIgaXMgcmFuXG4gICAgICogaGVyZSB0aGUgc3R1ZmYgYXJlIGluaXRpYWxpemVkXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiB2ZWN0b3IucmlnaHQuc2lkZW5hdi5jb250cm9sbGVyID4+PiBhY3RpdmF0ZSBcIiwgdm0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsb3NlIHRoaXMgc2lkZW5hdlxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNsb3NlICgpIHtcbiAgICAgICRtZFNpZGVuYXYoJ3JpZ2h0JykuY2xvc2UoKTtcbiAgICAgIHZtLmVkaXRNb2RlID0gbnVsbDtcbiAgICAgIHZtLmN1cnJlbnRGZWF0dXJlID0gbnVsbDtcbiAgICB9ICAgIFxuXG4gICAgLyoqXG4gICAgICogT3BlbiB0aGlzIHNpZGVuYXZcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvcGVuICgpIHtcbiAgICAgICRtZFNpZGVuYXYoJ3JpZ2h0Jykub3BlbigpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERpc3BsYXlzIGZlYXR1cmUncyBhdHRyaWJ1dGUgaW4gcmlnaHQtc2lkZS1uYXYuIENhbGxlZCBmcm9tIGV2ZW50IGJyb2FkY2FzdCBmcm9tIFxuICAgICAqIHZlY3Rvci5sZWZ0LnNpZGVuYXYuY29udHJvbGxlclxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNob3dBdHRyaWJ1dGVzKGZlYXR1cmVPYmplY3QpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IFZlY3RvclJpZ2h0U2lkZW5hdkNvbnRyb2xsZXIgPj4+IHNob3dGZWF0dXJlQXR0cigpIFwiLCBmZWF0dXJlT2JqZWN0KTtcbiAgICAgIC8vIGNoZWNrIGlmIGFueSB2YWx1ZSBjb250YWlucyBbXSBmb3IgYXR0cmlidXRlIHR5cGVzIGxpa2UgXCJMYW5ndWFnZVwiIHdoZXJlIHZhbHVlcyB3aWxsIGJlIGFuIGFycmF5XG4gICAgICB2YXIgdGVtcEZWYWxPYmogPSBPYmplY3QudmFsdWVzKGZlYXR1cmVPYmplY3QpO1xuICAgICAgdmFyIHRlbXBGS2V5T2JqID0gT2JqZWN0LmtleXMoZmVhdHVyZU9iamVjdCk7XG4gICAgICBmb3IodmFyIGk9MDsgaSA8IHRlbXBGVmFsT2JqLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmKHR5cGVvZiB0ZW1wRlZhbE9ialtpXSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgIGlmKHRlbXBGVmFsT2JqW2ldLmluZGV4T2YoXCJbXCIpICE9PSAtMSkge1xuICAgICAgICAgICAgZmVhdHVyZU9iamVjdFt0ZW1wRktleU9ialtpXV0gPSBKU09OLnBhcnNlKHRlbXBGVmFsT2JqW2ldKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgdm0uZmVhdHVyZUF0dHIgPSBmZWF0dXJlT2JqZWN0O1xuICAgICAgZ2V0Rm9ybUF0dHJpYnV0ZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhbGxlZCB3aGVuIGdlb20gdXBkYXRlIGlzIHBlcmZvcm1lZCBvbiBmZWF0dXJlLiBFeHBlY3RzIDEgZmVhdHVyZSBhdCBhIHRpbWUuIFxuICAgICAqIEhlbmNlIGNhbGxlZCBpbiBsb29wIGZyb20gdGhlIGNhbGxlci4gXG4gICAgICogQ2hlY2tzIGZvciBFZGl0ICsgRWRpdCBzY2VuYXJpb3MsIG1lbnRpb25lZCBpbiBUZXN0IGNhc2VzIG9mICMyMjUuXG4gICAgICogRG9lc24ndCByZXR1cm5zIGFueXRoaW5nIGJ1dCB1cGRhdGVzIHRoZSB2bS5lZGl0UGFyYW1cbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gZmVhdHVyZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFkZEZlYXR1cmVUb1VwZGF0ZUxpc3QoZmVhdHVyZSkge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gVmVjdG9yUmlnaHRTaWRlbmF2Q29udHJvbGxlciA+Pj4gYWRkRmVhdHVyZVRvVXBkYXRlTGlzdCBcIiwgZmVhdHVyZSk7XG4gICAgICBpZih2bS5lZGl0UGFyYW0uZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgIC8vIGZpbmQgZWRpdHRlZCBmZWF0dXJlIGluIGVkaXRQYXJhbSBcbiAgICAgICAgdmFyIGZvdW5kT2JqZWN0SW5FZGl0UGFyYW0gPSBsb2Rhc2guZmluZCh2bS5lZGl0UGFyYW0uZGF0YSwgZnVuY3Rpb24oZWFjaEZlYXR1cmUpe1xuICAgICAgICAgIHJldHVybiAocGFyc2VJbnQoZmVhdHVyZS5wcm9wZXJ0aWVzLnR5cGVfY3JtKSA9PT0gZWFjaEZlYXR1cmUudHlwZV9jcm0gfHwgXG4gICAgICAgICAgZmVhdHVyZS5wcm9wZXJ0aWVzLnR5cGVfY3JtID09PSBlYWNoRmVhdHVyZS50eXBlX2NybSkgXG4gICAgICAgIH0pO1xuICAgICAgICAvLyBpZiBmb3VuZCB0aGFuIHJlcGxhY2UgaXQgaW4gZWRpUGFyYW0gZWxzZSBpdHMgYSBuZXcgZmVhdHVyZSBwdXNoIHRvIGVkaXRQYXJhbVxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcImZvdW5kT2JqZWN0SW5FZGl0UGFyYW0gPSBcIiwgZm91bmRPYmplY3RJbkVkaXRQYXJhbSk7XG4gICAgICAgIGlmKHR5cGVvZiBmb3VuZE9iamVjdEluRWRpdFBhcmFtICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgLy8gc2VhcmNoQW5kUmVwbGFjZShmZWF0dXJlLCB2bS5lZGl0UGFyYW0pO1xuICAgICAgICAgIC8vIGxvZGFzaC5yZW1vdmUodm0uZWRpdFBhcmFtLmRhdGEsIGZ1bmN0aW9uKGVhY2hGZWF0dXJlKXtcbiAgICAgICAgICAvLyAgIHJldHVybiAocGFyc2VJbnQoZmVhdHVyZS50eXBlX2NybSkgPT09IGVhY2hGZWF0dXJlLnR5cGVfY3JtIHx8IFxuICAgICAgICAgIC8vICAgZmVhdHVyZS50eXBlX2NybSA9PT0gZWFjaEZlYXR1cmUudHlwZV9jcm0pIFxuICAgICAgICAgIC8vIH0pO1xuICAgICAgICAgIHNlYXJjaEFuZFJlcGxhY2VPbmx5R2VvbShmZWF0dXJlLCB2bS5lZGl0UGFyYW0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciB0ZW1wRmVhdHVyZSA9IHtcbiAgICAgICAgICAgIFwibGF5ZXJfaWRcIjogdm0uY3VycmVudExheWVyLmxheWVySWQsXG4gICAgICAgICAgICBcImtleV9jaWRvY19hcnJheVwiOiBmZWF0dXJlLnByb3BlcnRpZXMua2V5X2NpZG9jX2FycmF5LnNwbGl0KFwifFwiKSxcbiAgICAgICAgICAgIFwidmFsdWVfZ2F6ZXR0ZWVyX2FycmF5XCI6IGZlYXR1cmUucHJvcGVydGllcy52YWx1ZV9nYXpldHRlZXJfYXJyYXkuc3BsaXQoXCJ8XCIpLFxuICAgICAgICAgICAgXCJ0eXBlX2NybVwiOiBmZWF0dXJlLnByb3BlcnRpZXMudHlwZV9jcm1cbiAgICAgICAgICB9XG4gICAgICAgICAgdGVtcEZlYXR1cmUua2V5X2NpZG9jX2FycmF5LnB1c2goXCJnZW9tXCIpO1xuICAgICAgICAgIHRlbXBGZWF0dXJlLnZhbHVlX2dhemV0dGVlcl9hcnJheS5wdXNoKGZlYXR1cmUuZ2VvbWV0cnkpO1xuICAgICAgICAgIHZtLmVkaXRQYXJhbS5kYXRhLnB1c2godGVtcEZlYXR1cmUpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgdGVtcEZlYXR1cmUgPSB7XG4gICAgICAgICAgXCJsYXllcl9pZFwiOiB2bS5jdXJyZW50TGF5ZXIubGF5ZXJJZCxcbiAgICAgICAgICBcImtleV9jaWRvY19hcnJheVwiOiBmZWF0dXJlLnByb3BlcnRpZXMua2V5X2NpZG9jX2FycmF5LnNwbGl0KFwifFwiKSxcbiAgICAgICAgICBcInZhbHVlX2dhemV0dGVlcl9hcnJheVwiOiBmZWF0dXJlLnByb3BlcnRpZXMudmFsdWVfZ2F6ZXR0ZWVyX2FycmF5LnNwbGl0KFwifFwiKSxcbiAgICAgICAgICBcInR5cGVfY3JtXCI6IGZlYXR1cmUucHJvcGVydGllcy50eXBlX2NybVxuICAgICAgICB9XG4gICAgICAgIHRlbXBGZWF0dXJlLmtleV9jaWRvY19hcnJheS5wdXNoKFwiZ2VvbVwiKTtcbiAgICAgICAgdGVtcEZlYXR1cmUudmFsdWVfZ2F6ZXR0ZWVyX2FycmF5LnB1c2goZmVhdHVyZS5nZW9tZXRyeSk7XG4gICAgICAgIHZtLmVkaXRQYXJhbS5kYXRhLnB1c2godGVtcEZlYXR1cmUpO1xuICAgICAgfVxuICAgICAgLy8gY29uc29sZS5sb2coXCJ2bS5lZGl0UGFyYW0gPSBcIiwgdm0uZWRpdFBhcmFtKTtcbiAgICAgICRzZXNzaW9uU3RvcmFnZS5zZXRPYmplY3QoXCJlZGl0UGFyYW1cIiwgdm0uZWRpdFBhcmFtKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTYXZlIGZ1bmN0aW9uLiBDYWxsZWQgd2hlbiBTYXZlIGJ1dHRvbiBpbiByaWdodC1zYWlkZS1uYXYgaXMgY2xpY2tlZCwgdXBkYXRlZCB2bS5jcmVhdGVQYXJhbVxuICAgICAqIGFuZCB2bS5lZGl0UGFyYW0uXG4gICAgICogTm90IGZvciBEZWxldGUgZmVhdHVyZXMsIHNpbmNlIHRoaXMgaGFuZGxlcyBtYWpvcmx5IG9ubHkgZm9yIEF0dHJpYnV0ZSBTYXZlL1VwZGF0ZVxuICAgICAqIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+IFZlY3RvclJpZ2h0U2lkZW5hdkNvbnRyb2xsZXIgPj4+IHVwZGF0ZSA+Pj4gXCIsIHZtLmVkaXRNb2RlLCB2bS5jdXJyZW50TGF5ZXIsIHZtLmZlYXR1cmVBdHRyLCB2bS5jdXJyZW50RmVhdHVyZSk7XG4gICAgICBpZih2bS5lZGl0TW9kZSA9PT0gXCJjcmVhdGVcIikge1xuICAgICAgICAvLyB2bS5mZWF0dXJlQXR0ci50eXBlX2NybSA9IFwiY3JtX1wiICsgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKDk5OTkgLSAxICsgMSkpICsgMTtcbiAgICAgICAgdmFyIHRlbXBDcm0gPSBcImNybV9cIiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg5OTk5IC0gMSArIDEpKSArIDE7XG4gICAgICAgIHZhciBhcGlQYXJhbUZvcm1hdCA9IGNvbnZlcnRKc29uVG9BcGlSZXFPYmoodm0uZmVhdHVyZUF0dHIsIHZtLmN1cnJlbnRGZWF0dXJlKTtcbiAgICAgICAgdmFyIHRlbXBGZWF0dXJlID0ge1xuICAgICAgICAgIFwibGF5ZXJfaWRcIjogdm0uY3VycmVudExheWVyLmxheWVySWQsXG4gICAgICAgICAgXCJrZXlfY2lkb2NfYXJyYXlcIjogYXBpUGFyYW1Gb3JtYXQua2V5cyxcbiAgICAgICAgICBcInZhbHVlX2dhemV0dGVlcl9hcnJheVwiOiBhcGlQYXJhbUZvcm1hdC52YWx1ZXMsXG4gICAgICAgICAgXCJ0eXBlX2NybVwiOiB0ZW1wQ3JtXG4gICAgICAgIH1cbiAgICAgICAgdm0uY3JlYXRlUGFyYW0uZGF0YS5wdXNoKHRlbXBGZWF0dXJlKTtcbiAgICAgICAgLy8gY3JlYXRlIHRoZSB2bS5jdXJyZW50RmVhdHVyZSBpbiBzYW1lIHN0eWxlIGFzIHdlIHJlY2VpdmUgaXQgZnJvbSB3ZnMgbGF5ZXIgY2FsbFxuICAgICAgICAvLyB2bS5jdXJyZW50RmVhdHVyZS5wcm9wZXJ0aWVzID0gdm0uZmVhdHVyZUF0dHI7XG4gICAgICAgIHZtLmN1cnJlbnRGZWF0dXJlLnByb3BlcnRpZXMgPSB7XG4gICAgICAgICAgXCJrZXlfY2lkb2NfYXJyYXlcIjogY29udmVydFRvU1NWKGFwaVBhcmFtRm9ybWF0LmtleXMpLFxuICAgICAgICAgIFwidmFsdWVfZ2F6ZXR0ZWVyX2FycmF5XCI6IGNvbnZlcnRUb1NTVihhcGlQYXJhbUZvcm1hdC52YWx1ZXMpLFxuICAgICAgICAgIFwidHlwZV9jcm1cIjogdGVtcENybVxuICAgICAgICB9O1xuICAgICAgICB2bS5jdXJyZW50TGVhZkZlYXR1cmUuZmVhdHVyZSA9IHZtLmN1cnJlbnRGZWF0dXJlO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInZtLmN1cnJlbnRMZWFmRmVhdHVyZSA9IFwiLCB2bS5jdXJyZW50TGVhZkZlYXR1cmUpO1xuICAgICAgICAvLyBmaXJlIGJhY2sgdG8gbGVmdCBzaWRlbmF2IHRvIGFkZCBuZXdseSBhZGRlZCBmZWF0dXJlIHRvIGl0cyBsYXllclxuICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoXCJhZGRGZWF0dXJlVG9MYXllclwiLCB2bS5jdXJyZW50TGVhZkZlYXR1cmUpO1xuICAgICAgICAkc2Vzc2lvblN0b3JhZ2Uuc2V0T2JqZWN0KFwiY3JlYXRlUGFyYW1cIiwgdm0uY3JlYXRlUGFyYW0pO1xuICAgICAgfVxuICAgICAgZWxzZSBpZih2bS5lZGl0TW9kZSA9PT0gXCJlZGl0XCIpIHtcbiAgICAgICAgLy8gY2hlY2sgaWYgY3VycmVudCBmZWF0dXJlIGFscmVhZHkgZXhpc3QgaW4gdm0uY3JlYXRlUGFyYW1cbiAgICAgICAgaWYodm0uY3JlYXRlUGFyYW0uZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgLy8gZmluZCBlZGl0dGVkIGZlYXR1cmUgaW4gZWRpdFBhcmFtIFxuICAgICAgICAgIHZhciBmb3VuZE9iamVjdEluQ3JlYXRlUGFyYW0gPSBsb2Rhc2guZmluZCh2bS5jcmVhdGVQYXJhbS5kYXRhLCBmdW5jdGlvbihlYWNoRmVhdHVyZSl7XG4gICAgICAgICAgICByZXR1cm4gKHBhcnNlSW50KHZtLmZlYXR1cmVBdHRyLnR5cGVfY3JtKSA9PT0gZWFjaEZlYXR1cmUudHlwZV9jcm0gfHwgXG4gICAgICAgICAgICAgIHZtLmZlYXR1cmVBdHRyLnR5cGVfY3JtID09PSBlYWNoRmVhdHVyZS50eXBlX2NybSkgXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYodHlwZW9mIGZvdW5kT2JqZWN0SW5DcmVhdGVQYXJhbSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJmb3VuZCBpbiBjcmVhdGVQYXJhbSBcIiwgZm91bmRPYmplY3RJbkNyZWF0ZVBhcmFtKTtcbiAgICAgICAgICAgIHNlYXJjaEFuZFJlcGxhY2Uodm0uZmVhdHVyZUF0dHIsIHZtLmNyZWF0ZVBhcmFtKTtcbiAgICAgICAgICAgIHZhciBhcGlQYXJhbUZvcm1hdCA9IGNvbnZlcnRKc29uVG9BcGlSZXFPYmoodm0uZmVhdHVyZUF0dHIsIHZtLmN1cnJlbnRGZWF0dXJlKTtcbiAgICAgICAgICAgIHZtLmN1cnJlbnRGZWF0dXJlLnByb3BlcnRpZXMgPSB7XG4gICAgICAgICAgICAgIFwia2V5X2NpZG9jX2FycmF5XCI6IGNvbnZlcnRUb1NTVihhcGlQYXJhbUZvcm1hdC5rZXlzKSxcbiAgICAgICAgICAgICAgXCJ2YWx1ZV9nYXpldHRlZXJfYXJyYXlcIjogY29udmVydFRvU1NWKGFwaVBhcmFtRm9ybWF0LnZhbHVlcyksXG4gICAgICAgICAgICAgIFwidHlwZV9jcm1cIjogdm0uZmVhdHVyZUF0dHIudHlwZV9jcm1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2bS5jdXJyZW50TGVhZkZlYXR1cmUuZmVhdHVyZSA9IHZtLmN1cnJlbnRGZWF0dXJlO1xuICAgICAgICAgICAgLy8gZmlyZSBiYWNrIHRvIGxlZnQgc2lkZW5hdiB0byBhZGQgbmV3bHkgYWRkZWQgZmVhdHVyZSB0byBpdHMgbGF5ZXJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdChcImFkZEZlYXR1cmVUb0xheWVyXCIsIHZtLmN1cnJlbnRMZWFmRmVhdHVyZSk7XG4gICAgICAgICAgICAkc2Vzc2lvblN0b3JhZ2Uuc2V0T2JqZWN0KFwiY3JlYXRlUGFyYW1cIiwgdm0uY3JlYXRlUGFyYW0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoYW5kbGVFZGl0UGFyYW0odm0uZmVhdHVyZUF0dHIsIHZtLmVkaXRQYXJhbSwgdm0uY3VycmVudEZlYXR1cmUpO1xuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJ2bS5lZGl0UGFyYW0gPSBcIiwgdm0uZWRpdFBhcmFtKTtcbiAgICAgICAgICAgICRzZXNzaW9uU3RvcmFnZS5zZXRPYmplY3QoXCJlZGl0UGFyYW1cIiwgdm0uZWRpdFBhcmFtKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaGFuZGxlRWRpdFBhcmFtKHZtLmZlYXR1cmVBdHRyLCB2bS5lZGl0UGFyYW0sIHZtLmN1cnJlbnRGZWF0dXJlKTtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcInZtLmVkaXRQYXJhbSA9IFwiLCB2bS5lZGl0UGFyYW0pO1xuICAgICAgICAgICRzZXNzaW9uU3RvcmFnZS5zZXRPYmplY3QoXCJlZGl0UGFyYW1cIiwgdm0uZWRpdFBhcmFtKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0b2dnbGVTYXZlQnV0dG9uKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlcyBFZGl0ICsgRWRpdCBvcGVyYXRpb25zIG9uIFJpZ2h0IFNhdmUgY2xpY2tcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gZmVhdHVyZUF0dHIgZmVhdHVyZSdzIGF0dHJpYnV0ZXMgd2hpY2ggYXJlIGRpc3BsYXllZCBpbiByaWdodCBzaWRlbmF2XG4gICAgICogQHBhcmFtIHthbnl9IGVkaXRQYXJhbUNvbGxlY3Rpb24gRWRpdCBjb2xsZWN0aW9uICBcbiAgICAgKiBAcGFyYW0ge2FueX0gY3VycmVudEZlYXR1cmUgXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gaGFuZGxlRWRpdFBhcmFtKGZlYXR1cmVBdHRyLCBlZGl0UGFyYW1Db2xsZWN0aW9uLCBjdXJyZW50RmVhdHVyZSkge1xuICAgICAgLy8gY2hlY2sgaXMgY3VycmVudCBmZWF0dXJlIGFscmVhZHkgZXhpc3QgaW4gZWRpdFBhcmFtQ29sbGVjdGlvbiBkdWUgdG8gZ2VvbSBlZGl0XG4gICAgICBpZihlZGl0UGFyYW1Db2xsZWN0aW9uLmRhdGEubGVuZ3RoID4gMCkge1xuICAgICAgICAvLyBmaW5kIGVkaXR0ZWQgZmVhdHVyZSBpbiBlZGl0UGFyYW0gXG4gICAgICAgIHZhciBmb3VuZE9iamVjdEluRWRpdFBhcmFtID0gbG9kYXNoLmZpbmQoZWRpdFBhcmFtQ29sbGVjdGlvbi5kYXRhLCBmdW5jdGlvbihlYWNoRmVhdHVyZSl7XG4gICAgICAgICAgcmV0dXJuIChwYXJzZUludChmZWF0dXJlQXR0ci50eXBlX2NybSkgPT09IGVhY2hGZWF0dXJlLnR5cGVfY3JtIHx8IFxuICAgICAgICAgICAgZmVhdHVyZUF0dHIudHlwZV9jcm0gPT09IGVhY2hGZWF0dXJlLnR5cGVfY3JtKSBcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIGlmIGZvdW5kIHRoYW4gcmVwbGFjZSBpdCBpbiBlZGlQYXJhbSBlbHNlIGl0cyBhIG5ldyBmZWF0dXJlIHB1c2ggdG8gZWRpdFBhcmFtXG4gICAgICAgIGlmKHR5cGVvZiBmb3VuZE9iamVjdEluRWRpdFBhcmFtICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgc2VhcmNoQW5kUmVwbGFjZShmZWF0dXJlQXR0ciwgZWRpdFBhcmFtQ29sbGVjdGlvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHRlbXBGZWF0dXJlID0ge1xuICAgICAgICAgICAgXCJsYXllcl9pZFwiOiB2bS5jdXJyZW50TGF5ZXIubGF5ZXJJZCxcbiAgICAgICAgICAgIFwidHlwZV9jcm1cIjogcGFyc2VJbnQoZmVhdHVyZUF0dHIudHlwZV9jcm0pLFxuICAgICAgICAgICAgXCJrZXlfY2lkb2NfYXJyYXlcIjogT2JqZWN0LmtleXMoZmVhdHVyZUF0dHIpLFxuICAgICAgICAgICAgXCJ2YWx1ZV9nYXpldHRlZXJfYXJyYXlcIjogT2JqZWN0LnZhbHVlcyhmZWF0dXJlQXR0cilcbiAgICAgICAgICB9XG4gICAgICAgICAgZWRpdFBhcmFtQ29sbGVjdGlvbi5kYXRhLnB1c2godGVtcEZlYXR1cmUpO1xuICAgICAgICAgIGN1cnJlbnRGZWF0dXJlLnByb3BlcnRpZXMua2V5X2NpZG9jX2FycmF5ID0gT2JqZWN0LmtleXMoZmVhdHVyZUF0dHIpLnRvU3RyaW5nKCk7XG4gICAgICAgICAgY3VycmVudEZlYXR1cmUucHJvcGVydGllcy52YWx1ZV9nYXpldHRlZXJfYXJyYXkgPSBPYmplY3QudmFsdWVzKGZlYXR1cmVBdHRyKS50b1N0cmluZygpOyAgXG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciB0ZW1wRmVhdHVyZUF0dHIgPSBGZWF0dXJlU2VydmljZS50ZWFyT2JqZWN0KGZlYXR1cmVBdHRyKTtcbiAgICAgICAgdmFyIHRlbXBGZWF0dXJlID0ge1xuICAgICAgICAgIFwibGF5ZXJfaWRcIjogdm0uY3VycmVudExheWVyLmxheWVySWQsXG4gICAgICAgICAgXCJ0eXBlX2NybVwiOiBwYXJzZUludChmZWF0dXJlQXR0ci50eXBlX2NybSksXG4gICAgICAgICAgXCJrZXlfY2lkb2NfYXJyYXlcIjogdGVtcEZlYXR1cmVBdHRyLmtleXMsXG4gICAgICAgICAgXCJ2YWx1ZV9nYXpldHRlZXJfYXJyYXlcIjogdGVtcEZlYXR1cmVBdHRyLnZhbHVlc1xuICAgICAgICB9XG4gICAgICAgIGVkaXRQYXJhbUNvbGxlY3Rpb24uZGF0YS5wdXNoKHRlbXBGZWF0dXJlKTtcbiAgICAgICAgY3VycmVudEZlYXR1cmUucHJvcGVydGllcy5rZXlfY2lkb2NfYXJyYXkgPSBPYmplY3Qua2V5cyhmZWF0dXJlQXR0cikudG9TdHJpbmcoKTtcbiAgICAgICAgY3VycmVudEZlYXR1cmUucHJvcGVydGllcy52YWx1ZV9nYXpldHRlZXJfYXJyYXkgPSBPYmplY3QudmFsdWVzKGZlYXR1cmVBdHRyKS50b1N0cmluZygpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNpbmNlIG91ciBBUEkgcmVxdWlyZXMgdGhlIGRhdGEgaW4gYSBwYXJ0aWN1bGFyIGZvcm1hdC4gVGhpcyBmdW5jaW9uIGNvbnZlcnRzIGtleTogdmFsdWUgXG4gICAgICogY29tYmluYXRpb24gdG8gYWxsIGtleXMgdG9nZXRoZXIgYW5kIGFsbCB2YWx1ZXMgdG9nZXRoZXIuIEFsc28gYWRkcyBnZW9tZXRyeSB0byBcbiAgICAgKiB0aGF0IGtleSBhbmQgdmFsdWUgc3R5bGUgb2JqZWN0XG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IGF0dHJpYnV0ZXMgZmVhdHVyZSdzIGF0dHJpYnV0ZXMgd2hpY2ggYXJlIGRpc3BsYXllZCBpbiByaWdodCBzaWRlbmF2XG4gICAgICogQHBhcmFtIHthbnl9IGZlYXR1cmUgXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gY29udmVydEpzb25Ub0FwaVJlcU9iaihhdHRyaWJ1dGVzLCBmZWF0dXJlKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiBjb252ZXJ0SnNvblRvQXBpUmVxT2JqID4+PiBcIiwgYXR0cmlidXRlcywgZmVhdHVyZSk7XG4gICAgICBmb3IodmFyIGVhY2hBdHRyIGluIGF0dHJpYnV0ZXMpIHtcbiAgICAgICAgaWYoQXJyYXkuaXNBcnJheShhdHRyaWJ1dGVzW2VhY2hBdHRyXSkpIHtcbiAgICAgICAgICAvLyBlYWNoQXR0ciA9IGVhY2hBdHRyLnRvU3RyaW5nKCk7XG4gICAgICAgICAgYXR0cmlidXRlc1tlYWNoQXR0cl0gPSBKU09OLnN0cmluZ2lmeShhdHRyaWJ1dGVzW2VhY2hBdHRyXSk7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coXCJhdHRyaWJ1dGVzW2VhY2hBdHRyXSA9IFwiLCBhdHRyaWJ1dGVzW2VhY2hBdHRyXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoYXR0cmlidXRlcyk7XG4gICAgICB2YXIgdmFsdWVzID0gT2JqZWN0LnZhbHVlcyhhdHRyaWJ1dGVzKTtcbiAgICAgIFxuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gY29udmVydEpzb25Ub0FwaVJlcU9iaiA+Pj4gXCIsIHZhbHVlcyk7XG4gICAgICBrZXlzLnB1c2goXCJnZW9tXCIpO1xuICAgICAgdmFsdWVzLnB1c2goZmVhdHVyZS5nZW9tZXRyeSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBcImtleXNcIjoga2V5cyxcbiAgICAgICAgXCJ2YWx1ZXNcIjogdmFsdWVzXG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2VhcmNoIGZvciB0aGUgZmVhdHVyZSBpbiBjb2xsZWN0aW9uIHVzaW5nICd0eXBlX2NybScgaW4gZmVhdHVyZSB0byBtYXRjaCB3aXRoICd0eXBlX2NybScgXG4gICAgICogaW4gY29sbGVjdGlvbi4gSGFuZGxlcyBFZGl0ICsgRWRpdCBvcGVyYXRpb25cbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gZmVhdHVyZSBcbiAgICAgKiBAcGFyYW0ge2NvbGxlY3Rpb259IGNvbGxlY3Rpb25cbiAgICAgKiBcbiAgICAgKiBAcmV0dXJucyBjb2xsZWN0aW9uIG1vZGlmaWVkIGNvbGxlY3Rpb25cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzZWFyY2hBbmRSZXBsYWNlKGZlYXR1cmUsIGNvbGxlY3Rpb24pIHtcbiAgICAgIHZhciByZXR1cm5EYXRhID0gW107XG4gICAgICB2YXIgdGVtcENvbGxlY3Rpb24gPSBjb2xsZWN0aW9uLmRhdGE7XG4gICAgICBsb2Rhc2guZm9yRWFjaCh0ZW1wQ29sbGVjdGlvbiwgZnVuY3Rpb24oZWFjaEZlYXR1cmUpIHtcbiAgICAgICAgaWYocGFyc2VJbnQoZmVhdHVyZS50eXBlX2NybSkgPT09IGVhY2hGZWF0dXJlLnR5cGVfY3JtIHx8IFxuICAgICAgICAgICAgZmVhdHVyZS50eXBlX2NybSA9PT0gZWFjaEZlYXR1cmUudHlwZV9jcm0pIHtcbiAgICAgICAgICBmZWF0dXJlID0gRmVhdHVyZVNlcnZpY2UudGVhck9iamVjdChmZWF0dXJlKTtcbiAgICAgICAgICBlYWNoRmVhdHVyZS5rZXlfY2lkb2NfYXJyYXkgPSBmZWF0dXJlLmtleXM7XG4gICAgICAgICAgZWFjaEZlYXR1cmUudmFsdWVfZ2F6ZXR0ZWVyX2FycmF5ID0gZmVhdHVyZS52YWx1ZXM7XG4gICAgICAgIH0gXG4gICAgICB9KTtcbiAgICAgIHJldHVybiByZXR1cm5EYXRhO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNlYXJjaCBmb3IgdGhlIGZlYXR1cmUgaW4gY29sbGVjdGlvbiB1c2luZyAndHlwZV9jcm0nIGluIGZlYXR1cmUgdG8gbWF0Y2ggd2l0aCAndHlwZV9jcm0nIFxuICAgICAqIGluIGNvbGxlY3Rpb24uIEhhbmRsZXMgRWRpdCArIEVkaXQgb3BlcmF0aW9uXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IGZlYXR1cmUgXG4gICAgICogQHBhcmFtIHtjb2xsZWN0aW9ufSBjb2xsZWN0aW9uXG4gICAgICogXG4gICAgICogQHJldHVybnMgY29sbGVjdGlvbiBtb2RpZmllZCBjb2xsZWN0aW9uXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2VhcmNoRnJvbUNvbGxlY3Rpb25Ub0ZlYXR1cmUoZmVhdHVyZSwgY29sbGVjdGlvbikge1xuICAgICAgdmFyIHJldHVybkRhdGEgPSBudWxsO1xuICAgICAgdmFyIHRlbXBDb2xsZWN0aW9uID0gY29sbGVjdGlvbi5kYXRhO1xuICAgICAgbG9kYXNoLmZvckVhY2godGVtcENvbGxlY3Rpb24sIGZ1bmN0aW9uKGVhY2hGZWF0dXJlKXtcbiAgICAgICAgaWYoZmVhdHVyZS50eXBlX2NybSA9PT0gZWFjaEZlYXR1cmUudHlwZV9jcm0pIHtcbiAgICAgICAgICBlYWNoRmVhdHVyZSA9IEZlYXR1cmVTZXJ2aWNlLnN0aXRjaE9iamVjdChlYWNoRmVhdHVyZS5rZXlfY2lkb2NfYXJyYXksIGVhY2hGZWF0dXJlLnZhbHVlX2dhemV0dGVlcl9hcnJheSk7XG4gICAgICAgICAgcmV0dXJuRGF0YSA9IGVhY2hGZWF0dXJlO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwic2VhcmNoRnJvbUNvbGxlY3Rpb25Ub0ZlYXR1cmUgPj4+IHJldHVybkRhdGEgPSBcIiwgcmV0dXJuRGF0YSk7XG4gICAgICByZXR1cm4gcmV0dXJuRGF0YTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZWFyY2ggZm9yIHRoZSBmZWF0dXJlIGluIGNvbGxlY3Rpb24gdXNpbmcgJ3R5cGVfY3JtJyBpbiBmZWF0dXJlIHRvIG1hdGNoIHdpdGggJ3R5cGVfY3JtJyBcbiAgICAgKiBpbiBjb2xsZWN0aW9uLiBhbmQgcmVwbGFjZSB0aGUgRmVhdHVyZSdzIGdlb21ldHJ5IGluIENvbGxlY3Rpb24gIHdpdGggZmVhdHVyZScgZ2VvbWV0cnlcbiAgICAgKiBCYXNpY2FsbHkgdXNlZCBpbiBBZGQvRWRpdCArIEVkaXQgKGdlb20pIG9wZXJhdGlvblxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7YW55fSBmZWF0dXJlIFxuICAgICAqIEBwYXJhbSB7Y29sbGVjdGlvbn0gY29sbGVjdGlvblxuICAgICAqIFxuICAgICAqIEByZXR1cm5zIGNvbGxlY3Rpb24gbW9kaWZpZWQgY29sbGVjdGlvblxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHNlYXJjaEFuZFJlcGxhY2VPbmx5R2VvbShmZWF0dXJlLCBjb2xsZWN0aW9uKSB7XG4gICAgICB2YXIgdGVtcENvbGxlY3Rpb24gPSBjb2xsZWN0aW9uLmRhdGE7XG4gICAgICBsb2Rhc2guZm9yRWFjaCh0ZW1wQ29sbGVjdGlvbiwgZnVuY3Rpb24oZWFjaEZlYXR1cmUpe1xuICAgICAgICBpZihwYXJzZUludChmZWF0dXJlLnByb3BlcnRpZXMudHlwZV9jcm0pID09PSBlYWNoRmVhdHVyZS50eXBlX2NybSB8fCBcbiAgICAgICAgICAgIGZlYXR1cmUucHJvcGVydGllcy50eXBlX2NybSA9PT0gZWFjaEZlYXR1cmUudHlwZV9jcm0pIHtcbiAgICAgICAgICAgICAgZWFjaEZlYXR1cmUudmFsdWVfZ2F6ZXR0ZWVyX2FycmF5W2VhY2hGZWF0dXJlLmtleV9jaWRvY19hcnJheS5pbmRleE9mKFwiZ2VvbVwiKV0gPSBmZWF0dXJlLmdlb21ldHJ5O1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTZWFyY2hlcyBmb3IgYSBmZWF0dXJlIGluIGEgY29sbGVjdGlvbiBnaXZlbi4gUmV0dXJucyB0cnVlIGlmIGZvdW5kIGVsc2UgZmFsc2VcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge2FueX0gZmVhdHVyZSBcbiAgICAgKiBAcGFyYW0ge2NvbGxlY3Rpb259IGNvbGxlY3Rpb25cbiAgICAgKiBcbiAgICAgKiBAcmV0dXJucyBib29sZWFuXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2VhcmNoSW5Db2xsZWN0aW9uKGNvbGxlY3Rpb24sIGxheWVyKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcInNlYXJjaEluQ29sbGVjdGlvbiA+Pj4gXCIsIGNvbGxlY3Rpb24sIGxheWVyKTtcbiAgICAgIHZhciB0ZW1wUmV0dXJuID0gbG9kYXNoLmZpbmQoY29sbGVjdGlvbi5kYXRhLCBmdW5jdGlvbihlYWNoRmVhdHVyZSl7XG4gICAgICAgIHJldHVybiAocGFyc2VJbnQobGF5ZXIuZmVhdHVyZS5wcm9wZXJ0aWVzLnR5cGVfY3JtKSA9PT0gZWFjaEZlYXR1cmUudHlwZV9jcm0gfHwgXG4gICAgICAgIGxheWVyLmZlYXR1cmUucHJvcGVydGllcy50eXBlX2NybSA9PT0gZWFjaEZlYXR1cmUudHlwZV9jcm0pIFxuICAgICAgfSk7XG4gICAgICBpZih0eXBlb2YgdGVtcFJldHVybiAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWxldGVzIGEgZmVhdHVyZSBmcm9tIGEgY29sbGVjdGlvbiBnaXZlbi4gUmV0dXJucyBuZXcgY29sbGVjdGlvblxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7YW55fSBmZWF0dXJlIFxuICAgICAqIEBwYXJhbSB7Y29sbGVjdGlvbn0gY29sbGVjdGlvblxuICAgICAqIFxuICAgICAqIEByZXR1cm5zIGNvbGxlY3Rpb25cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBkZWxldGVGZWF0dXJlRnJvbUNvbGxlY3Rpb24obGF5ZXIsIGNvbGxlY3Rpb24pIHtcbiAgICAgIHJldHVybiBsb2Rhc2gucmVtb3ZlKGNvbGxlY3Rpb24uZGF0YSwgZnVuY3Rpb24oZWFjaEZlYXR1cmUpe1xuICAgICAgICByZXR1cm4gKHBhcnNlSW50KGxheWVyLmZlYXR1cmUucHJvcGVydGllcy50eXBlX2NybSkgPT09IGVhY2hGZWF0dXJlLnR5cGVfY3JtIHx8IFxuICAgICAgICBsYXllci5mZWF0dXJlLnByb3BlcnRpZXMudHlwZV9jcm0gPT09IGVhY2hGZWF0dXJlLnR5cGVfY3JtKSBcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERpc2FibGVzIHRoZSBTYXZlIGJ1dHRvbiBmcm9tIGFjY2lkZW50YWwgdXBkYXRlc1xuICAgICAqIEVuYWJsZXMgYmFjayB3aGVuIGZlYXR1cmUgaXMgY2xpY2tlZCBvbiBtYXBcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0b2dnbGVTYXZlQnV0dG9uKCkge1xuICAgICAgdm0uZGlzYWJsZVNhdmUgPSB0cnVlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhbGxzIHRoZSBBUEkgZm9yIGdldHRpbmcgYWxsIHZlcnNpb25zIG9mIGEgcGFydGljdWxhciBmZWF0dXJlXG4gICAgICogdXNlcyB2bS5jdXJyZW50RmVhdHVyZSwgdm0uY3VycmVudExheWVyXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2hvd0FsbEZlYXR1cmVWZXJzaW9ucygpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiPj4+ID4+PiBzaG93QWxsRmVhdHVyZVZlcnNpb25zID4+PiBcIiwgdm0uY3VycmVudEZlYXR1cmUsIHZtLmN1cnJlbnRMYXllcik7XG4gICAgICBNYXBMYXllclNlcnZpY2UucmVtb3ZlQWxsTWFwTGF5ZXJzKCdyaWdodE1hcFZpZXdlcicpO1xuICAgICAgLy8gY2FsbCBnZXRBbGxGZWF0dXJlVmVyc2lvblxuICAgICAgdmFyIHJlcVBhcmFtRGF0YSA9IHsgXG4gICAgICAgIHByb2pfaWQ6ICRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJwcm9qSWRcIikudG9TdHJpbmcoKSxcbiAgICAgICAgbGF5ZXJfaWQ6IHZtLmN1cnJlbnRMYXllci5sYXllcklkLFxuICAgICAgICB0eXBlX2NybTogdm0uY3VycmVudEZlYXR1cmUucHJvcGVydGllcy50eXBlX2NybSxcbiAgICAgICAgZmV0Y2g6ICdhbGxWZXJzaW9ucydcbiAgICAgIH07XG4gICAgICB2YXIgbGF5ZXJTZXJ2aWNlID0gbmV3IFZlY3RvclNlcnZpY2UoKTtcbiAgICAgIGxheWVyU2VydmljZS5nZXRBbGxGZWF0dXJlVmVyc2lvbihyZXFQYXJhbURhdGEpXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgICAgIGlmKHJlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIHNob3dGZWF0dXJlT25NYXAocmVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaG93cyAvIHJlbmRlcnMgYWxsIHZlcnNpb25zIG9mIGEgcGFydGljdWxhciBmZWF0dXJlIG9uIHJpZ2h0IG1hcFxuICAgICAqIEFzc29jaWF0ZXMgY2xpY2sgZXZlbnQgdG8gZWFjaCBmZWF0dXJlIHRvIHNob3cgYXR0cmlidXRlcyBvbiBjbGlja1xuICAgICAqIFxuICAgICAqIEBwYXJhbSBbe2FueX1dIGZlYXR1cmVzXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2hvd0ZlYXR1cmVPbk1hcChmZWF0dXJlcykge1xuXG4gICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5yaWdodE1hcExheWVyR3JvdXApKSB7XG4gICAgICAgIHZtLnJpZ2h0TWFwTGF5ZXJHcm91cC5jbGVhckxheWVycygpO1xuICAgICAgfVxuICAgICAgdm0ucmlnaHRNYXBMYXllckdyb3VwID0gbmV3IGxlYWZsZXQuTGF5ZXJHcm91cCgpO1xuICAgICAgXG4gICAgICBsZWFmbGV0RGF0YS5nZXRNYXAoJ3JpZ2h0TWFwVmlld2VyJykudGhlbihmdW5jdGlvbiAobWFwKSB7XG4gICAgICAgIGxvZGFzaC5mb3JFYWNoKGZlYXR1cmVzLCBmdW5jdGlvbihmZWF0dXJlKSB7XG4gICAgICAgICAgZmVhdHVyZS50eXBlX2NybSA9IHZtLmN1cnJlbnRGZWF0dXJlLnByb3BlcnRpZXMudHlwZV9jcm0gKyBcIl9cIiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICg5OTk5IC0gMSArIDEpKSArIDE7XG4gICAgICAgICAgdmFyIGZnZW9tID0gSlNPTi5wYXJzZShmZWF0dXJlLmdlb20pO1xuICAgICAgICAgIGRlbGV0ZSBmZWF0dXJlLmdlb207XG5cbiAgICAgICAgICB2YXIgZ2VvanNvbkZlYXR1cmUgPSB7XG4gICAgICAgICAgICBcInR5cGVcIjogXCJGZWF0dXJlXCIsXG4gICAgICAgICAgICBcInByb3BlcnRpZXNcIjogZmVhdHVyZSxcbiAgICAgICAgICAgIFwiZ2VvbWV0cnlcIjogZmdlb21cbiAgICAgICAgICB9O1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwiZ2VvanNvbkZlYXR1cmUgPSBcIiwgZ2VvanNvbkZlYXR1cmUpO1xuICAgICAgICAgIC8vIHZtLnJpZ2h0TWFwTGF5ZXJHcm91cCA9IGxlYWZsZXQuZ2VvSlNPTihnZW9qc29uRmVhdHVyZSwge1xuICAgICAgICAgIC8vICAgb25FYWNoRmVhdHVyZTogb25FYWNoRmVhdHVyZVxuICAgICAgICAgIC8vIH0pLmFkZFRvKG1hcCk7XG4gICAgICAgICAgbGVhZmxldC5nZW9KU09OKGdlb2pzb25GZWF0dXJlLCB7XG4gICAgICAgICAgICBvbkVhY2hGZWF0dXJlOiBvbkVhY2hGZWF0dXJlXG4gICAgICAgICAgfSkuYWRkVG8odm0ucmlnaHRNYXBMYXllckdyb3VwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHZtLnJpZ2h0TWFwTGF5ZXJHcm91cC5hZGRUbyhtYXApO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIGlubmVyIGZ1Y250aW9uIHVzZWQgZm9yIGJpbmRpbmcgY2xpY2sgZXZlbnQgdG8gZWFjaCBmZWF0dXJlXG4gICAgICBmdW5jdGlvbiBvbkVhY2hGZWF0dXJlKGZlYXR1cmUsIGxheWVyKSB7XG4gICAgICAgIGxheWVyLm9uKHtcbiAgICAgICAgICAnY2xpY2snOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgY2xvc2UoKTtcbiAgICAgICAgICAgIHNob3dBdHRyaWJ1dGVzKGZlYXR1cmUucHJvcGVydGllcyk7XG4gICAgICAgICAgICB2bS5kaXNhYmxlU2F2ZSA9IHRydWU7XG4gICAgICAgICAgICB2bS5zaG93QWxsVmVyc2lvbnMgPSBmYWxzZTtcbiAgICAgICAgICAgIG9wZW4oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIE9wZW4vY2xvc2UgdGhlIHJpZ2h0IHNpZGUgbmF2XG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9nZ2xlUmlnaHQoKSB7XG4gICAgICAkbWRTaWRlbmF2KCdyaWdodCcpLnRvZ2dsZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhbGxlZCB3aGVuIEZlYXR1cmUgVHlwZSBEcm9wZG93biBpcyBjaGFuZ2VkLiBHZXRzIGF0dHJpYnV0ZXMgKG9ubHkga2V5KW9mIHRoZSBmZWF0dXJlXG4gICAgICogdG8gZ2VuZXJhdGUgdGhlIEF0dHJpYnV0ZSBmb3JtXG4gICAgICogXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHZtLmZlYXR1cmVBdHRyLmZlYXR1cmUgZHJvcGRvd24gc2VsZWN0ZWQgdmFsdWVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRGb3JtQXR0cmlidXRlKCkge1xuICAgICAgLy8gY29uc29sZS5sb2coXCJnZXRGb3JtQXR0cmlidXRlIFwiLCB2bS5mZWF0dXJlQXR0ci5mZWF0dXJlKTtcbiAgICAgIC8vIGNhbGwgQVBJIGZvciB2bS5mZWF0dXJlQXR0ci5mZWF0dXJlXG4gICAgICB2YXIgZmVhdHVyZVR5cGUgPSB2bS5mZWF0dXJlQXR0ci5mZWF0dXJlO1xuICAgICAgaWYoZmVhdHVyZVR5cGUuaW5kZXhPZihcIiBcIikgIT09IC0xKSB7XG4gICAgICAgIGZlYXR1cmVUeXBlID0gZmVhdHVyZVR5cGUucmVwbGFjZSgvXFxzL2csICcnKTtcbiAgICAgIH1cbiAgICAgIHZhciByZXFQYXJhbURhdGEgPSB7dHlwZSA6IGZlYXR1cmVUeXBlfTtcbiAgICAgIHZhciB2ZWN0b3JTZXJ2aWNlID0gbmV3IFZlY3RvclNlcnZpY2UoKTtcbiAgICAgIHZlY3RvclNlcnZpY2UuZ2V0Rm9ybURhdGEocmVxUGFyYW1EYXRhKVxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlcyl7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcInJlc3BvbnNlIFwiLCByZXMpO1xuICAgICAgICAgICAgdm0uZm9ybVBhcmFtcyA9IHJlcztcbiAgICAgICAgICB9LCBmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3Mgd2hldGhlciBhIGZpZWxkIGlzIGRlcGVuZGVudCBvbiBvdGhlciBmaWVsZHMuIFVzZWQgZm9yIER5bmFtaWMgZm9ybSBcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gZmllbGRcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjaGVja0RlcGVuZGVudFZhbHVlKGZpZWxkKSB7XG4gICAgICAvLyB2bS5mb3JtUGFyYW1zXG4gICAgICAvLyBmZWF0dXJlQXR0cltmaWVsZC5uYW1lXVxuICAgICAgaWYodm0uZmVhdHVyZUF0dHIgIT09IG51bGwpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coZmllbGQubmFtZSwgXCIgLSBcIiwgZmllbGQuZGVwZW5kZW50KTsgXG4gICAgICAgIGlmKGZpZWxkLm5hbWUgIT09IGZpZWxkLmRlcGVuZGVudCkge1xuICAgICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLmZlYXR1cmVBdHRyW2ZpZWxkLmRlcGVuZGVudF0pKSB7XG4gICAgICAgICAgICAvLyBpZih2bS5mZWF0dXJlQXR0cltmaWVsZC5kZXBlbmRlbnRdICE9PSBcIlwiKSB7XG4gICAgICAgICAgICBpZih2bS5mZWF0dXJlQXR0cltmaWVsZC5kZXBlbmRlbnRdLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIj4+PiA+Pj4gY2hlY2tEZXBlbmRlbnRWYWx1ZSBcIiwgZmllbGQsIGZpZWxkLmRlcGVuZGVudCwgdm0uZmVhdHVyZUF0dHJbZmllbGQuZGVwZW5kZW50XSk7XG4gICAgICAgICAgICAgIC8vIGZpZWxkLnJlcXVpcmVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgLy8gY2xvc2UoKTtcbiAgICAgICAgICAgICAgLy8gb3BlbigpO1xuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGNvbW1hIHNwZXJhdGVkIHZhbHVlcyB0byBzZW1pLWNvbG9uIHNlcGVyYXRlZCB2YWx1ZXNcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0geyp9IGNzdlN0cmluZyBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjb252ZXJ0VG9TU1YoY3N2U3RyaW5nKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcImNzdlN0cmluZyA9IFwiLCBjc3ZTdHJpbmcpO1xuICAgICAgdmFyIHJlc3VsdFN0cmluZyA9IFwiXCI7XG4gICAgICBmb3IodmFyIGk9MDsgaSA8IGNzdlN0cmluZy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZih0eXBlb2YgY3N2U3RyaW5nW2ldICE9PSBcIm9iamVjdFwiICYmIHR5cGVvZiBjc3ZTdHJpbmdbaV0gIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICBpZihjc3ZTdHJpbmdbaV0uaW5kZXhPZihcIltcIikgIT09IC0xKSB7XG4gICAgICAgICAgICBpZihyZXN1bHRTdHJpbmcgPT0gXCJcIikge1xuICAgICAgICAgICAgICByZXN1bHRTdHJpbmcgPSBjc3ZTdHJpbmdbaV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXN1bHRTdHJpbmcgPSByZXN1bHRTdHJpbmcgKyBcIjtcIiAgKyBjc3ZTdHJpbmdbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZihyZXN1bHRTdHJpbmcgPT0gXCJcIikge1xuICAgICAgICAgICAgcmVzdWx0U3RyaW5nID0gY3N2U3RyaW5nW2ldO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXN1bHRTdHJpbmcgPSByZXN1bHRTdHJpbmcgKyBcIjtcIiAgKyBjc3ZTdHJpbmdbaV07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyByZXR1cm4gY3N2U3RyaW5nLnJlcGxhY2UoLywvZywgXCI7XCIpO1xuICAgICAgcmV0dXJuIHJlc3VsdFN0cmluZztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgdGhlIHVzZXIgYmFzZWQgb24gaGlzIHJvbGUgd2hldGhlciBoZS9zaGUgaXMgYWxsb3dlZCBhY2Nlc3Mgb24gdGhlIGZlYXR1cmUgXG4gICAgICogXG4gICAgICogQHBhcmFtIHtvYmplY3R9IGZlYXR1cmVcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gdXNlciBjdXJyZW50bHkgbG9nZ2VkIGluIHVzZXJcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBjaGVja1VzZXJBY2Nlc3NPbkZlYXR1cmUoZmVhdHVyZSwgdXNlcikge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gY2hlY2tVc2VyQWNjZXNzT25GZWF0dXJlID4+PiBcIiwgZmVhdHVyZSwgdXNlcik7XG4gICAgICAvLyBhZG1pblxuICAgICAgaWYoJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCIxXCIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICAvLyBzZW5pb3IgdXNlclxuICAgICAgaWYoJHNlc3Npb25TdG9yYWdlLmdldE9iamVjdChcInJvbGVcIikudG9TdHJpbmcoKSA9PT0gXCIyXCIpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICAvLyB1c2VyXG4gICAgICBpZigkc2Vzc2lvblN0b3JhZ2UuZ2V0T2JqZWN0KFwicm9sZVwiKS50b1N0cmluZygpID09PSBcIjNcIikge1xuICAgICAgICBpZihmZWF0dXJlLnByb3BlcnRpZXMudXNlcl9pZCA9PT0gdXNlcikge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSBcbiAgICAgIC8vIGd1ZXN0IHVzZXJcbiAgICAgIGlmKCRzZXNzaW9uU3RvcmFnZS5nZXRPYmplY3QoXCJyb2xlXCIpLnRvU3RyaW5nKCkgPT09IFwiNFwiKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBhY3RpdmF0ZSgpO1xuICAgIFxuICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcblxuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhclxuICAgIC5tb2R1bGUoJ2FwcCcpXG4gICAgLmNvbnRyb2xsZXIoJ01hcEJvdHRvbU5hdkNvbnRyb2xsZXInLCBNYXBCb3R0b21OYXZDb250cm9sbGVyKTtcblxuICAvKiogQG5nSW5qZWN0ICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBtYXgtcGFyYW1zXG4gIGZ1bmN0aW9uIE1hcEJvdHRvbU5hdkNvbnRyb2xsZXIoJGNvbnRyb2xsZXIsIE1hcFNlcnZpY2UsIGxvZGFzaCwgJG1kU2lkZW5hdiwgJHJvb3RTY29wZSwgTWFwTGF5ZXJTZXJ2aWNlLCBDMkRpYWxvZywgJHRyYW5zbGF0ZSwgTWFwVmlld2VyU2VydmljZSwgJHN0YXRlKSB7XG5cbiAgICB2YXIgdm0gPSB0aGlzOyAgIFxuICAgIHZtLmFmdGVyU2VhcmNoID0gYWZ0ZXJTZWFyY2g7XG4gICAgdm0udG9nZ2xlQm90dG9tID0gdG9nZ2xlQm90dG9tO1xuICAgIHZtLmFwcGx5RmlsdGVycyA9IGFwcGx5RmlsdGVycztcbiAgICB2bS50b2dnbGVJbmNsdWRlVG9Xb3JraW5nTGlzdCA9IHRvZ2dsZUluY2x1ZGVUb1dvcmtpbmdMaXN0O1xuICAgIHZtLmlzTG9hZGVkID0gaXNMb2FkZWQ7XG4gICAgdm0ub25BY3RpdmF0ZSA9IG9uQWN0aXZhdGU7XG4gICAgdm0uc2hvd0xvYWRNYXBJbkxlZnRCdXR0b24gPSBzaG93TG9hZE1hcEluTGVmdEJ1dHRvbjtcbiAgICB2bS5zaG93TG9hZE1hcEluUmlnaHRCdXR0b24gPSBzaG93TG9hZE1hcEluUmlnaHRCdXR0b247XG4gICAgdm0ubG9hZEdjcE9uTWFwID0gbG9hZEdjcE9uTWFwO1xuICAgIHZtLmlzTm9uR2VvcmVmTG9hZGVkID0gaXNOb25HZW9yZWZMb2FkZWQ7XG4gICAgdm0uc2hvd0ZpbHRlckNoZWNrYm94ID0gZmFsc2U7XG4gICAgdm0uc2hvd09ubHlDaGlsZE1hcCA9IGZhbHNlO1xuICAgIHZtLnNob3dPbmx5Q2hpbGRNYXBGdW5jID0gc2hvd09ubHlDaGlsZE1hcEZ1bmM7XG4gICAgdm0uaXNDaGlsZE1hcCA9IGlzQ2hpbGRNYXA7XG5cbiAgICAvKipcbiAgICAgKiBFeGVjdXRlIHRoZSBhY3Rpb24gd2hlbiB0aGlzIGNvbnRyb2xsZXIgaXMgYWN0aXZhdGVkXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gb25BY3RpdmF0ZSgpIHtcbiAgICAgIHZtLnNob3dCb3R0b21OYXYgPSBmYWxzZTtcbiAgICAgIHZtLnNob3dMb2FkTWFwSW5SaWdodCA9IE1hcFZpZXdlclNlcnZpY2UuZ2V0T3B0aW9uKCdyaWdodE1hcFZpZXdlcicsICdzaG93TG9hZE1hcEluUmlnaHQnLCB0cnVlKTtcbiAgICAgIHZtLnNob3dMb2FkTWFwSW5MZWZ0ID0gTWFwVmlld2VyU2VydmljZS5nZXRPcHRpb24oJ2xlZnRNYXBWaWV3ZXInLCAnc2hvd0xvYWRNYXBJbkxlZnQnLCB0cnVlKTtcbiAgICAgIFxuICAgIH1cblxuICAgIC8vIGluc3RhbnRpYXRlIGJhc2UgY29udHJvbGxlclxuICAgICRjb250cm9sbGVyKCdDUlVEQ29udHJvbGxlcicsIHtcbiAgICAgIHZtOiB2bSxcbiAgICAgIG1vZGVsU2VydmljZTogTWFwU2VydmljZSxcbiAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgc2VhcmNoT25Jbml0OiBmYWxzZSxcbiAgICAgICAgcGVyUGFnZTogMTFcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICAvKipcbiAgICAgKiBMaXN0ZW4gdG8gdGhlIHZpZXcgc3dpdGNoIGV2ZW50IGFuZCByZWxvYWQgdGhlIGRhdGFcbiAgICAgKiBmcm9tIHRoZSBiYWNrLWVuZCBpZiB0aGUgdGFyZ2V0IHZpZXcgaXMgdGhlIHRoZSBmb3JtXG4gICAgICovXG4gICAgJHJvb3RTY29wZS4kb24oJ3N3aXRjaGVkVmlldycsIGZ1bmN0aW9uIChldmVudCwgZGF0YSkge1xuICAgICAgaWYgKGRhdGEgPT09ICdmb3JtJykge1xuICAgICAgICB2bS5zZWFyY2godm0ucGFnaW5hdG9yLmN1cnJlbnRQYWdlKTtcbiAgICAgIH0gICAgICBcbiAgICB9KTtcblxuICAgICRyb290U2NvcGUuJG9uKCd2aWV3ZXJTaG93bicsIGZ1bmN0aW9uIChldmVudCwgdmlld2VySWQpIHtcbiAgICAgICAgaWYodmlld2VySWQgPT09ICdyaWdodE1hcFZpZXdlcicpIHtcbiAgICAgICAgICB2bS5zaG93TG9hZE1hcEluUmlnaHQgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZtLnNob3dMb2FkTWFwSW5MZWZ0ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0pOyAgICAgXG5cbiAgICAkcm9vdFNjb3BlLiRvbigndmlld2VySGlkZGVuJywgZnVuY3Rpb24gKGV2ZW50LCB2aWV3ZXJJZCkge1xuICAgICAgaWYodmlld2VySWQgPT09ICdyaWdodE1hcFZpZXdlcicpIHtcbiAgICAgICAgdm0uc2hvd0xvYWRNYXBJblJpZ2h0ID0gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2bS5zaG93TG9hZE1hcEluTGVmdCA9IGZhbHNlO1xuICAgICAgfSAgIFxuICAgIH0pO1xuXG4gICAgLy8gJHNjb3BlLiRvbignc2hvd09ubHlDaGlsZE1hcCcsIGZ1bmN0aW9uKG5ld1ZhbCwgb2xkVmFsKSB7XG4gICAgLy8gICBjb25zb2xlLmxvZyhcIj4+PiBzaG93T25seUNoaWxkTWFwID4+PiBcIiwgbmV3VmFsLCBvbGRWYWwpXG4gICAgLy8gICAvLyB2bS5zZWFyY2godm0ucGFnaW5hdG9yLmN1cnJlbnRQYWdlKTtcbiAgICAvLyB9KVxuICAgIC8qKlxuICAgICAqIEhlcmUgd2UgbGlzdGVuIHRvIHRoZSBhcHBseUZpbHRlcnMgY2FsbGJhY2sgdG8gYWRkIGN1c3RvbSBmaWx0ZXJzXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IGRlZmF1bHRRdWVyeUZpbHRlcnMgXG4gICAgICogQHJldHVybnMge31cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhcHBseUZpbHRlcnMoZGVmYXVsdFF1ZXJ5RmlsdGVycykgeyAgICAgXG4gICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLnF1ZXJ5RmlsdGVycykpICB7XG4gICAgICAgIHZtLnF1ZXJ5RmlsdGVycyA9IHt9O1xuICAgICAgfSAgICAgIFxuICAgICAgcmV0dXJuIGFuZ3VsYXIuZXh0ZW5kKGRlZmF1bHRRdWVyeUZpbHRlcnMsIHZtLnF1ZXJ5RmlsdGVycyk7XG4gICAgfSAgICBcblxuICAgIC8qKlxuICAgICAqIE1ha2Ugc29tZSBhZGp1c3RtZW50cyBpbiB0aGUgcmVzb3VyY2VzIGxpc3QgYWZ0ZXIgbG9hZGluZyB0aGVtXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IHJlc3BvbnNlIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGFmdGVyU2VhcmNoKHJlc3BvbnNlKSB7XG4gICAgICBsb2Rhc2gubWFwKHZtLnJlc291cmNlcywgZnVuY3Rpb24gKG1hcCkge1xuICAgICAgICBtYXAubWFwSW1hZ2VGaWxlID0gbWFwLm1hcF9pbWFnZV9maWxlO1xuICAgICAgICBtYXAubWFwVHlwZU5hbWUgPSBtYXAubWFwX3R5cGVfbmFtZTsgICAgICAgXG4gICAgICAgIHJldHVybiBtYXA7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAgLyoqXG4gICAgICogT3Blbi9jbG9zZSB0aGUgcmlnaHQgc2lkZSBuYXZcbiAgICAgKiBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB0b2dnbGVCb3R0b20oKXsgIFxuICAgICAgdm0uc2hvd0JvdHRvbU5hdiA9ICF2bS5zaG93Qm90dG9tTmF2OyBcbiAgICAgIGlmKHZtLnNob3dCb3R0b21OYXYgPT09IHRydWUpIHtcbiAgICAgICAgdm0ucGFnaW5hdG9yLmN1cnJlbnRQYWdlID0gKHZtLnBhZ2luYXRvci5jdXJyZW50UGFnZSA+IDApID8gdm0ucGFnaW5hdG9yLmN1cnJlbnRQYWdlIDogMTtcbiAgICAgICAgdm0uc2VhcmNoKHZtLnBhZ2luYXRvci5jdXJyZW50UGFnZSk7XG4gICAgICB9ICAgICAgICAgICBcbiAgICB9IFxuICAgIFxuICAgIC8qKlxuICAgICAqIEFkZC9yZW1vdmUgYSBtYXAgdG8gdGhlIHdvcmtpbmcgbGlzdFxuICAgICAqIFxuICAgICAqIEBwYXJhbSBvYmplY3QgcmVzb3VyY2UgXG4gICAgICovXG4gICAgZnVuY3Rpb24gdG9nZ2xlSW5jbHVkZVRvV29ya2luZ0xpc3QocmVzb3VyY2UsIHZpZXdlcklkKXtcbiAgICAgIHZhciB0b2dnbGVMb2FkTWFwID0gZnVuY3Rpb24oKXtcbiAgICAgICAgaWYgKGlzTG9hZGVkKHJlc291cmNlLCB2aWV3ZXJJZCkpe1xuICAgICAgICAgIE1hcExheWVyU2VydmljZS5yZW1vdmVNYXBMYXllcihyZXNvdXJjZSwgdmlld2VySWQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIE1hcExheWVyU2VydmljZS5hZGRNYXBMYXllcihyZXNvdXJjZSwgdmlld2VySWQpO1xuICAgICAgICB9XG4gICAgICB9ICBcbiAgICAgIC8vIENvbmZpcm0gYmVmb3JlIGxvYWRpbmcgbm9uIGdlb3JlZmVyZW5jZWQgbWFwICAgIFxuICAgICAgaWYoIWlzTG9hZGVkKHJlc291cmNlLCB2aWV3ZXJJZCkgJiYgcmVzb3VyY2UuZ2VvcmVmZXJlbmNlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgdmFyIGNvbmZpZyA9IHtcbiAgICAgICAgICB0aXRsZTogJHRyYW5zbGF0ZS5pbnN0YW50KCdkaWFsb2cuY29uZmlybUxvYWRVbmdlb3JlZmVyZW5jZWRUaXRsZScpLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2RpYWxvZy5Mb2FkVW5nZW9yZWZlcmVuY2VkRGVzY3JpcHRpb24nKSxcbiAgICAgICAgICB5ZXM6ICR0cmFuc2xhdGUuaW5zdGFudCgnZ2xvYmFsLnllcycpLFxuICAgICAgICAgIG5vOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2dsb2JhbC5ubycpXG4gICAgICAgIH1cbiAgICAgICAgQzJEaWFsb2cuY29uZmlybShjb25maWcpLnRoZW4oZnVuY3Rpb24gKCkgeyAgXG4gICAgICAgICAgdG9nZ2xlTG9hZE1hcCgpO1xuICAgICAgICAgIC8vIGxvb2sgZm9yIEdlb3JlZiBtYXBzIHdoaWNoIGFyZSBhc3NvY2lhdGVkIHRvIGN1cnJlbmN0bHkgbm9uZ2VvcmVmIGltYWdlXG4gICAgICAgICAgY2hlY2tBbGxHZW9SZWZNYXBzKHJlc291cmNlKTtcbiAgICAgICAgfSk7XG4gICAgICB9IFxuICAgICAgLy8gQ29uZmlybSBiZWZvcmUgbG9hZGluZyBnZW9yZWZlcmVuY2VkIG1hcCB3aGVuIGEgbm9uIGdlb3JlZmVyZW5jZWQgbWFwIGlzIGFscmVhZHkgbG9hZGVkICAgXG4gICAgICBlbHNlIGlmIChNYXBMYXllclNlcnZpY2UuaGFzTm9uR2VvcmVmZXJlbmNlZExheWVyKHZpZXdlcklkKSkge1xuICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgIHRpdGxlOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2RpYWxvZy5jb25maXJtTG9hZEdlb3JlZmVyZW5jZWRUaXRsZScpLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2RpYWxvZy5Mb2FkR2VvcmVmZXJlbmNlZERlc2NyaXB0aW9uJyksXG4gICAgICAgICAgeWVzOiAkdHJhbnNsYXRlLmluc3RhbnQoJ2dsb2JhbC55ZXMnKSxcbiAgICAgICAgICBubzogJHRyYW5zbGF0ZS5pbnN0YW50KCdnbG9iYWwubm8nKVxuICAgICAgICB9XG4gICAgICAgIEMyRGlhbG9nLmNvbmZpcm0oY29uZmlnKS50aGVuKGZ1bmN0aW9uICgpIHsgXG4gICAgICAgICAgTWFwTGF5ZXJTZXJ2aWNlLnJlbW92ZUFsbE1hcExheWVycyh2aWV3ZXJJZCk7XG4gICAgICAgICAgdG9nZ2xlTG9hZE1hcCgpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7IC8vIGluIHRoZSBvdGhlciBjYXNlcywgcnVuIGRpcmVjdGx5IHRoZSB0b2dnbGVMb2FkTWFwIHRvIHJlbW92ZT8vYWRkIGEgbWFwXG4gICAgICAgIHRvZ2dsZUxvYWRNYXAoKTtcbiAgICAgIH0gICAgIFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGNoZWNrIGlmIGEgbWFwIHJlc291cmNlIGlzIGFscmVhZHkgbG9hZGVkXG4gICAgICogXG4gICAgICogQHBhcmFtIG9iamVjdCByZXNvdXJjZSBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBpc0xvYWRlZChyZXNvdXJjZSwgdmlld2VySWQpe1xuICAgICAgdmFyIGlzTG9hZGVkID0gTWFwTGF5ZXJTZXJ2aWNlLmlzQWRkZWQocmVzb3VyY2UsIHZpZXdlcklkKTtcbiAgICAgIHJldHVybiBpc0xvYWRlZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBjaGVjayBpZiBjdXJyZW50IHBhZ2UgaXMgR2VvcmVmZXJlbmNlIGFuZCBpZiB0aGUgbWFwIHJlc291cmNlIGlzIG5vbmdlb3JlZmVyZW5jZWQgXG4gICAgICogdGhhbiBvbmx5IGFsbG93IHRoZSB1c2VyIHRvIGxvYWQgaXQgaW4gbGVmdCBtYXAgYW5kIGdlb3JlZmVyZW5jZWQgcmVzb3VyY2UgaW4gcmlnaHQgbWFwXG4gICAgICogXG4gICAgICogQHBhcmFtIG9iamVjdCByZXNvdXJjZSBcbiAgICAgKiBAcmV0dXJucyBib29sZWFuXG4gICAgICovXG4gICAgZnVuY3Rpb24gc2hvd0xvYWRNYXBJbkxlZnRCdXR0b24ocmVzb3VyY2UpIHtcbiAgICAgIGlmKCRzdGF0ZS5jdXJyZW50Lm5hbWUgPT09IFwiYXBwLmdlb3JlZmVyZW5jZVwiKSB7XG4gICAgICAgIGlmKCByZXNvdXJjZS5nZW9yZWZlcmVuY2VkPT09ZmFsc2UpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIGNoZWNrIGlmIGN1cnJlbnQgcGFnZSBpcyBHZW9yZWZlcmVuY2UgYW5kIGlmIHRoZSBtYXAgcmVzb3VyY2UgaXMgbm9uZ2VvcmVmZXJlbmNlZCBcbiAgICAgKiB0aGFuIG9ubHkgYWxsb3cgdGhlIHVzZXIgdG8gbG9hZCBpdCBpbiBsZWZ0IG1hcCBhbmQgZ2VvcmVmZXJlbmNlZCByZXNvdXJjZSBpbiByaWdodCBtYXBcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gb2JqZWN0IHJlc291cmNlIFxuICAgICAqIEByZXR1cm5zIGJvb2xlYW5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzaG93TG9hZE1hcEluUmlnaHRCdXR0b24ocmVzb3VyY2UpIHtcbiAgICAgIGlmKCRzdGF0ZS5jdXJyZW50Lm5hbWUgPT09IFwiYXBwLmdlb3JlZmVyZW5jZVwiKSB7XG4gICAgICAgIGlmKCByZXNvdXJjZS5nZW9yZWZlcmVuY2VkPT09dHJ1ZSkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2FsbGVkIHdoZW4gXCJMb2FkIEdDUCBvbiBNYXAgYnV0dG9uIGlzIGNsaWNrZWRcIlxuICAgICAqIFRyaWdnZXJzIGEgZXZlbnQgdG8gR2VvcmVmZXJlbmNlIGNvbnRyb2xsZXIgdG8gaGFuZGxlXG4gICAgICogXG4gICAgICogQHBhcmFtIG9iamVjdCByZXNvdXJjZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGxvYWRHY3BPbk1hcChyZXNvdXJjZSkge1xuICAgICAgLy8gY29uc29sZS5sb2coXCI+Pj4gbWFwLmJvdHRvbS5uYXYuY29udHJvbGxlciA+Pj4gbG9hZEdjcE9uTWFwXCIpO1xuICAgICAgaWYocmVzb3VyY2UuZ2VvcmVmZXJlbmNlZCkge1xuICAgICAgICBpZihyZXNvdXJjZS5nY3BzKSB7XG4gICAgICAgICAgLy8gYnJvYWRjYXN0IHRvIEdlb3JlZmVyZW5jZSBjb250cm9sbGVyIHRvIGNyZWF0ZSBtYXJrZXJzXG4gICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KFwiY3JlYXRlR2NwT25NYXBcIiwgSlNPTi5wYXJzZShyZXNvdXJjZS5nY3BzKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBjaGVja3MgaWYgTm9uR2VvcmVmZXJlbmNlZCBpbWFnZSBpcyBsb2FkZWQgaW4gbGVmdCBtYXBcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0gb2JqZWN0IHJlc291cmNlIFxuICAgICAqIEByZXR1cm5zIGJvb2xlYW4gXG4gICAgICovXG4gICAgZnVuY3Rpb24gaXNOb25HZW9yZWZMb2FkZWQocmVzb3VyY2UsIG1hcFZpZXdlcikge1xuICAgICAgaWYocmVzb3VyY2UuY2FuTG9hZEdjcCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPbmNlIGEgTm9uR2VvcmVmZXJlbmNlZCBpbWFnZSBpcyBsb2FkZWQsIGNoZWNrIGZvciBhbGwgR2VvcmVmZXJlbmNlZCBtYXBzIHRvIGtub3cgXG4gICAgICogd2hpY2ggYXJlIGFzc29jaWF0ZWQgdG8gaXQuIE9uY2Ugd2UgaGF2ZSB0aGUgbGlzdCBvZiBnZW9yZWYgbWFwcywgYWN0aXZhdGUgdGhlaXIgTG9hZCBHQ1AgYnV0dG9uXG4gICAgICogXG4gICAgICogQHBhcmFtIG9iamVjdCByZXNvdXJjZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNoZWNrQWxsR2VvUmVmTWFwcyhyZXNvdXJjZSkge1xuICAgICAgdmFyIGZpbGVOYW1lID0gcmVzb3VyY2UubWFwX2ltYWdlX2ZpbGUubmFtZTtcbiAgICAgIGlmKGZpbGVOYW1lLnNwbGl0KCcuJykgIT09IC0xKSB7XG4gICAgICAgIC8vIGxldCB0aGUgY2hlY2tib3ggYmUgdmlzaWJsZSBmb3IgdGhlIHVzZXIgdG8gZmlsdGVyXG4gICAgICAgIHZtLnNob3dGaWx0ZXJDaGVja2JveCA9IHRydWU7XG4gICAgICAgIGZpbGVOYW1lID0gZmlsZU5hbWUuc3BsaXQoJy4nKS5zbGljZSgwLCAtMSkuam9pbignLicpO1xuICAgICAgICAvLyBsb29wIHRocm91Z2ggYWxsIHRoZSByZXNvdXJjZXNcbiAgICAgICAgbG9kYXNoLmZvckVhY2godm0ucmVzb3VyY2VzLCBmdW5jdGlvbihlYWNoUmVzb3VyY2UpIHtcbiAgICAgICAgICBpZihlYWNoUmVzb3VyY2UuZ2VvcmVmZXJlbmNlZCkge1xuICAgICAgICAgICAgdmFyIHRlbXBJbWFnZU5hbWUgPSBlYWNoUmVzb3VyY2UubWFwX2ltYWdlX2ZpbGUubmFtZTtcbiAgICAgICAgICAgIHRlbXBJbWFnZU5hbWUgPSB0ZW1wSW1hZ2VOYW1lLnNwbGl0KCdfcmVjdCcpLnNsaWNlKDAsIC0xKS5qb2luKCdfcmVjdCcpO1xuICAgICAgICAgICAgaWYodGVtcEltYWdlTmFtZSA9PT0gZmlsZU5hbWUpIHtcbiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJlYWNoUmVzb3VyY2VzID0gXCIsIGVhY2hSZXNvdXJjZSk7XG4gICAgICAgICAgICAgIGVhY2hSZXNvdXJjZS5jYW5Mb2FkR2NwID0gdHJ1ZTtcbiAgICAgICAgICAgICAgZWFjaFJlc291cmNlLmlzQ2hpbGRPZkxvYWRlZE5vbmdlb3JlZiA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBlYWNoUmVzb3VyY2UuY2FuTG9hZEdjcCA9IGZhbHNlO1xuICAgICAgICAgICAgICBlYWNoUmVzb3VyY2UuaXNDaGlsZE9mTG9hZGVkTm9uZ2VvcmVmID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZWFjaFJlc291cmNlLmlzQ2hpbGRPZkxvYWRlZE5vbmdlb3JlZiA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhcImZpbGUgZG9lc250IGhhdmUgZXh0ZW5zaW9uXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzQ2hpbGRNYXAocmVzb3VyY2UpIHtcbiAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLnNob3dPbmx5Q2hpbGRNYXApKSB7XG4gICAgICAgIGlmKHZtLnNob3dPbmx5Q2hpbGRNYXApIHtcbiAgICAgICAgICBpZihyZXNvdXJjZS5pc0NoaWxkT2ZMb2FkZWROb25nZW9yZWYpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgZnVuY3Rpb24gc2hvd09ubHlDaGlsZE1hcEZ1bmMoKSB7XG4gICAgICBpZih2bS5zaG93T25seUNoaWxkTWFwKSB7XG4gICAgICAgIC8vIGdldCBjdXJyZW50bHkgbG9hZGVkIHJlc291cmNlXG4gICAgICAgIHZhciByZXNvdXJjZSA9IE1hcExheWVyU2VydmljZS5nZXRWaWV3ZXJPdmVybGF5cygnbGVmdE1hcFZpZXdlcicpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcInJlc291cmNlID0gXCIsIHJlc291cmNlKTtcbiAgICAgICAgLy8gY29uc29sZS5sb2coT2JqZWN0LnZhbHVlcyhyZXNvdXJjZSlbMF0ucmVzb3VyY2UubWFwX3NvdXJjZV9pZCk7XG4gICAgICAgIHZhciB0ZW1wTWFwSWQgPSBPYmplY3QudmFsdWVzKHJlc291cmNlKVswXS5yZXNvdXJjZS5tYXBfc291cmNlX2lkO1xuICAgICAgICAvLyBjcmVhdGUgYSBmaWx0ZXJcbiAgICAgICAgdm0ucXVlcnlGaWx0ZXJzID0geyBcInBhcmVudF9pZFwiIDogdGVtcE1hcElkIH07XG4gICAgICAgIC8vIGNhbGwgYXBwbHlGaWx0ZXIsIHdoaWNoIHdpbGwgdGFrZSBjYXJlIG9mIHJlc3RcbiAgICAgICAgdm0uc2VhcmNoKHZtLnBhZ2luYXRvci5jdXJyZW50UGFnZSk7XG4gICAgICAgIGFmdGVyU2VhcmNoKFwicmVzcG9uc2VcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2bS5xdWVyeUZpbHRlcnMgPSBudWxsO1xuICAgICAgICB2bS5zZWFyY2godm0ucGFnaW5hdG9yLmN1cnJlbnRQYWdlKTtcbiAgICAgICAgYWZ0ZXJTZWFyY2goXCJyZXNwb25zZVwiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgfVxuXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdhcHAnKVxuICAgIC5jb250cm9sbGVyKCdNYXBSaWdodFNpZGVuYXZDb250cm9sbGVyJywgTWFwUmlnaHRTaWRlbmF2Q29udHJvbGxlcik7XG5cbiAgLyoqIEBuZ0luamVjdCAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuICBmdW5jdGlvbiBNYXBSaWdodFNpZGVuYXZDb250cm9sbGVyKCRzY29wZSwgJHRpbWVvdXQsICRtZFNpZGVuYXYsICRsb2csICRyb290U2NvcGUsIE1hcExheWVyU2VydmljZSwgbG9kYXNoLCAkd2luZG93KSB7XG5cbiAgICB2YXIgdm0gPSB0aGlzO1xuICAgIHZtLmNsb3NlID0gY2xvc2U7XG4gICAgdm0uc2hvd01hcCA9IHNob3dNYXA7XG4gICAgdm0uaGlkZU1hcCA9IGhpZGVNYXA7XG4gICAgdm0ucmVtb3ZlTWFwID0gcmVtb3ZlTWFwO1xuICAgIHZtLmFwcGx5T3BhY2l0eSA9IGFwcGx5T3BhY2l0eTtcbiAgICB2bS5maXRNYXBCb3VuZHMgPSBmaXRNYXBCb3VuZHM7XG4gICAgdm0uZmlsdGVyTWFwTGF5ZXJzID0gZmlsdGVyTWFwTGF5ZXJzO1xuXG4gICAgLyoqXG4gICAgICogUnVuIHRoZSBpbml0aWFsIGFjdGlvbnMgd2hlbiB0aGUgY29udHJvbGxlciBpcyBhY3RpdmF0ZWRcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgICAgIHJlZnJlc2hPdmVybGF5cygpO1xuICAgICAgdm0uc29ydGFibGVDb25mID0ge29uVXBkYXRlOiB1cGRhdGVBZnRlclNvcnQsIGhhbmRsZTogJy5ncmFiLWhhbmRsZSd9O1xuICAgIH1cblxuICAgXG4gICAgXG5cbiAgICAvKipcbiAgICAgKiBDbG9zZSB0aGUgc2lkZW5hdlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGNsb3NlKCkgeyAgICAgXG4gICAgICAkbWRTaWRlbmF2KCdyaWdodCcpLmNsb3NlKClcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgIC8vIHlvdSBjYW4gYWRkIHNvbWUgdGFzayBhZnRlciBjbG9zaW5nXG4gICAgICAgIH0pO1xuICAgIH07IFxuICAgIFxuICAgIC8qKlxuICAgICAqIFNob3cgYSBtYXAgYWxyZWFkeSBsb2FkZWQgaW4gdGhlIHZpZXdlclxuICAgICAqIEBwYXJhbSB7fSBsYXllciBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzaG93TWFwKGxheWVyKSB7XG4gICAgICBNYXBMYXllclNlcnZpY2Uuc2hvd01hcChsYXllci5yZXNvdXJjZSwgbGF5ZXIudmlld2VySWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhpZGUgYSBtYXAgYWxyZWFkeSBsb2FkZWQgaW4gdGhlIHZpZXdlclxuICAgICAqIEBwYXJhbSB7fSBsYXllciBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBoaWRlTWFwKGxheWVyKSB7XG4gICAgICBNYXBMYXllclNlcnZpY2UuaGlkZU1hcChsYXllci5yZXNvdXJjZSwgbGF5ZXIudmlld2VySWQpO1xuICAgIH0gXG4gICAgXG4gICAgLyoqXG4gICAgICogUmVtb3ZlICh1bmxvYWQpIGEgbWFwIGZyb20gdGhlIHZpZXdlclxuICAgICAqIEBwYXJhbSB7fSBsYXllciBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiByZW1vdmVNYXAobGF5ZXIpIHtcbiAgICAgIE1hcExheWVyU2VydmljZS5yZW1vdmVNYXBMYXllcihsYXllci5yZXNvdXJjZSwgbGF5ZXIudmlld2VySWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpdCB0aGUgYm91bmRzIG9mIGFuIGFscmVhZHkgbG9hZGVkIG1hcCBzbyB0aGUgdGhhdCBhbGwgdGhlIG1hcCBpcyB2aXNpYmxlXG4gICAgICogQHBhcmFtIHt9IGxheWVyIFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZpdE1hcEJvdW5kcyhsYXllcikge1xuICAgICAgTWFwTGF5ZXJTZXJ2aWNlLmZpdE1hcEJvdW5kcyhsYXllci5yZXNvdXJjZSwgbGF5ZXIudmlld2VySWQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEFwcGx5IHRoZSBvcGFjaXR5IGRlZmluZWQgaW4gdGhlIGxheWVyLmxheWVyUGFyYW1zLm9wYWNpdHkgcHJvcGVydHlcbiAgICAgKiBAcGFyYW0ge30gbGF5ZXIgXG4gICAgICovXG4gICAgZnVuY3Rpb24gYXBwbHlPcGFjaXR5KGxheWVyKSB7XG4gICAgICBNYXBMYXllclNlcnZpY2UuYXBwbHlPcGFjaXR5KGxheWVyKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaWx0ZXIgdGhlIG1hcCBsYXllcnMgbG9hZGVkIGluIHRoZSB2aWV3ZXIgYnkgbmFtZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGZpbHRlck1hcExheWVycygpe1xuICAgICAgcmVmcmVzaE92ZXJsYXlzKCk7XG4gICAgICB2bS5sb2FkZWRNYXBzTGF5ZXJzID0gbG9kYXNoLmZpbHRlcih2bS5sb2FkZWRNYXBzTGF5ZXJzLCBmdW5jdGlvbihsYXllcil7XG4gICAgICAgIHJldHVybiBsYXllci5yZXNvdXJjZS50aXRsZS50b0xvd2VyQ2FzZSgpLmluZGV4T2Yodm0uZmlsdGVyTWFwTGF5ZXJzVHh0LnRvTG93ZXJDYXNlKCkpICE9IC0xOyAgICAgICBcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJlZnJlc2ggdGhlIG1hcHMgbGF5ZXJzIGluIHRoZSBzaWRlYmFyIGxpc3Qgd2hlbiB0aGUgbWFwTGF5ZXJzQ2hhbmdlZCBldmVudCBpcyBicm9hZGNhc3RlZFxuICAgICAqL1xuICAgICRyb290U2NvcGUuJG9uKCdtYXBMYXllcnNDaGFuZ2VkJywgZnVuY3Rpb24gKGV2ZW50KSB7ICBcbiAgICAgIHJlZnJlc2hPdmVybGF5cygpOyAgICAgIFxuICAgIH0pOyBcbiAgICBcbiAgICAvKipcbiAgICAgKiBSZWZyZXNoIHRoZSBvdmVybGF5cyBpbiB0aGUgcHJvcGVydHkgbG9hZGVkTWFwc0xheWVycyBnZXR0aW5nIGl0IGZyb20gTWFwTGF5ZXJTZXJ2aWNlXG4gICAgICogXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmVmcmVzaE92ZXJsYXlzKCl7XG4gICAgICAvLyBpbml0aWFsbHkgZGVmaW5lIHRoZSBvdmVybGF5cyBhcyBhbiBlbXB0eSBhcnJheVxuICAgICAgdm0ubG9hZGVkTWFwc0xheWVycyA9IFtdO1xuICAgICAgICBcbiAgICAgIC8vIEFzIHdlIHdhbnQgdG8gbGlzdCBhbGwgdGhlIGxheWVycywgdGhlbiBnZXQgdGhlIGxheWVycyBmcm9tIGJvdGggdmlld2Vyc1xuICAgICAgdmFyIHJpZ2h0TGF5ZXJzID0gTWFwTGF5ZXJTZXJ2aWNlLmdldFZpZXdlck92ZXJsYXlzKCdyaWdodE1hcFZpZXdlcicpO1xuICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQocmlnaHRMYXllcnMpKXtcbiAgICAgICAgYW5ndWxhci5mb3JFYWNoKHJpZ2h0TGF5ZXJzLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgdmFsdWUuaWQgPSBrZXk7XG4gICAgICAgICAgdm0ubG9hZGVkTWFwc0xheWVycy5wdXNoKHZhbHVlKTtcbiAgICAgICAgfSk7ICAgICAgIFxuICAgICAgfVxuICAgICAgXG4gICAgICB2YXIgbGVmdExheWVycyA9IE1hcExheWVyU2VydmljZS5nZXRWaWV3ZXJPdmVybGF5cygnbGVmdE1hcFZpZXdlcicpO1xuICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQobGVmdExheWVycykpe1xuICAgICAgICBhbmd1bGFyLmZvckVhY2gobGVmdExheWVycywgZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgICAgICAgIHZhbHVlLmlkID0ga2V5O1xuICAgICAgICAgIHZtLmxvYWRlZE1hcHNMYXllcnMucHVzaCh2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBcbiAgICAgIC8vIFRoZSBsYXllcnMgbXVzdCBiZSBzaG93IGluIHJldmVyc2Ugb3JkZXIgKGxhc3QgYWRkZWQgb24gdGhlIHRvcClcbiAgICAgIHZtLmxvYWRlZE1hcHNMYXllcnMgPSB2bS5sb2FkZWRNYXBzTGF5ZXJzLnNsaWNlKCkucmV2ZXJzZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEhhbmRsZSB0aGUgcmVvcmRlci9zb3J0IGV2ZW50IGFuZCBhcHBseSBpdCB0byB0aGUgTWFwTGF5ZXJTZXJ2aWNlXG4gICAgICogXG4gICAgICogQHBhcmFtIHthbnl9IGV2dCBcbiAgICAgKi9cbiAgICBmdW5jdGlvbiB1cGRhdGVBZnRlclNvcnQoZXZ0KXsgICAgICBcbiAgICAgIE1hcExheWVyU2VydmljZS5hcHBseVJlb3JkZXIoZXZ0Lm1vZGVscyk7ICAgICAgXG4gICAgfVxuXG4gICAgYWN0aXZhdGUoKTtcbiAgfVxuXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
